<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"helongquan.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="日记">
<meta property="og:type" content="website">
<meta property="og:title" content="鸢尾花序">
<meta property="og:url" content="https://helongquan.github.io/page/26/index.html">
<meta property="og:site_name" content="鸢尾花序">
<meta property="og:description" content="日记">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="泉哥">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://helongquan.github.io/page/26/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>鸢尾花序</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">鸢尾花序</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2018/02/03/%E9%87%87%E7%94%A8.htaccess%E5%92%8C.htpasswd%E4%B8%BAwordpress%E5%92%8Cmagento%E7%BD%91%E7%AB%99%E8%AE%BE%E7%BD%AE%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/02/03/%E9%87%87%E7%94%A8.htaccess%E5%92%8C.htpasswd%E4%B8%BAwordpress%E5%92%8Cmagento%E7%BD%91%E7%AB%99%E8%AE%BE%E7%BD%AE%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/" class="post-title-link" itemprop="url">采用.htaccess和.htpasswd为wordpress和magento网站设置访问控制</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-02-03 16:13:11" itemprop="dateCreated datePublished" datetime="2018-02-03T16:13:11+08:00">2018-02-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:06" itemprop="dateModified" datetime="2020-10-11T11:53:06+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在笔者开始使用magento创建一个商城网站的时候，在开发过程中，客户提出这么一个需求，说能否对网站加一个密码，知道账号密码的人才可以访问，在知道这个需求的时候，我没有实现过，我知道magento的后台中在System—Permissions那里可以创建用户，然后创建角色，不同角色访问的内容不一样，这样我们创建账号的时候，就可以给账号分配角色了，最后达到访问控制的问题，这个看起来不难，熟悉这个系统的人没有难度。</p>
<p>可是，问题在于对整个网站加一个账号，或者是对部分资源添加一个访问控制，这个时候倒是对笔者有点难度，于是决定着手解决这个问题。下面是步骤以及实施这个步骤的思路。</p>
<p>思路：采用.htaccess和.htpasswd为网站进行访问控制。</p>
<p>方案确定好了后，我们就来开始吧</p>
<p>首先，新建一个.htaccess在网站根目录下（如果你是想对整个网站设置访问控制的话），内容如下：</p>
<pre><code>AuthName &quot;Restricted Area&quot; 
AuthType Basic 
AuthUserFile /wwwroot/webroot/www.mydomain.com/.htpasswd    //这个是我网站在服务器上的根目录地址
AuthGroupFile /dev/null 
require valid-user</code></pre>
<p>这里最重要的地方就在这里 AuthUserFile，这个地址要写对，不然会出错的，到时候网站访问不了。这个我是用工具生成的，地址：<a target="_blank" rel="noopener" href="http://tools.dynamicdrive.com/password/">http://tools.dynamicdrive.com/password/</a></p>
<p>大家可以去这里生成，最开始我在本地服务器测试，死活不行，后面我索性在线上进行测试，失败的原因可能是我写的地址不对。</p>
<p>如果上面的步骤完成无误后，我们新建一个文件.htpasswd，添加的内容如下：</p>
<pre><code>zhangsan:YGLajNUF9sQ8c</code></pre>
<p>这个是密码，这个是加密后的状态，到时候输入的密码是我们设置的那个密码，为了安全，这个文件要放在一个不能被外部访问的路径下，这里为了测试，我就直接放在了根目录下。</p>
<p><img src="https://i.imgur.com/NK5JzXN.jpg"></p>
<p>看起来是这样的，最开始我是在magento里面测试的，然后就把这两个文件放在了根目录下，不是主题目录哦，这个要区分。由于magento原本就已经有了一个.htaccess，所以在这个文件里追加代码</p>
<pre><code>AuthName &quot;Restricted Area&quot; 
AuthType Basic 
AuthUserFile /wwwroot/webroot/www.mydomain.com/.htpasswd    //这个是我网站在服务器上的根目录地址
AuthGroupFile /dev/null 
require valid-user</code></pre>
<p>进去即可。</p>
<p>好的，准备好了之后，我们访问我们的网站：<a href="http://www.mydomain.com，不出意外的话，应该是这样的：">http://www.mydomain.com，不出意外的话，应该是这样的：</a></p>
<p><img src="https://i.imgur.com/LWzV1xO.jpg"></p>
<p>然后输入账号密码，如果正确的话将会访问到我们想要访问的页面，否则，将会报错。</p>
<p>好的，为了进一步的运用，笔者也把这个方案用在wordpress的网站上，效果是一样的，因此这个应该跟是哪个系统关系不大，由于我这个使用的是apache服务器，至于其他的服务器是否是这个文件，我们可以去网上搜索下方案，思路是一样的，文件可能不一样。</p>
<p>这个时候我们再往前走一步，就是通过这个策略进行IP访问控制，如果是国内的则不让访问，或者不是国内的不让访问，等等规则，这种情况在外贸圈里面非常常见。</p>
<p>那么，如何处理这个需求呢，我们可以对.htaccess进行修改，修改示例如下：</p>
<pre><code>AuthName &quot;Restricted Area&quot; 
AuthType Basic 
AuthUserFile /wwwroot/webroot/www.mydomain.com/.htpasswd    //这个是我网站在服务器上的根目录地址
AuthGroupFile /dev/null 
require valid-user
Order Allow,Deny
Allow from all
deny from 1.12.0.0/14
deny from 1.24.0.0/13
deny from 223.255.0.0/17</code></pre>
<p>我们对比一下，这个跟上面按个就多了一些IP地址。</p>
<p>deny from 1.12.0.0/14<br>这是禁止IP访问的路径</p>
<p>下面这里填写的是禁止中国IP访问的集合</p>
<p>中国最新IP提取，请到网站提取</p>
<p><a target="_blank" rel="noopener" href="http://ipinfodb.com/ip_country_block.php">http://ipinfodb.com/ip_country_block.php</a></p>
<p>提取的IP填写到下面屏蔽的地方即可！</p>
<p>下面就是开始测试这个是否好用，在浏览器访问这个网址，也就是中国的IP，看看是否被禁止，需要填写密码访问，然后填写上密码是否是通过，然后使用vpn代理访问，看看是否需要密码，如果没有达到自己的要求，就是上面设置错了！OK，完毕！</p>
<p>附：Magento网站不让中文浏览器访问的访问，这个作为文章的补充而写的。</p>
<p>做外贸的人大部分不希望同行查看自己的网站，一般会通过屏蔽中文浏览器，屏蔽中国IP，屏蔽中文操作系统，强创网络这里介绍的是如何实现ZenCart,Magento系统屏蔽中文浏览器，其实很简单，通过几行代码就可以轻松解决该问题。<br>注：其实要看你网站的人，可以有很多方法，他也可以安装英文浏览器、VPN代理访问、安装英文操作系统，只是说这样加大同行查看网站的难度。</p>
<p>1.通过JS代码屏蔽中文浏览器</p>
<pre><code>&lt;script type=&quot;text/javascript&quot;&gt;// &lt;![CDATA[
    if (navigator.language)
    var language = navigator.language;
    else
    var language = navigator.browserLanguage;
    if(language.indexOf(&#39;zh&#39;) &gt; -1)document.location.href =&#39;http://www.mydomain.com&#39;;
    // ]]&gt;
&lt;/script&gt;</code></pre>
<p>复制代码把以上代码插入到网站的标签内，这个我们可以放在magento的网站根目录下的index.php文件中，我的添加如下：</p>
<p><img src="https://i.imgur.com/g0gCoPA.png"></p>
<p>2.通过.htaccess屏蔽中文浏览器</p>
<pre><code>RewriteCond %&#123;HTTP:Accept-Language&#125; ^zh-cn.*$ [NC]
RewriteRule ^/?$ http://www.mydomain.com [R=301,L]</code></pre>
<p>复制代码以上代码添加到网站根目录的.htaccess文件中。 </p>
<p>这样的效果就是，如果是中文的浏览器，或者是中文的操作系统，那么当访问目标网站的时候，就会重定向到<a target="_blank" rel="noopener" href="http://www.mydomain.com这个网站中./">http://www.mydomain.com这个网站中。</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2018/02/03/magento1-9-market-connect%E6%8F%92%E4%BB%B6%E9%93%BE%E6%8E%A5%E5%A4%A7%E5%85%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/02/03/magento1-9-market-connect%E6%8F%92%E4%BB%B6%E9%93%BE%E6%8E%A5%E5%A4%A7%E5%85%A8/" class="post-title-link" itemprop="url">magento1.9 market connect插件链接大全</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-02-03 11:18:19" itemprop="dateCreated datePublished" datetime="2018-02-03T11:18:19+08:00">2018-02-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:57:58" itemprop="dateModified" datetime="2020-10-11T11:57:58+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/magento1/" itemprop="url" rel="index"><span itemprop="name">magento1</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>对于插件这块，首先我是在marketplace里面下载一些免费的，或者是收费的，然后登录自己的账号就可以进去下载或者安装，安装的时候会有一个链接，把链接粘贴到magento的connect manager里面安装即可。</p>
<p>这里粘贴一些常用插件：</p>
<p>1.删除订单：BoutikCircus_DeleteOrders</p>
<pre><code>URL：http://www.magentocommerce.com/extension/specs/4562/em_deleteorder</code></pre>
<p>另一个同类插件：</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/Wyomind/extension/6029/wyomind_orderseraser</code></pre>
<p>2.后台管理产品显示图片：TBT_Enhancedgrid</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/WDCA/extension/748/enhanced-product-grid
KEY：magento-community/TBT_Enhancedgrid</code></pre>
<p>3.订单加备注：Customer Order Comment</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/TanRambun/extension/1036/customer-order-comment
KEY：magento-community/Biebersdorf_CustomerOrderComment</code></pre>
<p>4.产品图片放大：Magento jqZoom</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/satrun77/extension/1492/magento-jqzoom/
KEY：magento-community/Safitech_Catalog</code></pre>
<p>另一个插件：IG LightBox 插件</p>
<pre><code>URL1：http://www.magentocommerce.com/magento-connect/IDEALIAGroup/extension/1843/ig-lightbox
URL2：http://www.magentocommerce.com/magento-connect/themes/ig-lightbox.html
KEY：magento-community/IG_LightBox</code></pre>
<p>另一个插件：Cueblocks Zoom</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/CueBlocks.com/extension/5367/cueblocks_zoom</code></pre>
<p>5.批量修改相关产品：Mass Product Relater</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/WDCA/extension/549/mass-product-relater
KEY：magento-community/Mass_Product_Relater</code></pre>
<p>6.官方简体中文语言包：</p>
<pre><code>URL1：http://www.magentocommerce.com/magento-connect/catalog/product/view/id/10320/s/magento-chinese-translation-3408/

URL2：http://www.magentocommerce.com/magento-connect/magento-community-modules-traditional-chinese-taiwan-language-pack.html</code></pre>
<p>7.Advanced Smtp ( 需要 php_openssl.dll 的支持 )</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/ziq2004/extension/460/advanced-smtp--artson.it
KEY：magento-community/ArtsOnIT_AdvancedSmtp</code></pre>
<p>8.IP 访问控制</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/niro/extension/6105/et_ipsecurity</code></pre>
<p>9.Magento Easy Lightbox</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/TemplatesMaster/extension/1487/magento-easy-lightbox
KEY：magento-community/magento_easy_lightbox</code></pre>
<p>10.MW_DeveloperToolbar ( 感谢 ERIC 提供 )</p>
<pre><code>URL：http://www.magentocommerce.com/module/2271/developer-toolbar
KEY：magento-community/HM_DeveloperToolbar</code></pre>
<p>11.Import Products categories, multiple images and custom options</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/capacitywebsolutions/extension/4421/import_products_categories__multiple_images_and_custom_options
KEY：magento-community/Import_Products_categories__multiple_images_and_custom_options</code></pre>
<p>另一个导入产品的插件：</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/sunit99/extension/3742/productimport</code></pre>
<p>12.Magento Social Bookmarking Services</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/_Fluxe/extension/2333/magento-social-bookmarking
KEY：magento-community/Magentix_SocialBookmarking</code></pre>
<p>13.Scheduled Products ( 定时激活禁用产品/限时购买插件 )</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/EcommerceDeveloper/extension/3782/ecomdev_scheduledproduct</code></pre>
<p>14.Magento EasyTabs</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/TemplatesMaster/extension/1725/magento-easytabs</code></pre>
<p>15.MailChimp Email 发送平台同步集成</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/ebizmarts/extension/1208/ebizmarts-mail-chimp-module</code></pre>
<p>16.Maintenance Page 网店离线</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/ziq2004/extension/523/maintenance-page--artson.it</code></pre>
<p>17.Magento 团购插件</p>
<pre><code>URL：https://www.magentocommerce.com/magento-connect/Zizio/extension/6378/ziziogroupsale</code></pre>
<p>18.验证码插件</p>
<pre><code>URL：http://www.magentocommerce.com/module/1169/fontis-recaptcha</code></pre>
<p>19.产品列表字母排序产品插件</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/vivek291186/extension/5338/alphabates</code></pre>
<p>20.免费团购插件</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/Zizio/extension/6378/ziziogroupsale</code></pre>
<p>21.清理无用的图片插件</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/defcon2/extension/1147/image-clean
KEY：magento-community/Mage_Imaclean</code></pre>
<p>22.分类产品随机关联</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/Open+Biz+Ltd/extension/4070/openbiz_randomrelatedproducts</code></pre>
<p>23.顾客登陆重定向</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/MagePsycho/extension/3763/custom_login_redirect</code></pre>
<p>25.回收站插件</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/_Fluxe/extension/2592/magento-recycle-bin
KEY：magento-community/Magentix_RecycleBin</code></pre>
<p>26.客户推荐插件</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/FrenchStallion/extension/1296/referrals</code></pre>
<p>27.产品展示到 Facebook</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/Turnkeye.com/extension/6131/facebook_products_tab</code></pre>
<p>28.超级菜单</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/Raptor+Commerce/extension/6081/supermenu_community_edition</code></pre>
<p>第三方：<a target="_blank" rel="noopener" href="http://web-experiment.info/webandpeople-custom-menu-extension.html">http://web-experiment.info/webandpeople-custom-menu-extension.html</a></p>
<p>29.给自定义项加描述</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/aijko_GmbH/extension/2678/custom-option-description</code></pre>
<p>30.电子邮件插件</p>
<pre><code>http://connect20.magentocommerce.com/community/ASchroder_SMTPPro</code></pre>
<p>31.自定义分层导航风格</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/custom-layered-navigation-style.html
KEY2：http://connect20.magentocommerce.com/community/Custom_Layered_Navigation
KEY1：magento-community/Custom_Layered_Navigation</code></pre>
<p>32.移动管理插件</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/customer-experience/mobile/mobileadmin-7554.html
KEY：http://connect20.magentocommerce.com/community/snm_mobileadminc</code></pre>
<p>33.关联产品管理 自动设置交叉、热卖、相关产品</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/related-proudcts-manager-7301.html
KEY：http://connect20.magentocommerce.com/community/CommerceStack_Recommender</code></pre>
<p>34.简单评论模板插件</p>
<pre><code>URL： http://www.magentocommerce.com/magento-connect/site-management/order-management/easycomments-3534.html
KEY1：magento-community/EasyComments
KEY2：http://connect20.magentocommerce.com/community/EasyComments</code></pre>
<p>35.退货插件</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/site-management/order-management/returnslink-rma-2707.html
KEY2：http://connect20.magentocommerce.com/community/ReturnsLink</code></pre>
<p>36.Magento 移动插件</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/magento-mobile-6497.html
KEY1：magento-core/Magento_Mobile
KEY2：http://connect20.magentocommerce.com/community/Magento_Mobile</code></pre>
<p>37.Magento 博客插件</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/blog-community-edition.html
KEY1：magento-community/AW_Blog
KEY2：http://connect20.magentocommerce.com/community/AW_Blog</code></pre>
<p>38.自定项友好切换插件</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/gala-color-swatches-free-9787.html
KEY1：magento-community/Gala_Colorswatches
KEY2：http://connect20.magentocommerce.com/community/Gala_Colorswatches</code></pre>
<p>39.导入产品关联，交叉销售，热卖推荐关系 ( ERIC 分享 )</p>
<pre><code>URL：http://www.magentocommerce.com/magento-connect/itib-mass-import-product-relations-upsell-and-cross-sell.html
KEY2: http://connect20.magentocommerce.com/community/ITIB_MassImportProductRelations
KEY1: magento-community/ITIB_MassImportProductRelations</code></pre>
<p>40.商品按库存排序</p>
<pre><code>URL： http://www.magentocommerce.com/magento-connect/customer-experience/category-product-page-enhancements/sort-products-by-stock-status-9821.html
KEY2：http://connect20.magentocommerce.com/community/Rayfox_Catalog</code></pre>
<p>41.magento1.x的FAQ插件</p>
<pre><code>https://connect20.magentocommerce.com/a44e6839a8292747b8add296620e10dd/tarunvishnoi+tv_faq_new-0.1.8</code></pre>
<p>42.magento1.x的法语语言安装包</p>
<pre><code>http://connect20.magentocommerce.com/community/Locale_Mage_community_fr_FR</code></pre>
<p>43.magento免费插件设置快递运费表</p>
<pre><code>http://connect20.magentocommerce.com/community/Auctionmaid_Matrxrate</code></pre>
<p><strong>这里列出magento常用的几种语言包下载</strong></p>
<p>列出一些Magento 1.5以上常用的语言包，方便自己也方便大家使用，安装语言包其实很简单，在Magento连接器中输入相应语言包的key，然后选安装就可以了。（后续会增加） </p>
<pre><code>简体中文： http://connect20.magentocommerce.com/community/Locale_Mage_community_zh_CN 

德国德语 http://connect20.magentocommerce.com/community/Locale_Mage_community_de_DE 

法国法语： http://connect20.magentocommerce.com/community/Locale_Mage_community_fr_FR 

丹麦语： http://connect20.magentocommerce.com/community/Locale_Mage_community_da_DK 

挪威语： http://connect20.magentocommerce.com/community/Locale_Mage_community_nb_NO 

西班牙语： http://connect20.magentocommerce.com/community/Locale_Mage_community_es_ES 

葡萄牙语： http://connect20.magentocommerce.com/community/Locale_Mage_community_pt_BR 

瑞典语： http://connect20.magentocommerce.com/community/Locale_Mage_community_sv_SE 

芬兰语： http://connect20.magentocommerce.com/community/Locale_Mage_community_fi_FI 

俄罗斯语： http://connect20.magentocommerce.com/community/Locale_Mage_community_ru_RU 

日语: http://connect20.magentocommerce.com/community/Locale_Mage_community_ja_JP 

捷克语： http://connect20.magentocommerce.com/community/Locale_Mage_community_cs_CZ 

希腊语： http://connect20.magentocommerce.com/community/Locale_Mage_community_el_GR 

意大利语： http://connect20.magentocommerce.com/community/Locale_Mage_community_it_IT 

阿拉伯语（沙特阿拉伯，另外还有科威特，埃及阿拉伯语）： http://connect20.magentocommerce.com/community/Locale_Mage_community_ar_SA 

繁体中文： http://connect20.magentocommerce.com/community/Locale_Mage_community_zh_TW</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2018/01/18/%E5%90%84%E7%A7%8D%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85magento%E7%9A%84%E5%90%84%E7%A7%8D%E7%89%88%E6%9C%AC%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/18/%E5%90%84%E7%A7%8D%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85magento%E7%9A%84%E5%90%84%E7%A7%8D%E7%89%88%E6%9C%AC%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">各种方式安装magento的各种版本详解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-01-18 14:11:33" itemprop="dateCreated datePublished" datetime="2018-01-18T14:11:33+08:00">2018-01-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:03" itemprop="dateModified" datetime="2020-10-11T11:53:03+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>今天来跟大家分享下如何安装magento，这个东西在中国用户比较少，国外比较多，但是对于那些想要搭建商城的用户来说，是一个好的选择方案，但是使用成本会很高。</p>
<p>我要分享的有如下：</p>
<p><strong>magneto的安装方式</strong></p>
<ol>
<li>命令方式安装</li>
<li>源码方式安装</li>
<li>在线方式安装（暂且这样说）</li>
</ol>
<p><strong>版本：magento1.x和magento2.x</strong></p>
<p>分别介绍这两种版本的不同安装方式。</p>
<p>环境：Ubuntu 16.04</p>
<p>首先，我们来说明用命令方式安装magnento的方法。</p>
<p><strong>Installation &amp; Update</strong></p>
<hr>
<p>Magento Installation</p>
<p>Install from archive file</p>
<p>First and easiest way is to download it from Magento download page, <a target="_blank" rel="noopener" href="https://www.magentocommerce.com/download">https://www.magentocommerce.com/download</a>.</p>
<p>You can choose from few different archive types (zip, tar.gz, tar.bz2) , with and without sample data.</p>
<p>Magento was kind enough to pack with all composer dependencies in the archive, so you don’t have to run Composer.</p>
<p>In this installation Magento core code is stored under /vendor directory and updating is possible through Magento admin.</p>
<p>So next steps are easy, just visit <a target="_blank" rel="noopener" href="http://m2.loc/2.07/magento-website/">http://m2.loc/2.07/magento-website/</a> (in my case) and follow Setup Wizard.</p>
<p>Install via Composer</p>
<p>Second, but not the last, is installing Magento via composer. Composer is a tool for dependency management in PHP. To learn more visit this link, <a target="_blank" rel="noopener" href="https://getcomposer.org/doc/00-intro.md">https://getcomposer.org/doc/00-intro.md</a>.</p>
<p>In this installation, Magento core code is also stored under /vendor directory and updating is possible through Magento admin.</p>
<p>First you need authentication keys which can be obtained here, and you will need Magento account to login.</p>
<p>Once logged in, go to “My Access Keys”, enter some descriptive “Name” and generate new set of keys. Magento uses this approach because, in future, extensions you buy from marketplace, will be available to you, through Magento admin interface.</p>
<p>Enter this command in terminal:</p>
<pre><code>composer create-project --repository-url=https://repo.magento.com/ magento/project-community-edition</code></pre>
<p>When prompted, your public key is username, and private key is password.</p>
<p>After that, Magento is ready for installation. Go through Setup Wizard and install it.</p>
<p>This was without sample data. So to install sample data, navigate to your Magento 2 root directory through terminal, and run the following command:</p>
<pre><code>php bin/magento sampledata:deploy
php bin/magento setup:upgrade</code></pre>
<p>These two commands will update your composer.json file and install sample data. If you get this message, after installing sample data – Please re-run Magento compile command, enter the following in terminal:</p>
<pre><code>php bin/magento setup:di:compile</code></pre>
<p>This command will take some time to complete.</p>
<p><strong>Install via GitHub</strong></p>
<p>Third, and the last one, is cloning or downloading release from GitHub repository.<br>In this installation, I will show you how to avoid setup wizard and install Magento through terminal. But, it is important to mention that in this installation Magento core code is stored under app/code not in vendor/ like in previous two examples.<br>When you try to update Magento through Admin interface, you will get error that this is a GitHub version and it’s not possible to update. GitHub releases are intended to be used by contributors/developers.</p>
<p>First we must clone Magento repo from here: <a target="_blank" rel="noopener" href="https://github.com/magento/magento2">https://github.com/magento/magento2</a> or you can download releases on <a target="_blank" rel="noopener" href="https://github.com/magento/magento2/releases">https://github.com/magento/magento2/releases</a></p>
<p>Create empty directory and run:</p>
<pre><code>git clone git@github.com:magento/magento2.git . </code></pre>
<p>After deploying has been finished, run:</p>
<pre><code>composer install</code></pre>
<p>Now it’s time to install Magento 2. My setup looks like this:</p>
<pre><code>php -f bin/magento setup:install –base-url=http://m2.loc/2.07/github/ --backend-frontname=admin --db-host=localhost --db-name=m2git --db-user=root --db-password=inchoo --admin-firstname=Magento --admin-lastname=User --admin-email=ivan.veres@inchoo.net --admin-user=admin --admin-password=magento123 --language=en_US --currency=USD --timezone=America/Chicago –use-rewrites=1</code></pre>
<p>Change your base-url, db-name, db-password, admin-email, admin-password to match your local setup.<br>If your visit you local link through browser (<a target="_blank" rel="noopener" href="http://m2.loc/2.07/github/">http://m2.loc/2.07/github/</a>), Magento 2 should be installed.</p>
<p>If you need sample data, follow along.<br>In your web root (not magento2) run:</p>
<pre><code>git clone git@github.com:magento/magento2-sample-data.git</code></pre>
<p>Navigate into cloned directory and execute:</p>
<pre><code>php -f dev/tools/build-sample-data.php -- --ce-source=&quot;your Magento CE install dir&quot;</code></pre>
<p>This will create symlinks to your Magento 2 installation.<br>Set ownership and permissions if you are on Linux machine:</p>
<pre><code>chown -R :your web server group name
find . -type d -exec chmod g+ws &#123;&#125; \;</code></pre>
<p>Then you need to clear static files (cache).<br>Navigate to Magento 2 var/ folder and enter following:</p>
<pre><code>rm -rf cache/* page_cache/* generation/*</code></pre>
<p>In Magento 2 documentation there are no further instructions. However you need to install sample data.</p>
<pre><code>php bin/magento setup:upgrade
php bin/magento setup:di:compile</code></pre>
<p>After that you should have sample data installed.</p>
<p>If you have some problems reference at: <a target="_blank" rel="noopener" href="http://devdocs.magento.com/guides/v2.0/install-gde/bk-install-guide.html">http://devdocs.magento.com/guides/v2.0/install-gde/bk-install-guide.html</a>.</p>
<p><strong>Theme Installation</strong></p>
<p>Prepare Installation</p>
<p>We recommend you to duplicate your live store on a development store and try installation on it in advance.</p>
<p>Backup magento files and the store database.</p>
<p><strong>Important!</strong></p>
<p>It’s very important to backup all of themes and extensions in Magento before installation, especially when you are working on a live server. We strongly recommend you to do not omit this step.</p>
<p>Disable all cache related section that you have in your magento.</p>
<p><strong>Theme Installation</strong></p>
<ol>
<li><p>Theme Files Upload</p>
<ul>
<li>Upload via FTP<br>Log into your hosting space via a FTP software. ie, FileZilla.</li>
</ul>
</li>
</ol>
<p>Unzip Theme Package &gt; Theme Files &gt; Magento 2.x &gt; Porto Theme.zip and upload all directories(There are 2 directories - app, pub) to magento 2 root directory.</p>
<p>If your magento version is 2.0.x, you should patch the theme with Porto Theme(Magento 2.0.x Patch).zip.</p>
<p>If your magento version is 2.1.x, you should patch the theme with Porto Theme(Magento 2.1.x Patch).zip </p>
<p>If your magento version is 2.1.6, you should patch the theme with Porto Theme(Magento 2.1.x Patch).zip and Porto theme (Magento 2.1.6 Patch).zip.</p>
<ul>
<li>Upload via CPanel<br>Log into your CPanel(Control Panel) by your hosting account or cpanel user information.</li>
</ul>
<p>Upload Theme Package &gt; Theme Files &gt; Magento 2.x &gt; Porto Theme.zip to your magento root directory and unzip its content.</p>
<p>If your magento version is 2.0.x, you should patch the theme with Porto Theme(Magento 2.0.x Patch).zip.</p>
<p>If your magento version is 2.1.x, you should patch the theme with Porto Theme(Magento 2.1.x Patch).zip. </p>
<p>If your magento version is 2.1.6, you should patch the theme with Porto Theme(Magento 2.1.x Patch).zip and Porto theme (Magento 2.1.6 Patch).zip</p>
<ol start="2">
<li>Active SW Extensions, open command line in folder root of magento and run commands via ssh using putty or others, php bin/magento setup:upgrade.</li>
</ol>
<p><img src="https://i.imgur.com/Xe16qO2.png"></p>
<p>这里说明的是：我在使用Porto这个主题的时候，有两个版本，一个是针对magento1.9的Quickstart文件，这个就是直接相当于magento1.9的所有源码，把这所有的复制放在magento1.9根目录下，然后运行安装程序，跟着安装步骤走即可。由于magento1.9这个版本对PHP的要求是php5.6或者以下，因此不能使用在php7的集成环境中，否则会报错。</p>
<p>接着是版本二的是magento2的，这个打开后只有app和pub这两个文件夹，所以，我们会觉得奇怪，这个不是所有源码，怎么办。这个是只包含主题文件夹的内容，需要在已经安装了magento2.x的基础上，进行覆盖的，如何覆盖呢？很简单！就是把app和pub这两个文件夹复制，然后在magento2这个根目录下粘贴，这样这个magento2里面的两个app和pub会被覆盖，当初我为了安全起见，只是把magento2里面的app和pub这两个文件夹重命名，然后把porto的magento2.x版本的主题拷贝到magento2的根目录中，这样是不行的。切记！</p>
<p>说明：magento2目录截图：</p>
<p><img src="https://i.imgur.com/jxRfXiV.png"><br>图一</p>
<p>porto的magento2.x版本主题目录截图：</p>
<p><img src="https://i.imgur.com/MJkyRIy.png"><br>图二</p>
<p>上面说了那么多，就是把图二中的所有文件复制到图一中去，覆盖里面的两个相同的文件夹，这样不会把图一中的文件彻底覆盖，只是把默认的部分保留，然后把主题的内容叠加进去，这样总算理解了吧！</p>
<p>根据多次的实验失败，个人觉得安装magento2的时候，最好去官网下在安装文件，然后通过FTP上传到服务器上去，然后解压，然后进行安装，这样报错的几率小很多。通过github下载下来的东西或多或少都会存在一点问题。</p>
<p>同时，以前我也采用composer去安装magento2，但是magento2比较大，中间在安装的时候可能会出现一些小问题。</p>
<p>当然，上面说的这两点是对于顺利安装的一些小建议，并不是说就不能采用github的方式进行源码的下载或者是composer的方式。</p>
<p>这篇文章，后面还会继续更新…</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2018/01/16/%E8%BD%AC%EF%BC%9AWordPress%E7%89%88%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97-%E4%B8%80-%EF%BC%9AWordPress-REST-API/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/16/%E8%BD%AC%EF%BC%9AWordPress%E7%89%88%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97-%E4%B8%80-%EF%BC%9AWordPress-REST-API/" class="post-title-link" itemprop="url">转：WordPress版微信小程序开发系列(一)：WordPress REST API</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-01-16 19:32:22" itemprop="dateCreated datePublished" datetime="2018-01-16T19:32:22+08:00">2018-01-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:52:49" itemprop="dateModified" datetime="2020-10-11T11:52:49+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>天介绍第一个技术要点：WordPress REST API。WordPress REST API无法访问是被问到的最多的问题。这个技术点在《利用WordPress REST API 开发微信小程序从入门到放弃》就初步介绍过，更为详细使用方法将在后续文章介绍，这里重点关注，如何才可以让WordPress REST API正常访问。</p>
<p>最常见的问题就是访问WordPress  REST API 的链接的时候显示404错误无法找到该页。 REST API是WordPress4.4版本开始提供的功能，不过是以插件的方式提供的，WordPress  4.7版本后才内置到系统里，如果你的WordPress站是4.7以前的版本，需要下载api插件：<a target="_blank" rel="noopener" href="https://wordpress.org/plugins/rest-api/%E3%80%82">https://wordpress.org/plugins/rest-api/。</a></p>
<p>如果是WordPress 4.7 或更高版本，要想正常访问 api,需要调整满足两个条件：</p>
<p>1.设置WordPress 的固定链接(permalink).</p>
<p>2、URL重写（url rewrite），也就是设置WordPress的伪静态。</p>
<p>一、设置WordPress 的固定链接(permalink)<br>打开Wordpress后台设置，如下图所示：</p>
<p><img src="https://i.imgur.com/V97NSdg.png"></p>
<p>选择除了“朴素”以外的其他选项都可以。不过注意一点：最好在固定链接的最后加上html的为后缀，虽然不加并不影响json api的使用，但考虑到小程序里的站内链接目前是通过判断html的后缀来获取文章slug值，如果不加html后缀会导致小程序的站内链接无法跳转，后续我会考虑完善兼容不带html后缀的固定链接的方式。</p>
<p><strong>一、URL重写</strong></p>
<p>设置完固定链接后，就可以可以通过以下的链接方式来访问REST API 了，比如查看文章列表的json：</p>
<p><a target="_blank" rel="noopener" href="https://www.watch-life.net/index.php/wp-json/wp/v2/posts">https://www.watch-life.net/index.php/wp-json/wp/v2/posts</a></p>
<p>但是这种方式看上去并不是那么优雅，中间还夹杂这index.php,如果去掉就是就感觉完美一些，这就需要通过URL 重写来实现，具体重写的原理就不详细阐述了，下面给出在不同的web服务器下URL重写代码。</p>
<p><strong>1.IIS 7服务器</strong></p>
<p>需要安装URL Rewrite Module。在web.config 文件 加入 URL重写代码：</p>
<p><img src="https://i.imgur.com/8UlXl4B.png"></p>
<p><strong>2.Apache服务器</strong></p>
<p>在WordPress网站根目录下增加.htaccess文件，加入 URL重写代码：</p>
<pre><code># BEGIN WordPress
&lt;IfModule mod_rewrite.c&gt;
RewriteEngine On
RewriteBase /
RewriteRule ^index\.php$ - [L]
RewriteCond %&#123;REQUEST_FILENAME&#125; !-f
RewriteCond %&#123;REQUEST_FILENAME&#125; !-d
RewriteRule . /index.php [L]
&lt;/IfModule&gt;
# END WordPress</code></pre>
<p><strong>3.nginx服务器</strong></p>
<p>增加一个conf文件比如wordpress.conf,加入 URL重写代码：</p>
<pre><code>location / &#123;

try_files $uri $uri/ /index.php?$args;

&#125;</code></pre>
<p>经过URL重写后，REST API访问的链接的地址就变成这样了：</p>
<p><a target="_blank" rel="noopener" href="https://www.watch-life.net/wp-json/wp/v2/posts%E3%80%82%E6%98%AF%E4%B8%8D%E6%98%AF%E8%A6%81%E4%BC%98%E9%9B%85%E5%BE%88%E5%A4%9A%E3%80%82">https://www.watch-life.net/wp-json/wp/v2/posts。是不是要优雅很多。</a></p>
<p><strong>特别注意：</strong></p>
<p>1.如果WordPress网站安装了水煮鱼的WPJAM Basic插件，在该插件的设置项里有个选项：</p>
<p>如果你的博客没有客户端，建议屏蔽 REST API 功能。</p>
<p>不要勾选这个选项，如果勾选了，json将无法访问。</p>
<p>如果你通过其他的方式屏蔽了json的访问，也要取消。</p>
<p>2.如果你担心开放Wordpress的json访问可能对网站的安全带来影响。可以参考Jeff的一个解决方法，考虑到微信小程序是通过手机访问的，那么就只允许手机来访问这个api，做一定范围的防范，如果你是nginx服务器，可以在config文件里加如下代码：</p>
<pre><code>location /wp-json &#123;
if ($http_user_agent !~ &#39;(iPhone|Android)&#39;)&#123;
return 403;
&#125;
try_files $uri $uri/ /index.php?$args;
&#125;</code></pre>
<p>不过这方法只是权宜之计，只要开放一个功能必然会打来隐患，有得必有失，看你的选择了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2018/01/16/wordpress%E5%BE%AE%E4%BF%A1%E7%89%88%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E6%96%B9%E6%A1%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/16/wordpress%E5%BE%AE%E4%BF%A1%E7%89%88%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E6%96%B9%E6%A1%88/" class="post-title-link" itemprop="url">wordpress微信版小程序安装配置方案</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-01-16 17:54:11" itemprop="dateCreated datePublished" datetime="2018-01-16T17:54:11+08:00">2018-01-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:10" itemprop="dateModified" datetime="2020-10-11T11:53:10+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>首先声明一下，这篇文章转载自<a target="_blank" rel="noopener" href="https://www.watch-life.net/wordpress/weixin-app-install.html">守望轩</a>，这篇文章主要是方便日后查阅需要，想要了解更多专业的内容，请访问：<a target="_blank" rel="noopener" href="https://www.watch-life.net./">https://www.watch-life.net。</a></p>
<p><strong>1.安装WordPress</strong></p>
<p>这个步骤感觉说出来是废话，我想说的是建议你使用WordPress4.7级以上的版本，因为需要使用rest json api ，这个版本后这个api就包含在WordPress里了，不必通过插件来安装。</p>
<p>这里说明一下，在WordPress的插件里，有个json api 的插件，和官方的rest json api是不一样的，无法使用在本小程序里。</p>
<p>当然，如果你熟悉json api 可以修改本小程序去对接json api的接口也是可以的。</p>
<p>再次强调使用WordPress4.7级以上的版本无需安装rest json api的插件。</p>
<p>rest json api 需要在wordpress设置固定链接和伪静态才可以正常使用。</p>
<p>有关rest json api 的使用以及固定链接、伪静态可以参考文章：<a target="_blank" rel="noopener" href="https://www.watch-life.net/wordpress/wordpress-rest-api.html">WordPress版微信小程序开发系列(一)：WordPress REST API</a></p>
<p><strong>2.配置微信小程序的服务器域名和业务域名</strong></p>
<p>在微信小程序公众平台的后台里，选择“设置”=&gt;“开发设置”，对“服务器域名”和“业务域名”进行配置，如下图：</p>
<p><img src="https://i.imgur.com/1xmGWH8.png"></p>
<p>其中request合法域名必须配置，这个参数保证了小程序可以正常发送request请求，程序才能运行起来。同时，这个域名必须备案。</p>
<p>“业务域名”主要用于web-view内嵌网页时，用作域名白名单，如果不是业务域名里的域名，在web-view内嵌里访问网页时，就会报无法访问的错误。</p>
<p>注意：个人小程序是没有“业务域名”这个配置的。</p>
<p><strong>3.配置HTTPS</strong></p>
<p>如果你的网站支持HTTS就可以忽略这步，由于小程序的request等请求是需要HTTPS的，因此需要网站支持HTTPS，关于WordPress网站开启请参考我写过的文章：<a href="http://helongquan.github.io/2018/01/12/%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84wordpress%E7%BD%91%E7%AB%99%E9%85%8D%E7%BD%AEssl%E8%AF%81%E4%B9%A6%E5%85%A8%E9%83%A8%E8%BF%87%E7%A8%8B/">WordPress整站轻松开启HTTPS</a>。</p>
<p>注意：一定要保证https和http两种方式都能正常访问网站，才能改这个配置，否则可能导致网站无法访问。</p>
<p><strong>4.安装WordPress插件：wp-rest-api-for-app</strong></p>
<p>之所以开发这个插件，是因为WordPress 官方的rest json api 不能满足小程序定制化的需求，我开发了插件作为官方api的补充，这个插件基本是按官方api二次开发的规范定制的。</p>
<p>由于插件部分数据的获取是通过直接访问数据库的方式，这样很可能无法提交到Wordpress的官方插件库，所以只能通过github下载。因此安装的方式是，直接上传文件夹到wordpress的插件目录，然后启用。</p>
<p>注意：从github下载的插件包，文件夹变成了wp-rest-api-for-app-master，在安装插件的时候，插件目录的名称要改成：wp-rest-api-for-app</p>
<p>插件的下载地址：<a target="_blank" rel="noopener" href="https://github.com/iamxjb/wp-rest-api-for-app%EF%BC%8C%E6%88%96%E8%80%85%E6%98%AF%E4%BB%8E[%E8%BF%99%E9%87%8C%E4%B8%8B%E8%BD%BD](https://pan.baidu.com/s/1nwLhQWx)%EF%BC%8C%E5%AF%86%E7%A0%81%EF%BC%9Ar8cm">https://github.com/iamxjb/wp-rest-api-for-app，或者是从[这里下载](https://pan.baidu.com/s/1nwLhQWx)，密码：r8cm</a></p>
<p>插件安装启用后，需要在后台配置一些参数：</p>
<p>1）wordpress后台 =&gt; 设置 =&gt;微信小程序设置</p>
<p>在这个配置界面配置AppID,AppSecret,小程序首页滑动文章ID,  前面两个参数在微信小程序的后台可以查到，这里就不赘述。“小程序首页滑动文章ID”这个参数是为了显示首页滑动轮播的文章。这里的设计我偷了懒，良好的设计应该弹出一个选择框，让用户来选择文章，而不是给个输入框输入id。</p>
<p><img src="https://i.imgur.com/9abQjti.png"></p>
<p>文章id如何在wordpress后台找到呢？其实很简单，看下图你就明白了：</p>
<p><img src="https://i.imgur.com/q1r0OtY.png"></p>
<p>2）wordpress后台 =&gt; 分类目录 =&gt;选择一个分类进行编辑</p>
<p><img src="https://i.imgur.com/P0C1fsY.png"></p>
<p>这里设置后，在小程序里“专题”页就会看到封面图片了。</p>
<p><strong>5.安装Wordpress版微信小程序：winxin-app-watch-life.net</strong></p>
<p>下载的地址：<a target="_blank" rel="noopener" href="https://github.com/iamxjb/winxin-app-watch-life.net">https://github.com/iamxjb/winxin-app-watch-life.net</a></p>
<p>有关在微信小程序的开发工具新建项目，导入程序，先去下载一个微信的开发者工具，然后先去微信小程序那里注册一个小程序，相信这一步应该提前就完成了的，然后新建的时候有个AppId，这个是小程序的，不是微信公众号的APPID，这个要区分开来，然后就是命名，然后就是事先在电脑本地新建一个目录，截图如下：</p>
<p><img src="https://i.imgur.com/Cqfs3P0.jpg"></p>
<p>这个目录就是存放这个小程序的源码的路径，然后把下载好的winxin-app-watch-life.net这个里面的源码放进去，在开发者工具那里编译一下就看到效果了。这个就是本地调试的效果，远程不能访问的，要修改一些东西，我们继续往下看。</p>
<p>微信小程序项目创建好了后，打开config.js文件，config.js文件的路径如下图：</p>
<p><img src="https://i.imgur.com/9xqYgZQ.png"></p>
<pre><code>var DOMAIN = &quot;www.watch-life.net&quot;;//配置域名,域名只修改此处，这个就是我们自己的域名了，这个域名需要备案，还要有ssl证书
var WEBSITENAME=&quot;守望轩&quot;; //网站名称，根据自己网站的名字写就行了
var ABOUTID= 1136; //wordpress网站 “关于” 页面的id
var TEMPPLATEID = &#39;hzKpxuPF2rw7O-qTElkeoE0lMwr0O4t9PJkLyt6v8rk&#39;;//模版消息id</code></pre>
<p>配置好以上参数，可以让小程序正常运行。其中：</p>
<p>DOMAIN就是wordpress所在服务器的域名；</p>
<p>ABOUTID是wordpress的“页面”的id，这个页面id的获取和上面说的文章id类似。</p>
<p>TEMPPLATEID是模版消息的id ，是发送模版消息的必须使用的id，有关模版消息参看文档：<a target="_blank" rel="noopener" href="https://www.watch-life.net/wordpress/wordpress-weixin-2-4.html">WordPress版微信小程序2.4版发布</a> ，这篇文章里有如何设置模版消息的说明。</p>
<p>如果想要修改其他内容，可以在微信开发者工具里面进行调试，调试完毕后，进行编译，编译完成后查看自己的修改是否无误，没有的话就上传，上传完了后，可以通过手机扫描 “预览” 那里的二维码，只有管理员才能够查看，等我们明确我们的网站服务领域后，在符合小程序发布规则，不违规，然后提交审核自己的小程序，审核成功后，就可以让别人查看了。</p>
<p>建议：在微信开发者工具调试阶段，不要频繁的上传，调试一个阶段后再上传会好点，不然被微信那边惩罚的。</p>
<p><strong>5.安装微信支付服务端程序</strong></p>
<p>如果你开通了微信支付，并使用WordPress版微信小程序的“赞赏”共功能，就需要安装微信支付服务端程序</p>
<p><img src="https://i.imgur.com/bthXbH0.png"></p>
<p>微信支付服务端程序下载地址：<a target="_blank" rel="noopener" href="https://github.com/iamxjb/weixin-app-wxpay">https://github.com/iamxjb/weixin-app-wxpay</a></p>
<p>有关此程序的详细安装和配置见文档:WordPress版微信小程序2.2.8版发布里的相关说明。</p>
<p>最后，我觉得很重要的一点就是，在做一个小程序之前，先想好为什么要做这个，要提供一些什么服务，满足什么需求，以便接下来，在wordpress网站中放什么内容。这个是我最大的感悟，因为最开始，我觉得做一个小程序就是为了满足一下个人成就感，就这样随随便便的折腾了一个，在提交审核的时候，发现不知道自己的这个网站主要是做什么，提供什么服务。显得特别尴尬。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2018/01/15/%E5%90%91wordpress%E7%BD%91%E7%AB%99%E4%B8%AD%E6%9C%AC%E5%9C%B0%E5%BC%95%E7%94%A8font-awesome%E7%9A%84%E5%AD%97%E4%BD%93%E5%9B%BE%E6%A0%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/15/%E5%90%91wordpress%E7%BD%91%E7%AB%99%E4%B8%AD%E6%9C%AC%E5%9C%B0%E5%BC%95%E7%94%A8font-awesome%E7%9A%84%E5%AD%97%E4%BD%93%E5%9B%BE%E6%A0%87/" class="post-title-link" itemprop="url">向wordpress网站中本地引用font awesome的字体图标</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-01-15 10:34:45" itemprop="dateCreated datePublished" datetime="2018-01-15T10:34:45+08:00">2018-01-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:52:52" itemprop="dateModified" datetime="2020-10-11T11:52:52+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>我们在使用fa fa-icon这个字体库的时候发现，有个别的icon是没法显示正确的，举例：当我们使用</p>
<pre><code>&lt;i class=&quot;fa fa-google-plus&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;</code></pre>
<p>按理来说是显示：</p>
<p><img src="https://i.imgur.com/RMTSapj.png"></p>
<p>可是显示的却是小写的那个 “g+”,而不是 “G+”。这个无论我们怎么调都不行，又比如我们网站主题没有fa fa-icon里面的图标支持字体包，我们改如何把这个引入呢，毕竟这个图标库非常丰富，又比如我们不想在网站的头部加载第三方的CDN，我们想让它在源码里面加载，可以避免因为禁用了谷歌字体而导致的不能使用的风险，等等，好的，今天看完这篇文章，你就会了。</p>
<p>针对上面这个问题，然后我们开始排查原因，因为我用的是：</p>
<pre><code>&lt;link href=&quot;http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css&quot; rel=&quot;stylesheet&quot;/&gt;</code></pre>
<p>这个版本是4.2的，后来查了下，发现谷歌修改了自己的字体图标logo，把<code>fa fa-google-plus</code>映射成了 “G+”，我寻思着，估计是这个版本太低了，于是在<a target="_blank" rel="noopener" href="http://www.bootcdn.cn/font-awesome/">这里</a>找了一个高版本的，当然也可以去官网下载一个高版本的：</p>
<pre><code>&lt;link href=&quot;https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css&quot; rel=&quot;stylesheet&quot;&gt;</code></pre>
<p>保存刷新，果然成功了。后来由于考虑到加载第三方库，所以把这个下载到了源码中，进行本地加载，然后去下载了这个4.7.0版本的。</p>
<p>在<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1sm4KBnf">这里下载</a>  密码：vo38</p>
<p>然后在wordpress头部引用进来，</p>
<pre><code>&lt;link href=&quot;&lt;?php bloginfo(&#39;template_url&#39;); ?&gt;/css/font-awesome.min.css&quot; rel=&quot;stylesheet&quot;&gt;</code></pre>
<p>字体包里面有个fonts文件夹，这个需要放在主题目录下，有的话就把里面的内容上传，没有的话就新建一个fonts文件夹，然后把里面的字体包上传即可。</p>
<p>我们打开这个font-awesome.min.css不难发现</p>
<pre><code>@font-face &#123;
  font-family: &#39;FontAwesome&#39;;
  src: url(&#39;../fonts/fontawesome-webfont.eot?v=4.7.0&#39;);
  src: url(&#39;../fonts/fontawesome-webfont.eot?#iefix&amp;v=4.7.0&#39;) format(&#39;embedded-opentype&#39;), url(&#39;../fonts/fontawesome-webfont.woff2?v=4.7.0&#39;) format(&#39;woff2&#39;), url(&#39;../fonts/fontawesome-webfont.woff?v=4.7.0&#39;) format(&#39;woff&#39;), url(&#39;../fonts/fontawesome-webfont.ttf?v=4.7.0&#39;) format(&#39;truetype&#39;), url(&#39;../fonts/fontawesome-webfont.svg?v=4.7.0#fontawesomeregular&#39;) format(&#39;svg&#39;);
  font-weight: normal;
  font-style: normal;
&#125;</code></pre>
<p>它这里是引用了字体包里的内容的，所以，我们把font-awesome.min.css放入css文件夹（与fonts文件夹同级）里面。</p>
<p>然后刷新，我们就看到了我们熟悉的：</p>
<p><img src="https://i.imgur.com/ZmwsRXR.png"></p>
<p>这篇是写给那些正在学习的新手，老手绕路。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2018/01/12/%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84wordpress%E7%BD%91%E7%AB%99%E9%85%8D%E7%BD%AEssl%E8%AF%81%E4%B9%A6%E5%85%A8%E9%83%A8%E8%BF%87%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/12/%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84wordpress%E7%BD%91%E7%AB%99%E9%85%8D%E7%BD%AEssl%E8%AF%81%E4%B9%A6%E5%85%A8%E9%83%A8%E8%BF%87%E7%A8%8B/" class="post-title-link" itemprop="url">最简单的wordpress网站配置ssl证书全部过程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-01-12 10:07:12" itemprop="dateCreated datePublished" datetime="2018-01-12T10:07:12+08:00">2018-01-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:52:49" itemprop="dateModified" datetime="2020-10-11T11:52:49+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>今天分享的是个人为wordpress网站设置ssl证书的详细步骤。</p>
<p>网站环境：由于是测试环境，我这里在linux上面使用了xampp这个环境集成包，由于里面放了多个网站，我采用了虚拟机的形式。</p>
<p>操作系统：linux</p>
<p>首先，我们先申请一个免费的ssl证书，因为收费的太贵了，所以我找到了阿里云的一款：赛门铁克免费型DV SSL，链接：<a target="_blank" rel="noopener" href="https://common-buy.aliyun.com/?spm=5176.2020520163.cas.1.41dbe13dj0ysg2&amp;commodityCode=cas#/buy">https://common-buy.aliyun.com/?spm=5176.2020520163.cas.1.41dbe13dj0ysg2&amp;commodityCode=cas#/buy</a></p>
<p><img src="https://i.imgur.com/knRGR7E.png"></p>
<p>点击购买，然后进行审核阶段，具体流程如下：<br><img src="https://i.imgur.com/xNyZnuD.png"></p>
<p>这里我们根据里面的要求进行填写就行了，这里有个地方需要提醒的是：如何选择域名授权验证</p>
<ol>
<li>DNS验证方式</li>
<li>文件验证方式</li>
</ol>
<p>根据不同业务需求进行选择，我们一般都是选择 “DNS验证方式”，然后勾选下面那个小的复选框，勾选后，会在域名解析那里自动添加一条解析记录：</p>
<p><img src="https://i.imgur.com/t7hEtGC.png"></p>
<p>如果您的域名托管在阿里云的云解析服务中，可选择授权证书服务系统自动完成域名配置。这样，您就不需要在域名解析管理控制台上进行任何操作了。</p>
<p><img src="https://i.imgur.com/mpuLS8E.png"></p>
<p>注意： 如果域名没有托管在阿里云的云解析服务中，请不要选择这个选项，即使选择该选项也无法完成推送。</p>
<p>重要： 由于某些 CA 中心可能会要求用户创建隐藏文件夹（.xxx），如果您的站点服务器是 Windows 服务器或者使用了阿里云 OSS 服务，将无法创建隐藏目录，请不要选择文件验证方式，建议您通过 DNS 方式进行域名授权验证。</p>
<p>完成这个后，就是等着阿里云那边审核了，大概等个10分钟左右，就基本可以完成，如果信息填写无误的话。通过审核后一般会有通知，邮件通知，然后再次进入到：阿里云管理控制台—CA证书服务，我们看到</p>
<p><img src="https://i.imgur.com/dsTYMLA.png"></p>
<p>这样的一个信息，然后我们点击下载那里</p>
<p><img src="https://i.imgur.com/QBbTJmM.png"></p>
<p>这里我们就根据我们使用的服务器来进行选择了，由于我前面说了，我采用的是xampp，所以我选择的是apache，我们选择apache那个选项，里面告诉了我们如何操作，但是这里需要注意的是，不要直接把上面的代码复制粘贴，毕竟每个人的服务器安装路径不一样，所以我们先阅读一下这些内容到底是什么意思会更好。</p>
<p>apache配置方法如下：</p>
<p><strong>安装证书</strong></p>
<p>文件说明：</p>
<ol>
<li>证书文件214432579040782.pem，包含两段内容，请不要删除任何一段内容。</li>
<li>如果是证书系统创建的CSR，还包含：证书私钥文件214432579040782.key、证书公钥文件public.pem、证书链文件chain.pem。</li>
</ol>
<p>( 1 ) 在Apache的安装目录下创建cert目录，并且将下载的全部文件拷贝到cert目录中。如果申请证书时是自己创建的CSR文件，请将对应的私钥文件放到cert目录下并且命名为214432579040782.key；<br>( 2 ) 打开 apache 安装目录（我这里是apache2）下 conf 目录中的 httpd.conf 文件，找到以下内容并去掉“#”，这里我说明下，我这边根据这个路径找到的是一个没有下面内容的，所以我于是想可能不是这个地方，然后我回到了 opt/lamp/etc/里面,在这里面也有httpd.conf，然后如愿以偿的找到了下面的这两个地方，这里吐槽下：对于这个问题“如果找不到请确认是否编译过 openssl 插件”，我百度了，基本都是千篇一律，全部是抄的，没有一个说到重点的，所以很多时候还得靠自己的脑子，别太依赖别人的方案，好的话说回来，我们把下面这两行开启，很多时候这两个应该都是开启了的：</p>
<pre><code>#LoadModule ssl_module modules/mod_ssl.so (如果找不到请确认是否编译过 openssl 插件)
#Include conf/extra/httpd-ssl.conf</code></pre>
<p>( 3 ) 打开 apache 安装目录下 conf/extra/httpd-ssl.conf 文件 (也可能是conf.d/ssl.conf，与操作系统及安装方式有关)， 在配置文件中查找以下配置语句:</p>
<pre><code># 添加 SSL 协议支持协议，去掉不安全的协议
SSLProtocol all -SSLv2 -SSLv3
# 修改加密套件如下
SSLCipherSuite HIGH:!RC4:!MD5:!aNULL:!eNULL:!NULL:!DH:!EDH:!EXP:+MEDIUM
SSLHonorCipherOrder on
# 证书公钥配置
SSLCertificateFile cert/public.pem
# 证书私钥配置
SSLCertificateKeyFile cert/214432579040782.key
# 证书链配置，如果该属性开头有 &#39;#&#39;字符，请删除掉
SSLCertificateChainFile cert/chain.pem</code></pre>
<p>貌似这个加进去没啥卵用，不过最好添加一下吧，原来存在的就注释掉，比如我这里有，以前安装的时候存在的一些配置</p>
<pre><code>#SSLCertificateChainFile &quot;/opt/lampp/etc/server-ca.crt&quot;  //这个是以前安装自带的，我把它注释掉了，不然会重复
#证书链配置，如果该属性开头有 &#39;#&#39;字符，请删除掉
SSLCertificateChainFile &quot;/opt/lampp/apache2/cert/chain.pem&quot;   //新添加的

#SSLCertificateKeyFile &quot;/opt/lampp/etc/ssl.key/server.key&quot;   //这些都注释
#证书公钥配置
SSLCertificateFile &quot;/opt/lampp/apache2/cert/public.pem&quot;    //新添加的
#证书私钥配置
SSLCertificateKeyFile &quot;/opt/lampp/apache2/cert/214432579040782.key&quot;    //新添加的
#SSLCertificateKeyFile &quot;/opt/lampp/etc/server-dsa.key&quot;   //这些都注释
#SSLCertificateKeyFile &quot;/opt/lampp/etc/server-ecc.key&quot;   //这些都注释</code></pre>
<p>可能是我加的地方错误，于是又痛苦了一晚，第二天早上继续处理，后来，我在<a target="_blank" rel="noopener" href="https://www.cnblogs.com/lqzweb/p/7121980.html">这篇文章</a>找到了我的答案。</p>
<p>他的意思是：</p>
<p><strong>第一步</strong></p>
<p>找到 #LoadModule ssl_module modules/mod_ssl.so 和 #Include conf/extra/httpd-ssl.conf，去掉前面的#号注释；这一步我已经完成了，这一步他说的比较笼统，新手很可能不知道在哪里找这两个，其实这两个就是前面第一步说的。</p>
<p><strong>第二步；</strong></p>
<p>编辑Apache根目录下 conf/extra/httpd-ssl.conf 文件，修改如下内容：（路径一定要填对，不然启动不了）<br>复制代码</p>
<pre><code>Listen 443
&lt;VirtualHost *:443&gt;
  SSLEngine on
  SSLProtocol all -SSLv2 -SSLv3  //去除不安全协议的
  SSLCipherSuite HIGH:MEDIUM:!aNULL:!MD5   //加密的
  SSLCertificateFile &quot;C:/phpStudy/Apache/conf/ssl/2_www.weiduweilan.cn.crt&quot;  //证书公钥
  SSLCertificateKeyFile &quot;C:/phpStudy/Apache/conf/ssl/3_www.weiduweilan.cn.key&quot;  //证书私钥
  SSLCertificateChainFile &quot;C:/phpStudy/Apache/conf/ssl/1_root_bundle.crt&quot; //根证书
  DocumentRoot  &quot;C:\phpStudy\WWW\Zerg\public&quot;
  &lt;Directory /&gt;
    Options +Indexes +FollowSymLinks +ExecCGI
    AllowOverride All
    Order allow,deny
    Allow from all
    Require all granted
  &lt;/Directory&gt;
&lt;/VirtualHost&gt;</code></pre>
<p>这一步，在哪里添加呢？这个根据个人配置，因为不同的配置，文件可能是不一样的，所以，我这里使用了虚拟机，就是建了一个httpd-vhosts.conf,所以，我把这个添加到了这个里面。大概在这个位置：</p>
<pre><code>#        #SSLCertificateKeyFile /etc/httpd/conf/server.key
#        SSLCertificateKeyFile &quot;/opt/lampp/apache2/cert/214432579040782.key&quot;
#&lt;/VirtualHost&gt;
# 把原本的80端口关闭或者删除，这里是作为测试https，所以，我关闭了，以备后面使用
#&lt;VirtualHost *:80&gt;
#    ServerAdmin webmaster@keli.com
#    DocumentRoot &quot;/wwwroot/webroot/www.keli.com&quot;
#    ServerName http://www.keli.com
#    ErrorLog &quot;logs/dummy-host2.example.com-error_log&quot;
#    CustomLog &quot;logs/dummy-host2.example.com-access_log&quot; common
#&lt;/VirtualHost&gt;

# 这个是我加进去的 开始
&lt;VirtualHost *:443&gt;
  SSLEngine on
  SSLProtocol all -SSLv2 -SSLv3
  SSLCipherSuite HIGH:MEDIUM:!aNULL:!MD5
  SSLCertificateFile &quot;/opt/lampp/apache2/cert/public.pem&quot;   //证书公钥
  SSLCertificateKeyFile &quot;/opt/lampp/apache2/cert/214432579040782.key&quot;   //证书私钥
  SSLCertificateChainFile &quot;/opt/lampp/apache2/cert/chain.pem&quot;   //根证书
  DocumentRoot  &quot;/wwwroot/webroot/www.keli.com&quot;  //这个是网站源码的根目录
  &lt;Directory /&gt;
    Options +Indexes +FollowSymLinks +ExecCGI
    AllowOverride All
    Order allow,deny
    Allow from all
    Require all granted
  &lt;/Directory&gt;
&lt;/VirtualHost&gt;
# 这个是我加进去的 结束
&lt;VirtualHost *:80&gt;
    ServerAdmin webmaster@university.com
    DocumentRoot &quot;/wwwroot/webroot/www.university.com&quot;
    ServerName http://www.university.com
    ErrorLog &quot;logs/dummy-host2.example.com-error_log&quot;
    CustomLog &quot;logs/dummy-host2.example.com-access_log&quot; common
&lt;/VirtualHost&gt;

&lt;VirtualHost *:80&gt;
    ServerAdmin webmaster@university.com
    DocumentRoot &quot;/wwwroot/webroot/www.cdoor.net&quot;
    ServerName http://www.cdoor.net
    ErrorLog &quot;logs/dummy-host2.example.com-error_log&quot;
    CustomLog &quot;logs/dummy-host2.example.com-access_log&quot; common
&lt;/VirtualHost&gt;</code></pre>
<p>这里我说明一下，由于我这个服务器放了三个网站，因此配置了三个域名，后面的那两个大家可以不用理睬，关注前面的那个被我注释掉的80端口，我把它关闭了，然后开启443，开启了443端口，这个端口已经在httpd-ssl.conf那边监听了，如果没有监听，去那边开启（把里面的#号删除）就行了，根据阿里云那边的教程，我这里对公钥和私钥，以及根证书的地址我采用了绝对路径（/opt/lampp/apache2/cert），这样比较容易理解，就行链接一样，能够找得到。</p>
<p><strong>注意：这里如果我们关闭了80端口的监听，那么我们是没法输入<a target="_blank" rel="noopener" href="http://www.keli.com进行访问的,原因很简单,因为这个端口没有监听,如果只是测试https的话,关了这个没关系,但是想要https和http都能访问,那么建议80端口和443端口都开着/">http://www.keli.com进行访问的，原因很简单，因为这个端口没有监听，如果只是测试https的话，关了这个没关系，但是想要https和http都能访问，那么建议80端口和443端口都开着</a></strong></p>
<pre><code># 为了两个协议都能访问，我都开启了
&lt;VirtualHost *:80&gt;
    ServerAdmin webmaster@keli.com
    DocumentRoot &quot;/wwwroot/webroot/www.keli.com&quot;
    ServerName http://www.keli.com
    ErrorLog &quot;logs/dummy-host2.example.com-error_log&quot;
    CustomLog &quot;logs/dummy-host2.example.com-access_log&quot; common
&lt;/VirtualHost&gt;

# 这个是我加进去的用来开启https 开始
&lt;VirtualHost *:443&gt;
  SSLEngine on
  SSLProtocol all -SSLv2 -SSLv3
  SSLCipherSuite HIGH:MEDIUM:!aNULL:!MD5
  SSLCertificateFile &quot;/opt/lampp/apache2/cert/public.pem&quot;   //证书公钥
  SSLCertificateKeyFile &quot;/opt/lampp/apache2/cert/214432579040782.key&quot;   //证书私钥
  SSLCertificateChainFile &quot;/opt/lampp/apache2/cert/chain.pem&quot;   //根证书
  DocumentRoot  &quot;/wwwroot/webroot/www.keli.com&quot;  //这个是网站源码的根目录
  &lt;Directory /&gt;
    Options +Indexes +FollowSymLinks +ExecCGI
    AllowOverride All
    Order allow,deny
    Allow from all
    Require all granted
  &lt;/Directory&gt;
&lt;/VirtualHost&gt;
# 这个是我加进去的用来开启https 结束</code></pre>
<p>好的，我这里确定好了之后。</p>
<p>( 4 ) 重启 Apache。</p>
<p>运行命令：</p>
<pre><code>/opt/lampp/lampp restart</code></pre>
<p>如果没有什么问题，所有的服务（apache,mysql,php等）都可以启动的</p>
<p><img src="https://i.imgur.com/2aLQcYo.png"></p>
<p>在wordpress版本4.7以上都会默认具有wp-json这个功能的了，所以我们没必要安装WP REST API的插件了。判断是否具备这个功能，直接访问<a target="_blank" rel="noopener" href="http://yourdomain.com/wp-json/wp/v2/posts%EF%BC%8C%E7%9C%8B%E4%B8%8B%E6%9C%89%E6%B2%A1%E6%9C%89json%E6%A0%BC%E5%BC%8F%E7%9A%84%E6%95%B0%E6%8D%AE%E5%87%BA%E6%9D%A5%EF%BC%8C%E6%9C%89%E7%9A%84%E8%AF%9D%E8%AF%B4%E6%98%8E%E4%BD%A0%E7%9A%84wordpress%E7%89%88%E6%9C%AC%E6%98%AF%E9%AB%98%E4%BA%8E4.7%E7%9A%84%EF%BC%8C%E6%88%96%E8%80%85%E8%AF%B4%E4%BD%A0%E5%B7%B2%E7%BB%8F%E5%AE%89%E8%A3%85%E4%BA%86WP">http://yourdomain.com/wp-json/wp/v2/posts，看下有没有json格式的数据出来，有的话说明你的wordpress版本是高于4.7的，或者说你已经安装了WP</a> REST API这个插件。</p>
<p>然后，去wordpress后台修改固定链接：</p>
<p><img src="https://i.imgur.com/bOo6bej.png"></p>
<p>然后把WordPress地址（URL）和站点地址（URL）的http改成https，这个得确保你的两个协议都能访问的情况下修改，不然改成https后没法访问了，所以，我的做法就是一边开着数据库，一边修改这个，如果发现没法访问了，直接把wp_option这个表中的https改成http。</p>
<p>好的，我们把这个修改成https后，我们就可以通过https进行访问了。不过，我这边貌似http就不能访问了，不过不要紧，我只是用作一个小程序的测试项目，不过能够两个都能访问就是最好的了。</p>
<p>至于服务器是nginx的如何配置，我这边引用一下阿里云的解决方案：</p>
<hr>
<p><strong>安装证书</strong></p>
<p>文件说明：</p>
<ol>
<li>证书文件214432579040782.pem，包含两段内容，请不要删除任何一段内容。</li>
<li>如果是证书系统创建的CSR，还包含：证书私钥文件214432579040782.key。</li>
</ol>
<p>( 1 ) 在Nginx的安装目录下创建cert目录，并且将下载的全部文件拷贝到cert目录中。如果申请证书时是自己创建的CSR文件，请将对应的私钥文件放到cert目录下并且命名为214432579040782.key；</p>
<p>( 2 ) 打开 Nginx 安装目录下 conf 目录中的 nginx.conf 文件，找到：</p>
<pre><code># HTTPS server
# #server &#123;
# listen 443;
# server_name localhost;
# ssl on;
# ssl_certificate cert.pem;
# ssl_certificate_key cert.key;
# ssl_session_timeout 5m;
# ssl_protocols SSLv2 SSLv3 TLSv1;
# ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;
# ssl_prefer_server_ciphers on;
# location / &#123;
#
#
#&#125;
#&#125;</code></pre>
<p>( 3 ) 将其修改为 (以下属性中ssl开头的属性与证书配置有直接关系，其它属性请结合自己的实际情况复制或调整) :</p>
<pre><code>server &#123;
    listen 443;
    server_name localhost;
    ssl on;
    root html;
    index index.html index.htm;
    ssl_certificate   cert/214432579040782.pem;
    ssl_certificate_key  cert/214432579040782.key;
    ssl_session_timeout 5m;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers on;
    location / &#123;
        root html;
        index index.html index.htm;
    &#125;
&#125;</code></pre>
<p>保存退出。</p>
<p>( 4 )重启 Nginx，等个两三分钟看效果。</p>
<p>经历过上面的问题后，相信这个方式问题不大。祝你们好运。如果你还有好的方法，以及任何疑问，可以与笔者取得联络，QQ:791447771</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2018/01/09/wordpress%E5%89%8D%E5%8F%B0%E5%AE%9E%E7%8E%B0%E5%90%91%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%8C%E7%B1%BB%E4%BC%BC%E6%B7%BB%E5%8A%A0%E9%98%B2%E4%BC%AA%E7%A0%81%E6%88%96%E8%80%85%E5%BA%8F%E5%88%97%E7%A0%81%E7%9A%84%E9%9C%80%E6%B1%82%EF%BC%8C%E7%84%B6%E5%90%8E%E5%8F%AF%E4%BB%A5%E6%9F%A5%E8%AF%A2%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87navicat%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AF%BC%E5%85%A5excel%E8%A1%A8%E6%95%B0%E6%8D%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/09/wordpress%E5%89%8D%E5%8F%B0%E5%AE%9E%E7%8E%B0%E5%90%91%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%8C%E7%B1%BB%E4%BC%BC%E6%B7%BB%E5%8A%A0%E9%98%B2%E4%BC%AA%E7%A0%81%E6%88%96%E8%80%85%E5%BA%8F%E5%88%97%E7%A0%81%E7%9A%84%E9%9C%80%E6%B1%82%EF%BC%8C%E7%84%B6%E5%90%8E%E5%8F%AF%E4%BB%A5%E6%9F%A5%E8%AF%A2%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87navicat%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AF%BC%E5%85%A5excel%E8%A1%A8%E6%95%B0%E6%8D%AE/" class="post-title-link" itemprop="url">wordpress前台实现向数据库添加数据的功能，类似添加防伪码或者序列码的需求，然后可以查询，也可以通过navicat的方式导入excel表数据，以及mysql乱码的问题解决方案</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-01-09 20:11:28" itemprop="dateCreated datePublished" datetime="2018-01-09T20:11:28+08:00">2018-01-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:58:03" itemprop="dateModified" datetime="2020-10-11T11:58:03+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wordpress/" itemprop="url" rel="index"><span itemprop="name">wordpress</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>这个我以wordpress默认的主题tweentyfifteen为例，我在主题根目录下新建一个模板文件，命名为：防伪码添加，文件名为<code>fanweima_add.php</code>，然后在主题目录下新建一个fanweima文件夹，在这个文件夹里面新建两个php文件：<code>fanweima_save.php</code>和config.php</p>
<p>准备材料：数据库，数据表（<code>wp_fanweima</code>），其中数据表的字段如下：</p>
<pre><code>CREATE TABLE `wp_fanweima` (
  `id` int not null primary key auto_increment,
  `name` char(20) COLLATE utf8_unicode_ci NOT NULL,
  `add_time` timestamp default current_timestamp,
  `brand` varchar(300) COLLATE utf8_unicode_ci NOT NULL
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;</code></pre>
<p>数据填充：</p>
<pre><code>INSERT INTO `wp_fanweima` (`id`, `name`, `add_time`, `brand`) VALUES
(1, &#39;112233&#39;, &#39;2017-12-21 00:00:00&#39;, &#39;yonghe&#39;),
(2, &#39;112234&#39;, &#39;2017-12-21 10:00:00&#39;, &#39;bisheng&#39;),
(3, &#39;112235&#39;, &#39;2017-12-21 10:23:00&#39;, &#39;bisheng&#39;),
(4, &#39;112236&#39;, &#39;2017-12-20 08:29:13&#39;, &#39;yongsheng&#39;),
(5, &#39;112237&#39;, &#39;2017-12-19 09:19:21&#39;, &#39;chaman&#39;),
(6, &#39;112238&#39;, &#39;2017-12-21 01:20:10&#39;, &#39;yonghe&#39;),
(7, &#39;112239&#39;, &#39;2017-12-21 13:10:00&#39;, &#39;bisheng&#39;),
(8, &#39;112240&#39;, &#39;2017-12-21 14:03:00&#39;, &#39;bisheng&#39;),
(9, &#39;112234&#39;, &#39;2017-12-20 16:09:13&#39;, &#39;yongsheng&#39;),
(10, &#39;112242&#39;, &#39;2017-12-19 09:19:21&#39;, &#39;chaman&#39;);</code></pre>
<p>另外，我们还可以在新建另外一个数据表（<code>wp_license</code>），其中创建数据表代码如下：</p>
<pre><code>CREATE TABLE `wp_license` (
  `id` int(16) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;9&#39;,
  `name` char(20) CHARACTER SET utf8 COLLATE utf8_unicode_ci NOT NULL,
  `brand` varchar(300) CHARACTER SET utf8 COLLATE utf8_unicode_ci NOT NULL,
  `fuzeren` varchar(20) CHARACTER SET utf8 COLLATE utf8_unicode_ci DEFAULT NULL,
  `diqu` varchar(200) CHARACTER SET utf8 COLLATE utf8_unicode_ci DEFAULT NULL,
  `chanpin` varchar(200) CHARACTER SET utf8 COLLATE utf8_unicode_ci DEFAULT NULL,
  `baozhiqi` varchar(16) CHARACTER SET utf8 COLLATE utf8_unicode_ci DEFAULT NULL,
  `attachment` varchar(255) CHARACTER SET utf8 COLLATE utf8_unicode_ci DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`)
) ENGINE=MyISAM AUTO_INCREMENT=54 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_520_ci;

-- ----------------------------
-- Records of wp_license
-- ----------------------------
INSERT INTO `wp_license` VALUES (&#39;41&#39;, &#39;34567&#39;, &#39;sdfhetj&#39;, &#39;ryhrym&#39;, &#39;etjegjn&#39;, &#39;tjnyemr&#39;, &#39;34&#39;, &#39;http://test.nocersity.com/wp-content/uploads/2018/03/blogging.jpg&#39;);
INSERT INTO `wp_license` VALUES (&#39;42&#39;, &#39;444&#39;, &#39;sdfghj&#39;, &#39;iuytre&#39;, &#39;dfvb&#39;, &#39;wefhjgn&#39;, &#39;56&#39;, &#39;http://test.notiusity.com/wp-content/uploads/2018/06/How.pdf&#39;);</code></pre>
<p>好的，准备工作完成后，我们进入正题。</p>
<p>文件结构我们准备好了，我们就先来说<code>fanweima_add.php</code>的文件内容。</p>
<p><strong>fanweima_add.php文件</strong></p>
<hr>
<p>我们找到内容显示区的代码，大概是在main标签里面：</p>
<pre><code>&lt;!-- 新添加的信息 开始 --&gt;
    &lt;div class=&quot;entry-content&quot;&gt;
        &lt;br&gt;
        &lt;form action=&quot;&lt;?php bloginfo(&#39;template_url&#39;); ?&gt;/fanweima/fanweima_save.php&quot; method=&quot;post&quot;&gt;
          &lt;div class=&quot;form-group&quot;&gt;
            &lt;label for=&quot;fanweimaname&quot;&gt;防伪码&lt;/label&gt;
            &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;fanweimaname&quot; name=&quot;name&quot; placeholder=&quot;输入防伪码&quot;&gt;
          &lt;/div&gt;
          &lt;div class=&quot;form-group&quot;&gt;
            &lt;label for=&quot;pingpaishang&quot;&gt;品牌商&lt;/label&gt;
            &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;pingpaishang&quot; name=&quot;brand&quot; placeholder=&quot;输入品牌商&quot;&gt;
          &lt;/div&gt;
          &lt;button type=&quot;submit&quot; class=&quot;btn btn-default&quot;&gt;Submit&lt;/button&gt;
        &lt;/form&gt;
    &lt;/div&gt;
&lt;!-- 新添加的信息 结束 --&gt;</code></pre>
<p>这个是显示在前台的一个表单，截图如下：</p>
<p><img src="https://i.imgur.com/L2vVtgF.png"></p>
<p>这个就是这个模板文件的作用，我们将向<code>fanweima_save.php</code>文件提交，代码：</p>
<pre><code>&lt;?php bloginfo(&#39;template_url&#39;); ?&gt;/fanweima/fanweima_save.php</code></pre>
<p>这里采用绝对路径。</p>
<p>好的我们来到fanweima文件夹中。</p>
<p><strong>config.php文件</strong></p>
<hr>
<p>这个文件很简单，就是连接数据库的文件，之所以把这几个环节分别放在不同的文件，这样做是为了条理清晰，分工明确，便于排错。好的，这个文件中的全部代码如下：</p>
<pre><code>&lt;?php 
//获取当前网站的配置文件
$gen=$_SERVER[&#39;DOCUMENT_ROOT&#39;];
require_once(&quot;$gen/wp-config.php&quot;);

//链接mysql服务器
$connection = mysqli_connect(DB_HOST, DB_USER, DB_PASSWORD);
//连接数据库
mysqli_select_db($connection, DB_NAME);
//设置字符编码 这个可以不设，保持默认就好
@mysqli_query(&#39;SET NAMES UTF8&#39;);
?&gt;</code></pre>
<p>这个文件分两部分，第一部分就是连接wordpress网站的配置文件，这样我们就不需要输入数据库账号密码了，这样相对来说是比较安全的。然后就是连接服务器，接着就是连上数据库，最后是设置字符编码。完事！</p>
<p><strong>fanweima_save.php文件</strong></p>
<hr>
<p>全部代码如下：</p>
<pre><code>&lt;?php 
    //引用数据库链接文件
    require(&quot;config.php&quot;); 
    //接收 AJAX 传递过来的数字：从第几篇开始
    $name = $_POST[&quot;name&quot;];
    $brand = $_POST[&quot;brand&quot;];
    $currentDate= date(&quot;Y-m-d H:i:s&quot;); 
    //下面是读取数据库数据
    $sql=&quot;insert into wp_fanweima values(null,$name,&#39;$currentDate&#39;,&#39;$brand&#39;)&quot;;
    $result = mysqli_query($connection,$sql) or die(mysqli_error($connection));
    echo &quot;&lt;script&gt;alert(&#39;防伪码添加成功!&#39;);location.href=&#39;&quot;.$_SERVER[&quot;HTTP_REFERER&quot;].&quot;&#39;;&lt;/script&gt;&quot;;
    mysqli_close($connection); //关闭数据库
?&gt;</code></pre>
<p>这个也做一个简单的讲解，第一个是引入数据库连接的文件，这个文件的路径就是在同目录中的config.php文件，只有连接上数据库才能对数据库进行查询。好的，连接成功后，把<code>fanweima_add.php</code>中的文件的请求字段name和brand，接着把数据插入数据表<code>（wp_fanweima）</code>中，这里需要提醒的是这个<code>mysqli_query</code>，在我以前使用纯php写的一个系统中貌似只需一个字段就行了，这里需要有两个字段，否则会报错，这里需要注意。参数一是连接信息，参数二是数据添加结果。当然，我们还可以进一步的对这个数据添加完善，比如做一个判断，如果记录受影响条数大于1的话，提示添加成功，否则添加失败，由于这里是用于的测试的，所以没有说得那么详细。</p>
<p>好的最后的结果，截图说明：</p>
<p><img src="https://i.imgur.com/23Zxs48.png"></p>
<p>数据库中截图：</p>
<p><img src="https://i.imgur.com/QPZJeW9.png"></p>
<p>上面这个方案是基于wordpress网站在htdocs根目录下的情况。下面这个我将会用另外一个方式来呈现。</p>
<hr>
<p><strong>这个方式，我将以enfold这个主题进行演示。</strong></p>
<p>wordpress站点目录：H:\Honest\software\wampserver\wamp\www\wordpress</p>
<p>我们根据上面的例子步骤：</p>
<p>1、在enfold主题下新建目录：wordpress/wp-content/themes/enfold/fanweima</p>
<blockquote>
<p>config.php，fanweima_save.php，license_save.php</p>
</blockquote>
<p>下载地址：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1WXRSpsVxKSIDdKOZm98ywA">https://pan.baidu.com/s/1WXRSpsVxKSIDdKOZm98ywA</a>，密码：6kxp</p>
<p>config.php代码：</p>
<pre><code>&lt;?php 

//获取当前文件所在目录
$gen=$_SERVER[&#39;DOCUMENT_ROOT&#39;];
require_once(&quot;$gen/wordpress/wp-config.php&quot;);
//如果笔者不是用的是子目录存放wordpress网站，那么应该用如下方式：
//require_once(&quot;$gen/wp-config.php&quot;);

//链接mysql服务器 开始
$connection = mysqli_connect(DB_HOST, DB_USER, DB_PASSWORD);
mysqli_select_db($connection, DB_NAME);
//设置字符编码
@mysqli_query(&#39;SET NAMES UTF8&#39;);
?&gt;</code></pre>
<p>区别：这里的引入地址要换成：/wordpress/wp-config.php，而不是/wp-config.php，原因就是这个站点的源码不是直接放在服务器额根目录下，而是在更目录下的wordpress文件夹下。</p>
<p>fanweima_save.php代码：</p>
<pre><code>&lt;?php 
    //引用数据库链接文件
    require(&quot;config.php&quot;); 
    //接收 AJAX 传递过来的数字：从第几篇开始
    $name = $_POST[&quot;name&quot;];
    $brand = $_POST[&quot;brand&quot;];
    $currentDate= date(&quot;Y-m-d H:i:s&quot;); 
    //下面是读取数据库数据
    // $sql = &quot;select id,name,brand from wp_fanweima order by id desc limit &quot;.$num.&quot;,3&quot;;
    $sql=&quot;insert into wp_fanweima values(null,$name,&#39;$currentDate&#39;,&#39;$brand&#39;)&quot;;
    $result = mysqli_query($connection,$sql) or die(mysqli_error($connection));
    echo &quot;&lt;script&gt;alert(&#39;防伪码添加成功!&#39;);location.href=&#39;&quot;.$_SERVER[&quot;HTTP_REFERER&quot;].&quot;&#39;;&lt;/script&gt;&quot;;
    mysqli_close($connection); //关闭数据库
?&gt;</code></pre>
<p>license_save.php代码：</p>
<pre><code>&lt;?php 
    //引用数据库链接文件
    require(&quot;config.php&quot;); 
    $name = $_POST[&quot;name&quot;];
    $brand = $_POST[&quot;brand&quot;];
    $fuzeren = $_POST[&quot;fuzeren&quot;];
    $diqu = $_POST[&quot;diqu&quot;];
    $chanpin = $_POST[&quot;chanpin&quot;];
    $baozhiqi = $_POST[&quot;baozhiqi&quot;];
    $file_name=$_POST[&quot;news_file&quot;];
    //下面是读取数据库数据
    // $sql = &quot;select id,name,brand from wp_fanweima order by id desc limit &quot;.$num.&quot;,3&quot;;
    $sql=&quot;insert into wp_license values(null,&#39;$name&#39;,&#39;$brand&#39;,&#39;$fuzeren&#39;,&#39;$diqu&#39;,&#39;$chanpin&#39;,&#39;$baozhiqi&#39;,&#39;$file_name&#39;)&quot;;
    $result = mysqli_query($connection,$sql) or die(mysqli_error($connection));
    echo &quot;&lt;script&gt;alert(&#39;序列码添加成功!&#39;);location.href=&#39;&quot;.$_SERVER[&quot;HTTP_REFERER&quot;].&quot;&#39;;&lt;/script&gt;&quot;;
    mysqli_close($connection); //关闭数据库
?&gt;</code></pre>
<p>好的，我们添加的一个防伪码的查询模板文件：page_license.php，把以下代码：</p>
<pre><code>&lt;?php
$genmul=$_SERVER[&#39;DOCUMENT_ROOT&#39;];
require_once(&quot;$genmul/wordpress/wp-config.php&quot;);
// 如果我们采用的不是子目录方式（wordpress放在服务器的wordrpess的文件夹下），就采用如下方式：
// require_once(&quot;$genmul/wp-config.php&quot;);

//链接mysql服务器 开始
$connection = mysqli_connect(DB_HOST, DB_USER, DB_PASSWORD);
mysqli_select_db($connection, DB_NAME);
//链接mysql服务器 结束

?&gt;

&lt;form action=&quot;#&quot; method=&quot;post&quot; class=&quot;form-control&quot;&gt;
    &lt;input type=&quot;text&quot; name=&quot;license&quot; placeholder=&quot;输入序列码&quot;&gt;
    &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;查询&quot;&gt;
&lt;/form&gt;

&lt;?php
if (@$_POST[&#39;license&#39;] !== null) &#123;

    $localtime=date(&#39;Y-m-d H:i:s&#39;,time());
    $license=$_POST[&quot;license&quot;];
    $query_Recordset1 = &quot;SELECT * FROM `wp_license` where name =$license&quot;;
    $Recordset1 = mysqli_query($connection, $query_Recordset1 ) or die(mysqli_error($connection));
    $row_Recordset1 = mysqli_fetch_assoc($Recordset1);
    $totalRows_Recordset1 = mysqli_num_rows($Recordset1);
    if ($totalRows_Recordset1 &lt;= 0) &#123;
        echo &quot;请注意！这个序列码无效&lt;br&gt;&quot;;
    &#125;
    else&#123;
        echo &#39;&lt;ul class=&quot;list-group&quot;&gt;&#39;;
        echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;您的序列码为：&#39;.$_POST[&quot;license&quot;].&#39;&lt;/li&gt;&#39;;
        echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;您的序列码数量为：&#39;.$totalRows_Recordset1.&#39;&lt;/li&gt;&#39;;
        echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;码伪码所属品牌商：&#39;.$row_Recordset1[&quot;brand&quot;].&#39;&lt;/li&gt;&#39;;
        echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;序列码负责人：&#39;.$row_Recordset1[&quot;fuzeren&quot;].&#39;&lt;/li&gt;&#39;;
        echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;所属地区：&#39;.$row_Recordset1[&quot;diqu&quot;].&#39;&lt;/li&gt;&#39;;
        echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;产品名称：&#39;.$row_Recordset1[&quot;chanpin&quot;].&#39;&lt;/li&gt;&#39;;
        if ( is_user_logged_in() ) &#123;
            echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;产品检测报告下载：&lt;a  style=&quot;background:red&quot; href=&quot;&#39;.$row_Recordset1[&quot;attachment&quot;].&#39;&quot;&gt;预览&lt;/a&gt; &lt;a href=&quot;&#39;.$row_Recordset1[&quot;attachment&quot;].&#39;&quot; download&gt;下载&lt;/a&gt;&lt;/li&gt;&#39;;
        &#125;
        else&#123;
            echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;产品检测报告下载：&lt;a href=&quot;/wp-login.php&quot;&gt;请登录&lt;/a&gt;&lt;/li&gt;&#39;;
        &#125;
        echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;序列码查询时间：&#39;.$localtime.&#39;&lt;/li&gt;&#39;;
        echo &#39;&lt;/ul&gt;&#39;;
    &#125;

&#125;
else&#123;
    return &#39;&#39;;
&#125;

?&gt;

&lt;style&gt;
    .list-group&#123;
        margin:0px;
    &#125;
    a&#123;
        text-decoration: none !important;
        font-size: 12px;
    &#125;
    .form-control input&#123;
        padding:8px 15px;
    &#125;
    .list-group-item&#123;
        border:1px solid #aaa;
        padding:8px 15px;
        border-bottom: 0px;
    &#125;
    .list-group-item:last-child&#123;
        border-bottom: 1px solid #e0e0e0 !important;
    &#125;
    .list-group-item a&#123;
        background: #719430;
        padding: 5px 15px;
        border-radius: 3px;
        color: #fff;
    &#125;
&lt;/style&gt;</code></pre>
<p>添加进去。然后为这个模板文件命名为：</p>
<pre><code>/**
 *
    Template Name: 序列码查询
 *
 * This is the template that displays all pages by default.
 * Please note that this is the WordPress construct of pages and that
 * other &quot;pages&quot; on your WordPress site will use a different template.
 *
 */</code></pre>
<p>这里我们就会注意到代码：</p>
<pre><code>require_once(&quot;$genmul/wordpress/wp-config.php&quot;);</code></pre>
<p>这里我引入的地址是：/wordpress/wp-config.php，而不是/wp-config.php。</p>
<p>因为在web服务器的根目录下还有多个网站，wordpress网站笔者是放在wordpress这个目录下，因此要这样引用。区别就在这里。</p>
<p>在enfold主题里面复制page.php的代码，然后把以上的代码插入控制内容显示的区域：</p>
<p>也就是：</p>
<p><img src="https://i.imgur.com/s09DIDO.png"></p>
<p>这个位置的下面，在<code>&lt;main&gt;&lt;/main&gt;</code>标签之间即可。</p>
<p>最后的效果就是：</p>
<p><img src="https://i.imgur.com/jpcXS5G.png"></p>
<p>这个时候我们可以添加一个防伪码添加的功能的模板文件：license_add.php。把以下代码：</p>
<pre><code>&lt;!-- 新添加的信息 开始 --&gt;
    &lt;div class=&quot;entry-content&quot;&gt;
        &lt;br&gt;
        &lt;form action=&quot;&lt;?php bloginfo(&#39;template_url&#39;); ?&gt;/fanweima/license_save.php&quot; method=&quot;post&quot;&gt;
          &lt;div class=&quot;form-group&quot;&gt;
            &lt;label for=&quot;fanweimaname&quot;&gt;序列码&lt;/label&gt;
            &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;fanweimaname&quot; name=&quot;name&quot; placeholder=&quot;输入防伪码&quot;&gt;
          &lt;/div&gt;
          &lt;div class=&quot;form-group&quot;&gt;
            &lt;label for=&quot;pingpaishang&quot;&gt;品牌&lt;/label&gt;
            &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;pingpaishang&quot; name=&quot;brand&quot; placeholder=&quot;输入品牌商&quot;&gt;
          &lt;/div&gt;
          &lt;div class=&quot;form-group&quot;&gt;
            &lt;label&gt;负责人&lt;/label&gt;
            &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;fuzeren&quot; placeholder=&quot;负责人&quot;&gt;
          &lt;/div&gt;
          &lt;div class=&quot;form-group&quot;&gt;
            &lt;label&gt;地区&lt;/label&gt;
            &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;diqu&quot; placeholder=&quot;地区&quot;&gt;
          &lt;/div&gt;
          &lt;div class=&quot;form-group&quot;&gt;
            &lt;label&gt;产品名称&lt;/label&gt;
            &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;chanpin&quot; placeholder=&quot;产品名称&quot;&gt;
          &lt;/div&gt;
          &lt;div class=&quot;form-group&quot;&gt;
            &lt;label&gt;保质期&lt;/label&gt;
            &lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;baozhiqi&quot; placeholder=&quot;保质期&quot;&gt;
          &lt;/div&gt;
          &lt;div class=&quot;form-group&quot;&gt;
              &lt;label&gt;检测报告地址&lt;/label&gt;
            &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;exampleInputFile1&quot; name=&quot;news_file&quot;&gt;
          &lt;/div&gt;
          &lt;button type=&quot;submit&quot; class=&quot;btn btn-default&quot;&gt;Submit&lt;/button&gt;
        &lt;/form&gt;

    &lt;/div&gt;

&lt;!-- 新添加的信息 结束 --&gt;</code></pre>
<p>添加进入到模板文件中。然后我们就可以新建一个页面，在模板那里选择这个模板文件即可。</p>
<p>这个模板文件跟上次那个一样的操作，复制一个模板文件然后把以上代码嵌入到控制内容显示的位置即可。然后为这个模板文件命名：</p>
<pre><code>/**
 *
    Template Name: 序列码添加
 *
 * This is the template that displays all pages by default.
 * Please note that this is the WordPress construct of pages and that
 * other &quot;pages&quot; on your WordPress site will use a different template.
 *
 */</code></pre>
<p>最后的效果：</p>
<p><img src="https://i.imgur.com/9ZMeLPZ.png"></p>
<p>这样我们就可以通过页面进行信息的添加了，这种方案是用来解决防伪码数量比较少的情况而制定的。</p>
<p>如果我们的客户要添加大量的防伪码，那么这样会比较耗时间，这个时候建议采用把所有的防伪码整理成excel（选择.xls这个版本的excel）表，然后导入到数据表中。这里建议使用navicat这个工具。然后把整理好的文件一键导入即可。</p>
<p>在这个地方需要说一点：这个地方可能会出现乱码的情况，要么是当前端页面添加防伪码的时候有中文字符，添加成功后，到数据库中一看变成了乱码了；要么是数据表里面是中文，可是查询防伪码的时候，显示到前台的时候是乱码，那么解决mysql的乱码的终极解决发方案是什么呢？请往下看：</p>
<p>修改mysql配置文件/etc/my.cnf，由于笔者是在本地的wampp server里面测试的，所以这里的是my.ini，打开后把以下的代码加进入，如果原本有就设置成如下即可。</p>
<pre><code>[mysqld]
character-set-server=utf8 
[client]
default-character-set=utf8 
[mysql]
default-character-set=utf8</code></pre>
<p>请注意这几个参数配置的位置，不然可能会启动不起来mysql服务：</p>
<p><img src="https://i.imgur.com/M2K12Gr.png"></p>
<p>OK。这下如果你重启mysql服务也会发现它的字符集是utf8.</p>
<pre><code>show variables like &#39;%char%&#39;;</code></pre>
<p><img src="https://i.imgur.com/8NPQN3v.png"></p>
<p>而且我们创建表的时候不需要指定字符编码,它默认就是utf8;</p>
<pre><code>drop database wordpress;
create database wordpress;
use wordpress;
create table wp_license(name varchar(11));
show create table wp_license \G;</code></pre>
<p>我们就可以看到：</p>
<p><img src="https://i.imgur.com/CYW1x1D.png"></p>
<p>笔者上面说了这么多，整理一下本篇文章的代码：</p>
<h2 id="升级一下防伪码功能"><a href="#升级一下防伪码功能" class="headerlink" title="升级一下防伪码功能"></a>升级一下防伪码功能</h2><p>我们都知道，防伪码应该是暴露后就不能再次使用的了，或者这样说吧，防伪码一旦经过查询后就失效不能再次被查询的，这样才是符合实际情况的。不然很容易被仿制或者假冒的。</p>
<p>好的，笔者的思路是这样的：<strong>在防伪码查询页面那里如果查询了一个存在防伪码后，显示防伪码的明细，然后再执行一条删除这条防伪码记录，这样的话，刚才查询的防伪码就已经不再数据库表中了，那么当再次查询的时候就会显示不存在</strong></p>
<p>好的，思路明确后，我们打开上面的模板文件：page-license.php，添加如下代码：</p>
<pre><code>$delete_requested = &quot;DELETE FROM wp_license WHERE name =$license&quot;;
$Recordset2 = mysqli_query($connection, $delete_requested ) or die(mysqli_error($connection));</code></pre>
<p>到</p>
<pre><code>else&#123;
    echo &#39;&lt;ul class=&quot;list-group&quot;&gt;&#39;;
    echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;您的序列码为：&#39;.$_POST[&quot;license&quot;].&#39;&lt;/li&gt;&#39;;
    echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;您的序列码数量为：&#39;.$totalRows_Recordset1.&#39;&lt;/li&gt;&#39;;
    echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;码伪码所属品牌商：&#39;.$row_Recordset1[&quot;brand&quot;].&#39;&lt;/li&gt;&#39;;
    echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;序列码负责人：&#39;.$row_Recordset1[&quot;fuzeren&quot;].&#39;&lt;/li&gt;&#39;;
    echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;所属地区：&#39;.$row_Recordset1[&quot;diqu&quot;].&#39;&lt;/li&gt;&#39;;
    echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;产品名称：&#39;.$row_Recordset1[&quot;chanpin&quot;].&#39;&lt;/li&gt;&#39;;
    if ( is_user_logged_in() ) &#123;
        echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;产品检测报告下载：&lt;a  style=&quot;background:red&quot; href=&quot;&#39;.$row_Recordset1[&quot;attachment&quot;].&#39;&quot;&gt;预览&lt;/a&gt; &lt;a href=&quot;&#39;.$row_Recordset1[&quot;attachment&quot;].&#39;&quot; download&gt;下载&lt;/a&gt;&lt;/li&gt;&#39;;
    &#125;
    else&#123;
        echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;产品检测报告下载：&lt;a href=&quot;/wp-login.php&quot;&gt;请登录&lt;/a&gt;&lt;/li&gt;&#39;;
    &#125;
    echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;序列码查询时间：&#39;.$localtime.&#39;&lt;/li&gt;&#39;;
    echo &#39;  &lt;/ul&gt;&#39;;
&#125;</code></pre>
<p>后面，添加后的代码如下：</p>
<pre><code>else&#123;
    echo &#39;&lt;ul class=&quot;list-group&quot;&gt;&#39;;
    echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;您的序列码为：&#39;.$_POST[&quot;license&quot;].&#39;&lt;/li&gt;&#39;;
    echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;您的序列码数量为：&#39;.$totalRows_Recordset1.&#39;&lt;/li&gt;&#39;;
    echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;码伪码所属品牌商：&#39;.$row_Recordset1[&quot;brand&quot;].&#39;&lt;/li&gt;&#39;;
    echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;序列码负责人：&#39;.$row_Recordset1[&quot;fuzeren&quot;].&#39;&lt;/li&gt;&#39;;
    echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;所属地区：&#39;.$row_Recordset1[&quot;diqu&quot;].&#39;&lt;/li&gt;&#39;;
    echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;产品名称：&#39;.$row_Recordset1[&quot;chanpin&quot;].&#39;&lt;/li&gt;&#39;;
    if ( is_user_logged_in() ) &#123;
        echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;产品检测报告下载：&lt;a  style=&quot;background:red&quot; href=&quot;&#39;.$row_Recordset1[&quot;attachment&quot;].&#39;&quot;&gt;预览&lt;/a&gt; &lt;a href=&quot;&#39;.$row_Recordset1[&quot;attachment&quot;].&#39;&quot; download&gt;下载&lt;/a&gt;&lt;/li&gt;&#39;;
    &#125;
    else&#123;
        echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;产品检测报告下载：&lt;a href=&quot;/wp-login.php&quot;&gt;请登录&lt;/a&gt;&lt;/li&gt;&#39;;
    &#125;
    echo &#39;  &lt;li class=&quot;list-group-item&quot;&gt;序列码查询时间：&#39;.$localtime.&#39;&lt;/li&gt;&#39;;
    echo &#39;  &lt;/ul&gt;&#39;;
    //在数据表中删除上面查询的防伪码
    $delete_requested = &quot;DELETE FROM wp_license WHERE name =$license&quot;;
    $Recordset2 = mysqli_query($connection, $delete_requested ) or die(mysqli_error($connection));
&#125;</code></pre>
<p>保存，然后我们再试一下效果，当我们初次查询的时候：</p>
<p><img src="https://i.imgur.com/i9IBJtk.png"></p>
<p>很显然，由于防伪码为678的这个在数据表中，所以我们能够查看得到查询后的明细。当我们再次查询的时候，我们看下效果：</p>
<p><img src="https://i.imgur.com/gmDVYd6.png"></p>
<p>很显然这个已经不在数据表中了。问题搞定！</p>
<p><strong>3、总结一句话就是：</strong></p>
<p>网上很多答案都是直接在session级别设置mysql的字符编码，这是治标不治本的方法。我们还是要从源头上解决这个问题。那就是修改mysql默认的配置文件，把它的字符集修改成能够使用中文字符的UTF8就OK了。</p>
<p>好的，今天分享至此，希望大家尊重笔者原创，如有任何疑问和需要交流的请与我取得联络，QQ：791447771</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2018/01/09/%E4%B8%BAwordpress%E7%BD%91%E7%AB%99%E5%BC%80%E5%8F%91ajax%E5%8A%A0%E8%BD%BD%E6%9B%B4%E5%A4%9A%E7%9A%84%E5%8A%9F%E8%83%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/09/%E4%B8%BAwordpress%E7%BD%91%E7%AB%99%E5%BC%80%E5%8F%91ajax%E5%8A%A0%E8%BD%BD%E6%9B%B4%E5%A4%9A%E7%9A%84%E5%8A%9F%E8%83%BD/" class="post-title-link" itemprop="url">为wordpress网站开发ajax加载更多的功能</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-01-09 18:44:50" itemprop="dateCreated datePublished" datetime="2018-01-09T18:44:50+08:00">2018-01-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:52:53" itemprop="dateModified" datetime="2020-10-11T11:52:53+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>看了一篇文章，启发了我准备实现这个方案：为wordpress网站开发ajax加载更多的功能</p>
<p>这个我以wordpress默认的主题tweentyfifteen为例，我在主题根目录下新建一个模板文件，命名为：加载更多，文件名为page-more.php，然后在主题目录下新建一个restart文件夹，在这个文件夹里面新建两个php文件：get.php和config.php</p>
<p>然后我么你需要准备文件：jquery.dataTables.min.js这个库文件。把这个js文件放在主题的某个位置，通常我们放在js文件夹，然后在header.php引用这个javascript库。由于wordpress主题大都会引用了jquery这个库，所以一般不会再引用一次，当然，如果发现加载不出来，看下是否需要再次引用jquery。</p>
<p>好的文件结构我们准备好了后，我们就先来说page-more.php的文件内容。</p>
<p><strong>page-more.php文件</strong></p>
<hr>
<p>我们找到内容显示区的代码，大概是在main标签里面：</p>
<pre><code>&lt;!-- 添加自定义 开始 --&gt;

&lt;div class=&quot;entry-content&quot;&gt;

&lt;div class=&quot;box&quot;&gt;
    &lt;style type=&quot;text/css&quot;&gt;
        .hot&#123;
            cursor: pointer;
        &#125;
    &lt;/style&gt;
    &lt;ul&gt;
    &lt;?php query_posts(&#39;posts_per_page=5&amp;caller_get_posts=1&#39;); ?&gt;
    &lt;?php while (have_posts()) : the_post(); ?&gt;
        &lt;li class=&quot;list-group-item&quot;&gt;
            &lt;a target=&quot;_blank&quot; href=&quot;&lt;?php the_permalink(); ?&gt;&quot; title=&quot;&lt;?php the_title(); ?&gt;&quot; class=&quot;title&quot;&gt;&lt;?php the_title(); ?&gt;&lt;/a&gt;
        &lt;/li&gt;
    &lt;?php endwhile; wp_reset_query(); ?&gt;
    &lt;/ul&gt;
&lt;/div&gt;
&lt;span class=&quot;hot btn btn-info&quot;&gt;加载更多&lt;/span&gt;

&lt;script type=&quot;text/javascript&quot;&gt;
    $(function()&#123;
    var num = 5;//初始化从第几篇开始点击加载
    var numm = 3; //每点击一次加载多少篇
    $(&quot;.hot&quot;).click(function()&#123;
    $.post( //使用Ajax 的 post方法
    &quot;&lt;?php bloginfo(&#39;template_url&#39;); ?&gt;/restart/get.php&quot;,//php文件路径
    &#123; numb:num&#125;, //传递参数：从第几篇开始
    function(response,status,xhr)&#123; //回调函数，返回数据
    $(&quot;.box&quot;).html( $(&quot;.box&quot;).html() + response);
    &#125;);
    num +=numm; //num 累加
    &#125;);
&#125;);
&lt;/script&gt;

&lt;/div&gt;

&lt;!-- 自定义代码 结束 --&gt;</code></pre>
<p>添加的这些自定义内容是一个先显示部分文章，然后显示 “加载更多” 的链接，这就是全部，里面的javascript代码是一个ajax的post请求方式，这个至关重要，没有这个就不会发起请求，自然就不会产生数据。好的完成这个后，我们接着往下看。</p>
<p><strong>get.php文件</strong></p>
<hr>
<p>这文件存放的是对数据库的查询代码，以及查询结果的输出，好的全部代码如下：</p>
<pre><code>&lt;?php 
    //引用数据库链接文件
    require(&quot;config.php&quot;); 
    //接收 AJAX 传递过来的数字：从第几篇开始
    $num = $_POST[&quot;numb&quot;]; 
    //下面是读取数据库数据
    $sql = &quot;select ID,post_title,guid from wp_posts order by ID desc limit &quot;.$num.&quot;,3&quot;;
    $result = mysqli_query($connection,$sql) or die(mysqli_error($connection));
    echo &quot;&lt;ul&gt;&quot;;
    while($row = mysqli_fetch_array($result))&#123;
    echo &#39;&lt;li class=&quot;list-group-item&quot;&gt;&lt;a href=&quot;&#39;.$row[&quot;guid&quot;].&#39;&quot;&gt;&#39;.$row[&quot;post_title&quot;].&#39;&lt;/a&gt;&lt;/li&gt;&#39;;
    &#125;
    echo &quot;&lt;/ul&gt;&quot;;
    mysqli_close($connection); //关闭数据库
?&gt;</code></pre>
<p>这个也做一个简单的讲解，第一个是引入数据库连接的文件，这个文件的路径就是在同目录中的config.php文件，只有连接上数据库才能对数据库进行查询。好的，连接成功后，把page-more.php中的文件的请求字段numb，通过这个发起请求，接着对查询进行一个遍历，这里需要提醒的是这个mysqli_query，在我以前使用纯php写的一个系统中貌似只需一个字段就行了，这里需要有两个字段，否则会报错，这里需要注意。参数一是连接信息，参数二是查询结果。</p>
<p>完成后就是对结果的循环遍历。最后关闭数据库连接。完成！</p>
<p><strong>config.php文件</strong></p>
<hr>
<p>这个文件很简单，就是连接数据库的文件，之所以把这几个环节分别放在不同的文件，这样做是为了条理清晰，分工明确，便于排错。好的，这个文件中的全部代码如下：</p>
<pre><code>&lt;?php 
//获取当前网站的配置文件
$gen=$_SERVER[&#39;DOCUMENT_ROOT&#39;];
require_once(&quot;$gen/wp-config.php&quot;);

//链接mysql服务器
$connection = mysqli_connect(DB_HOST, DB_USER, DB_PASSWORD);
//连接数据库
mysqli_select_db($connection, DB_NAME);
//设置字符编码 这个可以不设，保持默认就好
@mysqli_query(&#39;SET NAMES UTF8&#39;);
?&gt;</code></pre>
<p>这个文件分两部分，第一部分就是连接wordpress网站的配置文件，这样我们就不需要输入数据库账号密码了，这样相对来说是比较安全的。然后就是连接服务器，接着就是连上数据库，最后是设置字符编码。完事！</p>
<p>作为补充，我把page-more.php的全部代码贴一下吧：</p>
<pre><code>&lt;?php
/**
 *
    Template Name: 加载更多
 *
 * This is the template that displays all pages by default.
 * Please note that this is the WordPress construct of pages and that
 * other &quot;pages&quot; on your WordPress site will use a different template.
 *
 * @package WordPress
 * @subpackage Twenty_Fifteen
 * @since Twenty Fifteen 1.0
 */

get_header(); ?&gt;

&lt;!-- add custom --&gt;

    &lt;div id=&quot;primary&quot; class=&quot;content-area&quot;&gt;
        &lt;main id=&quot;main&quot; class=&quot;site-main&quot; role=&quot;main&quot;&gt;

        &lt;?php
        // Start the loop.
        while ( have_posts() ) : the_post();

            // Include the page content template.
            get_template_part( &#39;content&#39;, &#39;page&#39; );

            // If comments are open or we have at least one comment, load up the comment template.
            if ( comments_open() || get_comments_number() ) :
                comments_template();
            endif;

        // End the loop.
        endwhile;
        ?&gt;

&lt;!-- 添加自定义 开始 --&gt;


&lt;div class=&quot;entry-content&quot;&gt;

&lt;div class=&quot;box&quot;&gt;
    &lt;style type=&quot;text/css&quot;&gt;
        .hot&#123;
            cursor: pointer;
        &#125;
    &lt;/style&gt;
    &lt;ul&gt;
    &lt;?php query_posts(&#39;posts_per_page=5&amp;caller_get_posts=1&#39;); ?&gt;
    &lt;?php while (have_posts()) : the_post(); ?&gt;
        &lt;li class=&quot;list-group-item&quot;&gt;
            &lt;a target=&quot;_blank&quot; href=&quot;&lt;?php the_permalink(); ?&gt;&quot; title=&quot;&lt;?php the_title(); ?&gt;&quot; class=&quot;title&quot;&gt;&lt;?php the_title(); ?&gt;&lt;/a&gt;
        &lt;/li&gt;
    &lt;?php endwhile; wp_reset_query(); ?&gt;
    &lt;/ul&gt;
&lt;/div&gt;
&lt;span class=&quot;hot btn btn-info&quot;&gt;加载更多&lt;/span&gt;

&lt;script type=&quot;text/javascript&quot;&gt;
    $(function()&#123;
    var num = 5;//初始化从第几篇开始点击加载
    var numm = 3; //每点击一次加载多少篇
    $(&quot;.hot&quot;).click(function()&#123;
    $.post( //使用Ajax 的 post方法
    &quot;&lt;?php bloginfo(&#39;template_url&#39;); ?&gt;/restart/get.php&quot;,//php文件路径
    &#123; numb:num&#125;, //传递参数：从第几篇开始
    function(response,status,xhr)&#123; //回调函数，返回数据
    $(&quot;.box&quot;).html( $(&quot;.box&quot;).html() + response);
    &#125;);
    num +=numm; //num 累加
    &#125;);
&#125;);
&lt;/script&gt;

&lt;/div&gt;

&lt;!-- 自定义代码 结束 --&gt;

        &lt;/main&gt;&lt;!-- .site-main --&gt;
    &lt;/div&gt;&lt;!-- .content-area --&gt;

&lt;?php get_footer(); ?&gt;</code></pre>
<p>到目前位置我么就算完成了，前台也会如愿以偿的加载出了我们想要的内容，由于我这里调用的是防伪码数据表，这里我粘贴一下成果吧：</p>
<p><img src="https://i.imgur.com/9admqNq.jpg"></p>
<p>这样，每次点击加载更多就会显示三个防伪码。</p>
<p>补充一下：因为这个我都是写在一个模板文件里面的，所以只需要调用这个模板就行了，里面的加载更多的按钮位置也定义死了，这样可定制性就不太好，所以我们可以把html类的写在网站模板的后台编辑器里面。比如我把加载更多的这段代码：</p>
<pre><code>&lt;span class=&quot;hot btn btn-info&quot;&gt;加载更多&lt;/span&gt;</code></pre>
<p>写在编辑器里面：</p>
<p><img src="https://i.imgur.com/1mjL5bS.jpg"></p>
<p>这样就可以灵活点，当然这个是排版的问题，也可以通过css进行美化。今日到此为止。</p>
<p>打包文件下载地址：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1qqkL-nFJPEytbfmvRU243Q">https://pan.baidu.com/s/1qqkL-nFJPEytbfmvRU243Q</a>   密码：9ywz</p>
<p>本文为笔者原创，请尊重我们对分享的热情，如果你有更好的想法和新的突破，请联系我，大家共同创造更多的惊喜。</p>
<p>我的QQ:791447771</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2018/01/08/wordpress%E4%B8%BB%E9%A2%98%E7%8B%AC%E7%AB%8B%E9%A1%B5%E9%9D%A2%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/08/wordpress%E4%B8%BB%E9%A2%98%E7%8B%AC%E7%AB%8B%E9%A1%B5%E9%9D%A2%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/" class="post-title-link" itemprop="url">wordpress主题独立页面连接数据库进行数据查询</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-01-08 18:04:58" itemprop="dateCreated datePublished" datetime="2018-01-08T18:04:58+08:00">2018-01-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:08" itemprop="dateModified" datetime="2020-10-11T11:53:08+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一直以来很想挑战一下，实现wordpress自定义数据库表和对自定义数据表内容进行查询，今天居然做到了，wordpress确实给我们带来了很多惊喜。</p>
<p>准备材料：数据库，数据表（wp_fanweima），其中数据表的字段如下：</p>
<pre><code>CREATE TABLE `wp_fanweima` (
  `id` int not null primary key auto_increment,
  `name` char(20) COLLATE utf8_unicode_ci NOT NULL,
  `add_time` timestamp default current_timestamp,
  `brand` varchar(300) COLLATE utf8_unicode_ci NOT NULL
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;</code></pre>
<p>数据填充：</p>
<pre><code>INSERT INTO `wp_fanweima` (`id`, `name`, `add_time`, `brand`) VALUES
(1, &#39;112233&#39;, &#39;2017-12-21 00:00:00&#39;, &#39;yonghe&#39;),
(2, &#39;112234&#39;, &#39;2017-12-21 10:00:00&#39;, &#39;bisheng&#39;),
(3, &#39;112235&#39;, &#39;2017-12-21 10:23:00&#39;, &#39;bisheng&#39;),
(4, &#39;112236&#39;, &#39;2017-12-20 08:29:13&#39;, &#39;yongsheng&#39;),
(5, &#39;112237&#39;, &#39;2017-12-19 09:19:21&#39;, &#39;chaman&#39;),
(6, &#39;112238&#39;, &#39;2017-12-21 01:20:10&#39;, &#39;yonghe&#39;),
(7, &#39;112239&#39;, &#39;2017-12-21 13:10:00&#39;, &#39;bisheng&#39;),
(8, &#39;112240&#39;, &#39;2017-12-21 14:03:00&#39;, &#39;bisheng&#39;),
(9, &#39;112234&#39;, &#39;2017-12-20 16:09:13&#39;, &#39;yongsheng&#39;),
(10, &#39;112242&#39;, &#39;2017-12-19 09:19:21&#39;, &#39;chaman&#39;);</code></pre>
<p>好的，准备工作完成后，我们进入正题。</p>
<p>这个我以wordpress默认的主题tweentyfifteen为例，我在主题根目录下新建一个模板文件，命名为：防伪码查询，文件名为page-fanweima.php</p>
<p>首先，我们必须让主题中的模板文件能够连上wordpress数据库，好的。往下看：</p>
<p>情况一：知道数据库信息的情况下</p>
<hr>
<p>如果你知道网站的数据库信息，如：数据库服务器路径、数据库名、数据库用户名、数据库密码，这时，你可以直接在php文件中添加数据库链接。比方说：</p>
<pre><code>数据库服务器路径： http://localhost
数据库名：user
数据库用户名：user
数据库密码：345463</code></pre>
<p>这时，我们直接在这个独立的php文件中添加如下代码：</p>
<pre><code>define(&quot;DB_HOST&quot;,&quot;localhost&quot;);
define(&quot;DB_USER&quot;,&quot;user&quot;);
define(&quot;DB_PWD&quot;,&quot;345463&quot;);
define(&quot;DB_NAME&quot;,&quot;user&quot;);
$conn = @mysql_connect(DB_HOST,DB_USER,DB_PWD) or die(&quot;连接服务器出错：&quot;.mysql_error());
@mysql_select_db(DB_NAME) or die(&quot;连接数据库出错：&quot;.mysql_error());
@mysql_query(&#39;SET NAMES UTF8&#39;);
//然后可以对数据库数据操作</code></pre>
<p>情况二：不知道数据库信息的情况下</p>
<hr>
<p>当然，对自己的网站那是肯定知道数据库信息的，如果你是wordpress主题开发者，而这些新开发的主题你又想让更多的人使用，甚至想买卖这些wordpress主题，这时，我们就不知道用户们的网站的数据库信息了。这时，我们就不能通过上面的方法来链接数据库了。</p>
<p>其实，wordpress程序自身就有链接数据库的文件，就是wordpress根目录下的wp_config.php文件，这个文件中就有数据库信息，我们只需要引用这个文件，就可以直接使用这些数据库信息了。但是，我们又不能使用固定的绝对路径来引用这个文件，因为不同的网站，绝对路径是不一样的。这时，我们就必须通过php方法来动态获取到这个绝对路径。代码如下：</p>
<pre><code>//获取当前文件所在目录
define(&quot;__S__&quot;,str_replace(&quot;\\&quot;,&quot;/&quot;,dirname(__FILE__)));
/*获取wordpress所在目录,这里要位移取决于最后面的那个数字，现在调整为33,为了说的更清楚，举例：s.substr(a,b);的意思是从字符串s下标为a开始去字符中取出b个字符！
*这里就是以根目录下标为0，开始去字符取出33个字符，如果我把33改成0，那么得出的路径是“/wp-config.php”，如果我多取33个那么就变成“/wwwroot/webroot/www.kelin601.com/wp-config.php”，不同的路径长度可能不一样，需要调整这个值
*/
define(&quot;__ROOT__&quot;,substr(__S__,0,33));
//引用wp-config.php文件，获取数据库信息
require(__ROOT__.&quot;/wp-config.php&quot;);</code></pre>
<p>当然，这个我已经在我的另外一篇文章里面解释了这种方法的弊端，作为改进，我采用以下方式连接wp-config.php，代码如下：</p>
<pre><code>$wordpressroot=$_SERVER[&#39;DOCUMENT_ROOT&#39;];
require_once(&quot;$wordpressroot/wp-config.php&quot;);</code></pre>
<p>即可引用到，不过这个代码是直接引用的根目录，如果你的目录形式是使用子目录的 ，如在本地常见的<a target="_blank" rel="noopener" href="http://localhost/wordpress/%EF%BC%8C%E5%B0%B1%E9%9C%80%E8%A6%81%E5%9C%A8%E5%BC%95%E7%94%A8%E7%9A%84%E5%9C%B0%E6%96%B9%E5%8A%A0%E4%B8%8A%E4%BD%A0%E7%9A%84%E5%AD%90%E7%9B%AE%E5%BD%95%EF%BC%9A">http://localhost/wordpress/，就需要在引用的地方加上你的子目录：</a></p>
<pre><code>$wordpressroot=$_SERVER[&#39;DOCUMENT_ROOT&#39;].&#39;/wordpress&#39;;
require_once(&quot;$wordpressroot/wp-config.php&quot;);</code></pre>
<p>好的，这个时候，我们已经解决了连接配置文件的问题了。</p>
<p>接下来我们要连上数据库，在文件中继续添加代码：</p>
<pre><code>//链接mysql服务器 开始
$connection = mysqli_connect(DB_HOST, DB_USER, DB_PASSWORD);
mysqli_select_db($connection, DB_NAME);
//链接mysql服务器 结束</code></pre>
<p>这种方式就是不需要输入数据库的账号密码，相对来说是比较安全的，所以情况一，我们不到万不得已不采纳。</p>
<p>如果不报错的话，我们已经连上数据库了。接下来我们要写一个表单，用来发情http请求，获取数据库表中的数据，添加表单代码如下:</p>
<pre><code>&lt;form action=&quot;#&quot; method=&quot;post&quot; class=&quot;form-control&quot;&gt;
    &lt;input type=&quot;text&quot; name=&quot;fanweima&quot;&gt;
    &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;查询&quot;&gt;
&lt;/form&gt;</code></pre>
<p>因为我要在当前页面显示出来，所以form这里的action我就不写文件名，而是以#取代。</p>
<p>好的表单已经解决了，我们接下来就发送请求到数据库，然后显示出来，继续添加代码如下：</p>
<pre><code>&lt;?php
$localtime=date(&#39;Y-m-d H:i:s&#39;,time());  //这里说明下，如果y是小写的话，时间格式不太好看，这个顺带说下，改成大写的y
$fanweima=$_POST[&quot;fanweima&quot;];   //这里是表单的数据发出的请求
$query_Recordset1 = &quot;SELECT * FROM `wp_fanweima` where name =$fanweima&quot;;   //查询输入的防伪码
$Recordset1 = mysqli_query($connection, $query_Recordset1 ) or die(mysqli_error($connection));
$row_Recordset1 = mysqli_fetch_assoc($Recordset1);     //这个返回一个数组格式的对象
$totalRows_Recordset1 = mysqli_num_rows($Recordset1);   //查询的条数
if ($totalRows_Recordset1 &lt;= 0) &#123;
    echo &quot;请注意！这个不是正品&lt;br&gt;&quot;;
&#125;
else&#123;
    echo &quot;您的防伪码为：&quot;.$_POST[&quot;fanweima&quot;].&quot;&lt;/br&gt;&quot;;
    echo &quot;您的防伪码数量为：&quot;.$totalRows_Recordset1.&quot;&lt;/br&gt;&quot;;
    echo &quot;你搜索的防伪码的品牌商是：&quot;.$row_Recordset1[brand].&quot;&lt;br&gt;&quot;;
    echo &quot;防伪码添加时间：&quot;.$row_Recordset1[add_time].&quot;&lt;br&gt;&quot;;
    echo &quot;防伪码查询时间：&quot;.$localtime.&quot;&lt;br&gt;&quot;;
&#125;

?&gt;</code></pre>
<p>好的，最后这个模板文件如下：</p>
<pre><code>&lt;?php
/**
 *
    Template Name: 防伪码查询
 *
 * This is the template that displays all pages by default.
 * Please note that this is the WordPress construct of pages and that
 * other &quot;pages&quot; on your WordPress site will use a different template.
 *
 * @package WordPress
 * @subpackage Twenty_Fifteen
 * @since Twenty Fifteen 1.0
 */

get_header(); ?&gt;

&lt;!-- 添加数据库连接信息 开始 --&gt;
&lt;?php
//引入wordpress网站根目录的配置文件
$wordpressroot=$_SERVER[&#39;DOCUMENT_ROOT&#39;];
require_once(&quot;$wordpressroot/wp-config.php&quot;);

//链接mysql服务器 开始
$connection = mysqli_connect(DB_HOST, DB_USER, DB_PASSWORD);
mysqli_select_db($connection, DB_NAME);
//链接mysql服务器 结束
?&gt;
&lt;!-- 添加数据库连接信息 结束 --&gt;

    &lt;div id=&quot;primary&quot; class=&quot;content-area&quot;&gt;
        &lt;main id=&quot;main&quot; class=&quot;site-main&quot; role=&quot;main&quot;&gt;
        &lt;?php
        // Start the loop.
        while ( have_posts() ) : the_post();
            // Include the page content template.
            get_template_part( &#39;content&#39;, &#39;page&#39; );
            // If comments are open or we have at least one comment, load up the comment template.
            if ( comments_open() || get_comments_number() ) :
                comments_template();
            endif;
        // End the loop.
        endwhile;
        ?&gt;

&lt;!-- 添加自定义 开始 --&gt;
&lt;div class=&quot;entry-content&quot;&gt;
&lt;br&gt;
&lt;form action=&quot;#&quot; method=&quot;post&quot; class=&quot;form-control&quot;&gt;
    &lt;input type=&quot;text&quot; name=&quot;fanweima&quot;&gt;
    &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;查询&quot;&gt;
&lt;/form&gt;

&lt;?php
$localtime=date(&#39;Y-m-d H:i:s&#39;,time());
$fanweima=$_POST[&quot;fanweima&quot;];
$query_Recordset1 = &quot;SELECT * FROM `wp_fanweima` where name =$fanweima&quot;;
$Recordset1 = mysqli_query($connection, $query_Recordset1 ) or die(mysqli_error($connection));
$row_Recordset1 = mysqli_fetch_assoc($Recordset1);
$totalRows_Recordset1 = mysqli_num_rows($Recordset1);
if ($totalRows_Recordset1 &lt;= 0) &#123;
    echo &quot;请注意！这个不是正品&lt;br&gt;&quot;;
&#125;
else&#123;
    echo &quot;您的防伪码为：&quot;.$_POST[&quot;fanweima&quot;].&quot;&lt;/br&gt;&quot;;
    echo &quot;您的防伪码数量为：&quot;.$totalRows_Recordset1.&quot;&lt;/br&gt;&quot;;
    echo &quot;你搜索的防伪码的品牌商是：&quot;.$row_Recordset1[brand].&quot;&lt;br&gt;&quot;;
    echo &quot;防伪码添加时间：&quot;.$row_Recordset1[add_time].&quot;&lt;br&gt;&quot;;
    echo &quot;防伪码查询时间：&quot;.$localtime.&quot;&lt;br&gt;&quot;;
&#125;
?&gt;

&lt;/div&gt;
&lt;!-- 自定义代码 结束 --&gt;
        &lt;/main&gt;&lt;!-- .site-main --&gt;
    &lt;/div&gt;&lt;!-- .content-area --&gt;

&lt;?php get_footer(); ?&gt;</code></pre>
<p>把这个模板文件上传到wordpress主题的目录下，然后在wordpress的后台新建一个页面，在右边模板那里选择—防伪码查询，保存，在前端查看效果，这个时候出现一个输入框和一个查询按钮，这个时候，根据前面说的数据准备中的，我们输入：112233，显示如下：</p>
<p><img src="https://i.imgur.com/bzGAXaQ.jpg"></p>
<p>输入一个不符合的防伪码试试，比如：123，显示的结果如下：</p>
<p><img src="https://i.imgur.com/JowbQRG.jpg"></p>
<p>说明达到了预期目标。</p>
<p>经过实践发现这个有个小问题，因为我这里没有经过判断，会产生这样一个报错，截图如下：</p>
<pre><code>&lt;?php
//进行一个判断，如果提交内容非空，则运行如下内容，否则，运行else里面的内容
if (@$_POST[&#39;fanweima&#39;] !== null) &#123;

    $localtime=date(&#39;Y-m-d H:i:s&#39;,time());
    $fanweima=$_POST[&quot;fanweima&quot;];
    $brand=$_POST[&quot;brand&quot;];
    $query_Recordset1 = &quot;SELECT * FROM `wp_fanweima` where name =$fanweima&quot;;
    $Recordset1 = mysqli_query($connection, $query_Recordset1 ) or die(mysqli_error($connection));
    $row_Recordset1 = mysqli_fetch_assoc($Recordset1);
    $totalRows_Recordset1 = mysqli_num_rows($Recordset1);
    if ($totalRows_Recordset1 &lt;= 0) &#123;
        echo &quot;请注意！这个不是正品&lt;br&gt;&quot;;
    &#125;
    else&#123;
        echo &quot;您的防伪码为：&quot;.$_POST[&quot;fanweima&quot;].&quot;&lt;/br&gt;&quot;;
        echo &quot;您的防伪码数量为：&quot;.$totalRows_Recordset1.&quot;&lt;/br&gt;&quot;;
        echo &quot;你搜索的防伪码的品牌商是：&quot;.$row_Recordset1[brand].&quot;&lt;br&gt;&quot;;
        echo &quot;你输入的防伪码的品牌商是：&quot;.$_POST[&quot;brand&quot;].&quot;&lt;br&gt;&quot;;
        echo &quot;防伪码添加时间：&quot;.$row_Recordset1[add_time].&quot;&lt;br&gt;&quot;;
        echo &quot;防伪码查询时间：&quot;.$localtime.&quot;&lt;br&gt;&quot;;
    &#125;
    mysqli_close($connection); //关闭数据库
&#125;
else&#123;
    return &#39;&#39;;
&#125;
?&gt;</code></pre>
<p>经过这样处理，就不会报错了，对比一下，其实就是进行了一个判断，把这个包起来。如果提交内容非空，则运行查询，否则，运行else里面的内容，就是返回空值。</p>
<p>这里我作为补充：我们可以进行多个字段进行搜索，比如我要进行防伪码和品牌商这两个进行搜索，该如何呢？我们对搜索表单进行一个修改，修改后如下：</p>
<pre><code>&lt;form action=&quot;#&quot; method=&quot;post&quot; class=&quot;form-control&quot;&gt;
    &lt;input type=&quot;text&quot; name=&quot;fanweima&quot;&gt;
    &lt;div class=&quot;form-group&quot;&gt;
        &lt;select class=&quot;form-control&quot; name=&quot;brand&quot;&gt;
            &lt;?php
                $query_Recordset3 = &quot;SELECT distinct(brand) FROM `wp_fanweima`&quot;;
                $Recordset3 = mysqli_query($connection, $query_Recordset3 ) or die(mysqli_error($connection));
                $row_Recordset3 = mysqli_fetch_assoc($Recordset3);
                while ($row=mysqli_fetch_array($Recordset3)) &#123;
                ?&gt;
                &lt;option value=&quot;&lt;?php echo $row[&#39;brand&#39;];?&gt;&quot;&gt;&lt;?php echo $row[&#39;brand&#39;];?&gt;&lt;/option&gt;
                &lt;?php
                &#125;
                ?&gt;
        &lt;/select&gt;
    &lt;/div&gt;
    &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;查询&quot;&gt;
&lt;/form&gt;</code></pre>
<p>由于多了一个参数brand，所以后面需要添加一条：</p>
<pre><code>&lt;?php
$localtime=date(&#39;Y-m-d H:i:s&#39;,time());
$fanweima=$_POST[&quot;fanweima&quot;];
$brand=$_POST[&quot;brand&quot;];   //新添加
--more--</code></pre>
<p>前台效果如下：</p>
<p><img src="https://i.imgur.com/kAMh41L.jpg"></p>
<hr>
<p>好的，现在总结下：这个地方很重要的三个地方：</p>
<ol>
<li>引入网站的配置文件</li>
<li>连接数据库</li>
<li>显示查询后的数据</li>
</ol>
<p>由于mysql_connect()方法由于php版本原因，已经不支持了，所以改成mysqli_connect(),其他的地方都要改成mysqli的方式。</p>
<p>当然，我们可以进行多方面的扩展，这个查询不仅仅局限于自定义的数据表，还有wordpress的默认表，都可以进行查询，只是wordpress对数据数的查询已经有了另外一种查询方式，就是使用wpdb这个变量，具体方式我已近在另外一篇文章里说明了，有什么疑问和有进一步补充的欢迎一起探讨和学习，我的QQ：791447771，本文笔者原创，请尊重我的创作，转载需说明来源。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/25/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><span class="page-number current">26</span><a class="page-number" href="/page/27/">27</a><span class="space">&hellip;</span><a class="page-number" href="/page/43/">43</a><a class="extend next" rel="next" href="/page/27/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">泉哥</p>
  <div class="site-description" itemprop="description">日记</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">424</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">400</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">泉哥</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
