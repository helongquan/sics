<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/22/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/22/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/05/10/%E9%80%9A%E8%BF%87javascript%E7%A6%81%E6%AD%A2%E7%94%B5%E8%84%91%E7%89%88%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BF%E9%97%AE%E7%BD%91%E7%AB%99%EF%BC%8C%E5%8C%85%E6%8B%AC%E5%BE%AE%E4%BF%A1%E7%94%B5%E8%84%91%E7%89%88%EF%BC%8C%E5%8F%AA%E8%AE%A9%E5%BE%AE%E4%BF%A1%E6%89%8B%E6%9C%BA%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/10/%E9%80%9A%E8%BF%87javascript%E7%A6%81%E6%AD%A2%E7%94%B5%E8%84%91%E7%89%88%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BF%E9%97%AE%E7%BD%91%E7%AB%99%EF%BC%8C%E5%8C%85%E6%8B%AC%E5%BE%AE%E4%BF%A1%E7%94%B5%E8%84%91%E7%89%88%EF%BC%8C%E5%8F%AA%E8%AE%A9%E5%BE%AE%E4%BF%A1%E6%89%8B%E6%9C%BA%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AE/" class="post-title-link" itemprop="url">通过javascript禁止电脑版浏览器访问网站，包括微信电脑版，只让微信手机客户端访问</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-05-10 22:13:50" itemprop="dateCreated datePublished" datetime="2018-05-10T22:13:50+08:00">2018-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:52:55" itemprop="dateModified" datetime="2020-10-11T11:52:55+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>笔者在折腾一个web应用的时候，不想让这个web应用在web浏览器上打开，只能在微信的内置浏览器里面打开。</p>
<p>笔者是这样处理的，在web应用的html中的头部，也就是<head>里面，添加了javascript代码：</p>
<pre><code>&lt;script type=&quot;text/javascript&quot;&gt;
    // 对浏览器的UserAgent进行正则匹配，不含有微信独有标识的则为其他浏览器
    var useragent = navigator.userAgent;
    if (useragent.match(/MicroMessenger/i) != &#39;MicroMessenger&#39;) &#123;
    // 这里警告框会阻塞当前页面继续加载
    var url = window.location.href;
    window.location.href = &#39;https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxe733fbd3986881fc&amp;redirect_uri=https://h5.zuijiadaxue.com/api/weixin/access&amp;response_type=code&amp;scope=snsapi_userinfo&amp;state=STATE#wechat_redirect&#39;;
    &#125;
&lt;/script&gt;</code></pre>
<p>这句脚本的意思就是判断客户端，对浏览器的UserAgent进行正则匹配，不含有微信独有标识的则为其他浏览器，就会报错，不能打开。</p>
<p>这个确实是达到了我们的目的。可是当我们用微信PC版客户端打开的时候，居然是可以打开的，这个其实也没错，这个确实在微信内置的浏览器里面打开的，但是这个不是我们希望的，笔者希望的是只有手机上面打开才行。所以这个就行。</p>
<p>面对这个问题，我继续在javascript上面处理，于是笔者准备了以下的脚本：</p>
<pre><code>&lt;script&gt;
        var ua = navigator.userAgent.toLowerCase();
        var isWeixin = ua.indexOf(&#39;micromessenger&#39;) != &quot;-1&quot;;
        var isMobile = ua.indexOf(&#39;mobile&#39;) != &quot;-1&quot;;
        if (!isWeixin || !isMobile) &#123;
            document.head.innerHTML = &#39;&lt;title&gt;很遗憾，请在微信手机版访问&lt;/title&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, user-scalable=0&quot;&gt;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/hidden.css&quot;&gt;&#39;;
            document.body.innerHTML = &#39;&lt;div class=&quot;weui_msg&quot;&gt;&lt;div class=&quot;weui_icon_area&quot;&gt;&lt;i class=&quot;weui_icon_info weui_icon_msg&quot;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&quot;weui_text_area&quot;&gt;&lt;h4 class=&quot;weui_msg_title&quot;&gt;请在微信手机客户端打开链接&lt;/h4&gt;&lt;/div&gt;&lt;/div&gt;&#39;;
        &#125;
&lt;/script&gt;</code></pre>
<p>这个脚本也很明白，就是如果不是微信或者不是手机客户端终端打开的，就加载新的东西，这个新的东西然后把要显示的东西隐藏掉，对此，这里笔者加载了一个样式表，笔者命名为：hidden.css，代码如下：</p>
<pre><code>body,html,p,span,a,h1,h2,h3,h4,h5,h6,i&#123;
    display: none !important;
&#125;
.container&#123;
    display: none !important;
&#125;</code></pre>
<p>代码很简单，就是把所有的东西都隐藏，这个很重要。</p>
<p>好的，我们把这两个结合起来就行了，这两个脚本由运行顺序的，先判断是否是微信客户端和是否是手机版这个脚本先运行。这个目的就是先屏蔽掉不符合规则的内容。但是这个虽然没有内容显示出来，但是可以通过浏览器查看源代码的方式看得到内容，所以我们还需要进行下一步，接着然后就是对浏览器的UserAgent进行正则匹配，不含有微信独有标识的则为其他浏览器，这个时候就会弹出报错信息，而这个报错信息就会掩盖掉web应用的源码信息，即使用户通过审查元素的方式也没法知道隐藏的信息了。最后粘贴一下：</p>
<pre><code>&lt;script&gt;
        var ua = navigator.userAgent.toLowerCase();
        var isWeixin = ua.indexOf(&#39;micromessenger&#39;) != &quot;-1&quot;;
        var isMobile = ua.indexOf(&#39;mobile&#39;) != &quot;-1&quot;;
        if (!isWeixin || !isMobile) &#123;
            document.head.innerHTML = &#39;&lt;title&gt;抱歉，出错了&lt;/title&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, user-scalable=0&quot;&gt;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/hidden.css&quot;&gt;&#39;;
            document.body.innerHTML = &#39;&lt;div class=&quot;weui_msg&quot;&gt;&lt;div class=&quot;weui_icon_area&quot;&gt;&lt;i class=&quot;weui_icon_info weui_icon_msg&quot;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&quot;weui_text_area&quot;&gt;&lt;h4 class=&quot;weui_msg_title&quot;&gt;请在微信手机客户端打开链接&lt;/h4&gt;&lt;/div&gt;&lt;/div&gt;&#39;;
        &#125;
&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
        // 对浏览器的UserAgent进行正则匹配，不含有微信独有标识的则为其他浏览器
        var useragent = navigator.userAgent;
        if (useragent.match(/MicroMessenger/i) != &#39;MicroMessenger&#39;) &#123;
        // 这里警告框会阻塞当前页面继续加载
        var url = window.location.href;
        window.location.href = &#39;https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxe733fbd3986881fc&amp;redirect_uri=https://h5.zuijiadaxue.com/api/weixin/access&amp;response_type=code&amp;scope=snsapi_userinfo&amp;state=STATE#wechat_redirect&#39;;
        &#125;
&lt;/script&gt;</code></pre>
<p>这样就可以达到最终目的。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/05/10/jquery%E6%88%AA%E5%8F%96%E8%B6%85%E5%87%BA%E9%95%BF%E5%BA%A6%E7%9A%84%E6%96%87%E5%AD%97%EF%BC%8C%E8%AE%A9%E8%BE%93%E5%87%BA%E7%9A%84%E6%96%87%E5%AD%97%E5%9C%A8%E8%A7%84%E5%AE%9A%E7%9A%84%E5%AD%97%E6%95%B0%E5%86%85%EF%BC%8C%E5%A4%9A%E4%BD%99%E7%9A%84%E7%94%A8%E7%82%B9%E7%82%B9%E6%98%BE%E7%A4%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/10/jquery%E6%88%AA%E5%8F%96%E8%B6%85%E5%87%BA%E9%95%BF%E5%BA%A6%E7%9A%84%E6%96%87%E5%AD%97%EF%BC%8C%E8%AE%A9%E8%BE%93%E5%87%BA%E7%9A%84%E6%96%87%E5%AD%97%E5%9C%A8%E8%A7%84%E5%AE%9A%E7%9A%84%E5%AD%97%E6%95%B0%E5%86%85%EF%BC%8C%E5%A4%9A%E4%BD%99%E7%9A%84%E7%94%A8%E7%82%B9%E7%82%B9%E6%98%BE%E7%A4%BA/" class="post-title-link" itemprop="url">jquery截取超出长度的文字，让输出的文字在规定的字数内，多余的用点点显示</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-05-10 18:50:29" itemprop="dateCreated datePublished" datetime="2018-05-10T18:50:29+08:00">2018-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:57:58" itemprop="dateModified" datetime="2020-10-11T11:57:58+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>有的时候，为了美化页面的显示，我们可能需要对文字，特别是标题的文字进行一个截取，或者是对博客文章的摘要进行截取，demo如下：</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;&lt;/title&gt;
    &lt;script src=&quot;https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js&quot;&gt;&lt;/script&gt;
    &lt;style&gt;
        .r-advInfo-itemText&#123;
            padding: 25px 20px;
            background: red;
            color: #fff;
            border-radius: 5px;
            width: 500px;
            display: block;
            margin:10px auto;
        &#125;
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class=&quot;r-advInfo-itemText&quot;&gt;
    &lt;h2 class=&quot;zxx_text_overflow&quot;&gt;月光如流水一般，静静地泻在这一片叶子和花上。薄薄的青雾浮起在荷塘里&lt;/h2&gt;
        &lt;p&gt;天心里颇不宁静。今晚在院子里坐着乘凉，忽然想起日日走过的荷塘，在这满月的光里该另有一番样子吧。月亮渐渐地升高了，墙外马路上孩子们的欢笑，已经听不见了；妻 屋里拍着闰儿，迷迷糊糊地哼着眠歌。我悄悄地披了大衫，带上门出去。&lt;/p&gt;
    &lt;div&gt;
        &lt;h2 class=&quot;zxx_text_overflow&quot;&gt;路上只我一个人，背着手踱着。这一片天地好像是我的，我也像超出了平常的自己&lt;/h2&gt;
        &lt;p&gt;
            荷塘的四面，远远近近，高高低低的都是树，而杨柳最多。这些树将一片荷塘重重围住；只在小路一旁，漏着几段空隙，像是特为月光留下的。树色一例是阴阴的，乍看像一团烟雾；但杨柳的丰姿，便在烟雾里也辨得出.
        &lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;script&gt;
    $(document).ready(function()&#123;
        //限制字符个数
        $(&quot;.zxx_text_overflow&quot;).each(function()&#123;
            var maxwidth=20;
            if($(this).text().length&gt;maxwidth)&#123;
                $(this).text($(this).text().substring(0,maxwidth));
                $(this).html($(this).html()+&#39;…&#39;);
            &#125;
        &#125;);
    &#125;);
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>这个例子很典型的说明了jquery是如何截取文字的长度的。</p>
<p>下面就用一个实际的运用例子来说明下，笔者有个朋友说想让侧栏的文章标题和文字显示字数得到一个限制，以美化一下这个地方，这个时候刚好用得上这个。</p>
<p>由于笔者这里用在了magento上面，里面已经有了jquery的调用，而且里面本身就对jquery进行了重写，所以这里笔者把这个javascript代码也要跟随magento主题的编写规则，根据开发者工具我们找到了文章标题的dom节点是：<code>.postTitle h2</code>，文章内容的dom节点是：<code>.postContent</code>。好的，我的写法如下：</p>
<pre><code>&lt;script&gt;
    jQuery(function($)&#123;
        jQuery(&quot;.postContent&quot;).each(function()&#123;
            // 选择class为postContent下的内容，控制显示的长度是100个字符作为摘要
            var maxwidth=100;
            if(jQuery(this).text().length&gt;maxwidth)&#123;
                jQuery(this).text(jQuery(this).text().substring(0,maxwidth));
                jQuery(this).html(jQuery(this).html()+&#39;…&#39;);
            &#125;
        &#125;);
    &#125;);
&lt;/script&gt;
&lt;script&gt;
    jQuery(function($)&#123;
        jQuery(&quot;.postTitle h2&quot;).each(function()&#123;
            // 选择class为postTitle下的h2标签，控制显示的长度是40个字符
            var maxwidth=40;
            if(jQuery(this).text().length&gt;maxwidth)&#123;
                jQuery(this).text(jQuery(this).text().substring(0,maxwidth));
                jQuery(this).html(jQuery(this).html()+&#39;…&#39;);
            &#125;
        &#125;);
    &#125;);
&lt;/script&gt;</code></pre>
<p>笔者之所以写这两种形式，主要是让大家顺便知道一下重写$的用法，高手请忽略。</p>
<p>最后的效果如下：</p>
<p><img src="https://i.imgur.com/LyfBCFd.jpg"></p>
<p>当标题超出40个字符串的时候，被截断，多余的用…表示，同样的，内容当超过100个字符串之后被截断，多余的用…表示。</p>
<p>作为补充，这里如果只是想让手机版截取，PC版上不截取，这个该怎么办呢？解决方案如下：</p>
<pre><code>&lt;script&gt;
    jQuery(function($)&#123;
          if ($(&quot;.section&quot;).width() &lt;= 767) &#123;
              jQuery(&quot;.postTitle h2&quot;).each(function()&#123;
                  // 选择class为postTitle下的h2标签，控制显示的长度是40个字符
                  var maxwidth=40;
                  if(jQuery(this).text().length&gt;maxwidth)&#123;
                      jQuery(this).text(jQuery(this).text().substring(0,maxwidth));
                      jQuery(this).html(jQuery(this).html()+&#39;…&#39;);
                  &#125;
              &#125;);
          &#125;
    &#125;);
&lt;/script&gt;</code></pre>
<p>这段代码的意思就是，当dom元素class为section的div宽度为767px的时候，执行里面的代码。里面的代码就是截取字符长度的功能。</p>
<p>更多的可以参考jquery的<a target="_blank" rel="noopener" href="http://www.w3school.com.cn/tiy/t.asp?f=jquery_dim_width_height">尺寸</a>这个api。</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;script src=&quot;https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js&quot;&gt;&lt;/script&gt;
&lt;/script&gt;
&lt;script&gt;
$(document).ready(function()&#123;
  $(&quot;button&quot;).click(function()&#123;
    var txt=&quot;&quot;;
    txt+=&quot;Width of div: &quot; + $(&quot;#div1&quot;).width() + &quot;&lt;/br&gt;&quot;;
    txt+=&quot;Height of div: &quot; + $(&quot;#div1&quot;).height();
    $(&quot;#div1&quot;).html(txt);
  &#125;);
&#125;);
&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;div id=&quot;div1&quot; style=&quot;height:100px;width:300px;padding:10px;margin:3px;border:1px solid blue;background-color:lightblue;&quot;&gt;&lt;/div&gt;
&lt;br&gt;
&lt;button&gt;显示 div 的尺寸&lt;/button&gt;
&lt;p&gt;width() - 返回元素的宽度。&lt;/p&gt;
&lt;p&gt;height() - 返回元素的高度。&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>
<hr>
<p>**更新：2019/2/14 17:18:33 **</p>
<p>笔者在使用过程中最常见的是，对博客列表的摘要进行截取，把多余的地方切掉，可是笔者在处理这个地方的时候，博客是抓取出来的，就是说是一个循环，而且在这个摘要里面包含了一个按钮，而这个按钮是我需要保留下来的，不能被截取掉。这个时候该怎么处理，且看如下：</p>
<p><strong>html代码：</strong></p>
<pre><code>&lt;div class=&quot;slide-content&quot;&gt;
    &lt;div class=&quot;slide-entry-excerpt entry-content&quot; itemprop=&quot;text&quot;&gt;Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute…&lt;div class=&quot;read-more-link&quot;&gt;&lt;a href=&quot;/2019/02/14/why-you-need/&quot; class=&quot;more-link&quot;&gt;Read more&lt;span class=&quot;more-link-arrow&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
<p><strong>js代码：</strong></p>
<pre><code>&lt;script src=&quot;https://code.jquery.com/jquery-3.3.1.min.js&quot;&gt;&lt;/script&gt;

&lt;script&gt;
jQuery(function($)&#123;
  if(jQuery(&quot;#blog_block&quot;).find(&quot;.slide-entry-excerpt&quot;).length &gt;= 1)&#123;
      jQuery(&quot;#blog_block .slide-entry-excerpt&quot;).each(function()&#123;
          jQuery(this).after(jQuery(this).children(&quot;.read-more-link&quot;).html());
          var maxwidth=120;
          if(jQuery(this).text().length&gt;maxwidth)&#123;
              jQuery(this).text(jQuery(this).text().substring(0,maxwidth));
              jQuery(this).html(jQuery(this).html()+&#39;…&#39;);
          &#125;
      &#125;);
  &#125;
&#125;);
&lt;/script&gt;</code></pre>
<p>说明一下：因为这个是某个页面中才有的，而这个js代码是放在footer.php里面的，这个是一个公共底部，所以为了不在其他页面运行的时候出现报错信息，需要做个判断，看下是否有这个东西：</p>
<pre><code>jQuery(&quot;#blog_block&quot;).find(&quot;.slide-entry-excerpt&quot;).length &gt;= 1</code></pre>
<p>有就进行下一步的运行，否则不运行这些代码。其中blog_block这个是笔者自己为这个区域命名的一个id。</p>
<p>接着这个代码里面有个each循环，然后把这个按钮提取出来放在这个摘要外部的后面而不是摘要内部的后面。</p>
<pre><code>jQuery(this).after(jQuery(this).children(&quot;.read-more-link&quot;).html());</code></pre>
<p>先提取出来后，再进行截取，这个顺序很重要。这里用了this，说明是对当前的这个进行提取，如果写死了，那么就会出现三个。所以这个很重要。最后的效果：</p>
<p><img src="https://i.imgur.com/qNefwRs.jpg"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/05/10/javascript%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%A1%B5%E7%9A%84%E6%89%80%E6%9C%89%E9%93%BE%E6%8E%A5%E4%B8%8D%E8%83%BD%E7%82%B9%E5%87%BB%E4%BB%A5%E5%8F%8A%E7%A6%81%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/10/javascript%E5%AE%9E%E7%8E%B0%E7%BD%91%E9%A1%B5%E7%9A%84%E6%89%80%E6%9C%89%E9%93%BE%E6%8E%A5%E4%B8%8D%E8%83%BD%E7%82%B9%E5%87%BB%E4%BB%A5%E5%8F%8A%E7%A6%81%E7%94%A8/" class="post-title-link" itemprop="url">javascript实现网页的所有链接不能点击以及禁用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-05-10 12:26:01" itemprop="dateCreated datePublished" datetime="2018-05-10T12:26:01+08:00">2018-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:57:57" itemprop="dateModified" datetime="2020-10-11T11:57:57+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近有个朋友说要让网站中页面的链接都不能被点击，这个时候我在想这个问题应该是跟javascript有关的。</p>
<p>笔者这里采用的是jquery，当然也可以采用javascript的方式。</p>
<p>如果使用jquery的话，经过笔者检验的代码如下：</p>
<pre><code>&lt;script&gt;
jQuery(function($)&#123;
    jQuery(&quot;a&quot;).removeAttr(&#39;href&#39;);
    jQuery(&quot;a&quot;).removeAttr(&#39;onclick&#39;);
    jQuery(&quot;a&quot;).attr(&#39;disabled&#39;,&quot;true&quot;);
&#125;);
&lt;/script&gt;</code></pre>
<p>这里由于避免与原来的jquery冲突，重写了$，因此用jQuery代替了$，不用重写的话是这样的：</p>
<pre><code>&lt;script&gt;
$(document).ready(function()&#123;
    $(&quot;a&quot;).removeAttr(&#39;href&#39;);
    $(&quot;a&quot;).removeAttr(&#39;onclick&#39;);
    $(&quot;a&quot;).attr(&#39;disabled&#39;,&quot;true&quot;);
&#125;);
&lt;/script&gt;</code></pre>
<p>把代码放在页面中，或者放在公共头部，或者是公共底部，如果找不到的话就放在当前页面的里面。</p>
<p><strong>这里额外贴一下热心网友提供的方案：</strong></p>
<p>jquery禁用a标签方法1</p>
<pre><code>$(document).ready(function () &#123;
        $(&quot;a&quot;).each(function () &#123;
            var textValue = $(this).html();
            if (textValue == &quot;XX概况&quot; || textValue == &quot;服务导航&quot;) &#123;
                $(this).css(&quot;cursor&quot;, &quot;default&quot;);
                $(this).attr(&#39;href&#39;, &#39;#&#39;);     //修改&lt;a&gt;的 href属性值为 #  这样状态栏不会显示链接地址  
                $(this).click(function (event) &#123;
                    event.preventDefault();   // 如果&lt;a&gt;定义了 target=&quot;_blank“ 需要这句来阻止打开新页面
                &#125;);
            &#125;
        &#125;);
&#125;);</code></pre>
<p>jquery禁用a标签方法2</p>
<pre><code>$(&#39;a.tooltip&#39;).live(&#39;click&#39;, function(event) &#123;
   alert(&quot;抱歉,已停用！&quot;);  
   event.preventDefault();   
&#125;);</code></pre>
<p>jquery禁用a标签方法3</p>
<pre><code>$(function()&#123;
    $(&quot;a&quot;).removeAttr(&#39;href&#39;);//去掉a标签中的href属性
    $(&quot;a&quot;).removeAttr(&#39;onclick&#39;);//去掉a标签中的onclick事件
&#125;);</code></pre>
<p>jquery控制按钮的禁用与启用</p>
<p>控制按钮为禁用：</p>
<pre><code>&lt;script&gt;
    $(&quot;a&quot;).attr(&#39;disabled&#39;,&quot;true&quot;);添加disabled属性 
    $(&quot;a&quot;).removeAttr(&quot;disabled&quot;); 移除disabled属性
&lt;/script&gt;</code></pre>
<p>最后，提醒大家一下，笔者在实践的时候出了一个小小的错误，我把标签那里使用的是单引号，貌似不起作用，后来改成了双引号才起作用，大家要注意，如果不清楚单引号和双引号的区别，可以自行搜索了解详情。</p>
<p>如果大家还有什么更好的方案，可以告诉我，谢谢。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/05/09/javascript%E5%AE%9E%E7%8E%B0wordpress%E4%B8%AD%E7%9A%84woocommerce%E4%BA%A7%E5%93%81%E5%8D%95%E9%A1%B5%E5%B1%9E%E6%80%A7%E7%9A%84%E9%80%89%E6%8B%A9%E9%AB%98%E4%BA%AE%E6%96%B9%E6%A1%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/09/javascript%E5%AE%9E%E7%8E%B0wordpress%E4%B8%AD%E7%9A%84woocommerce%E4%BA%A7%E5%93%81%E5%8D%95%E9%A1%B5%E5%B1%9E%E6%80%A7%E7%9A%84%E9%80%89%E6%8B%A9%E9%AB%98%E4%BA%AE%E6%96%B9%E6%A1%88/" class="post-title-link" itemprop="url">javascript实现wordpress中的woocommerce产品单页属性的选择高亮方案</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-05-09 15:00:10" itemprop="dateCreated datePublished" datetime="2018-05-09T15:00:10+08:00">2018-05-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:57:57" itemprop="dateModified" datetime="2020-10-11T11:57:57+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wordpress/" itemprop="url" rel="index"><span itemprop="name">wordpress</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>用户wooommcerce的人都知道，大概很多时候我们可能需要一个可变产品，然后通过选择属性，获取自己某个适合自己的产品。可是默认情况是这样的：</p>
<p><img src="https://i.imgur.com/mn4uPvs.png"></p>
<p>这个是个下拉框，当然我们可以从后台那里选择：</p>
<p><img src="https://i.imgur.com/rd1X1wi.jpg"></p>
<p>这里需要安装一个插件才能看到，插件的下载地址：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1sOnTLlhn4bAEobAcQA7Q8g">WooCommerce Variation Swatches and Photos</a>，密码：ra2w</p>
<p>好的，采用radio的形式，到前台查看是这样的效果：</p>
<p><img src="https://i.imgur.com/7QWJZHs.jpg"></p>
<p>但是，尽管如此，客户还是喜欢类似这样的效果：</p>
<p><img src="https://i.imgur.com/9Ak3LuX.jpg"></p>
<p>好的，这里笔者这里的方案是采用radio这种方式，但是需要通过javascript和css的配合。</p>
<p>先浮动：</p>
<p><img src="https://i.imgur.com/mkw5tzv.png"></p>
<p>我们先把radio的按钮隐藏，代码如下，这个代码可能根据主题不一样也会不一样，笔者这里是采用enfold主题作为讲解，代码仅做参考：</p>
<pre><code>.variations .radio-select ul li &#123;
    float: left;
    margin-right: 20px;
&#125;
.variations .radio-select ul li label &#123;
    border: 1px solid #f7b557;
    width: 50px !important;
    text-align: center;
    display:block !important;
&#125;
.swatch-control.radio-select li label &#123;
    margin-left: 0px !important;
&#125;
.variations .radio-select ul li .radio-option&#123;
   max-width:0px !important;
   display:none;
&#125;</code></pre>
<p>通过css的美化，我们达到了类似的效果，<span style="color:red">这里提个醒</span> : 我之所以采用label，而不是li,那是因为lable是跟input是绑定在一起的，所以我们需要把label这个当做一个块级元素，以便这个border里面的所有区域对鼠标的点击事件进行响应。</p>
<p><img src="https://i.imgur.com/5BVSjSD.png"></p>
<p>已经很接近了，但是当我们点击的时候，颜色不会变化，这个时候我们就需要javascript的点击事件了，代码如下：</p>
<pre><code>&lt;script type=&quot;text/javascript&quot;&gt;
    $(function()&#123;
    $(&quot;.variations .radio-select ul li&quot;).click(function()&#123;
        if ($(this).hasClass(&#39;disabled&#39;)) &#123;
            $(this).css(&quot;border&quot;,&quot;1px solid #eee&quot;);
        &#125;else&#123;
               $(this).css(&quot;border&quot;,&quot;1px solid red&quot;).siblings().css(&quot;border&quot;,&quot;1px solid #eee&quot;);
        &#125;
    &#125;);
    &#125;)
&lt;/script&gt;</code></pre>
<p>说明：由于woocommerce的自带的功能，当我们的属性组合在后台设置了，才能被选中，打个比方，如果红色的尺寸没有XL，那么当我们选择红色的时候，再从Size的那里选择XL的时候，是不能被选择的，我们通过浏览器开发者工具可以看到这个：</p>
<pre><code>&lt;ul id=&quot;radio_select_pa_size5af29bc9a06b4&quot; class=&quot;&quot; data-attribute_name=&quot;attribute_pa_size&quot;&gt;
    &lt;li&gt;
        &lt;input class=&quot;radio-option&quot; name=&quot;attribute_pa_size_5af29bc9a05e2&quot; id=&quot;radio_pa_size5af29bc9a06b4_37&quot; type=&quot;radio&quot; data-value=&quot;37&quot; value=&quot;37&quot;&gt;
        &lt;label for=&quot;radio_pa_size5af29bc9a06b4_37&quot;&gt;37&lt;/label&gt;
    &lt;/li&gt;
    &lt;li class=&quot;disabled&quot;&gt;
        &lt;input class=&quot;radio-option&quot; name=&quot;attribute_pa_size_5af29bc9a05e2&quot; id=&quot;radio_pa_size5af29bc9a06b4_38&quot; type=&quot;radio&quot; data-value=&quot;38&quot; value=&quot;38&quot; disabled=&quot;disabled&quot;&gt;
        &lt;label for=&quot;radio_pa_size5af29bc9a06b4_38&quot;&gt;38&lt;/label&gt;
    &lt;/li&gt;
    &lt;li&gt;
        &lt;input class=&quot;radio-option&quot; name=&quot;attribute_pa_size_5af29bc9a05e2&quot; id=&quot;radio_pa_size5af29bc9a06b4_39&quot; type=&quot;radio&quot; data-value=&quot;39&quot; value=&quot;39&quot; checked=&quot;checked&quot;&gt;
        &lt;label for=&quot;radio_pa_size5af29bc9a06b4_39&quot;&gt;39&lt;/label&gt;
    &lt;/li&gt;
    &lt;li class=&quot;disabled&quot;&gt;
        &lt;input class=&quot;radio-option&quot; name=&quot;attribute_pa_size_5af29bc9a05e2&quot; id=&quot;radio_pa_size5af29bc9a06b4_40&quot; type=&quot;radio&quot; data-value=&quot;40&quot; value=&quot;40&quot; disabled=&quot;disabled&quot;&gt;
        &lt;label for=&quot;radio_pa_size5af29bc9a06b4_40&quot;&gt;40&lt;/label&gt;
    &lt;/li&gt;
&lt;/ul&gt;</code></pre>
<p>对应的是这样的：</p>
<p><img src="https://i.imgur.com/IHsFyxl.jpg"></p>
<p>好的，正因为这样，我们就可以对javascript代码进行分析了：</p>
<pre><code>&lt;script type=&quot;text/javascript&quot;&gt;
    $(function()&#123;
    $(&quot;.variations .radio-select ul li&quot;).click(function()&#123;
        if ($(this).hasClass(&#39;disabled&#39;)) &#123;
            $(this).css(&quot;border&quot;,&quot;1px solid #eee&quot;);
        &#125;else&#123;
               $(this).css(&quot;border&quot;,&quot;1px solid red&quot;).siblings().css(&quot;border&quot;,&quot;1px solid #eee&quot;);
        &#125;
    &#125;);
    &#125;)
&lt;/script&gt;</code></pre>
<p>这个里面有个判断，如果li标签里面有disabled这个class，那么就执行代码：</p>
<pre><code>$(this).css(&quot;border&quot;,&quot;1px solid #eee&quot;);</code></pre>
<p>否则，就执行代码：</p>
<pre><code>$(this).css(&quot;border&quot;,&quot;1px solid red&quot;).siblings().css(&quot;border&quot;,&quot;1px solid #eee&quot;);</code></pre>
<p>思路很清楚，这个为了达到看不出来的效果，那么所有li标签的边框默认的样式应该也是跟代码：</p>
<pre><code>$(this).css(&quot;border&quot;,&quot;1px solid #eee&quot;);</code></pre>
<p>里面控制的样式是一样的，因此：</p>
<pre><code>.variations .radio-select ul li label &#123;
    border: 1px solid #eee;
&#125;</code></pre>
<p>这个的border属性值就是<code>1px solid #eee</code></p>
<p>好的，从上面的代码不难看出，这个是基于jquery的，所以先引用<strong>jquery</strong>，通常wordpress都引用了这个javascript库，所以我们就不用再次引用，如果没有的话，需要再次引用。</p>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>这里如果再次引入jquery的时候，可能会存在一个jquery冲突的问题，这个时候我们需要解决冲突，</p>
<pre><code>&lt;script type=&quot;text/javascript&quot;&gt;
    var jQuery_3_3_1 = $.noConflict(true);
&lt;/script&gt;
&lt;script src=&quot;https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js&quot;&gt;&lt;/script&gt;</code></pre>
<p>在引入这个jquery的时候，添加一个冲突解决的代码。</p>
<p>然后在以后写的jquery的<code>$</code>的时候，全部用<code>jQuery_3_3_1</code>代替即可。</p>
<p>然后，我们把这个javascript代码放在wordpress里面的header.php里面的<code>&lt;/head&gt;</code>之前即可。</p>
<h2 id="这里有个小问题："><a href="#这里有个小问题：" class="headerlink" title="这里有个小问题："></a>这里有个小问题：</h2><p>当我们选择红色的时候，，然后我们从size里面选择一个有这个组合的，我们选择：37，那么红色+37这个组合的价格是77元，可是我们接着在Size里面选择40的时候（这个组合我在后台没有加产品和价格），按理说这个价格不显示才对，可是一直还是显示选择上一个有效组合的价格（也就是37），虽然点击40的那里颜色确实没有高亮，但是为了避免误会，这个价格不变化还是不太好。</p>
<p>为了解决这个问题，笔者采用一个巧妙的方法，就是只要是li标签里面有disabled的，我们都把它隐藏，这样当我们选红色的时候，根据上面的那个html代码可以看出：37和39是显示的，38和40隐藏的。</p>
<p>同样的，当我们选择其他的颜色的时候，只有没有这个组合，那么这个就应该隐藏，以免用户误点，造成纠纷。</p>
<p>所以这里只需要在css里面添加代码：</p>
<pre><code>.variations .radio-select ul li.disabled&#123;
   display:none;
&#125;</code></pre>
<p>这里提醒一下，这个class必须是这个区域的，如果其他区域也有的话，可能会莫名奇妙的被隐藏了，其实我们只需要把范围缩小基本就没啥问题的。</p>
<p>好的我们再来看下效果：</p>
<p><img src="https://i.imgur.com/nVZevWD.jpg"></p>
<p>这个时候，我们点击红色的时候，那么跟红色有效组合的只有尺寸为37和39的这两个。其他不符合的都被隐藏。</p>
<p>从可用性来讲，这两种方法都是可以的，笔者之所以这么啰嗦，仅仅是希望启发大家能够有个发散性思维，面对问题有更多的方案。</p>
<p>更新：2018/12/6 9:53:59 </p>
<p>这里笔者又有类似的需求，先安装woocommerce颜色切换插件（WooCommerce Variation Swatches and Photos），然后添加一个可变产品，添加东西，然后选择radio，添加属性…</p>
<p>然后就是点击某个属性高亮，其他的同级变暗。</p>
<p>js代码如下：</p>
<pre><code>&lt;script src=&quot;http://code.jquery.com/jquery-2.1.4.min.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
var jQuery = $.noConflict(true);
jQuery(document).ready(function()&#123;
  jQuery(&quot;.return-to-shop a&quot;).attr(&quot;href&quot;,&quot;http://ro.vazpra.com/store/&quot;);
  jQuery(&quot;.variations .swatch-control.radio-select li&quot;).click(function()&#123;
        jQuery(this).addClass(&quot;actives&quot;).siblings().removeClass(&quot;actives&quot;);
  &#125;);
  jQuery(&quot;#picker_pa_color .select-option&quot;).click(function()&#123;
        jQuery(this).addClass(&quot;actives&quot;).siblings().removeClass(&quot;actives&quot;);
  &#125;);
  jQuery(&quot;.woocommerce-Tabs-panel table td&quot;).removeAttr(&quot;style&quot;);
  jQuery(&quot;.woocommerce-Tabs-panel table td&quot;).removeAttr(&quot;width&quot;);
  jQuery(&quot;.woocommerce-Tabs-panel table&quot;).removeAttr(&quot;width&quot;);
&#125;)
&lt;/script&gt;</code></pre>
<p>把这个代码添加到wordpress的footer.php底部。其中，</p>
<pre><code>jQuery(&quot;.woocommerce-Tabs-panel table td&quot;).removeAttr(&quot;style&quot;);
jQuery(&quot;.woocommerce-Tabs-panel table td&quot;).removeAttr(&quot;width&quot;);
jQuery(&quot;.woocommerce-Tabs-panel table&quot;).removeAttr(&quot;width&quot;);</code></pre>
<p>是为了去除掉从word里面复制的表格，而带进来的自有格式，这里可以忽略。真正作用的是这里，</p>
<pre><code>jQuery(&quot;.variations .swatch-control.radio-select li&quot;).click(function()&#123;
    jQuery(this).addClass(&quot;actives&quot;).siblings().removeClass(&quot;actives&quot;);
&#125;);
jQuery(&quot;#picker_pa_color .select-option&quot;).click(function()&#123;
    jQuery(this).addClass(&quot;actives&quot;).siblings().removeClass(&quot;actives&quot;);
&#125;);</code></pre>
<p>css代码：</p>
<pre><code>.variations .radio-select ul li &#123;
    float: left;
    margin-right: 10px;
&#125;
.variations .radio-select ul li label &#123;
    width: 75px !important;
    text-align: center;
    display:block !important;
&#125;
.swatch-control.radio-select li label &#123;
    margin-left: 0px !important;
&#125;
#top .variations td &#123;
    text-align: left !important;
    padding: 4px 10px 10px 5px;
    vertical-align: middle !important;
&#125;
.swatch-wrapper &#123;
    padding: 2px 6px 2px 0px;
&#125;
.variations .radio-select ul li .radio-option&#123;
   max-width:0px !important;
   display:none;
&#125;
.variations .swatch-control.radio-select li&#123;
   border:1px solid #bbb;
&#125;
.actives&#123;
   border:1px solid #f2ab20 !important;
&#125;
.variations .swatch-wrapper.selected &#123;
    padding: 0px !important;
&#125;
.variations .swatch-wrapper &#123;
    padding: 0px 0px 0px 0px !important;
&#125;</code></pre>
<p>完成。最终效果：</p>
<p><img src="https://i.imgur.com/nTusU3L.jpg"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/05/08/wordpress%E8%81%94%E7%B3%BB%E8%A1%A8%E5%8D%95%E5%BC%B9%E7%AA%97%E9%87%87%E7%94%A8popup-maker%E6%8F%92%E4%BB%B6%E6%96%B9%E6%A1%88%E5%AE%9E%E7%8E%B0%E7%9A%84%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/08/wordpress%E8%81%94%E7%B3%BB%E8%A1%A8%E5%8D%95%E5%BC%B9%E7%AA%97%E9%87%87%E7%94%A8popup-maker%E6%8F%92%E4%BB%B6%E6%96%B9%E6%A1%88%E5%AE%9E%E7%8E%B0%E7%9A%84%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">wordpress联系表单弹窗采用popup maker弹窗插件方案实现网站头部添加询价表单的弹出效果</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-05-08 16:07:00" itemprop="dateCreated datePublished" datetime="2018-05-08T16:07:00+08:00">2018-05-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:58:03" itemprop="dateModified" datetime="2020-10-11T11:58:03+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wordpress/" itemprop="url" rel="index"><span itemprop="name">wordpress</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>前一阵子，有个客户需要一个这样的需求，想让别人访问自己的下载中心或者是某个页面先发送电邮后才能访问资源或者是下载资源，并且再次访问后不能经常性的弹出窗口让填电邮。</p>
<p>笔者在这里分解了下这个问题：</p>
<ol>
<li>弹窗</li>
<li>联系表单</li>
<li>会话控制（session或者是cookie）</li>
<li>支持全局控制和局部控制（可以访问网站的任意页面或者文章都会弹出窗口，也可以让指定的页面或者文章弹出窗口）。</li>
<li>必须要填写电邮才能访问，不填写的话打死都不让访问，而且刷新也没有，还得显示窗口。</li>
<li>联系表单填写完毕后重定向到某个地方或者当前页面</li>
</ol>
<p>分解后，我想到的好几种方案都感觉不太合适，或者说是不够完美，因为下载中心有很多个资源，如果下载每个资源都弹出一个窗口的话，我估计用户会疯了的。</p>
<p>然后采用wordpress的模板文件，笔者曾经采取的是新建一个模板文件，然后针对下载中心进行个性化开发。采用session，这个倒是没问题，联系表单这个问题也不大，可以采用脚本的形式，不需要经过数据库。至于弹窗嘛，也可以采用js的方式实现，但是要做到能够指定某些页面可以弹出窗口，或者全部窗口都弹出，这个工作量以及维护难度还是有的。</p>
<p>还有就是，必须要填写电邮才能访问，不填写不能访问，这个也是一个棘手的问题，资深人士除外，因此，从成本的角度考虑，因为这个是个例，需求不普遍，实现起来没有太大的价值，因此摒弃了这种方式。</p>
<p>下面我们进入重点，笔者这里采取的是插件的方式：popup maker</p>
<p>通过对这个插件的了解，几乎是全是为这个需求量身定做的。先去安装吧，安装完成后，我们会看到：</p>
<p><img src="https://i.imgur.com/OZv0Eb0.jpg"></p>
<p>已经有了Popup Maker这个选项了，我们进入到里面，新建一个：</p>
<p><img src="https://i.imgur.com/yISvsli.jpg"></p>
<p>接着往下，我们会看到有个设置的地方，这个是针对我们新建的这个弹窗的一些行为和显示方式：</p>
<p><img src="https://i.imgur.com/tbEeuQM.jpg"></p>
<p>这个写得很清楚，左边有（triggers触发器，Targeting目标，Display显示方式，close弹窗关闭方式），右边就是相关的设置项。</p>
<p>如果不想让弹窗每次都弹出，这个需要设置cookie，这个cookie是跟某个触发器结合的，以上截图的那个是点击打开的时候有cookie，比如以下这个：</p>
<p><img src="https://i.imgur.com/3TTvB4I.jpg"></p>
<p>这个是自动弹出窗口，比如我们在访问下载中心的时候，1000ms后弹出一个联系表单，不填写表单天王老子都不让访问，绑定的事件是下面的那个框中的，这个可以根据自己的需要进行设置。我做一个简单的解说，这里就是（弹窗关闭、表单发送成功或者表单已经提交过）后启用cookie，如果再次访问的时候，就不需要再次弹出窗口了。这里也有一个时效性性，这里默认是一个月，如果一个月以后再来访问，又会弹出一个窗口要你填写联系表单里的信息，当然这个可以根据自己的需求进行设定。</p>
<p>好的，针对支持全局控制和局部控制（可以访问网站的任意页面或者文章都会弹出窗口，也可以让指定的页面或者文章弹出窗口）这个问题，直接在Display那里设定就好了。当我们完成这些设置后，我们如何运用呢？</p>
<p>我们新建一个页面，然后来到添加文本那里：</p>
<p><img src="https://i.imgur.com/sF5uBGi.jpg"></p>
<p>这里就是添加一个文本编辑，然后我们看到：</p>
<p><img src="https://i.imgur.com/1qqSz09.jpg"></p>
<p>然后添加一个Subscription Form表单，这个就是所说的联系表单了。是这个插件内置的，貌似不能添加更多的字段。</p>
<p><img src="https://i.imgur.com/oYgnmlJ.jpg"></p>
<p>然后进入这里，对这个进行设定。这里里面可以进行一些设定包括电邮发送后的重定向和，表单的样式，以及弹窗等问题。</p>
<p>如果是添加Popup Trigger的时候，这里就是添加我们新建的那些popup，或者是自定义的，来张截图吧：</p>
<p><img src="https://i.imgur.com/CgdvaSX.jpg"></p>
<p>看到了吧，这个就是说在新建的页面中我们，我们就可以调用新建的弹窗。至于弹窗的行为以及cookie不是在这里设置的，而是在创建弹窗的那里设置的。</p>
<p>我们来个实际的问题吧，这里我的有个客户是这样的，他希望他的产品页面和商店（shop）页面都要有弹窗形式的联系表单，这个联系表单是在用户初次打开这个页面的时候要有弹窗，不能每次打开的时候都有弹窗，接着是必须先发送电邮，验证这个电邮是否有效后获取从网站管理员电邮发送的验证码，通过验证码才能下载已经加密的资源。</p>
<p>好的，我们新建一个Popup，命名为third popup：</p>
<p>第一步：</p>
<p><img src="https://i.imgur.com/Vzi5G7N.jpg"></p>
<p>第二步：让这个联系表单在页面打开的时候自动的弹出，或者是延时弹出：</p>
<p>这里可以设置cookie，让这个弹窗不要每次都弹出：</p>
<p><img src="https://i.imgur.com/9rxxfbU.jpg"></p>
<p>添加好了之后的效果：</p>
<p><img src="https://i.imgur.com/t4Lu090.jpg"></p>
<p>第三步：设置这个联系表单弹窗在哪些页面弹出，默认是全部都弹出，我们可以通过自定义设置，让这个在指定的页面进行弹窗。</p>
<p><img src="https://i.imgur.com/4GEAw3x.jpg"></p>
<p>这里选择是所有的商品单页都要弹窗，或者是shop页面也要弹窗。</p>
<p>笔者由于是调试阶段，因此，没有使用cookie，如果设置好了之后，只允许初次访问弹窗的话，那么就设置下cookie。</p>
<p>第四步：我们设置一下弹窗的cookie</p>
<p><img src="https://i.imgur.com/10WnAab.jpg"></p>
<p>这个里面cookie的名称是：pum-9317</p>
<p>然后我们需要去为这个触发器指定一个cookie的名字：</p>
<p><img src="https://i.imgur.com/sCcmfFg.jpg"></p>
<p>然后我们选择cookie的列表，我们找到上面的那个cookie的名字：</p>
<p><img src="https://i.imgur.com/UDgGYrZ.jpg"></p>
<p>这里我们回到触发器这里，我们选择Add New Cookie这个按钮，然后添加两个：Subscription Forms Successful和On Popup Close这两个事件，就是当联系表单成功订阅和关闭联系表单的时候，记录cookie值，当再次访问的时候，由于已经有了cookie值那么就不会再次弹出窗口了。</p>
<p>第五步：我们去看效果，我们访问shop页面的时候：</p>
<p><img src="https://i.imgur.com/OHtaVQb.jpg"></p>
<p>我们再去访问一下产品单页，看下效果：</p>
<p><img src="https://i.imgur.com/oY8onBF.jpg"></p>
<p>好的，可能有的还有一个需求，就是当我们把联系表单提交成功后，需要来个重定向，这里笔者说下怎么设置：</p>
<p>第六步：设置提交后的重定向，我们回到这个弹窗的联系表单那里，进行编辑</p>
<p><img src="https://i.imgur.com/zyPhKob.jpg"></p>
<p>设置重定向地址：</p>
<p><img src="https://i.imgur.com/gcIqzHX.jpg"></p>
<p>最后，笔者分享下如何让用户不得不发送电邮才能访问页面的强制性方法。</p>
<p>我的做法是这样的：直接把联系表单的那个close的地方通过css的方式屏蔽，就是不让这个东西显示出来，这样用户就会老老实实的发送电邮了。</p>
<p>这里有个局限的地方是，采用这个插件的默认联系表单的话，那么就只有两个输入框：名字和电邮，比如客户想要其他更多的字段，比如手机号，公司名等等。这个时候该怎么办呢？我们跟着往下走：</p>
<p>我们可以在popup那里添加一个联系表单来取代popup默认的联系表单，看截图：</p>
<p><img src="https://i.imgur.com/UUPdEKw.png"></p>
<p>又或者我们可以安装一个联系表单插件：contact form 7，然后获取联系表单的短码放在弹窗的popup里面：</p>
<p><img src="https://i.imgur.com/P3fYlmJ.png"></p>
<p>接着继续设置下面的选项：</p>
<p><img src="https://i.imgur.com/iPdzkM6.png"></p>
<p>意思就是对这个popup进行一个设置：当页面加载完毕后，就弹出窗口。然后下面又设置了一个cookie来控制，就是弹窗关闭后记录cookie，记录一个月。</p>
<p>好的，这个弹窗就算是做好了，我们应用到一个页面，看看如何应用。我们新建一个页面：</p>
<p><img src="https://i.imgur.com/04ET0ZV.png"></p>
<p>添加一个subscription form，然后把添加的popup加进来，看截图：</p>
<p><img src="https://i.imgur.com/S6e03fr.png"></p>
<p>添加完毕后，我们来到前台看效果：</p>
<p><img src="https://i.imgur.com/Ryj79LI.png"></p>
<p>这个时候我们就可以输入信息发送了，如果不让这个每一次都弹出，那么我们前面那个popup的设置cookie的那里就可以用得上了。</p>
<p>正确的做法应该是要在这里把cookie的名字加上，不然这个弹窗到底响应那个cookie的name是不知道的，如下截图：</p>
<p><img src="https://i.imgur.com/gsxEfgM.png"></p>
<p>整体大致如下，我们可以在邮箱那边设置自动回复功能，这样就可以做到推动密码给用户了。</p>
<blockquote>
<p>经过实践发现，通过网站里面的联系表单发送到已经设置了自动回复的QQ邮箱，那么已经设置了自动回复的QQ邮箱是可以收到电邮的，可是提交电邮的地址却不能收到自动回复的密码。</p>
</blockquote>
<blockquote>
<p>只有通过电邮客户端或者是在邮箱对邮箱发送的方式才能收到自动回复。</p>
</blockquote>
<p>具体的其他知识可以去官网了解。</p>
<h2 id="文章更新"><a href="#文章更新" class="headerlink" title="文章更新"></a>文章更新</h2><p>笔者通过采用contact form 7 和popup做了一个实验：点击按钮弹出联系表单窗口，然后发送电邮，接着经过网站管理员回电邮来获取验证码，然后在被加密的部分内容的输入框中输入刚才获取的验证码，然后显示出被加密的内容，同时点击获取验证码的按钮文字发生改变。</p>
<p>实现方式：</p>
<ol>
<li><p>安装popup插件</p>
</li>
<li><p>安装contact form 7插件</p>
</li>
<li><p>新建一个contact form 7联系表单</p>
</li>
<li><p>创建一个popup（命名为：mytest），在里面添加contact form 7短码。<br><img src="https://i.imgur.com/BWI5Jsz.png"></p>
</li>
<li><p>对mytest进行设置，由于这里是点击按钮才触发这个弹窗事件，所以这里在设置那里选择：<br><img src="https://i.imgur.com/aXgKssE.png"></p>
</li>
<li><p>由于发送电邮后，已经获取了验证码，第二次点击就应该不再弹出联系表单窗口了，所以这里设置一下cookie:<br><img src="https://i.imgur.com/MEPWAXL.png"></p>
</li>
<li><p>要想让这个cookie要跟第5步进行结合起来约束第二次点击，那么这里我们需要对第5步那里编辑一下：<br><img src="https://i.imgur.com/CRkZxy9.png"></p>
</li>
<li><p>然后指定这个弹窗要对哪个页面进行起作用，这里随便选择一个页面作为讲解，当我们选中页面的时候，那么这个弹窗只对指定的页面进行起作用，也可以全局设置，比如针对产品的，针对页面的，针对文章的，或者针对某些ID的等等。：<br><img src="https://i.imgur.com/56Y9X2k.png"></p>
</li>
<li><p>来到刚才指定的页面：<code>输入密码再访问</code>，创建一个触发器，截图如下：<br><img src="https://i.imgur.com/Bfubcko.png"><br><img src="https://i.imgur.com/bqSK1UF.png"></p>
</li>
<li><p>触发器已经做好了，我们就接着添加一个加密局部内容的功能。</p>
</li>
</ol>
<p>在functions.php文件中添加代码：</p>
<pre><code>function e_secret($atts, $content=null)&#123;
 extract(shortcode_atts(array(&#39;key&#39;=&gt;null), $atts));
 if(isset($_POST[&#39;e_secret_key&#39;]) &amp;&amp; $_POST[&#39;e_secret_key&#39;]==$key)&#123;
 return &#39;
&lt;div class=&quot;e-secret&quot;&gt;&#39;.$content.&#39;&lt;/div&gt;
&#39;;
 &#125;
 else&#123;
 return &#39;
&lt;form class=&quot;e-secret&quot; action=&quot;&#39;.get_permalink().&#39;&quot; method=&quot;post&quot; name=&quot;e-secret&quot;&gt;&lt;label&gt;输入密码下载资源：&lt;/label&gt;&lt;input type=&quot;password&quot; name=&quot;e_secret_key&quot; class=&quot;euc-y-i&quot; maxlength=&quot;50&quot;&gt;&lt;input type=&quot;submit&quot; class=&quot;euc-y-s&quot; value=&quot;确定&quot;&gt;
&lt;div class=&quot;euc-clear&quot;&gt;&lt;/div&gt;
&lt;/form&gt;
&#39;;
 &#125;
&#125;
add_shortcode(&#39;secret&#39;,&#39;e_secret&#39;);</code></pre>
<p>然后，在页面后天编辑中添加代码：</p>
<pre><code>[secret key=&quot;123&quot;]
&lt;div&gt;&lt;a href=&quot;#&quot;&gt;Architectural Lighting&lt;/a&gt;&lt;a href=&quot;#&quot;&gt;Entertainment Lighting&lt;/a&gt;&lt;a href=&quot;#&quot;&gt;LED Controller&lt;/a&gt;&lt;a href=&quot;#&quot;&gt;Download Catalogue&lt;/a&gt;&lt;/div&gt;
[/secret]</code></pre>
<p>这里是个简码：key里面的是密码，<code>[secret]...[/secret]</code>之间的内容是需要加密的内容。好的，确定好了这个之后，我们随便在这个页面添加点别的，然后保存，访问该页面的前台。</p>
<p><img src="https://i.imgur.com/VLXMbfa.png"></p>
<p>这个就是需要输入密码的输入框了，现在我们是不知道密码的，我们需要点击上面的按钮获取授权码，点击我们就会看到一个弹窗：</p>
<p><img src="https://i.imgur.com/jWk591R.png"></p>
<p>输入完毕后，发送，成功后，我们关闭这个弹窗，然后通过跟网站管理员联系获取授权码，然后我们就可以输入进入，成功后我们就可以看到我们想要看的资源了：</p>
<p><img src="https://i.imgur.com/fO9jdOt.png"></p>
<p>这个时候，我们再次点击获取授权码是不能弹出联系表单窗口的。这个是符合实际情况的。然后为了更的体验，我们需要进一步的完善一下这个按钮，当再次点击的时候，文字变成：<strong>你已经获取过验证码了</strong>。这个如何实现呢？很简单！在这个页面如下JavaScript代码：</p>
<pre><code>&lt;script&gt;
        var button = document.querySelector(&#39;.getlicense&#39;);
        button.onclick = function () &#123;
            this.textContent = &#39;你已经获取过授权码了&#39;;
        &#125;
&lt;/script&gt;</code></pre>
<p>说明一下，这里的<code>getlicense</code>是前面我们截图中设置的那个class，当然我们也可以重浏览器的开发者工具中看到这个class。</p>
<p>经过这样改造后是不是体验又更好了点？</p>
<p><img src="https://i.imgur.com/sILpREK.png"></p>
<p>当然，我们还可以进一步优化的，因为当我们刷新这个页面后，按钮文字又会变回<strong>获取授权码</strong>，比如这里我们可以像这个弹窗那样，设置cookie，在一段时间内都不能回到显示：<code>获取授权码</code>的那个按钮的文字。这个不在本文的讲解范围内。这个需要后端的配合才行。</p>
<hr>
<p>**更新：2019/2/20 18:28:19 **</p>
<p>我们经常看到一个在wordpress网站的头部菜单那里显示一个询价按钮的，效果如下：</p>
<p><img src="https://i.imgur.com/BfDCJWd.jpg"></p>
<p>这个点击这个按钮后，弹出一个联系表单，然后发送电邮，在网站后台可以收到这个地方提交的内容。这个东西怎么实现呢？跟着笔者的节奏往下看。</p>
<p>这里需要采用三个wordpress插件：</p>
<ol>
<li>popup maker</li>
<li>contact form 7</li>
<li>contact form 7 DB</li>
</ol>
<p>为什么需要这三个呢？</p>
<p>第一个插件，前面也说了，这个主要的用途是弹窗的；第二个的用途是弹窗里面的联系表单，虽然第一个插件已经有了联系表单，但是不够灵活，而且字段很有限，因此需要用上这个插件；第三个插件是用来实现收集在前台提交的联系表单的内容到网站后台显示出来的，根据名字可以看出这个是要跟contact form 7这个插件配合使用的。</p>
<p>我们把这三个都安装好了之后，第一件事是添加一个联系表单，然后自己设置字段，然后命名，这个是关于contact from 7的设置的问题，很简单，大家可以设置好就行了。笔者把这个联系表单命个名字：request a quote</p>
<p>第二件事是添加一个弹窗触发器：</p>
<p><img src="https://i.imgur.com/SX4ux3O.jpg"></p>
<p>把第一步创建的联系表单的短码加进去。</p>
<p>然后，我们设置一下这个弹窗触发器，设置如下：</p>
<p><img src="https://i.imgur.com/uUxHsIF.jpg"></p>
<p>意思就是点击弹出窗口，我们要的就是这种形式，当然另外一种是不点击，自动弹出窗口（这种我们不需要），点击这个进去：</p>
<p><img src="https://i.imgur.com/htw6Nzg.jpg"></p>
<p>其他的地方自己可以根据需要进行设置即可。</p>
<p>设置完毕后保存。然后我们来到菜单那里添加一个自定义链接的内容，然后在这菜单项里面选择我们刚才创建的那个弹窗触发器：</p>
<p><img src="https://i.imgur.com/a3jm70g.jpg"></p>
<p>保存菜单即可。然后我们来到前台，然后通过css稍微美化一下就可以看到如下的效果：</p>
<p><img src="https://i.imgur.com/BfDCJWd.jpg"></p>
<p><img src="https://i.imgur.com/Cu0FjDP.jpg"></p>
<p>为了想要在网站后台也可以看到，那么我们就可以安装一个contact form 7 DB，相信你已经安装了。通过这个插件就可以看到这个弹窗联系表单的留言信息。</p>
<p>通常为了让弹窗联系表单填写完内容发送成功后自动关闭，我们可以在联系表单那里设置一下：</p>
<p><img src="https://i.imgur.com/jKKaxoP.jpg"></p>
<p>点击进去，选择close popup，delay那里设置1，就是电邮发送成功1s后，关闭弹窗。</p>
<p><img src="https://i.imgur.com/9AQMHiu.jpg"></p>
<p>这个就比较人性化。今天就是说道这里，敬请关注笔者的相关动态，获取更多关于网站建设方面的知识。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/05/08/javascript%E7%89%B9%E6%95%88%E4%B9%8B%E9%BC%A0%E6%A0%87%E6%BB%9A%E5%8A%A8%E6%96%B9%E5%90%91%E4%BA%8B%E4%BB%B6%E8%A7%A6%E5%8F%91%E7%AC%94%E5%A4%B4%E5%92%8C%E7%AC%94%E8%BA%AB%E5%88%86%E5%90%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/08/javascript%E7%89%B9%E6%95%88%E4%B9%8B%E9%BC%A0%E6%A0%87%E6%BB%9A%E5%8A%A8%E6%96%B9%E5%90%91%E4%BA%8B%E4%BB%B6%E8%A7%A6%E5%8F%91%E7%AC%94%E5%A4%B4%E5%92%8C%E7%AC%94%E8%BA%AB%E5%88%86%E5%90%88/" class="post-title-link" itemprop="url">javascript特效之鼠标滚动方向事件触发笔头和笔身分合</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-05-08 14:50:36" itemprop="dateCreated datePublished" datetime="2018-05-08T14:50:36+08:00">2018-05-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:57:57" itemprop="dateModified" datetime="2020-10-11T11:57:57+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>今天就来通过javascript实现一下笔头跟笔身的分合特效，一个做笔的客户匆忙的找到我，想要一个笔头跟笔身分开和在一起的效果，希望能够通过鼠标滚动就能达到这个效果。</p>
<p>看到这个问题，我就开干了：</p>
<p>直接上代码：</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;title&gt;铅笔盖子和笔身分合特效&lt;/title&gt;
  &lt;script src=&quot;https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js&quot;&gt;&lt;/script&gt;
  &lt;style type=&quot;text/css&quot;&gt;
      .wumens&#123;
        display: flex;
        padding:20px 0px;
        width: 100%;
        background: red;
        color:#fff;
      &#125;
      .braver&#123;
        flex:1;
      &#125;
      .wenziqu&#123;
        padding:60px;
      &#125;
      .tupianqu img&#123;
        display: block;
        width: 100%;
        max-width: 50px;
        margin: 0 auto;
      &#125;
      .bishengs&#123;
        z-index: 0;
      &#125;
      @media (max-width: 767px)&#123;
        .wumens &#123;
          display: block !important;
      &#125;

      &#125;
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

  &lt;!-- 鼠标滚动方向触发相应的事件 --&gt;
    &lt;script&gt;
       var scrollFunc = function (e) &#123;  
            var direct = 0;  
            e = e || window.event;  
            if (e.wheelDelta) &#123;  //判断浏览器IE，谷歌滑轮事件               
                if (e.wheelDelta &gt; 0) &#123; //当滑轮向上滚动时  
                    // alert(&quot;滑轮向上滚动&quot;);
                    $(&#39;.gaizi&#39;).css(&#123;&quot;transform&quot;:&quot;translateY(0px)&quot;,&quot;z-index&quot;:&quot;0&quot;,&quot;transition&quot;:&quot;2s&quot;&#125;);
                    $(&#39;.bisheng&#39;).css(&#123;&quot;transform&quot;:&quot;translateY(0px)&quot;,&quot;z-index&quot;:&quot;999&quot;,&quot;transition&quot;:&quot;2s&quot;&#125;);  
                &#125;  
                if (e.wheelDelta &lt; 0) &#123; //当滑轮向下滚动时  
                    // alert(&quot;滑轮向下滚动&quot;);
                    $(&#39;.gaizi&#39;).css(&#123;&quot;transform&quot;:&quot;translateY(50px)&quot;,&quot;z-index&quot;:&quot;0&quot;,&quot;transition&quot;:&quot;2s&quot;&#125;);
                    $(&#39;.bisheng&#39;).css(&#123;&quot;transform&quot;:&quot;translateY(-10px)&quot;,&quot;z-index&quot;:&quot;9999&quot;,&quot;transition&quot;:&quot;2s&quot;&#125;); 
                &#125;  
            &#125; else if (e.detail) &#123;  //Firefox滑轮事件  
                if (e.detail&gt; 0) &#123; //当滑轮向上滚动时  
                    // alert(&quot;滑轮向上滚动&quot;);
                    $(&#39;.gaizi&#39;).css(&#123;&quot;transform&quot;:&quot;translateY(0px)&quot;,&quot;z-index&quot;:&quot;0&quot;&#125;);
                &#125;  
                if (e.detail&lt; 0) &#123; //当滑轮向下滚动时  
                    // alert(&quot;滑轮向下滚动&quot;);
                    $(&#39;.gaizi&#39;).css(&#123;&quot;transform&quot;:&quot;translateY(60px)&quot;,&quot;z-index&quot;:&quot;0&quot;&#125;);
                &#125;  
            &#125;  
            ScrollText(direct);  
        &#125;  
        //给页面绑定滑轮滚动事件  
        if (document.addEventListener) &#123;  
            document.addEventListener(&#39;DOMMouseScroll&#39;, scrollFunc, false);  
        &#125;  
        //滚动滑轮触发scrollFunc方法  
        window.onmousewheel = document.onmousewheel = scrollFunc;    
    &lt;/script&gt; 


    &lt;div class=&quot;wumens&quot;&gt;
        &lt;div class=&quot;braver wenziqu&quot;&gt;
          &lt;h2&gt;LEADING INHALATION TECHNOLOGY FORWARD&lt;/h2&gt;
          &lt;p&gt;As your partner, it’s our responsibility to provide high-performance state-of-the-art solutions, allowing producers to focus on their craft and leaving the hardware to us. At Jupiter Research, it’s our passion to design, develop and manufacture vaporization technologies exclusively for the natural plant-derived oil producer. The modern consumers’ demand for purity and performance is a challenge. Hardware available today is antiquated and originally intended for the electronic cigarette industry. Jupiter’s proprietary technology is engineered specifically for today’s high viscosity extracts, giving the producer a proven and reliable solution to deliver their product. Jupiter’s Liquid platform provides powerful performance with the intended flavor and efficacy you and your customers expect.&lt;/p&gt;
        &lt;/div&gt;
        &lt;div class=&quot;braver tupianqu&quot;&gt;
          &lt;img class=&quot;gaizi&quot; src=&quot;1.png&quot; alt=&quot;&quot;&gt;
          &lt;img class=&quot;bisheng&quot; src=&quot;2.png&quot; alt=&quot;&quot;&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>后面这两张图片，自己做，笔者不提供了，这里注意两点：</p>
<ol>
<li>这个需要依赖jquery</li>
<li>做两张合适的图，能够很好的契合在一起的那种</li>
</ol>
<p>最后，注意鼠标滚动事件，往上滚动和往下滚动触发不同的事件，然后配合css3的效果，就完成一个逼真的效果，看到这个demo后，客户高兴得请我喝了一杯咖啡。</p>
<p>demo地址没有，但是我贴两张图片吧：</p>
<p>默认情况或者是鼠标往上滚动是这样的：</p>
<p><img src="https://i.imgur.com/9Uh3EFV.jpg"></p>
<p>当鼠标向下滚动后效果如下：</p>
<p><img src="https://i.imgur.com/PTDC08p.jpg"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/05/07/javascript%E9%BC%A0%E6%A0%87%E6%BB%9A%E5%8A%A8%E4%BA%8B%E4%BB%B6%E5%9B%BE%E7%89%87%E6%A8%A1%E7%B3%8A%EF%BC%8C%E6%96%87%E5%AD%97%E9%9A%90%E8%97%8F%E5%92%8C%E6%B6%88%E5%A4%B1%E7%9A%84%E5%88%87%E6%8D%A2%E5%8F%98%E5%8C%96%E6%A1%88%E4%BE%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/07/javascript%E9%BC%A0%E6%A0%87%E6%BB%9A%E5%8A%A8%E4%BA%8B%E4%BB%B6%E5%9B%BE%E7%89%87%E6%A8%A1%E7%B3%8A%EF%BC%8C%E6%96%87%E5%AD%97%E9%9A%90%E8%97%8F%E5%92%8C%E6%B6%88%E5%A4%B1%E7%9A%84%E5%88%87%E6%8D%A2%E5%8F%98%E5%8C%96%E6%A1%88%E4%BE%8B/" class="post-title-link" itemprop="url">javascript鼠标滚动事件图片模糊，文字隐藏和消失的切换变化案例</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-05-07 15:42:25" itemprop="dateCreated datePublished" datetime="2018-05-07T15:42:25+08:00">2018-05-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:57:58" itemprop="dateModified" datetime="2020-10-11T11:57:58+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>这个案例是基于苹果官网的效果而来的，客户想要鼠标悬浮的时候不需要特效，只有用户的鼠标在这个区域，滚动鼠标的时候，所在区域的图片相应的模糊，同时进行缩放，然后有文字状态由隐藏变成显示。当鼠标往上滚动的时候，图片变得清晰，同时放大，在这个过程中，文字状态由显示变成隐藏。</p>
<p>我们知道这个需求后，我们就进行定位问题，这个问题我们采用javascript方案，然后配合css的模糊特性和透明度来进行解决。</p>
<p>废话少说，代码贴上：</p>
<pre><code>&lt;style type=&quot;text/css&quot;&gt;
    .nocticontainer&#123;
        position: relative;
        //overflow: hidden;
        height: auto;
        text-align: center;
    &#125;
    .nocticontainer img&#123;
        //width:1920px;
        //height:600px;
    &#125;
    .description&#123;
        position: absolute;
        background: transparent;
        top: 50%;
        width: 320px;
        left: 50%;
        opacity: 0;
        z-index: 999;
    &#125;
    @media (max-width:767px)&#123;
        .description &#123;
            position: absolute;
            background: transparent;
            top: 10%;
            width: 100%;
            left: 0% !important;
            opacity: 0;
            z-index: 999;
        &#125;
    &#125;
&lt;/style&gt;

&lt;script language=&quot;javascript&quot;&gt;
function bigimg(obj) &#123;
    //obj是一个对象，初始时obj并没有zoom属性，所以给zoom赋值为100；
    var zoom = parseInt(obj.style.zoom)||100;
    console.log(zoom);
    //每次滚动鼠标时，改变zoom的大小
    //event.wheelDelta有两个值，120，-120，取值情况取决于滚动鼠标的方向
    var delta = event.wheelDelta;
    zoom += delta/12;//每次滚动加减
    if (zoom &gt;= 41 &amp;&amp; zoom &lt;=100) &#123;
        obj.style.zoom = zoom+&quot;%&quot;;
        //更改后的zoom赋值给obj
        // console.log(obj.style.zoom);
        $(&quot;.nocticontainer img&quot;).css(&#123;&quot;filter&quot;:&quot;blur(10px)&quot;,&quot;transform&quot;:&quot;scale(1.2)&quot;,&quot;transition&quot;:&quot;10s&quot;,&quot;duration&quot;:&quot;3s&quot;,&quot;opacity&quot;:&quot;0.5&quot;&#125;);
        $(&#39;.description&#39;).css(&#123;&quot;opacity&quot;:&quot;1&quot;,&quot;transition&quot;:&quot;10s&quot;,&quot;left&quot;:&quot;30%&quot;&#125;);

    &#125;else if(zoom &gt;=101)&#123;
        $(&quot;.nocticontainer img&quot;).css(&#123;&quot;filter&quot;:&quot;blur(0px)&quot;,&quot;transform&quot;:&quot;scale(1.5)&quot;,&quot;transition&quot;:&quot;10s&quot;,&quot;duration&quot;:&quot;3s&quot;,&quot;opacity&quot;:&quot;1&quot;&#125;);
        $(&#39;.description&#39;).css(&#123;&quot;filter&quot;:&quot;blur(0px)&quot;,&quot;opacity&quot;:&quot;0&quot;&#125;);
    &#125;else if(zoom &lt;= 40)&#123;
        $(&quot;.nocticontainer img&quot;).css(&#123;&quot;transform&quot;:&quot;scale(1)&quot;,&quot;filter&quot;:&quot;blur(0px)&quot;,&quot;opacity&quot;:&quot;1&quot;,&quot;transition&quot;:&quot;15s&quot;&#125;);
        $(&#39;.description&#39;).css(&#123;&quot;opacity&quot;:&quot;0&quot;,&quot;transition&quot;:&quot;15s&quot;,&quot;left&quot;:&quot;50%&quot;&#125;);
    &#125;
    return false;

&#125;

&lt;/script&gt;


&lt;div&gt;
    &lt;div class=&quot;nocticontainer&quot;&gt;
        &lt;div class=&quot;description&quot;&gt;
            &lt;h2&gt;The freedom of cellular&lt;/h2&gt;
            &lt;p&gt;Take a call when you’re out on the water. Ask Siri to send a message. Stream your favorite songs on your run. And do it all while leaving your phone behind.&lt;/p&gt;
        &lt;/div&gt;
    &lt;img src=&quot;test.png&quot; width=&quot;100%&quot; heigth=&quot;600px&quot; onmousewheel=&quot;bigimg(this)&quot;&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
<p>把代码放在wordpress页面的某个地方，然后去前台看下效果：</p>
<p>这个是鼠标往下滚动的效果，文字显示，图片模糊：</p>
<p><img src="https://i.imgur.com/XkcclI0.jpg"></p>
<p>这个是鼠标往上滚动的效果，文字消失，图片清晰：</p>
<p><img src="https://i.imgur.com/txvI13P.jpg"></p>
<p>这里需要注意的是javascript跟css的相互结合，让特效变得更有意思，更加的灵活。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/05/05/%E4%BA%91%E5%B9%B3%E5%8F%B0%E8%B5%B0%E8%BF%87%E7%9A%84%E5%9D%91%E5%92%8C%E6%97%A5%E5%B8%B8%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/05/%E4%BA%91%E5%B9%B3%E5%8F%B0%E8%B5%B0%E8%BF%87%E7%9A%84%E5%9D%91%E5%92%8C%E6%97%A5%E5%B8%B8%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">云平台走过的坑和日常笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-05-05 11:07:33" itemprop="dateCreated datePublished" datetime="2018-05-05T11:07:33+08:00">2018-05-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:52:50" itemprop="dateModified" datetime="2020-10-11T11:52:50+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>继续推进上一篇关于云平台的笔记，这里我记录的是在日常问题中的解决思路。</p>
<p>linux里面的四台虚拟机，为了让彼此能够通信，我们可以通过ping他们内部的IP地址来确认，他们之间是不是可以连得通的。这是实现内部虚拟机之间通信的第一步。</p>
<p><strong>问题一：</strong></p>
<p>假设四个虚拟机（tp5、msyql、nginx、html）都跑起来了，不同虚拟机扮演不同的角色，这个时候发现没法连到mysql虚拟机上的数据库，这个是怎么办呢？</p>
<p>首先，我们先确定mysql的服务是否已经开启，先进入mysql的虚拟机把mysql的服务启动起来，命令：</p>
<pre><code>sudo /etc/init.d/mysql restart</code></pre>
<p>好的，我们再接着下一步，就是本地查看3306端口是否已经开启，在mysql虚拟机下运行命令：</p>
<pre><code>netstat -an | grep 3306</code></pre>
<p>如果已经开启了这个端口会出现：</p>
<pre><code>tcp6       0      0 :::3306                 :::*                    LISTEN</code></pre>
<p>好的，既然本地能够开启了，那么我们需要在本地登陆下mysql，这个命令如下：</p>
<pre><code>mysql -u root -p</code></pre>
<p>如果可以登陆成功，那么说明本地的mysql服务器是没有问题的，可是由于linunx中的mysql为了安全，是不支持远程连接的，那么如何让mysql支持远程连接呢，我们可以网上搜索一下关于让mysql支持远程连接的问题，这里我也为大家准备了方案，进入mysql（用root账号登陆）：</p>
<p>如果我们不想要root账号的话，我们需要先创建一个mysql账号，这里命名为zhangsan，先运行命令：</p>
<pre><code>mysql&gt; use mysql;

mysql&gt; select Host,User from user;   //查看mysql数据库中有哪些用户

mysql&gt; create user zhangsan identified by &#39;123456&#39;;  //创建用户名为zhangsan的用户，并且分配密码

mysql&gt;use databasename;     //选择自己开放授权远程的访问的数据库

mysql&gt;grant all privileges on *.* to zhangsan@&quot;%&quot; identified by &#39;password&#39; with grant option   //这里把

mysql&gt;flush privileges;</code></pre>
<p>我以为就此收工了，等等，程序怎么还是连不上去，还是 access deny ;</p>
<p>难道端口不是3306吗，打开 mysql配置文件，这里需要注意的是 bind-address这个东西，这个配置文件我们可能会因为不同的版本或者是不同的系统，会有点不一样，我这里用的是ubuntu16.04的，我的配置文件并不是跟网上别人说的 <code>/etc/mysql/my.cnf</code> 这个路径，在  <code>/etc/mysql/</code>  下是找不到 <code>my.cnf</code> 的，那么我们就没法改bind-address了，其实这个bind-address在 <code>/etc/mysql/mysql.conf.d/mysqld.cnf</code> 这个文件里面。我们需要把这个注释掉</p>
<pre><code>bind-address           = 127.0.0.1</code></pre>
<p>改成</p>
<pre><code># bind-address           = 127.0.0.1</code></pre>
<p>原因就是这里mysql默认绑定了本地ip，不接受其他来源；只需要注释掉，重启mysql ，就好了！</p>
<p>还有两个常用操作；</p>
<p>修改指定用户密码命令：</p>
<pre><code>update mysql.user set password=password(&#39;新密码&#39;) where User=&quot;zhangsan&quot; and Host=&quot;localhost&quot;;</code></pre>
<p>删除用户，比如我们想删除上面创建的zhangsan这个账户，就可以像如下这样运行命令：</p>
<pre><code>delete from user where User=&#39;zhangsan&#39; and Host=&#39;localhost&#39;;</code></pre>
<p><strong>忘记root密码</strong></p>
<p>设置不用密码登录</p>
<pre><code>[mysqld]
skip-grant-tables=1</code></pre>
<p>修改完密码后，记得删除该配置行</p>
<p>好的，我们已经完成了mysql虚拟机这边的服务的开启、本地登陆，远程访问授权三个。</p>
<p><strong>问题二：</strong></p>
<p>通过tp5虚拟机远程登陆mysql虚拟机连不上怎么办？</p>
<p>解决思路：</p>
<p>第一，因为前面我们已经测试好了mysql那边是没有问题的，现在我们就相当于在局域网中连其他电脑那样，好的，我们先测试下通过远程查看下mysql的3306是否开启，在tp5虚拟机里面运行命令：</p>
<pre><code>telnet 13.1.1.10 3306   //13.1.1.10是mysql虚拟机的IP地址</code></pre>
<p>如果成功，那么会出现类似这样的画面：</p>
<pre><code>Trying 13.1.1.10...
Connected to 13.1.1.10.
Escape character is &#39;^]&#39;.
[
5.7.21-0ubuntu0.16.04.1
                       )01uSnnkPB~dN2mysql_native_passwordXshell</code></pre>
<p>如果不成功，那么就是直接报错。</p>
<p>好的，我们假设已经成功连接了，事实上也应该成功了。这个就说明可以远程访问了，那么我们再进一步的测试，运行以下命令：</p>
<pre><code>mysql -h 13.1.1.10 -u zhangsan -p databasename   //这个就是从tp5这台虚拟机上远程连接mysql虚拟机，通过zhangsan这个账号登录到授权访问的数据库</code></pre>
<p>然后输入密码，如果密码成功，那么就可以成功的从tp5这边远程的登录到mysql服务器那边的数据库了。</p>
<p><strong>问题三</strong></p>
<p>当我们完成了第一步和第二步的时候，我们可以通过在tp5里面发起api的请求了，假设我这里的api地址是：</p>
<pre><code>/api/school/details</code></pre>
<p>那么我们可以现在tp5里面进行一个本地的请求，请求地址：</p>
<pre><code>links http://13.1.1.12/api/school/details   //这个13.1.1.12是tp5的本地地址，后面的路由地址是获取学校详情的api</code></pre>
<p>如果成功，那么就会输出请求的数据，如果不成功，说明请求本身是有问题的，这个就需要排查，因为这个跟tp5和mysql两边息息相关，这个需要两边逐个排查。根据笔者经历，可能出现的错误是mysql的授权问题，报错吗1449，类似如下的报错：</p>
<blockquote>
<p>1449 The user specified as a definer (‘root’@’%’) does not exist</p>
</blockquote>
<p><strong>错误原因</strong></p>
<p>这是权限问题，授权给root的所有的SQL语句，解决办法，在mysql虚拟机中登录mysql，然后运行如下命令：</p>
<pre><code>mysql&gt; use databasename;

mysql&gt; GRANT ALL PRIVILEGES ON *.* TO root@&quot;%&quot; IDENTIFIED BY &quot;.&quot;;

FLUSH PRIVILEGES;</code></pre>
<p>通常，进行这样的操作后，我们已经解决了这个问题了，我们接着往下走。</p>
<p><strong>问题四</strong></p>
<p>如果前面三步都完成了，我们接下来的时候是需要做的是通过nginx这个进行一个转发来实现通过浏览器的输入域名的方式来访问后端的api数据，然后渲染到前端去。这个也是我们的终极目标。</p>
<p>那么我们需要解决tp5的api请求在本地是可以成功的，假设已经成功了，那么我们需要对nginx进行一个转发规则的设置，这个就是在nginx虚拟机上进行设置了，这个我们打开这个目录：<code>/etc/nginx/conf.d</code></p>
<p>有的可能不是这个目录，直接在 <code>/etc/nginx/sites-available</code> ，笔者是为了方便管理，自定义了一个配置文件，这个也是大家常用的方式。</p>
<p>好的，我们的配置文件规则如下：</p>
<pre><code>server&#123;
        listen 443;
        charset utf-8;
        #把ssl证书加入进来
        ssl on;
        ssl_certificate   cert/214551314040845.pem;
        ssl_certificate_key  cert/214551314040845.key;
        ssl_session_timeout 5m;
        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_prefer_server_ciphers on;

        server_name www.yourdomain.com;
        # server_name localhost;  #如果没有进行域名解析的话，那么就直接用localhost，而不是IP地址

        location ^~/api/ &#123;

                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header REMOTE-HOST $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                #禁用缓存
                proxy_buffering off;

                proxy_pass http://13.1.1.12/api/;   #后端tp5服务，这里记得api后面要有“/”斜杆，这个表示在api这个目录下找index.html,或者index.php，不然的话，就找api.html或者是api.php
        &#125;
        location / &#123;

                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header REMOTE-HOST $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                #禁用缓存
                proxy_buffering off;

                proxy_pass http://13.1.1.9/;  #前端的html服务

        &#125;
        location /phpmyadmin/ &#123;

                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header REMOTE-HOST $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                #禁用缓存
                proxy_buffering off;

               proxy_pass http://13.1.1.10/;  #数据库服务

        &#125;
&#125;</code></pre>
<p>经过配置后，发现通过在浏览器访问地址：</p>
<p>最开始笔者是通过这个linux的服务器IP进行访问的，如下：</p>
<pre><code>https://121.55.23.113/api/school/details    //假设linux云服务器的IP地址是121.55.23.113</code></pre>
<p>后来一个高人说要用域名访问，因为nginx是按域名匹配的。于是乎就改成了如下的方式访问，当输入</p>
<pre><code>https://www.youdomain.com/api/school/details</code></pre>
<p>的时候，我们看到了梦寐以求的结果。好的，这里笔者以一张图来说明下总体的思路和做法：</p>
<p><img src="https://i.imgur.com/5pEJsgT.png"></p>
<p>好的，如果有更好地办法，欢迎补充。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/04/26/%E6%94%B9%E9%80%A0wordpress%E5%90%8E%E5%8F%B0%E7%BC%96%E8%BE%91%E5%8C%BA%E9%9D%A2%E6%9D%BF%E5%92%8Cportfolio%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%80%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/26/%E6%94%B9%E9%80%A0wordpress%E5%90%8E%E5%8F%B0%E7%BC%96%E8%BE%91%E5%8C%BA%E9%9D%A2%E6%9D%BF%E5%92%8Cportfolio%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%80%E5%8F%91/" class="post-title-link" itemprop="url">改造wordpress后台编辑区面板和portfolio的自定义开发，portfolio自定义属性的添加和定制后台，添加立即购买按钮</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-04-26 19:44:44" itemprop="dateCreated datePublished" datetime="2018-04-26T19:44:44+08:00">2018-04-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:58:05" itemprop="dateModified" datetime="2020-10-11T11:58:05+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近接到一个客户的需求，说是把portfolio当做产品展示的方式来用，因为每个产品会有一些自定义的参数，比如颜色，频率等，这个对于portfolio来说是没有的，这个时候，又要做到跟商城那样，比如在产品列表页面显示标题，下面会有一些参数类似：标签、颜色、频率等元素。</p>
<p>这个怎么搞呢？<strong>切记：先把全文阅读完毕在添加代码。</strong></p>
<p><strong>第一步：找到控制portfolio单页的php文件</strong></p>
<p>这里我以enfold为例，通过开发者工具，再结合主题源码全文搜索，我找到了：/nocti/config-templatebuilder/avia-shortcodes/portfolio.php</p>
<p>我们最开始是这样的：</p>
<p><img src="https://i.imgur.com/HAiz6wt.jpg">，通过调用portfolio的分类，然后就是这样的，所以通过定位我们找到标题显示的代码区：</p>
<p><img src="https://i.imgur.com/ogVP9ss.jpg"></p>
<p>好的，我们确定位置后，我们就可以知道这个应该显示在h3标签下面，这个时候我们如何让每篇文章显示他们自己的参数呢？我们接着看。</p>
<p><strong>第二步：为数据库添加自定义字段</strong></p>
<p>我们进入数据库把wp_posts，导出然后打开.sql的文件：</p>
<pre><code>CREATE TABLE IF NOT EXISTS `wp_posts` (
  `ID` bigint(20) unsigned NOT NULL,
  `post_author` bigint(20) unsigned NOT NULL DEFAULT &#39;0&#39;,
  `post_date` datetime NOT NULL DEFAULT &#39;0000-00-00 00:00:00&#39;,
  `post_date_gmt` datetime NOT NULL DEFAULT &#39;0000-00-00 00:00:00&#39;,
  `post_content` longtext COLLATE utf8mb4_unicode_520_ci NOT NULL,
  `post_title` text COLLATE utf8mb4_unicode_520_ci NOT NULL,
  `post_excerpt` text COLLATE utf8mb4_unicode_520_ci NOT NULL,
  `post_status` varchar(20) COLLATE utf8mb4_unicode_520_ci NOT NULL DEFAULT &#39;publish&#39;,
  `comment_status` varchar(20) COLLATE utf8mb4_unicode_520_ci NOT NULL DEFAULT &#39;open&#39;,
  `ping_status` varchar(20) COLLATE utf8mb4_unicode_520_ci NOT NULL DEFAULT &#39;open&#39;,
  `post_password` varchar(255) COLLATE utf8mb4_unicode_520_ci NOT NULL DEFAULT &#39;&#39;,
  `post_name` varchar(200) COLLATE utf8mb4_unicode_520_ci NOT NULL DEFAULT &#39;&#39;,
  `to_ping` text COLLATE utf8mb4_unicode_520_ci NOT NULL,
  `pinged` text COLLATE utf8mb4_unicode_520_ci NOT NULL,
  `post_modified` datetime NOT NULL DEFAULT &#39;0000-00-00 00:00:00&#39;,
  `post_modified_gmt` datetime NOT NULL DEFAULT &#39;0000-00-00 00:00:00&#39;,
  `post_content_filtered` longtext COLLATE utf8mb4_unicode_520_ci NOT NULL,
  `post_parent` bigint(20) unsigned NOT NULL DEFAULT &#39;0&#39;,
  `guid` varchar(255) COLLATE utf8mb4_unicode_520_ci NOT NULL DEFAULT &#39;&#39;,
  `menu_order` int(11) NOT NULL DEFAULT &#39;0&#39;,
  `post_mime_type` varchar(100) COLLATE utf8mb4_unicode_520_ci NOT NULL DEFAULT &#39;&#39;,
  `post_type` varchar(20) COLLATE utf8mb4_unicode_520_ci NOT NULL DEFAULT &#39;post&#39;,
  `comment_count` bigint(20) NOT NULL DEFAULT &#39;0&#39;
) ENGINE=MyISAM AUTO_INCREMENT=9512 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_520_ci;</code></pre>
<p>这个我们在最后添加三个字段，这里笔者随便取了三个字段paramar,color,descriptions，这个没有强制性规定，大家根据自己的需求设置。添加后如下：</p>
<pre><code>CREATE TABLE IF NOT EXISTS `wp_posts` (
  `ID` bigint(20) unsigned NOT NULL,
  `post_author` bigint(20) unsigned NOT NULL DEFAULT &#39;0&#39;,
  `post_date` datetime NOT NULL DEFAULT &#39;0000-00-00 00:00:00&#39;,
  `post_date_gmt` datetime NOT NULL DEFAULT &#39;0000-00-00 00:00:00&#39;,
  `post_content` longtext COLLATE utf8mb4_unicode_520_ci NOT NULL,
  `post_title` text COLLATE utf8mb4_unicode_520_ci NOT NULL,
  `post_excerpt` text COLLATE utf8mb4_unicode_520_ci NOT NULL,
  `post_status` varchar(20) COLLATE utf8mb4_unicode_520_ci NOT NULL DEFAULT &#39;publish&#39;,
  `comment_status` varchar(20) COLLATE utf8mb4_unicode_520_ci NOT NULL DEFAULT &#39;open&#39;,
  `ping_status` varchar(20) COLLATE utf8mb4_unicode_520_ci NOT NULL DEFAULT &#39;open&#39;,
  `post_password` varchar(255) COLLATE utf8mb4_unicode_520_ci NOT NULL DEFAULT &#39;&#39;,
  `post_name` varchar(200) COLLATE utf8mb4_unicode_520_ci NOT NULL DEFAULT &#39;&#39;,
  `to_ping` text COLLATE utf8mb4_unicode_520_ci NOT NULL,
  `pinged` text COLLATE utf8mb4_unicode_520_ci NOT NULL,
  `post_modified` datetime NOT NULL DEFAULT &#39;0000-00-00 00:00:00&#39;,
  `post_modified_gmt` datetime NOT NULL DEFAULT &#39;0000-00-00 00:00:00&#39;,
  `post_content_filtered` longtext COLLATE utf8mb4_unicode_520_ci NOT NULL,
  `post_parent` bigint(20) unsigned NOT NULL DEFAULT &#39;0&#39;,
  `guid` varchar(255) COLLATE utf8mb4_unicode_520_ci NOT NULL DEFAULT &#39;&#39;,
  `menu_order` int(11) NOT NULL DEFAULT &#39;0&#39;,
  `post_mime_type` varchar(100) COLLATE utf8mb4_unicode_520_ci NOT NULL DEFAULT &#39;&#39;,
  `post_type` varchar(20) COLLATE utf8mb4_unicode_520_ci NOT NULL DEFAULT &#39;post&#39;,
  `comment_count` bigint(20) NOT NULL DEFAULT &#39;0&#39;,
  `paramar` varchar(200) COLLATE utf8mb4_unicode_520_ci NULL DEFAULT &#39;&#39;,
  `descriptions` varchar(200) COLLATE utf8mb4_unicode_520_ci NULL DEFAULT &#39;&#39;,
  `color` varchar(100) COLLATE utf8mb4_unicode_520_ci NULL DEFAULT &#39;&#39;
) ENGINE=MyISAM AUTO_INCREMENT=9512 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_520_ci;</code></pre>
<p>打开数据库的这个数据表：wp_posts，效果如下：</p>
<p><img src="https://i.imgur.com/ZzUn539.jpg"></p>
<p>然后就是，找到post_type为portfolio的产品页面，然后进入他们的记录，添加几个数据。好的数据库这边已经搞定。<strong>笔者经过后来的实践发现为数据库添加字段的方法是不对的，导致的问题是，新添加产品或者添加文章或者页面的时候按钮不能发布，会报错，发布按钮变成了 submit the review.，正确的方法就是从第三步部开始</strong></p>
<p><strong>第三步：回到portfolio的控制文件，就是第一步中找到的那个文件</strong></p>
<p>我们要解决的是每篇文章显示他们各自的自定义参数。</p>
<pre><code>if(!empty($title))
&#123;
    $markup = avia_markup_helper(array(&#39;context&#39; =&gt; &#39;entry_title&#39;,&#39;echo&#39;=&gt;false, &#39;id&#39;=&gt;$the_id, &#39;custom_markup&#39;=&gt;$custom_markup));
    $output .= &#39;&lt;header class=&quot;entry-content-header&quot;&gt;&#39;;
    $output .= &quot;&lt;h3 class=&#39;grid-entry-title entry-title&#39; $markup&gt;&quot;;

    if(!empty($title_link))
    &#123;
        $output .= &quot;&lt;a href=&#39;&#123;$title_link&#125;&#39; title=&#39;&quot;.esc_attr(strip_tags($title)).&quot;&#39;&gt;&quot;.$title.&quot;&lt;/a&gt;&quot;;
    &#125;
    else
    &#123;
        $output .= &quot;&quot;.$title.&quot;&quot;;
    &#125;
    $output .= &#39;&lt;/h3&gt;&lt;/header&gt;&#39;;
&#125;</code></pre>
<p>这就是我们要处理地方，我们可以看到有个$title，我们找到跟这个相关的引用，我在这个文件里面全文搜索$title，终于我找到了这个地方：</p>
<pre><code>switch($contents)
&#123;
    case &quot;excerpt&quot;: $excerpt = $entry-&gt;post_excerpt; $title = $entry-&gt;post_title; break;
    case &quot;title&quot;: $excerpt = &#39;&#39;; $title = $entry-&gt;post_title;  break;
    case &quot;only_excerpt&quot;: $excerpt = $entry-&gt;post_excerpt; $title = &#39;&#39;; break;
    case &quot;no&quot;: $excerpt = &#39;&#39;; $title = &#39;&#39;; break;
&#125;</code></pre>
<p>这里有个重要判断，如果内容是标题那么就会显示标题：</p>
<pre><code>$title = $entry-&gt;post_title</code></pre>
<p>这里的post_title启发了笔者，这不就是wp_posts里面的其中一个字段嘛，好的，既然可以这样，我们就可以定义三个变量了，分别代表paramar,color,descriptions。定义如下：</p>
<pre><code>$paramar = $entry-&gt;paramar;
$color = $entry-&gt;color;
$descriptions = $entry-&gt;descriptions;</code></pre>
<p><img src="https://i.imgur.com/lhgJtYt.jpg"></p>
<p>这里值得说明的一个地方是：我们这个都在这样一个遍历里面的：</p>
<pre><code>foreach ($this-&gt;entries-&gt;posts as $entry)
&#123;
    $the_id     = $entry-&gt;ID;
    $parity        = $post_loop_count % 2 ? &#39;odd&#39; : &#39;even&#39;;
    $last       = $this-&gt;entries-&gt;post_count == $post_loop_count ? &quot; post-entry-last &quot; : &quot;&quot;;
    $post_class = &quot;post-entry post-entry-&#123;$the_id&#125; grid-entry-overview grid-loop-&#123;$post_loop_count&#125; grid-parity-&#123;$parity&#125; &#123;$last&#125;&quot;;
    $sort_class = $this-&gt;sort_cat_string($the_id, $this-&gt;atts);

    switch($linking)
    &#123;
        case &quot;lightbox&quot;:  $link = aviaHelper::get_url(&#39;lightbox&#39;, get_post_thumbnail_id($the_id));    break;
        default:           $link = get_permalink($the_id); break;
    &#125;

    $title_link  = get_permalink($the_id);
    $custom_link = get_post_meta( $the_id ,&#39;_portfolio_custom_link&#39;, true) != &quot;&quot; ? get_post_meta( $the_id ,&#39;_portfolio_custom_link_url&#39;, true) : false;

    if($custom_link)
    &#123;
        $title_link = &quot;&quot;;
        $link = $custom_link;
    &#125;

    $excerpt     = &#39;&#39;;
    $title         = &#39;&#39;;
    $paramar = $entry-&gt;paramar;
    $color = $entry-&gt;color;
    $descriptions = $entry-&gt;descriptions;

    switch($contents)
    &#123;
        case &quot;excerpt&quot;: $excerpt = $entry-&gt;post_excerpt; $title = $entry-&gt;post_title; break;
        case &quot;title&quot;: $excerpt = &#39;&#39;; $title = $entry-&gt;post_title;  break;
        case &quot;only_excerpt&quot;: $excerpt = $entry-&gt;post_excerpt; $title = &#39;&#39;; break;
        case &quot;no&quot;: $excerpt = &#39;&#39;; $title = &#39;&#39;; break;
    &#125;

    $custom_overlay = apply_filters(&#39;avf_portfolio_custom_overlay&#39;, &quot;&quot;, $entry);
    $link_markup     = apply_filters(&#39;avf_portfolio_custom_image_container&#39;, array(&quot;a href=&#39;&#123;$link&#125;&#39; title=&#39;&quot;.esc_attr(strip_tags($title)).&quot;&#39; &quot;,&#39;a&#39;), $entry);

    $title             = apply_filters(&#39;avf_portfolio_title&#39;, $title, $entry);
    $title_link        = apply_filters(&#39;avf_portfolio_title_link&#39;, $title_link, $entry);
    $image_attrs    = apply_filters(&#39;avf_portfolio_image_attrs&#39;, array(), $entry);
    //还有很多
    //....
&#125;</code></pre>
<p>从这个里面我们可以看到，这个很重要的$entry就是在这里循环输出的一个变量，这个变量代表了每条记录。</p>
<p>好的，我们找到我们想要让我们自定义的那三个字段显示地方，然后加上去后如下：</p>
<pre><code>if(!empty($title))
&#123;
    $markup = avia_markup_helper(array(&#39;context&#39; =&gt; &#39;entry_title&#39;,&#39;echo&#39;=&gt;false, &#39;id&#39;=&gt;$the_id, &#39;custom_markup&#39;=&gt;$custom_markup));
    $output .= &#39;&lt;header class=&quot;entry-content-header&quot;&gt;&#39;;
    $output .= &quot;&lt;h3 class=&#39;grid-entry-title entry-title&#39; $markup&gt;&quot;;

    if(!empty($title_link))
    &#123;
        $output .= &quot;&lt;a href=&#39;&#123;$title_link&#125;&#39; title=&#39;&quot;.esc_attr(strip_tags($title)).&quot;&#39;&gt;&quot;.$title.&quot;&lt;/a&gt;&quot;;
    &#125;
    else
    &#123;
        $output .= &quot;&quot;.$title.&quot;&quot;;
    &#125;
    $output .= &quot;&lt;p style=&#39;color:&quot;.$color.&quot;&#39;&gt;&quot;.$paramar.&quot;&lt;/p&gt;&quot;;
    $output .= &quot;&lt;p&gt;&quot;.$color.&quot;&lt;/p&gt;&quot;;
    $output .= &#39;&lt;/h3&gt;&lt;/header&gt;&#39;;
&#125;</code></pre>
<p>保存后，我们就可以看到如下的效果：</p>
<p><img src="https://i.imgur.com/wVrtcNZ.jpg"></p>
<p><strong>第四步：自定义wordpress的后台编辑区面板（切记不要在wp_posts表添加任何字段，直接从通过修改模板文件和functions.php文件即可达到目的）</strong></p>
<p>自定义Meta Box需要用到add_meta_box函数，这里参考了这篇文章：<a target="_blank" rel="noopener" href="https://www.boke8.net/wordpress-post-type-meta-box.html">https://www.boke8.net/wordpress-post-type-meta-box.html</a></p>
<pre><code>add_meta_box( $id, $title, $callback, $post_type, $context,$priority, $callback_args );</code></pre>
<blockquote>
<p>参数说明如下：</p>
</blockquote>
<blockquote>
<p>$id：字段id，唯一</p>
</blockquote>
<blockquote>
<p>$title：标题名称</p>
</blockquote>
<blockquote>
<p>$callback：回调函数</p>
</blockquote>
<blockquote>
<p>$post_type：文章类型</p>
</blockquote>
<blockquote>
<p>$context：显示位置</p>
</blockquote>
<blockquote>
<p>$priority：优先级</p>
</blockquote>
<p>我们找到主题的functions.php，然后把以下代码加上去：</p>
<pre><code>// 自定义文章添加自定义字段面板 开始
// 注册一个 Meta Box 示例
add_action( &#39;add_meta_boxes&#39;, &#39;product_director&#39; );
function product_director() &#123;
    add_meta_box(
        &#39;product_director&#39;,
        &#39;产品参数&#39;,
        &#39;product_director_meta_box&#39;,
        &#39;portfolio&#39;,
        &#39;side&#39;,
        &#39;high&#39;
    );
&#125;
// 创建回调函数product_director_meta_box
function product_director_meta_box($post) &#123;
    // 创建临时隐藏表单，为了安全
    wp_nonce_field( &#39;product_director_meta_box&#39;, &#39;product_director_meta_box_nonce&#39; );
    // 获取之前存储的值
    $value = get_post_meta( $post-&gt;ID, &#39;_product_director&#39;, true );
?&gt;
    &lt;label for=&quot;product_director&quot;&gt;&lt;/label&gt;
    &lt;input type=&quot;text&quot; id=&quot;product_director&quot; name=&quot;product_director&quot; value=&quot;&lt;?php echo esc_attr( $value ); ?&gt;&quot; placeholder=&quot;输入产品价格&quot;&gt;
&lt;?php
&#125;

// 这时候表单还不能用，因为提交文章之后并没有保存这个 Meta Box 的内容，下面是验证保存内容的代码：
add_action( &#39;save_post&#39;, &#39;product_director_save_meta_box&#39; );
function product_director_save_meta_box($post_id)&#123;
    if ( ! isset( $_POST[&#39;product_director_meta_box_nonce&#39;] ) ) &#123;
        return;
    &#125;
    if ( ! wp_verify_nonce( $_POST[&#39;product_director_meta_box_nonce&#39;], &#39;product_director_meta_box&#39; ) ) &#123;
        return;
    &#125;
    if ( ! current_user_can( &#39;edit_post&#39;, $post_id ) ) &#123;
        return;
    &#125;
    if ( ! isset( $_POST[&#39;product_director&#39;] ) ) &#123;
        return;
    &#125;
    $product_director = sanitize_text_field( $_POST[&#39;product_director&#39;] );
    update_post_meta( $post_id, &#39;_product_director&#39;, $product_director );
&#125;

// 扩展：把Meta Box添加把后台所有产品列表字段中显示 这个可要不可要
add_action(&quot;manage_posts_custom_column&quot;,  &quot;product_custom_columns&quot;);
add_filter(&quot;manage_edit-product_columns&quot;, &quot;product_edit_columns&quot;);
function product_custom_columns($column)&#123;
    global $post;
    switch ($column) &#123;
        case &quot;product_director&quot;:
            echo get_post_meta( $post-&gt;ID, &#39;_product_director&#39;, true );
            break;
    &#125;
&#125;
function product_edit_columns($columns)&#123;
    $columns[&#39;product_director&#39;] = &#39;产品参数&#39;;
    return $columns;
&#125;

// 自定义文章添加自定义字段面板 结束</code></pre>
<p>调用代码：</p>
<pre><code>&lt;?php 
    if(get_post_meta($post-&gt;ID,&#39;_product_director&#39;,true))&#123;
        echo get_post_meta($post-&gt;ID,&#39;_product_director&#39;,true);
    &#125;
?&gt;</code></pre>
<p>这段代码加在portfolio的模板文件中，具体位置根据自己的业务需求进行添加。后台设置效果如下：</p>
<p><img src="https://i.imgur.com/MYsq9Ku.jpg"></p>
<p><img src="https://i.imgur.com/8qwuITp.jpg"></p>
<p>前台显示如下：</p>
<p><img src="https://i.imgur.com/fdE9mNM.jpg"></p>
<p>说明在后台添加，前台可以显示了，好的，接下来我们要做的就是把后台添加的东西插入到数据库中去。</p>
<p>好的，笔者现在要把后台添加的显示到产品分类列表中去，这里要做一个修改，修改如下：</p>
<p>我们把</p>
<pre><code>&lt;?php 
    if(get_post_meta($post-&gt;ID,&#39;_product_director&#39;,true))&#123;
        echo get_post_meta($post-&gt;ID,&#39;_product_director&#39;,true);
    &#125;
?&gt;</code></pre>
<p>加到第三步说的那个portfolio.php文件中的这里，添加后如下：</p>
<pre><code>if(!empty($title))
&#123;
    $markup = avia_markup_helper(array(&#39;context&#39; =&gt; &#39;entry_title&#39;,&#39;echo&#39;=&gt;false, &#39;id&#39;=&gt;$the_id, &#39;custom_markup&#39;=&gt;$custom_markup));
    $output .= &#39;&lt;header class=&quot;entry-content-header&quot;&gt;&#39;;
    $output .= &quot;&lt;h3 class=&#39;grid-entry-title entry-title&#39; $markup&gt;&quot;;

    if(!empty($title_link))
    &#123;
        $output .= &quot;&lt;a href=&#39;&#123;$title_link&#125;&#39; title=&#39;&quot;.esc_attr(strip_tags($title)).&quot;&#39;&gt;&quot;.$title.&quot;&lt;/a&gt;&quot;;
    &#125;
    else
    &#123;
        $output .= &quot;&quot;.$title.&quot;&quot;;
    &#125;

    $output .= &quot;&lt;p style=&#39;color:&quot;.$color.&quot;&#39;&gt;&quot;.$paramar.&quot;&lt;/p&gt;&quot;;
    $output .= &quot;&lt;p&gt;&quot;.$color.&quot;&lt;/p&gt;&quot;;
    // 这里就是显示在后台添加的自定义代码的地方 开始
    if(get_post_meta($the_id,&#39;_product_director&#39;,true))&#123;
        $pricss = get_post_meta($the_id,&#39;_product_director&#39;,true);
        $output .= &quot;&lt;p&gt;&quot;.$pricss.&quot;&lt;/p&gt;&quot;;
    &#125;
    // 添加结束
    $output .= &#39;&lt;/h3&gt;&lt;/header&gt;&#39;;
&#125;</code></pre>
<p>我们看到了这里跟上面的那个：</p>
<pre><code>&lt;?php 
    if(get_post_meta($post-&gt;ID,&#39;_product_director&#39;,true))&#123;
        echo get_post_meta($post-&gt;ID,&#39;_product_director&#39;,true);
    &#125;
?&gt;</code></pre>
<p>有点不一样，笔者把<code>$post-&gt;ID</code>改成了<code>$the_id</code>，这个也是从上面的那个遍历里面获取灵感的：</p>
<p><img src="https://i.imgur.com/xevDVae.jpg"></p>
<p>好的，我们来测试下，还是找前面的两三个产品都在后台添加不同的参数：</p>
<p><img src="https://i.imgur.com/YOtaifR.jpg"></p>
<p>这样我们就可以<strong>不用在数据库里面自定义数据字段</strong>来存储了，省掉一个麻烦，排除了一个安全隐患。</p>
<hr>
<p>最后根据这个方法，笔者对portfolio后台设置后的最终效果：</p>
<p><img src="https://i.imgur.com/e5EGv6M.jpg"></p>
<p>关于实现这个效果的代码就是两点：</p>
<ol>
<li>把代码添加到functions.php里面</li>
<li>修改对应的portfolio模板文件，来控制哪个字段显示出来，以什么样的方式显示等等。</li>
</ol>
<hr>
<p>这个是笔者的心血，请支持笔者的原创，如果有更好的方法，可以与笔者取得联系，QQ：791447771</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2018/04/25/nginx-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86-%E5%8F%96%E5%BE%97%E7%9C%9F%E5%AE%9EIP%E5%92%8C%E5%9F%9F%E5%90%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/25/nginx-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86-%E5%8F%96%E5%BE%97%E7%9C%9F%E5%AE%9EIP%E5%92%8C%E5%9F%9F%E5%90%8D/" class="post-title-link" itemprop="url">nginx 反向代理 取得真实IP和域名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-04-25 22:03:25" itemprop="dateCreated datePublished" datetime="2018-04-25T22:03:25+08:00">2018-04-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:18" itemprop="dateModified" datetime="2020-10-11T11:53:18+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>##一、反向代理配置：</p>
<p><strong>完整配置示例</strong></p>
<p>(/etc/nginx/nginx.conf) ，注意这个nginx.conf，可能不是默认的这个，有的人自定义了的，得根据自己配置走，反正是跟着自己的配置文件走就行了，你的设置在哪个配置文件中就去哪个配置文件中加这个：</p>
<pre><code>worker_processes 1;
events &#123;
worker_connections 1024;
&#125; 
http &#123;
    include mime.types;
    default_type application/octet-stream;
    sendfile on;
    keepalive_timeout 65; 

    upstream backend &#123; 
    server 192.168.56.4;
    server 192.168.56.5;
    　　　　fair;
    &#125; 

     server &#123;
        listen 80;
        server_name _; 

        location / &#123;

            #设置主机头和客户端真实地址，以便服务器获取客户端真实IP
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header REMOTE-HOST $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

            #禁用缓存
            proxy_buffering off; 

            #反向代理的地址
            proxy_pass http://backend; 
        &#125;
     &#125; 
&#125;</code></pre>
<p>二、获取真实客户端ip</p>
<p>nginx反向代理后，在应用中取得的ip都是反向代理服务器的ip，取得的域名也是反向代理配置的url的域名，解决该问题，需要在nginx反向代理配置中添加一些配置信息，目的将客户端的真实ip和域名传递到应用程序中。</p>
<p>笔者这里加的是这样的：</p>
<pre><code>server_name www.zhangsan.com;

location ^~/api/ &#123;

proxy_set_header Host $host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header REMOTE-HOST $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#禁用缓存
proxy_buffering off;

proxy_pass http://localhost:9899/api/;
&#125;
location / &#123;

proxy_set_header Host $host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header REMOTE-HOST $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#禁用缓存
proxy_buffering off;

root /home/username/zhangsan_html;
index index.html;
&#125;</code></pre>
<p>nginx反向代理配置时，一般会添加下面的配置：</p>
<blockquote>
<p>proxy_set_header Host $host;</p>
</blockquote>
<blockquote>
<p>proxy_set_header X-Real-IP $remote_addr;</p>
</blockquote>
<blockquote>
<p>proxy_set_header REMOTE-HOST $remote_addr;</p>
</blockquote>
<blockquote>
<p>proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</p>
</blockquote>
<p>其中第一行关于host的配置，是关于域名传递的配置，余下跟IP相关。</p>
<p>PHP中取得客户端真实IP：</p>
<pre><code>function getClientIP() &#123;
$ip = &quot;unknown&quot;;
if (isset($_SERVER)) &#123;
if (isset($_SERVER[&quot;HTTP_X_FORWARDED_FOR&quot;])) &#123;
$ip = $_SERVER[&quot;HTTP_X_FORWARDED_FOR&quot;];
&#125; elseif (isset($_SERVER[&quot;HTTP_CLIENT_ip&quot;])) &#123;
$ip = $_SERVER[&quot;HTTP_CLIENT_ip&quot;];
&#125; else &#123;
$ip = $_SERVER[&quot;REMOTE_ADDR&quot;];
&#125;
&#125; else &#123;
if (getenv(&#39;HTTP_X_FORWARDED_FOR&#39;)) &#123;
$ip = getenv(&#39;HTTP_X_FORWARDED_FOR&#39;);
&#125; elseif (getenv(&#39;HTTP_CLIENT_ip&#39;)) &#123;
$ip = getenv(&#39;HTTP_CLIENT_ip&#39;);
&#125; else &#123;
$ip = getenv(&#39;REMOTE_ADDR&#39;);
&#125;
&#125;
if(trim($ip)==&quot;::1&quot;)&#123;
$ip=&quot;127.0.0.1&quot;;
&#125;
 return $ip;
&#125;</code></pre>
<p>笔者在tp5中的用法如下：</p>
<pre><code>$ip = &quot;unknown&quot;;
if (isset($_SERVER)) &#123;
if (isset($_SERVER[&quot;HTTP_X_FORWARDED_FOR&quot;])) &#123;
$ip = $_SERVER[&quot;HTTP_X_FORWARDED_FOR&quot;];
&#125; elseif (isset($_SERVER[&quot;HTTP_CLIENT_ip&quot;])) &#123;
$ip = $_SERVER[&quot;HTTP_CLIENT_ip&quot;];
&#125; else &#123;
$ip = $_SERVER[&quot;REMOTE_ADDR&quot;];
&#125;
&#125; else &#123;
if (getenv(&#39;HTTP_X_FORWARDED_FOR&#39;)) &#123;
$ip = getenv(&#39;HTTP_X_FORWARDED_FOR&#39;);
&#125; elseif (getenv(&#39;HTTP_CLIENT_ip&#39;)) &#123;
$ip = getenv(&#39;HTTP_CLIENT_ip&#39;);
&#125; else &#123;
$ip = getenv(&#39;REMOTE_ADDR&#39;);
&#125;
&#125;
if(trim($ip)==&quot;::1&quot;)&#123;
$ip=&quot;127.0.0.1&quot;;
&#125;</code></pre>
<p>获取到用户的$ip的IP后，就可以插入数据库了。类似这样的：</p>
<pre><code>$nickname = $userinfoarr[&#39;nickname&#39;];
$city = $userinfoarr[&#39;city&#39;];
$access_time = date(&#39;y-m-d h:i:s&#39;,time());
Db::table(&#39;member&#39;)
    -&gt;data([&#39;openid&#39;=&gt;$openid,&#39;ip&#39;=&gt;$ip,&#39;city&#39;=&gt;$city,&#39;nickname&#39;=&gt;$nickname,&#39;access_time&#39;=&gt;$access_time])
    -&gt;insert();</code></pre>
<p>所以这里最核心的就是两点：</p>
<p>第一：代理那里要添加：</p>
<pre><code>proxy_set_header Host $host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header REMOTE-HOST $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#禁用缓存
proxy_buffering off;</code></pre>
<p>获取ＩＰ的地方需要修改下，而不是ｔｐ５中默认的方法了，改成如下：</p>
<pre><code>$ip = &quot;unknown&quot;;
if (isset($_SERVER)) &#123;
if (isset($_SERVER[&quot;HTTP_X_FORWARDED_FOR&quot;])) &#123;
$ip = $_SERVER[&quot;HTTP_X_FORWARDED_FOR&quot;];
&#125; elseif (isset($_SERVER[&quot;HTTP_CLIENT_ip&quot;])) &#123;
$ip = $_SERVER[&quot;HTTP_CLIENT_ip&quot;];
&#125; else &#123;
$ip = $_SERVER[&quot;REMOTE_ADDR&quot;];
&#125;
&#125; else &#123;
if (getenv(&#39;HTTP_X_FORWARDED_FOR&#39;)) &#123;
$ip = getenv(&#39;HTTP_X_FORWARDED_FOR&#39;);
&#125; elseif (getenv(&#39;HTTP_CLIENT_ip&#39;)) &#123;
$ip = getenv(&#39;HTTP_CLIENT_ip&#39;);
&#125; else &#123;
$ip = getenv(&#39;REMOTE_ADDR&#39;);
&#125;
&#125;
if(trim($ip)==&quot;::1&quot;)&#123;
$ip=&quot;127.0.0.1&quot;;
&#125;</code></pre>
<p>好的，总结完成！</p>
<p>原文参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/luotingliang/p/7289811.html">https://www.cnblogs.com/luotingliang/p/7289811.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/21/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><span class="page-number current">22</span><a class="page-number" href="/page/23/">23</a><span class="space">&hellip;</span><a class="page-number" href="/page/43/">43</a><a class="extend next" rel="next" href="/page/23/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">424</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">400</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
