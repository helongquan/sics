<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/38/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/38/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2017/02/17/%E9%98%BF%E9%87%8C%E4%BA%91Linux%E4%B8%80%E9%94%AE%E5%AE%89%E8%A3%85web%E7%8E%AF%E5%A2%83%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/02/17/%E9%98%BF%E9%87%8C%E4%BA%91Linux%E4%B8%80%E9%94%AE%E5%AE%89%E8%A3%85web%E7%8E%AF%E5%A2%83%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/" class="post-title-link" itemprop="url">阿里云Linux一键安装web环境使用教程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-02-17 22:24:39" itemprop="dateCreated datePublished" datetime="2017-02-17T22:24:39+08:00">2017-02-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:06" itemprop="dateModified" datetime="2020-10-11T11:53:06+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>以前是万网虚拟主机空间越发的不够了，想换服务器由于备案在万网为了方便只好选择了阿里云空间。</p>
<p>配置环境阿里云Linux一键安装web环境是一个方便广大网站建设者的环境配置，省去了使用面板不安全占用系统内存的诸多问题，方便的建设PHP环境省去了，人工配置的繁琐节省时间。</p>
<p>如果是新手建议安装面板解决问题，毕竟这个环境还是需要手动配置的，如果你安装之后不懂可以在阿里云后台申请阿里云的工程师帮您解决问题。</p>
<p>如果是1G内存以上的ECS可以使用WDCP这个使用的比较多久是版本不怎么更新安全性还是可以的。小于1g内存的可以使用自己的路面板或AMH这个AMH好像收费的不过不贵的。收费才能长久开发的推荐使用。自己的路免费的好像不怎么更新了。</p>
<p><strong>安装须知</strong></p>
<p>1、此安装包可在阿里云所有linux系统上部署安装，此安装包包含的软件及版本为：</p>
<p>nginx：1.0.15、1.2.5、1.4.4</p>
<p>apache：2.2.22、2.4.2</p>
<p>mysql：5.1.73、5.5.35、5.6.15</p>
<p>php：5.3.18、5.4.23、5.5.7</p>
<p>php扩展：memcache、Zend Engine/ OPcache</p>
<p>ftp：（yum/apt-get安装）</p>
<p>phpwind：8.7 GBK</p>
<p>phpmyadmin：4.1.8</p>
<p>2、请使用最新的一键安装包脚本安装，以前老版本都存在bug，会导致安装异常以及安装的环境混乱。</p>
<p>3、执行一键安装包(./install.sh)，会自动清理之前一键安装包安装过的环境。</p>
<p>如果您已经安装过一键安装包，再次执行安装，如若有重要数据，请自行备份/alidata目录。</p>
<p>4、一键安装包会将软件安装在/alidata目录下。</p>
<p>如果您的系统不存在数据盘，则一键安装包会将软件安装到系统/alidata目录下。</p>
<p>如果您的系统存在数据盘，且还没有格式化挂载数据盘。则一键安装包会自动帮您格式化第一块数据盘，并挂载在/alidata目录下。</p>
<p>如果您的系统存在数据盘，且已格式化并挂载了第一块数据盘。一键安装包会将第一块数据盘再次挂载到/alidata目录下，并不影响您之前的挂载目录的使用。比如下图所示，安装前，已经挂载了mnt目录。安装后，一键安装包再次挂载/alidata目录。</p>
<p>如果您的系统存在数据盘，且已格式化数据盘，但没有挂载数据盘。一键安装包会将第一块数据盘挂载到/alidata目录下。</p>
<p>5、怎么样卸载一键安装包？</p>
<p>可以执行以下命令完成卸载：</p>
<pre><code>chmod  777 -R sh-1.3.0/

cd sh-1.3.0/

./uninstall.sh</code></pre>
<p><strong>准备工具如下：</strong></p>
<pre><code>xshell 

Xftp</code></pre>
<p><strong>方法/步骤</strong></p>
<p>1.首先安装xshell（基本上是点击Next直至安装 完成）</p>
<p>具体安装过程跟一般的软件安装没什么不同，这里就省略。</p>
<p>2.安装完这两个工具之后，就可以打开xshell， 设置云服务器登录信息。</p>
<p><img src="http://i.imgur.com/e9yWgR4.jpg"></p>
<p>3.设置服务器账号密码。</p>
<p><img src="http://i.imgur.com/tW8lDL3.jpg"></p>
<p>4.设置字符集编码（如果不设置字符集编码，则中文字符将会在xshell中显示为乱码）。</p>
<p><img src="http://i.imgur.com/3F0bFDF.jpg"></p>
<ol start="5">
<li>一切准备就绪，让我们连接看看云linux服务器的庐山真面目吧！</li>
</ol>
<p><img src="http://i.imgur.com/wrCZPSf.jpg"></p>
<p>6.在打开的界面中输入cd 就可以进入主目录了。这个cd后门带一个空格的 最早接触到计算机的应该能了解一些的cd 在以前计算机DOS系统下的命了的，本人在初中接触计算机的时候知道一些，看来还是得学习。</p>
<p><img src="http://i.imgur.com/nxpbUiZ.jpg"></p>
<p>7.现在开始用xftp上传环境安装文件。</p>
<p><img src="http://i.imgur.com/kQUnIQk.jpg"></p>
<p>8.回到shell界面，用ll命令看下情况，输入命令：ll ，是不是多了一个sh-1.3.0目录，熟悉linux的朋友，直接可以用wget命令安装包这样就不用使用上传了。</p>
<p><img src="http://i.imgur.com/sZgHmzo.jpg"></p>
<p>9.输入命令：</p>
<pre><code>chmod –R 777 sh-1.3.0
  cd sh-1.3.0
  ./install.sh</code></pre>
<p>出现了一个选择提示，进入web服务器的选择界面。这里您可以根据需要选择apache或者nginx服务器。1是nginx 2是apache一般选择1就可以了。（简单的讲解下在高并发连接的情况下，Nginx是Apache服务器不错的替代品。Nginx同时也可以作为7层负载均衡服务器来使用。根据我的测试结果，Nginx 0.8.46 + PHP 5.2.14 (FastCGI) 可以承受3万以上的并发连接数，相当于同等环境下Apache的10倍。）这里就不多讲了可以自己百度一下。</p>
<p>10.这里我们选择nginx，输入1，回车</p>
<p><img src="http://i.imgur.com/PjQJb0U.jpg"></p>
<p>11.然后我们再选择要安装的nginx的版本（如果web服务器选择的是apache，这里提示信息则是要安装apache的版本），总共有1.0.15/1.2.5/1.4.4三个版本可以提供我们选择，这里我们选择1.2.5版本，则输入2，回车（如果什么都不输入，直接回车，或者输入错误的字符，则默认选择1.0.15版本）这个我就不截图了选择默认的就可以直接回车键就行.</p>
<p>12.然后我们再选择要安装的php的版本，总共有5.3.18/5.4.23/5.5.7三个版本可以提供我们选择，这里我们选择5.5.7版本，则输入3，回车（如果什么都不输入，直接回车，或者输入错误的字符，则默认选择5.3.18版本）这个我就不截图了选择默认的就可以直接回车键就行</p>
<p>13.然后我们再选择要安装的mysql的版本，总共有5.1.73/5.5.35/5.6.15三个版本可以提供我们选择，这里我们选择5.1.73版本，则输入1，回车（如果什么都不输入，直接回车，或者输入错误的字符，则默认选择5.1.73版本）这个我就不截图了选择默认的就可以直接回车键就行.</p>
<p>14.最后就可以看到可我们刚才选择的版本如下，我们输入y或者Y进行安装。这里，我们就正式进入环境安装环节了。这个环节需要一定的时间和服务器的配置和有有关的一般半个小时左右的，期间不能关闭的。等着就好了可以干点别的去了。</p>
<p><img src="http://i.imgur.com/O8fPnZb.jpg"></p>
<p>15.到这个界面说明安装已经结束了，我们可以输入以下命令再次验证是不是已经安装成功</p>
<p><img src="http://i.imgur.com/ERkW0nZ.jpg"></p>
<p>16.接着在命令行里输入：</p>
<pre><code>cat account.log</code></pre>
<p>就可以看到默认的密码了。</p>
<p><img src="http://i.imgur.com/lVtvANB.jpg"></p>
<p>ftp的用户名是：www</p>
<p>mysql的用户名是：root</p>
<p>以上密码都是系统随机设置的安全性很高的，可以修改也可以不修改的。</p>
<p>17.如何管理mysql呢? 这个很简单</p>
<p>在地址栏输入您的服务器IP/phpmyadmin</p>
<p>就会看到登陆页面了。输入上面随机的密码就可以了</p>
<p><img src="http://i.imgur.com/CJyW6XJ.jpg"></p>
<p>18.安装网站程序这个阿里云的环境默认带一个phpwind论坛的大家可以测试下，在浏览器中输入您的域名会IP就可以出来安全界面了按照提示进行安装就可以了。看下图片就知道了。</p>
<p><img src="http://i.imgur.com/rLR1ycF.jpg"></p>
<p><img src="http://i.imgur.com/UAnfpvX.jpg"></p>
<p><img src="http://i.imgur.com/DGYsIiq.jpg"></p>
<p>这样就算安装成功了。</p>
<hr>
<p><strong>这里来介绍一下域名绑定教程</strong></p>
<p>1、 登录您的Linux云主机，进入WEB服务器配置文件夹；  　　</p>
<p>运行命令：cd /aliyun/webserver/apache2.2.15/conf  　　</p>
<p>2、 备份WEB服务器配置文件；  　　</p>
<p>运行命令：cp httpd.conf httpd.conf.bak  　　</p>
<p>3、 修改WEB服务器配置文件；  　　</p>
<p>运行命令：vi + httpd.conf  　　</p>
<p>4、 添加网站配置信息；  　　</p>
<ol>
<li><p>按字母i键，进入编辑模式；  　　</p>
</li>
<li><p>在配置文件末尾，添加  　　</p>
<p> ServerAdmin admin@domain（您的邮箱）  　　</p>
<p> DocumentRoot /alidata/www/wwwroot/phpwind （网站存放路径）  　　</p>
<p> ServerName test.com （网站域名）  　　</p>
<p> ServerAlias <a target="_blank" rel="noopener" href="http://www.test.com(网站别名)/">www.test.com（网站别名）</a>  　　</p>
<p> ErrorDocument 404 /404.php  　　</p>
<p> DirectoryIndex index.html index.php index.htm  　　（网站存放路径）  　　</p>
<p> Options +Includes  　　</p>
<p> AllowOverride None  　　</p>
<p> Order allow,deny  　　</p>
<p> Allow from all  　　</p>
</li>
<li><p>保存修改。</p>
</li>
</ol>
<p>按ESC键，输入”:wq”后回车；  　　</p>
<ol start="4">
<li>使配置生效。</li>
</ol>
<p>运行命令：../bin/apachectl graceful  　　</p>
<ol start="5">
<li>测试网站。请在浏览器中输入域名，测试设置。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2017/02/14/%E5%87%A0%E4%B8%AA%E4%BC%98%E5%8C%96WordPress%E4%B8%ADJavaScript%E5%8A%A0%E8%BD%BD%E4%BD%93%E9%AA%8C%E7%9A%84%E6%8F%92%E4%BB%B6%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/02/14/%E5%87%A0%E4%B8%AA%E4%BC%98%E5%8C%96WordPress%E4%B8%ADJavaScript%E5%8A%A0%E8%BD%BD%E4%BD%93%E9%AA%8C%E7%9A%84%E6%8F%92%E4%BB%B6%E4%BB%8B%E7%BB%8D/" class="post-title-link" itemprop="url">几个优化WordPress中JavaScript加载体验的插件介绍</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-02-14 22:52:34" itemprop="dateCreated datePublished" datetime="2017-02-14T22:52:34+08:00">2017-02-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:01" itemprop="dateModified" datetime="2020-10-11T11:53:01+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>这篇文章主要介绍了几个优化WordPress中JavaScript加载体验的插件,一般来说在WordPress中加载JavaScript最好使用wp_enqueue_script()函数以减少问题提高效率,需要的朋友可以参考下。</p>
<p>WordPress 本身以及主题和插件通常需要加载一些 JavaScript 来实现某些特殊功能。为了最大限度地保证兼容性，不至于出现 JavaScript 失效的情况，所以一般在页头加载 JavaScript 文件。但是根据 Yahoo 开发者论坛的建议，加载 JavaScript 应该尽量在页尾以提高页面的显示（响应、渲染）速度。本文根据作者的使用经验介绍几个相关插件，并说明如何在某些特殊页面仍然在页头加载 JavaScript。</p>
<p>下面先简单介绍几个相关的优化 JavaScript 的 WordPress 插件及特点，然后演示如何处理一些特殊情况。</p>
<p><strong>一. 优化JavaScript的WordPress插件</strong></p>
<p>我曾经用过 WP Minify、Autoptimize、JavaScript to Footer这三个插件，下面一一介绍其特点。</p>
<p><strong>1. WP Minify</strong></p>
<p>这个插件将 Minify 引擎整合到 WordPress 中。一经启用，该插件就能够合并和压缩你的 JS 和 CSS 文件来提高页面的加载速度。</p>
<p>WP Minify 能够抓取生成的 WordPress 页面中的 JS/CSS 文件，将文件列表传递给 Minify 引擎。</p>
<p>Minify 引擎处理后返回一个加强、精简并经过压缩的 JavaScript 或样式表文件（CSS），由 WP Minify 将其替换到 WordPress 页头中。</p>
<p>其主要特点是：</p>
<pre><code>易于使用；
对 JavaScript、CSS 和 HTML 均有效；
提供了调试工具；
能够处理外部 JS 和 CSS 文件；
能够排除指定 JS 和 CSS 文件；
能够指定处理后的 JS 和 CSS 文件的位置（页头或页尾，甚至别的地方）；
可对处理后的 JS 和 CSS 文件添加过期时间等。</code></pre>
<p>当 WordPress 3.1 测试版出来后，我发现 WP Minify 与之不兼容，会导致网站无法正确加载。</p>
<p><strong>2. Autoptimize</strong></p>
<p>也许将来 WP Minify 升级后会解决不兼容问题，但是我等不及了。后来找到了 Autoptimize 这个具有类似功能的插件，而且这个插件操作更简单。</p>
<p>Autoptimize 整合、精简并压缩所有的 JS 和 样式表（CSS）文件，增加缓存过期标志。然后将样式表文件放到页头（同样是为了提高页面加载效率），并将 JS 文件放到页尾。它还能够精简 HTML 代码，给你的页面瘦身。不过我觉得给 HTML 页面瘦身作用不是很明显，只要你的服务器开启了 Gzip 压缩特性就没必要这么做了。</p>
<p>默认情况下，Autoptimize 会按照上面介绍的方式优化所有 HTML/CSS/JavaScript 。</p>
<p>我个人觉得，Autoptimize 是比 WP Minify 更好用的 WordPress 优化插件。</p>
<p><strong>3. JavaScript to Footer</strong></p>
<p>这个插件写的非常简洁。我查看了源代码，完成任务的代码只有 6 个 WordPress 函数（见下文），也就是 6 行。所以这个插件从创建之后就怎么更新过。我一开始就因为见它最后更改日期还停留在2009年9月22日，所以把它给忽略了。</p>
<p>但是它仅仅优化 JavaScript 的加载位置，也就是将所有在 WordPress 中正确声明了的 Javascript 文件都给移到页面末尾来加载。它没有对 HTML 代码和 CSS 样式表文件作任何处理。<br>根据 JavaScript to Footer 的源代码，它使用下面的 6 行代码来完成工作：</p>
<pre><code>remove_action(&#39;wp_head&#39;, &#39;wp_print_scripts&#39;);
remove_action(&#39;wp_head&#39;, &#39;wp_print_head_scripts&#39;, 9);
remove_action(&#39;wp_head&#39;, &#39;wp_enqueue_scripts&#39;, 1);
add_action(&#39;wp_footer&#39;, &#39;wp_print_scripts&#39;, 5);
add_action(&#39;wp_footer&#39;, &#39;wp_enqueue_scripts&#39;, 5);
add_action(&#39;wp_footer&#39;, &#39;wp_print_head_scripts&#39;, 5);</code></pre>
<p>如果有需要，可以在某个特定 WordPress 模板的 wp_head() 函数前加入下面的代码，将上述过程逆转过来，也就是使之失效，恢复成了本来的加载位置：</p>
<pre><code>remove_action(&#39;wp_footer&#39;, &#39;wp_print_scripts&#39;, 5);
remove_action(&#39;wp_footer&#39;, &#39;wp_enqueue_scripts&#39;, 5);
remove_action(&#39;wp_footer&#39;, &#39;wp_print_head_scripts&#39;, 5);
add_action(&#39;wp_head&#39;, &#39;wp_print_scripts&#39;);
add_action(&#39;wp_head&#39;, &#39;wp_print_head_scripts&#39;, 9);
add_action(&#39;wp_head&#39;, &#39;wp_enqueue_scripts&#39;, 1);</code></pre>
<p>当然只是说某些特定的页面模板，如果是所有页面，那干脆禁用该插件好了。</p>
<p><strong>二. 使用方法</strong></p>
<p>相信对于大多数 WPer 来说，看了前面的介绍就知道如何选择自己需要的优化插件并合理使用了。无非是基于以下三个方面来考虑：</p>
<p>你的页面模板中是否使用了大量的 HTML 注释、空格、空行等标记？如果没有，那么你就不需要为了一点点（开启 Gzip 压缩时通常 1% 以下）的带宽节省而使用 HTML 精简功能；</p>
<p>你的页面中是否加载了多个 CSS 样式表文件？如果没有，你也不需要通过插件来精简和整合 CSS 样式表，手工精简和整合 CSS 样式表比使用插件更加简单有效；</p>
<p>基于 WordPress 默认会在页头中加载 JavaScript，一般的 WordPress 网站都需要对 JS 的加载位置进行优化。但是如果你大部分的页面也都需要在页面头部加载 JS 以保证不会出现 JS 失效的情况，那你就不能进行这样的优化了。</p>
<p>在我看来，WP Minify 就不需要了，原因在前面已经说过了。那么剩下的 Autoptimize 和 JavaScript to Footer 可以选用其一或者两者配合使用（如果是配合使用，当然是使用前者的 HTML 和 CSS 精简/整合功能，而使用后者的 JS 位置控制功能，因为后者就这一个功能）。我只需要控制 JS 的加载位置，所以就选择了 JavaScript to Footer。因为我的页面中也就四五个 JS 文件，又是放到页尾加载，我觉得没必要进行整合。</p>
<p><strong>三. 特殊情况处理</strong></p>
<p>虽然将 JavaScript 文件都放到页面末尾加载对于页面加载速度很有帮助，但是请注意，所谓页面末尾指的是在 WordPress 的 wp_footer() 函数中调用，这个函数通常刚好位于页面的 </body> 标签前面（当然是末尾了）。</p>
<p>有时候我们可能会在 wp_footer 函数出现之前就需要用到某些 JavaScript，比如 jquery.js 文件。<br>这样的情况也是很常见的。比如我单独创建了一个链接页面，在这个页面中我使用了 jQuery 方法来获取链接网站的 favicon。很显然，我只需要在这唯一一个页面使用这部分代码，所以将这段代码直接放在这个页面模板中是最好的做法。问题来了：这部分内容显然是在 wp_footer 之前出现的，那么这段代码就在 jquery.js 文件之前出现了，导致该代码段实际上无法工作，因为调用 jQuery 方法的代码段必须比 jquery.js 文件后加载。</p>
<p>那么如何处理这种特殊情况呢？其实也很简单。以上面的情景为例，既然我们需要先调用 jquery.js 文件，那我们就在该代码段之前直接输出需要的 jquery.js 文件，不使用 wp_enqueue_script() 函数，而改用 wp_print_scripts() 函数。</p>
<p>wp_enqueue_script() 与 wp_print_scripts() 的区别是：wp_enqueue_script() 是告诉 WordPress “我在这个页面上需要用到某个 JavaScript 文件，你可要记得加载啊”。WordPress 默认在 wp_head() 中处理，而我们改为在 wp_footer() 中处理。wp_print_scripts() 则直接在你使用此方法的位置输出需要的 JavaScript 文件，而不是加入到 WordPress 的处理任务中。</p>
<p>如果我们在页面的中间使用，</p>
<pre><code>&lt;?php wp_print_scripts(&#39;jquery&#39;); ?&gt;</code></pre>
<p>直接输出了 jquery.js 文件（通常是其压缩版本 jquery.min.js），那么即使其它的插件或者什么东西使用，</p>
<pre><code>&lt;?php wp_enqueue_script(&#39;jquery&#39;); ?&gt;</code></pre>
<p>告诉 WordPress 需要加载 jquery.js，WordPress 在 wp_footer() 中处理的时候也会先检查前面是不是已经有了，如果有了就不会再重新加载一次。</p>
<p><strong>四. 结论</strong></p>
<p>在 WordPress 中加载 JavaScript 最好使用 wp_enqueue_script() 函数以减少问题提高效率。如果不是有这些特殊情况要处理，使用 Autoptimize 显然比较好，它全面完成任务而且使用简单。</p>
<p>但是如果使用的主题本身已经很简洁了，那么 JavaScript to Footer 更简单高效，也就更好。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2017/02/14/%E9%98%BF%E9%87%8C%E4%BA%91ecs%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%80%9A%E8%BF%87WDCP%E6%80%8E%E4%B9%88%E5%88%9B%E5%BB%BA%E5%A4%9A%E4%B8%AA%E7%BD%91%E7%AB%99%EF%BC%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/02/14/%E9%98%BF%E9%87%8C%E4%BA%91ecs%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%80%9A%E8%BF%87WDCP%E6%80%8E%E4%B9%88%E5%88%9B%E5%BB%BA%E5%A4%9A%E4%B8%AA%E7%BD%91%E7%AB%99%EF%BC%9F/" class="post-title-link" itemprop="url">阿里云ecs服务器通过WDCP怎么创建多个网站？</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-02-14 22:38:45" itemprop="dateCreated datePublished" datetime="2017-02-14T22:38:45+08:00">2017-02-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:06" itemprop="dateModified" datetime="2020-10-11T11:53:06+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>既然是创建多个网站，首先你得有阿里云ECS服务器，安装过wdcp控制面板，也已经建过一个网站了。</p>
<p>此篇文章，是我自学阿里云服务器后建的第二个网站的经验总结，也希望这些可以帮助更多的朋友。下面，直接给大家说下应该如何操作：</p>
<p>第一步，登录WDCP控制面板，地址一般是http://公网ip:8080/</p>
<p><img src="http://i.imgur.com/6jK0bXM.jpg"></p>
<p>第二步，点击WDCP控制面板左边的创建整站，如果使用新的域名建站，直接输入不带WWW的域名，在下面选择添加WWW域名，如果使用以前建站过的二级域名建站，就像下面图片所示，输入二级域名就行，再把下面的数据库和FTP设置下行了。</p>
<p><img src="http://i.imgur.com/4USNba4.jpg"></p>
<p>第三步，这时候在站点列表中就可以看到刚创建的网站，把FTP和数据库信息备份好</p>
<p><img src="http://i.imgur.com/nt0tZLr.jpg"></p>
<p>第四步，打开XFTP工具，在www/web目录下能看到你创建的网站</p>
<p><img src="http://i.imgur.com/iweleYN.jpg"></p>
<p>把里面的二个文件给删除了，把自己的网站源码上传到这里面，上传后安装，输入刚才配置的数据库信息安装就行了。</p>
<p>如果大家以前用的的虚拟主机建站，会比较简单，如果是用阿里云服务器建站会有点麻烦，比如我曾试着建立一个商城，一个论坛，还有其他的网站，就连安装都不成功。</p>
<p>经过昨天的测试，我发现在安装的时候，如果没有权限，大家直接给提示的文件的权限改为777就行了，如果没有文件就创建，总之，遇到问题再解决吧。</p>
<p>以前我用过香港空间，美国空间，还有国内的一些空间，不过都不太稳定，现在用了阿里云服务器博客一直很稳定，速度也快。等一个网站流量大了，也该考虑用服务器了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2017/02/14/%E9%98%BF%E9%87%8C%E4%BA%91%E4%B8%BB%E6%9C%BA%E6%80%8E%E6%A0%B7%E5%AE%89%E8%A3%85%E5%A4%9A%E4%B8%AA%E7%BD%91%E7%AB%99%EF%BC%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/02/14/%E9%98%BF%E9%87%8C%E4%BA%91%E4%B8%BB%E6%9C%BA%E6%80%8E%E6%A0%B7%E5%AE%89%E8%A3%85%E5%A4%9A%E4%B8%AA%E7%BD%91%E7%AB%99%EF%BC%9F/" class="post-title-link" itemprop="url">阿里云主机怎样安装多个网站？</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-02-14 22:31:37" itemprop="dateCreated datePublished" datetime="2017-02-14T22:31:37+08:00">2017-02-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:05" itemprop="dateModified" datetime="2020-10-11T11:53:05+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>云主机是越来越受到站长们的追捧了，因为它的稳定性、速度、独立IP相比传统主机，有着质的提升。国内最出名的云主机莫过于阿里云了，相信有很多站长都在使用阿里云了吧。但阿里云给我们带来这么多优点的同时，也给我们带来了一些麻烦：所有的软件安装都要我们自己来完成。</p>
<p>这篇文章主要跟大家探讨“阿里云主机怎样安装多个网站？”，这里主要是针对 linux 操作系统 nginx 服务器，并且没有安装控制面板。</p>
<p>首先，通过Xshell 安全终端远程连接到你的服务器，连接上后，点击“ 文件传输”按钮，如下图箭头所指处：</p>
<p><img src="http://i.imgur.com/BSRKCxO.jpg"></p>
<p>然后，通过“Xftp 文件传输软件“在服务器端找到“/alidata/server/nginx-1.2.5/conf/vhosts ”文件夹（当然这里的nginx-1.2.5会因为你的nginx版本不同而有所变化）。这个文件夹的 .conf文件就是域名绑定文件。（如下图）</p>
<p><img src="http://i.imgur.com/42tlTK7.jpg"></p>
<p>默认的阿里云主机安装了一个phpwind论坛，在上面这个文件夹里就会有个 phpwind.conf 文件，它是指向phpwind论坛的。我们可以把这个文件复制一份或者直接通过 Xftp 工具把它传输到本地，进行修改，然后再上传到这个文件夹里。关键是怎么修改这个复制的 .conf 文件</p>
<p>怎么修改呢？分几步走：</p>
<p>1、把这个复制过来的 .conf 文件名改成你的新建网站的文件夹名（网站文件夹一般在/alidata/www 目录里），比方说，你的网站文件夹名是hello ，那么，这个文件就改成 hello.conf 。</p>
<p>2、修改这个文件的内容。用记事本打开这个文件（如下图）</p>
<p><img src="http://i.imgur.com/8VKzSy6.jpg"></p>
<p>蓝色框里的都要修改，第一个改成你的域名，第二个和第三个都改成你的网站文件夹名（如hello）。然后保存。</p>
<p>接着就是上传到服务器里了，就是上面的“/alidata/server/nginx-1.2.5/conf/vhosts ”文件夹。</p>
<p>最后，就是重启一下你的阿里云服务器，启动完后，输入域名，就可以正常访问你的新网站了。你还可以接着按同样的方法安装多个网站。这样，我们就实现了阿里云主机安装上多个网站。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2017/02/14/%E9%98%BF%E9%87%8C%E4%BA%91%E4%B8%BB%E6%9C%BAAliyun-Linux%E7%B3%BB%E7%BB%9F%E4%B8%8A%E5%AE%89%E8%A3%85WDCP%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/02/14/%E9%98%BF%E9%87%8C%E4%BA%91%E4%B8%BB%E6%9C%BAAliyun-Linux%E7%B3%BB%E7%BB%9F%E4%B8%8A%E5%AE%89%E8%A3%85WDCP%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">阿里云主机Aliyun Linux系统上安装WDCP服务器管理系统</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-02-14 22:23:33" itemprop="dateCreated datePublished" datetime="2017-02-14T22:23:33+08:00">2017-02-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:06" itemprop="dateModified" datetime="2020-10-11T11:53:06+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>各位使用阿里云ECS的朋友，当你们看到上面的一个Aliyun Linux的系统的时候，会不会跟我这个菜鸟一样对这个Aliyun Linux感兴趣呢。想不想在上面安装WDCP或者Amh等主机面板呢？如果有兴趣的话，就跟着我这个菜鸟来学习一下如何在Aliyun Linux系统上安装WDCP吧。 </p>
<p>首先，介绍一下WDCP。wdcp (WDlinux Control Panel) 是一套用PHP开发的Linux服务器管理系统,旨在易于使用和管理Linux服务器,通过web页面操作就可以管理服务器和虚拟主机.简单,方便,易操作.只有Linux版本,没有windows版本,让你方便地使用和管理Linux服务器,让不懂Linux的人也可以用Linux做服务器了。 </p>
<p>在Aliyun Linux系统上安装WDCP，我采用的是源码编译安装的方式，没有去尝试RPM包快速安装方式，有兴趣的可以去尝试一下能否安装。 </p>
<p>由于Aliyun Linux是Redhat的再编译的产物，由于Redhat的yum在线更新是收费的，如果没有注册的话是不能使用的，即不能在线安装软件。因此，我们首先需要配置Aliyun Linux 系统的yum源为免费yum源：<br>具体过程这里不详述，请参考：<a target="_blank" rel="noopener" href="http://hxs.fd.fj.cn/?action=show&amp;id=41">http://hxs.fd.fj.cn/?action=show&amp;id=41</a> </p>
<p>配置好Aliyun Linux的yum源之后，接下来开始安装WDCP： </p>
<pre><code>wget http://dl.wdlinux.cn:5180/lanmp_laster.tar.gz 
tar zxvf lanmp_laster.tar.gz </code></pre>
<p>执行</p>
<pre><code>sh install.sh</code></pre>
<p>我这步安装出错，请恕我菜鸟一只，也不知道为什么，如果你也安装出错，就跟我这个菜鸟一样，手动执行如下命令吧： </p>
<pre><code>chmod 755 lanmp.sh 
chmod 755 wdcp.sh </code></pre>
<p>如果不设置lanmp.sh和wdcp.sh的执行权限，后面php编译安装过程中会出现chown:invalid user: ‘wdcpu.wdcpg’的错误。 </p>
<p>然后依次执行如下命令，安装lanmp环境和wdcp面板 </p>
<pre><code>./lanmp.sh 
./wdcp.sh </code></pre>
<p>提醒一下，WDCP编译安装的过程比较漫长，不要误认为系统卡死了，所以请耐心等待吧，可能需要30分钟到1个小时。 </p>
<p>原文：<a target="_blank" rel="noopener" href="http://hxs.fd.fj.cn/?action=show&amp;id=42">http://hxs.fd.fj.cn/?action=show&amp;id=42</a> </p>
<p>这里我安装到了./lanmp.sh 这一步，因为我在安装这个之前已经有网站在运行了，所以不知道安装后会不会对我原有的网站程序造成影响，暂时停留在这一步，待我把在这个服务器中的数据备份了，之后再继续安装后面的。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2017/02/10/IIS%E3%80%81Apache%E3%80%81Nginx%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8BWordPress%E9%85%8D%E7%BD%AE%E4%BC%AA%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/02/10/IIS%E3%80%81Apache%E3%80%81Nginx%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8BWordPress%E9%85%8D%E7%BD%AE%E4%BC%AA%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">IIS、Apache、Nginx服务器下WordPress配置伪静态方法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-02-10 23:21:59" itemprop="dateCreated datePublished" datetime="2017-02-10T23:21:59+08:00">2017-02-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:32" itemprop="dateModified" datetime="2020-10-11T11:53:32+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>首先检查一下网站是否支持伪静态规则，检测主机是否支持伪静态的方法：在WP后台 &gt; 设置 &gt; 固定链接，设置为 非默认带?的那种结构，然后访问任何一篇文章，如果出现 404 错误，说明你的主机当前不支持 WordPress 伪静态。</p>
<p><img src="http://i.imgur.com/JNHcNuA.png"></p>
<p><strong>IIS伪静态规则</strong></p>
<p>IIS 环境是 Windows 主机常用的服务器环境，新建一个 txt 文件，将下面的代码添加到文件中：</p>
<pre><code>[ISAPI_Rewrite]
# Defend your computer from some worm attacks
#RewriteRule .*(?:global.asa|default\.ida|root\.exe|\.\.).* . [F,I,O]
# 3600 = 1 hour

CacheClockRate 3600
RepeatLimit 32

# Protect httpd.ini and httpd.parse.errors files
# from accessing through HTTP
# Rules to ensure that normal content gets through

RewriteRule /tag/(.*) /index\.php\?tag=$1
RewriteRule /software-files/(.*) /software-files/$1 [L]
RewriteRule /images/(.*) /images/$1 [L]
RewriteRule /sitemap.xml /sitemap.xml [L]
RewriteRule /favicon.ico /favicon.ico [L]
# For file-based wordpress content (i.e. theme), admin, etc.
RewriteRule /wp-(.*) /wp-$1 [L]
# For normal wordpress content, via index.php
RewriteRule ^/$ /index.php [L]
RewriteRule /(.*) /index.php/$1 [L]</code></pre>
<p>然后另存为 httpd.ini 文件，上传到WordPress站点的根目录即可。</p>
<p><strong>Apache伪静态规则</strong></p>
<p>Apache是 Linux 主机下常见的环境，现在一般的 Linux 虚拟主机都采用这种环境。新建一个 htaccess.txt 文件，添加下面的代码：</p>
<pre><code>&lt;IfModule mod_rewrite.c&gt;
RewriteEngine On
RewriteBase /
RewriteRule ^index\.php$ - [L]
RewriteCond %&#123;REQUEST_FILENAME&#125; !-f
RewriteCond %&#123;REQUEST_FILENAME&#125; !-d
RewriteRule . /index.php [L]
&lt;/IfModule&gt;</code></pre>
<p>然后上传到 WordPress 站点的根目录，重命名为 .htaccess 即可。</p>
<p><strong>Nginx伪静态规则</strong></p>
<p>Nginx环境一般是Linux 主机 VPS或服务器用户用的比较多，这些用户一般都会自己配置Nginx，或者有专门的人帮你配置，打开 nginx.conf 或者某个站点的配置环境，比如 xxx.com.conf（不同人配置的不一样），在  server   { } 大括号里面添加下面的代码：</p>
<pre><code>location / &#123;
if (-f $request_filename/index.html)&#123;
                rewrite (.*) $1/index.html break;
        &#125;
if (-f $request_filename/index.php)&#123;
                rewrite (.*) $1/index.php;
        &#125;
if (!-f $request_filename)&#123;
                rewrite (.*) /index.php;
        &#125;
&#125;</code></pre>
<p>以上这段代码也可以在/alidata/server/nginx-1.4.4/conf/rewrite里面的wordpress.conf找到，复制过来即可。</p>
<p>添加完后，重启服务器，重启一下nginx即可。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2017/02/10/%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%80%81%E6%98%AF%E7%88%86%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E4%B8%8D%E4%B8%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/02/10/%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%80%81%E6%98%AF%E7%88%86%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E4%B8%8D%E4%B8%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">阿里云服务器老是爆数据库连接不上解决方法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-02-10 23:19:02" itemprop="dateCreated datePublished" datetime="2017-02-10T23:19:02+08:00">2017-02-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:06" itemprop="dateModified" datetime="2020-10-11T11:53:06+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>针对linux服务器运行一段时间后连接不上的问题。</p>
<p>故障：统运行一段时间，就会出现莫名其妙的网络连接不上，需到机房去service network restart一下，或者直接reboot才可以。</p>
<p>解决这个问题有2种方法，第一种相对简单，就是在Linux内核中禁用 ACPI 电源管理系统。<br>但该方法不推荐，因为会导致服务器失去智能电源调节，增加功耗。</p>
<p>方法二：就是升级一下网卡的驱动以及固件驱动，记得更新驱动后需重启服务器或者网卡才会生效。</p>
<p>以上这些情况针对的是自有服务器的情况，另外的情况是云服务器这种情况改怎么办呢？</p>
<p>直接打电话问服务器服务商，另外需要补充的后面完善，如果有更多经验的可以帮助一起完善起来，方便更多人。</p>
<p><strong>这里我找到了网上一个有类似问题解决方案，如下：</strong></p>
<p>以前一直用虚机，这次改用了阿里云服务器，因为这个站点纯粹就是个人喜好建立的，所以主机配置比较低，单核1G，1M独立外网带宽，环境是centos6.5 64位，nginx mysql 位安装管理面板，自己对这方面也完全是白丁，整个服务器环境的搭设全部按照阿里云官方的教程进行，整体弄完后，把自己的WORDPRESS搬上去，也还算顺利。不过运行了半个多余突然出现问题。打开网页的时候显示“建立数据库连接时出错”，通过后台链接MYSQL发现报错无法连接，自己也不太懂，就直接重启了服务器，一切正常。不过出现这种问题心理多少有些担忧，就在后台通过看了下进程，一看发现一个php-fpm的进程有很多子进程，且占用内存非常大，很短时间1G内存空闲就只剩下不到300M，而CPU使用率却很低。</p>
<p>找了个在线压力测试，并发30,进行3分钟压力访问，发现内存很快就所剩无几了，直到低于90M以后突然恢复到270M空闲时，发现MYSQL的进程被KILL了。压力测试结束后，内存并没有被释放。这就是问题所在了。</p>
<p>通过百度查询得知，PHP-CGI会释放内存，但并不会把内存归还系统，所以当过多的PHP-FPM子进程存在时，内存就会一点点被吃干，最终导致溢出。解决方法网上貌似很多，但看起来有点天书，选了一种比较好理解易操作的方法，就是修改<code>php-fpm.conf</code>文件，控制这个进程的数量。</p>
<p>找这个文件我就费了很大劲，网上的文章都不说这个文件在哪，对于小白来说，就有点吃力，最后找到，这个文件在php安装文件夹心下的etc文件夹里，如果是阿里云的话，应该就是 <code>/alidata/server/php/etc</code>里。</p>
<p>打开编辑这个文件，可以通过FTP或者LINUX命令行进行修改。主要涉及几个参数。</p>
<p>pm 这个是设置运行方式的，分别是static（静态）或者dynamic（动态）</p>
<p>默认应该是在214行左右，显示为 pm = dynamic，意思就是动态方式，如果内存小，比如512M，1G，2G之类，建议使用动态。</p>
<pre><code>pm.max_children：静态方式下开启的php-fpm进程数量，这个是有在pm模式为static的情况下生效。

pm.start_servers：动态方式下的起始php-fpm进程数量，这个是pm位dynamic模式下需要设置的参数，意思就是启动运行时建立的起始php-fpm进程数量</code></pre>
<p>大概在230行左右，我设置后的，</p>
<pre><code>pm.start_servers = 3

pm.min_spare_servers：动态方式下的最小php-fpm进程数

大概位置在235行，我设置后的，pm.min_spare_servers = 3

pm.max_spare_servers：动态方式下的最大php-fpm进程数量</code></pre>
<p>大概位置在240行，我设置后的，pm.max_spare_servers = 10</p>
<p>还有一个就是pm.max_requests，这个在百度查询都的结果就是接受多少次请求后自动重启进程的，默认是500，不知道这个数值具体是指什么的，因为重启就意味着把php占用的空闲内存释放给系统，不过一旦这个值设置的过低，可能会导致所有的php-fpm进程在几乎同时重启，而重启过程中CPU占用率会飙升，且PHP会拒绝访问请求，所以这个值不能过低，按照我这个小白理解就是宁可适当的减少运行的子进程数，也不能过分的降低这个值。不知道对不对</p>
<p>大概位置在251行，我设置后的，pm.max_requests = 200</p>
<p>这就是我设置后的几个参数，保存后重启服务，再次观察，内存占用率基本稳定在400M，缓慢增长，经过了一晚的再次进行30并发的压力测试，虽然内存和CPU同样会在此时爆发增长，但是这个并发数还是挺住了，且在压力测试结束后，内存大部分被释放给系统了。</p>
<p>最后又在wordpress安装了wp-super-cache缓存插件，很大程度降低了访问页面时对服务器的压力。</p>
<p>根据百度查到的，配置php-fpm并非由固定的模式，他基本是要找到一个平衡，对于我这样的小白来说，只能一点点的试，先改成这样运行一段时间观察下，后续再做调整，毕竟自己是小白，很多东西都得摸索，短时间内也无法确定效果，慢慢试吧。</p>
<p>linux命令行  </p>
<pre><code>top命令可以查看动态的系统资源占用情况。 

ps aux可以查看当时占用系统资源的情况，非动态。</code></pre>
<p>这里补充一点，开始的时候由于客户那边下班了，没法进入阿里云账号里面查看Linux版本位数，后来查看了下，其实通过在shell里面运行命令也可以查看系统位数的，在根目录下运行命令：</p>
<pre><code>file /sbin/init</code></pre>
<p>出现</p>
<pre><code>ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.24</code></pre>
<p>说明是32位的。</p>
<p>还有其他的命令为我们省去每次都要登录阿里云账号才能看的繁琐事情，比如查看阿里云服务器里面磁盘情况，运行命令：</p>
<pre><code>df</code></pre>
<p>即可出现：</p>
<pre><code>Filesystem     1K-blocks    Used Available Use% Mounted on
/dev/xvda1      51604092 4014912  44967852   9% /
udev              505140       4    505136   1% /dev
tmpfs             102488     248    102240   1% /run
none                5120       0      5120   0% /run/lock
none              512440       0    512440   0% /run/shm</code></pre>
<p>这样是很省事的。</p>
<p>这里补充一下，经过以上方法的验证，我的Ubantu服务器出现了502错误，具体原因还有待解决，方案后面补上。</p>
<p><strong>针对阿里云服务在调试的时候数据库连接不上的问题纪实如下：</strong></p>
<p>在调试程序的时候，发现数据库访问相关的环节出现错误：</p>
<p>12:16:40,941  WARN ThreadPoolAsynchronousRunner:608 - com.mchange.v2.async.ThreadPoolAsynchronousRunner$DeadlockDetector@1278b126 – APPARENT DEADLOCK!!! Creating emergency threads for unassigned pending tasks!<br>12:16:40,947  WARN ThreadPoolAsynchronousRunner:624 - com.mchange.v2.async.ThreadPoolAsynchronousRunner$DeadlockDetector@1278b126 – APPARENT DEADLOCK!!! Complete Status:<br>检查配置项，一切正常。</p>
<p>分析：</p>
<p>1.进入命令行，telnet serverip 3306，是有响应的。</p>
<p>2.用MySQL客户端直接连接测试：mysql -hdbhost -uusername -p，报错：</p>
<p>ERROR 2013 (HY000): Lost connection to MySQL server at ‘reading initial communication packet’, system error: 0<br>3.这种情况还真没遇到过。搜索一下，很多答案，无非是在my.cnf中去掉bind-address或者添加skip-name-resolve 以加速客户端连接速度。</p>
<p>看了一下配置文件，第一个根本就没有，第二个加了也没用。</p>
<p>其实仔细分析一下，刚才还好好的，突然不行了。最大的可能不在于服务器本身，而是网络或者服务器之外的环境。</p>
<p>4.关闭防火墙：虽然可以telnet通，还是关闭一下试试吧。服务器和客户端的防火墙都关了，还是一样。</p>
<p>5.尝试换一个端口号呢？于是，在my.cnf中，[mysqld]端增加一句：port=3307</p>
<p>sudo service mysqld restart，再试，居然OK了。</p>
<p><strong>结论：</strong></p>
<p>因为这台服务器只有本人在使用，所以，很大可能性，是阿里云服务器环境上有什么外围的设置导致了这个问题。</p>
<p>以上分析过程，希望可以给出现类似问题的同仁带来启发，迅速解决问题。</p>
<p>以下这是网友碰到的问题：</p>
<pre><code>http://iottech.com.cn/
首先密码什么的肯定不会错,因为大部分时候是正常的.
但是每隔2-3天,就会出现数据库连接错误.
登上去检查,发现mysql服务停止了,开启服务后恢复正常.

目前不知道是什么原因会时不时导致mysql服务挂掉.
貌似有几位同学跟我有一样的问题:
http://bbs.aliyun.com/simple/?t6251.html
http://bbs.aliyun.com/simple/?t123803.html

那个什么
define(&#39;WP_ALLOW_REPAIR&#39;, true);
也加了,无济于事.</code></pre>
<p>貌似跟我的差不多啊，果断把下面的全看了。</p>
<p>我们看下回复：</p>
<pre><code>humiaozuzu   2013-08-06 12:27:20 +08:00
主机的配置多少 
贴一下mysql的error log

master   2013-08-06 12:33:10 +08:00
WP信息展示的话，建议装下WP Super Cache，这样推广访问的人多的话，也能应付。 
至于MySQL挂掉的问题，还是贴一下日志吧。

iZr   2013-08-06 12:44:15 +08:00
Page Caching using disk: enhanced 
Database Caching using disk 
Object Caching 899/1101 objects using disk 
楼主你要逆天么?全用 disk 做缓存,阿里云的 disk 那是慢得一塌糊涂啊...... 

建议用 W3 Total Cache 的memcached

cxh116   2013-08-06 12:46:15 +08:00
如果是512m内存的linux机器,看看你们的/var/log/kern.log 日志,查找是不是因为内存不够而导致mysql进程被kill. 
如果是,加机器内存,或加swap file 

日志示例 
Aug 5 16:55:38 judgementmace kernel: [104957.959991] Out of memory: Kill process 14134 (bundle) score 302 or sacrifice child 
Aug 5 16:55:38 judgementmace kernel: [104957.960071] Killed process 14134 (bundle) total-vm:223712kB, anon-rss:151136kB, file-rss:312kB

iZr   2013-08-06 12:47:07 +08:00
另外:图片,js,css,html 使用七牛做 cdn 加速(国内的 cdn最好不要用,比如哪个是什么云,你懂的). 
wordpress 插件在 我爱水煮鱼:http://blog.wpjam.com/project/wpjam-qiniutek/

guoqiao   2013-08-06 14:31:45 +08:00
@humiaozuzu 
内存大小：512MB 
系统名称：Ubuntu 12.04 64位 

/var/log/mysql.err以及mysql.log 内容都为空 

不过在kern.log里倒是发现了一点问题: 

cat /var/log/kern.log | grep mysql: 

Aug 5 11:59:46 AY1210311012137b74305 kernel: [6624574.875628] Out of memory: Kill process 9321 (mysqld) score 107 or sacrifice child 
Aug 5 11:59:46 AY1210311012137b74305 kernel: [6624574.877330] Killed process 9321 (mysqld) total-vm:887172kB, anon-rss:53508kB, file-rss:0kB 
Aug 5 11:59:46 AY1210311012137b74305 kernel: [6624575.008973] init: mysql main process (9321) killed by KILL signal 
Aug 5 11:59:46 AY1210311012137b74305 kernel: [6624575.009003] init: mysql main process ended, respawning 
Aug 5 11:59:46 AY1210311012137b74305 kernel: [6624575.731638] type=1400 audit(1375675186.838:67): apparmor=&quot;STATUS&quot; operation=&quot;profile_replace&quot; name=&quot;/usr/sbin/mysqld&quot; pid=10834 comm=&quot;apparmor_parser&quot; 
Aug 5 11:59:47 AY1210311012137b74305 kernel: [6624576.468831] init: mysql main process (10838) terminated with status 1 
Aug 5 11:59:47 AY1210311012137b74305 kernel: [6624576.468857] init: mysql main process ended, respawning 
Aug 5 11:59:48 AY1210311012137b74305 kernel: [6624577.229334] init: mysql post-start process (10839) terminated with status 1 
Aug 5 11:59:48 AY1210311012137b74305 kernel: [6624577.282343] type=1400 audit(1375675188.390:68): apparmor=&quot;STATUS&quot; operation=&quot;profile_replace&quot; name=&quot;/usr/sbin/mysqld&quot; pid=10862 comm=&quot;apparmor_parser&quot; 
Aug 5 11:59:48 AY1210311012137b74305 kernel: [6624577.358414] init: mysql main process (10866) terminated with status 1 
Aug 5 11:59:48 AY1210311012137b74305 kernel: [6624577.358453] init: mysql respawning too fast, stopped
Aug 6 11:23:15 AY1210311012137b74305 kernel: [6708784.129980] type=1400 audit(1375759395.241:69): apparmor=&quot;STATUS&quot; operation=&quot;profile_replace&quot; name=&quot;/usr/sbin/mysqld&quot; pid=19445 comm=&quot;apparmor_parser&quot; 


&quot;Out of memory: Kill process 9321 (mysqld) score 107 or sacrifice child&quot; 
貌似真的是因为内存不足? 必须升级内存?

phuslu   2013-08-06 14:36:34 +08:00
http://rds.aliyun.com

Starry   2013-08-06 14:36:50 +08:00
wodpress加个缓存插件！

guoqiao   2013-08-06 14:38:43 +08:00
@iZr 我是用了W3 Total Cache 这个插件, 不过缓存方式只有disk basic 和 disc enhenced可选,其它选项包括你说的memcached都是灰色禁用的. 这个是要付费还是要设置什么的?           

cxh116   2013-08-06 14:48:05 +08:00
@guoqiao 参考这个,添加swap file,搞个1G 

https://wiki.archlinux.org/index.php/Swap

skyworker   2013-08-06 14:52:57 +08:00 via Android
@iZr 迷茫了，七牛不是国内的cdn吗？

skyworker   2013-08-06 14:55:06 +08:00 via Android
最简单的方案就是关闭mysql的innodb引擎，太费内存了，并且对wp这样的应用没什么实际帮助

shiny   2013-08-06 14:57:45 +08:00
wordpress 记得默认已经用 innodb 了吧…… 用监控宝监控内存波动，如果内存满了,swap也用了很多就必须加内存，要么用静态化插件。

guoqiao   2013-08-06 15:00:41 +08:00
@iZr 已安装并启用,多谢

guoqiao   2013-08-06 15:22:52 +08:00
@cxh116 多谢,加了个512M的swapfile. 
主机内存才512M, swapfile大于这个数貌似也意义不大吧?

master   2013-08-07 02:32:52 +08:00
@Mihuwa 
没用过 W3 Total Cache 呢，是说用 W3 Total Cache 插件的时候，客户还会因为数据库问题还是只能看到错误页而访问不了？ 

看网站页面其实并不多，数据库里面的内容也不可能多的感觉，所以感觉数据库应该不会很占用资源 
而且展示性内容的网站用 MyISAM 也足矣，关掉InnoDB 用 MyISAM 也够了。 
我 512M 内存跑一千多篇日志的WP，还跑着Discuz 也都没发现说系统资源不够的问题，虽然磁盘I/O是对于数据库是有些堪忧。 
如果mysql没问题，但是系统资源不够用的话，是不是应该检查一下系统环境部署的问题，关注一下系统进程和内容使用情况吧，是不是装了很多没用的东西占用的资源，要是内存紧张还用memcache，我不知道是不是给内存资源火上浇油

cst4you   2013-08-07 08:29:50 +08:00 via Android
我这边有之前1.3g内存的vps跑到百万pv的例子。 
主要还是根据我爱水煮鱼那个方法，用memcache做obj cache，用batcache插件缓存未游客访问的页面。 
晚上一般同时在线2500的时候负载不过2的。 
W3 total cache这个插件钩子太多了，用不好适得其反。   

xinghegu   2014-05-15 18:30:01 +08:00
我的也是这样，楼主怎么解决的，帮我


guoqiao   2014-05-20 19:13:17 +08:00
@xinghegu 已经太久,不记得了.貌似是之前缓存插件设置不正确.


leisudeng   2014-10-30 23:54:07 +08:00
可以考虑用这个lowendscript的lnmp的一键包了，自用数台vps都装的它，运行稳定，内存占用相当低 
http://leisudeng.com/debian-tutorials/debian-tutorials-171-1.html


leisudeng   2014-10-30 23:56:23 +08:00
128m内存的OVZ vps运行wordpress都非常流畅</code></pre>
<p>跟着脚步走，我们查看了下系统的配置，看看到底是不是内存消耗完了的问题，具体命令如下：</p>
<pre><code>cat /proc/cpuinfo 查看cpu

free -m 查看内存

fdisk -l 查看硬盘分区

df -h 查看挂载目录

ifconfig 查看网卡信息

ethtool eth0 查看详西的网卡工作模式

lspic 列出所有芯片信息</code></pre>
<p>一看果然是内存消耗完了的问题：</p>
<pre><code>root@iZ94q0nbcj0Z:/# free -m
             total       used       free     shared    buffers     cached
Mem:          1000        922         77          0         16        102
-/+ buffers/cache:        803        197
Swap:            0          0          0</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2017/01/12/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E9%83%A8%E7%BD%B2wordpress%E5%A4%9A%E7%AB%99%E7%82%B9%E5%92%8C%E5%9F%9F%E5%90%8D%E6%98%A0%E5%B0%84%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/01/12/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E9%83%A8%E7%BD%B2wordpress%E5%A4%9A%E7%AB%99%E7%82%B9%E5%92%8C%E5%9F%9F%E5%90%8D%E6%98%A0%E5%B0%84%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="post-title-link" itemprop="url">云服务器上部署wordpress多站点和域名映射的一些问题与解决方案</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-01-12 23:57:15" itemprop="dateCreated datePublished" datetime="2017-01-12T23:57:15+08:00">2017-01-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:52:50" itemprop="dateModified" datetime="2020-10-11T11:52:50+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在Wordpress3.0及以上版本可以直接使用多站点，它可以：</p>
<p>1、只安装一个Wordpress程序即可创建多个wordpress站点，可以是子域名也可以是子目录。</p>
<p>2、可以有独立的博客后台，独立的博客地址。</p>
<p>3、管理员可设置开放哪些主题给站点使用。</p>
<p>4、管理员可配置插件给每个站点使用。</p>
<p>5、多个站点之间共用“用户数据库表”，也就是表 wp_usermeta 和 wp_users，其他的为独立数据库表。</p>
<p><strong>WordPress多站点的配置方法：</strong></p>
<p>1、首先，备份网站的数据库，以防出现意外时恢复（一般可忽略）。</p>
<p>2、打开WordPress的根目录下的wp-config.php文件，在</p>
<pre><code>require_once(ABSPATH . &#39;wp-settings.php&#39;);</code></pre>
<p>前面加上以下代码：</p>
<pre><code>define(&#39;WP_ALLOW_MULTISITE&#39;,true);</code></pre>
<p>3、进入WordPress后台，”工具”-&gt; 点击”配置网络”</p>
<p>ps：如果您要使用二级域名的形式，可以到“设置”-&gt;“常规”里面，把站点地址（URL）的www.去掉。</p>
<p><img src="http://ww2.sinaimg.cn/large/62579065gw1ewcnpha4sfj20jy0ebdi7.jpg"></p>
<p>4、点击安装后，按照提示做好相关的配置</p>
<p>5、配置好，再次进入后台，在头部将出现“我的站点”-&gt;“管理网络”的选项菜单，接下来您可以管理或者创建站点，也可以开启主题或者插件给其他站点使用。</p>
<p><img src="http://ww3.sinaimg.cn/large/62579065gw1ewcnphrgqjj20n80bcabi.jpg"></p>
<p>6、如果要给站点绑定其他域名，可以安装 WordPress MU Domain Mapping 插件。</p>
<p>WordPress MU Domain Mapping插件绑定其他域名的方法：</p>
<p>1、打开WordPress的根目录下的wp-config.php文件，在</p>
<pre><code>require_once(ABSPATH . &#39;wp-settings.php&#39;);</code></pre>
<p>前面加上以下代码：</p>
<pre><code>define(&#39;SUNRISE&#39;, &#39;on&#39;);</code></pre>
<p>2、将WordPress MU Domain Mapping插件里面 sunrise.php 文件移到 /wp-content目录中</p>
<p>3、获取站点ID。</p>
<p>点击导航的【站点】-【所有站点】，找到您要绑定域名的站点，鼠标放上去，点【编辑】，会在浏览器地址栏中看到类似于</p>
<pre><code>site-info.php?id=2</code></pre>
<p>其中数字2 就是我们要的站点ID（Site ID）</p>
<p>4、点击导航的【设置】-【Domains】，在【New Domain】中填写信息，如图:</p>
<p><img src="http://ww3.sinaimg.cn/large/62579065gw1ewcnpi5deuj20ht09fgm5.jpg"></p>
<p>如果勾选 Primary 表示该域名为主要域名，切记：同一个站点只能其中一个域名勾选，其他的附属域名不要勾选。</p>
<p>大部分的情况下根据这个流程走是没啥问题的，可以是笔者这里遇到这样一个问题，就是当我把多站点的配置都弄好了之后，发现当我新建一个子站点的时候，访问子站点的时候出现404页面。这让我纳闷很久。最终的解决方案是这样的，这里我得说明一点，我用来的是云服务器，web环境也是一键配置的，而不是云虚拟主机，我在云虚拟主机上没有遇到这个问题，这里是需要强调的地方。好吧，我们进入重点。</p>
<p>这是因为没有配置伪静态的原因。具体方法如下：</p>
<p>apache 规则：配置网络页面里提供的伪静态代码默认是 apache，直接用它替换掉你的网站根目录下的 .htaccess 文件里的代码。 如下：</p>
<pre><code>RewriteEngine On
RewriteBase /
RewriteRule ^index.php$ – [L]
# add a trailing slash to /wp-admin
RewriteRule ^([_0-9a-zA-Z-]+/)?wp-admin$ $1wp-admin/ [R=301,L]
RewriteCond %&#123;REQUEST_FILENAME&#125; -f [OR]
RewriteCond %&#123;REQUEST_FILENAME&#125; -d
RewriteRule ^ – [L]
RewriteRule ^([_0-9a-zA-Z-]+/)?(wp-(content|admin|includes).*) $2 [L]
RewriteRule ^([_0-9a-zA-Z-]+/)?(.*.php)$ $2 [L]
RewriteRule . index.php [L]</code></pre>
<p>ginx规则：假设你的网站域名是 xxx.com ，那么nginx规则文件就是：/alidata/server/nginx-1.2.5/conf/vhosts/xxx.com.conf （当然，这个 xxx.com.conf文件名是你自己取的，要对应相关网站目录），在这个文件的最后一个大括号 } 前面添加以下代码：</p>
<pre><code>#ignored: “-” thing used or unknown variable in regex/rew
rewrite ^/([_0-9a-zA-Z-]+/)?wp-admin$ /$1wp-admin/ permanent;
if (-f $request_filename)&#123;
 set $rule_2 1;
&#125;
if (-d $request_filename)&#123;
 set $rule_2 1;
&#125;
if ($rule_2 = &quot;1&quot;)&#123;
#ignored: “-” thing used or unknown variable in regex/rew
&#125;
rewrite ^/([_0-9a-zA-Z-]+/)?(wp-(content|admin|includes).*) /$2 last;
rewrite ^/([_0-9a-zA-Z-]+/)?(.*.php)$ /$2 last;
rewrite /. /index.php last;</code></pre>
<p>保存文件 ，然后重启服务器。这样一来，这个主站的wordpress多站点功能就搭建成功了。</p>
<p>然后，你就可以在你的网站后台顶部看到一个 我的站点——&gt;管理网络菜单 ，这个菜单下有4个小菜单，点击其中的 “站点”，就可以在这个站点页面里创建你的新站点了。</p>
<p>如果你的站点是在虚拟空间的话，建多站点，会比阿里云更加方便好建。</p>
<p> 注意：如果是 子目录 模式，主站点的文章都自动在链接中添加了 /blog/，如果你直接在这个子目录站点的 设置 &gt; 固定链接 设置结构，是无法去除 /blog/ 的，而且在 lnmp 环境下，直接修改会自动添加 index.php。</p>
<p>解决办法是，访问 所有站点，点击主站点的编辑：</p>
<p><img src="http://filesimg.111cn.net/2014/12/05/20141205224249297.jpg"></p>
<p>切换到“设置”标签，找到 固定链接 ，在这里直接填写 固定链接结构（比如 /%postname%.html），保存即可。这样就可以去除 /bolg/ ，同时不会添加 index.php。</p>
<p>更多消息欢迎添加我QQ（791447771），大家共同学习。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2016/12/19/%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%80%E9%94%AEweb%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85%E5%8C%85%E5%AE%8C%E6%AF%95%E5%90%8E%E7%9A%84%E9%82%A3%E4%BA%9B%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/19/%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%80%E9%94%AEweb%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85%E5%8C%85%E5%AE%8C%E6%AF%95%E5%90%8E%E7%9A%84%E9%82%A3%E4%BA%9B%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">阿里云服务器一键web环境安装包完毕后的那些问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-19 22:10:36" itemprop="dateCreated datePublished" datetime="2016-12-19T22:10:36+08:00">2016-12-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:06" itemprop="dateModified" datetime="2020-10-11T11:53:06+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>至于如何一键web环境配置的教程网上已经很多了这里就不再多说，这里我只粘贴下教程的地址：</p>
<pre><code>http://jingyan.baidu.com/article/2f9b480d94928541cb6cc29d.html</code></pre>
<p>一键环境安装包可以在这里下载：</p>
<pre><code>http://pan.baidu.com/s/1i5dUMuL    密码：2xe0</code></pre>
<p>这里提醒下：</p>
<blockquote>
<p>一键安装web环境的时候，不要照搬教程追求一模一样，教程中有个home文件是教程作者的根目录，我们需要根据我们自身的服务器情况找到自己的根目录，然后把sh-1.5.5这个文件夹放在这个目录下面即可。然后根据教程一步一步的走即可完成安装，在配置环境的时候，最好保持服务器干净，个人习惯是在一键web环境安装之前，把服务器初始化一下，再开始比较好。这个看个人习惯哈</p>
</blockquote>
<p>直接在shell里运行命令：</p>
<pre><code>cd /
pwd</code></pre>
<p>就可以看到自己根目录在哪里了。</p>
<p>问题在于安装完后，我们该如何把自己做好的网站放上去呢？</p>
<p>打个比方，我的网站域名是：111.com</p>
<p>解析完后，访问这个域名的时候，111.com/phpwind,这样就进入到了安装界面，这是新用户必须经历的一步，完成后，可以进入到数据库管理界面，跟我们本地服务器一样的，地址是：111.com/phpmyadmin.</p>
<p>这样当我们没有放我们的网站程序的时候，输入111.com就默认进入到了论坛页面。截图如下：</p>
<p><img src="http://i.imgur.com/8V4BEOJ.jpg"></p>
<p>好吧，根据教程来看，貌似www就是存放我们网站程序的根目录</p>
<p><img src="http://i.imgur.com/vK78OMY.jpg"></p>
<p>不过是不是这个并不是绝对的，这个要看你的网站配置文件的根目录指定地址，因为我当初配置的服务器是nginx，所以我们需要在alidata目录下的server下的conf配置文件vhosts的phpwind.conf。</p>
<p><img src="http://i.imgur.com/HNFRiw9.jpg"></p>
<p>打开这个配置文件，代码如下：</p>
<pre><code>server &#123;
        listen       80;
        server_name  localhost;
    index index.html index.htm index.php;
    root /alidata/www/phpwind;
    location ~ .*\.(php|php5)?$
    &#123;
        #fastcgi_pass  unix:/tmp/php-cgi.sock;
        fastcgi_pass  127.0.0.1:9000;
        fastcgi_index index.php;
        include fastcgi.conf;
    &#125;
    location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$
    &#123;
        expires 30d;
    &#125;
    location ~ .*\.(js|css)?$
    &#123;
        expires 1h;
    &#125;
    #Î±¾²Ì¬¹æÔò
    include /alidata/server/nginx/conf/rewrite/phpwind.conf;
    access_log  /alidata/log/nginx/access/phpwind.log;
&#125;</code></pre>
<p>这里的网站根目录路径：</p>
<pre><code>/alidata/www/phpwind</code></pre>
<p>所以上传的文件代码应该放在phpwind文件夹下。这样我们就可以完成网站的上传了和搭建了。</p>
<p>安装完wordpress后，每次在wordpress后台更新网站的时候，总是提示说要输入FTP账号密码，弄得很不方便，后来在网上查找了一下方法，具体是这样的：</p>
<p>找到wordpress的配置文件：wp-config.php,加上如下代码：</p>
<pre><code>define(&#39;FS_METHOD&#39;, &#39;direct&#39;);
define(&#39;FS_CHMOD_DIR&#39;, 0777);
define(&#39;FS_CHMOD_FILE&#39;, 0777);</code></pre>
<p>上传覆盖原有的wp-config.php，刷新一下，然后安装插件或者是更新wordpress的程序，这个时候可能会出现这样一个问题</p>
<pre><code>无法创建目录</code></pre>
<p>其实出现这个的问题就是Apache/Nginx的执行身份非文件属主身份。这个时候是权限问题了，解决方案如下：</p>
<p>假设你的wordpress安装目录为/alidata/www/phpwind/wordpress</p>
<p>那么，在根目录运行如下命令：</p>
<pre><code>sudo chmod -R 777 /alidata/www/phpwind/wordpress</code></pre>
<p>截图如下：</p>
<p><img src="http://i.imgur.com/tjhlqnr.jpg"></p>
<p>这样刷新wordpress后台，再次更新或者安装插件，就可以成功了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2016/12/17/%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8centos7%E9%80%90%E4%B8%AA%E5%AE%89%E8%A3%85%E7%8E%AF%E5%A2%83%E7%9A%84%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/17/%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8centos7%E9%80%90%E4%B8%AA%E5%AE%89%E8%A3%85%E7%8E%AF%E5%A2%83%E7%9A%84%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4/" class="post-title-link" itemprop="url">阿里云服务器centos7逐个安装环境的详细步骤</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-17 08:53:32" itemprop="dateCreated datePublished" datetime="2016-12-17T08:53:32+08:00">2016-12-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:06" itemprop="dateModified" datetime="2020-10-11T11:53:06+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>首先得去阿里云注册一个账号，你的芝麻信用分得达标，然后购买一个9.9元的oss的东西服务，然后就可以满足要求了，这些细节在这里就省略了。</p>
<p>为了让我们彻底的放心折腾这个服务器，我还是先说下如何初始化服务器，免得弄得乱七八糟的时候可以恢复到最原始状态，</p>
<p>首先我们进入到阿里云后台，看截图：</p>
<p><img src="http://i.imgur.com/PRa4qe3.jpg"></p>
<p>找到实例，停止实例，点击“停止服务”—找到“磁盘”—初始化所有磁盘，包括系统盘。</p>
<p>必须先停止服务后才能点击截图中的红框内容</p>
<p><img src="http://i.imgur.com/g9eJcVA.jpg"></p>
<p>初始化完毕之后，重启就行了。</p>
<p>这样就是完成服务器的初始化。</p>
<p>这里作为一个小插曲。</p>
<p>然后就是选择一些操作系统，由于开始不是很清楚linux的各个版本，所以就选择了centos，其实选择debian会更容易操作，好吧，我们继续。</p>
<p>先下载好Xshell和Xftp这两个软件，简单的安装后，我们新建一个连接，输入账号和密码即可。</p>
<p>先以root身份登录服务器XShell</p>
<p>开始安装mysql数据库,运行命令</p>
<pre><code>yum install mysql</code></pre>
<p>提示错误，主要是说需要依赖mariadb，所以就又来了一遍，运行以下命令：</p>
<pre><code>yum install mariadb *</code></pre>
<p>安装后还是不成功，说是缺少repo源，经过搜索发现，CentOS7的yum源中默认好像是没有mysql的。为了解决这个问题，我们要先下载mysql的repo源。</p>
<p>因此，貌似这个方法不管用，所以我们接下来真正的进入到安装的正式步骤。</p>
<hr>
<p>我们进入到数据库安装阶段</p>
<p><strong>## centos7下使用yum安装mysql ##</strong></p>
<p><strong>1. 下载mysql的repo源</strong></p>
<pre><code>$ wget http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm</code></pre>
<p><strong>2. 安装mysql-community-release-el7-5.noarch.rpm包</strong></p>
<pre><code>$ sudo rpm -ivh mysql-community-release-el7-5.noarch.rpm</code></pre>
<p>安装这个包后，会获得两个mysql的yum repo源：/etc/yum.repos.d/mysql-community.repo，/etc/yum.repos.d/mysql-community-source.repo。</p>
<p><strong>3. 安装mysql</strong></p>
<pre><code>$ sudo yum install mysql-server</code></pre>
<p>根据步骤安装就可以了，不过安装完成后，没有密码，需要重置密码。</p>
<p><strong>4. 重置密码</strong></p>
<p>重置密码前，首先要登录</p>
<pre><code>$ mysql -uroot -p</code></pre>
<p>登录时有可能报这样的错：ERROR 2002 (HY000): Can‘t connect to local MySQL server through socket ‘/var/lib/mysql/mysql.sock‘ (2)，原因是/var/lib/mysql的访问权限问题。下面的命令把/var/lib/mysql的拥有者改为当前用户：</p>
<pre><code>$ sudo chown -R openscanner:openscanner /var/lib/mysql</code></pre>
<p>这句话中的openscanner可以是mysql,这里我没用过这句命令，这里我可以粘贴一下别人是怎么用的这句命令：</p>
<p>然后，重启服务：</p>
<pre><code>$ service mysqld restart</code></pre>
<p>接下来登录重置密码：</p>
<pre><code>$ mysql -u root
mysql &gt; use mysql;
mysql &gt; update user set password=password(‘123456‘) where user=‘root‘;
mysql &gt; exit;</code></pre>
<p><strong>5. 开放3306端口</strong></p>
<pre><code>$ sudo vim /etc/sysconfig/iptables</code></pre>
<p>添加以下内容：</p>
<pre><code>-A INPUT -p tcp -m state --state NEW -m tcp --dport 3306 -j ACCEPT</code></pre>
<p>保存后重启防火墙：</p>
<pre><code>$ sudo service iptables restart</code></pre>
<p>这样从其它客户机也可以连接上mysql服务了。</p>
<p>安装完数据库就要测试一下</p>
<p>我们可以通过以下命令管理mysql:</p>
<pre><code>service mysqld start          //数据库开启
service mysqld stop          //数据库停止
service mysqld restart      //数据库重启</code></pre>
<p>最开始mysql的密码是为空的，所以先设置密码：</p>
<p>第一步：用帐号登录mysql，运行命令：</p>
<pre><code>mysql -u root</code></pre>
<p>第二步：改变用户数据库，进入数据库，运行命令：</p>
<pre><code>mysql&gt; use mysql</code></pre>
<p>第三步：修改密码，记得密码要用password()函数进行加密，一定不要忘记！</p>
<pre><code>mysql&gt; update user set password=password(&#39;qwe123&#39;)</code></pre>
<p>第四步：刷新权限表</p>
<pre><code>mysql&gt; flush previleges;</code></pre>
<p>第五步：退出mysql</p>
<pre><code>mysql&gt; exit</code></pre>
<p>第六步：对mysql进行重启</p>
<pre><code>service mysqld restart;</code></pre>
<p>连接数据库，看看是否修改好，运行命令：</p>
<pre><code>mysql -uroot -p</code></pre>
<p>这里我也遇到了不少问题，就是没法启动mysql的问题，解决方法如下：</p>
<p>首先讲下MariaDB，MariaDB数据库管理系统是MySQL的一个分支，主要由开源社区在维护，采用GPL授权许可。开发这个分支的原因之一是：甲骨文公司收购了MySQL后，有将MySQL闭源的潜在风险，因此社区采用分支的方式来避开这个风险。[3]</p>
<p>MariaDB的目的是完全兼容MySQL，包括API和命令行，使之能轻松成为MySQL的代替品。在存储引擎方面，10.0.9版起使用XtraDB（名称代号为Aria）来代替MySQL的InnoDB</p>
<pre><code># yum install mysql -y
# mysql
ERROR 2002 (HY000): Can&#39;t connect to local MySQL server through socket &#39;/var/lib/mysql/mysql.sock&#39; (22)</code></pre>
<p>试着去启动mysql服务，还是不行，代码如下：</p>
<pre><code># systemctl start mysql
Failed to issue method call: Unit mysql.service failed to load: No such file or directory.

# systemctl start  mysql.service
Failed to issue method call: Unit mysql.service failed to load: No such file or directory

# systemctl enable mysql.service
Failed to issue method call: Access denied</code></pre>
<p>正确方法如下：</p>
<pre><code># yum install mariadb-server -y
# systemctl start mariadb.service
# systemctl enable mariadb.service
# mysql
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 10
Server version: 5.5.44-MariaDB MariaDB Server

Copyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.

Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.

MariaDB [(none)]&gt; </code></pre>
<blockquote>
<p>高人指点</p>
<p>阿里云给你一个服务，就像给你一台电脑，里面有两个磁盘分区，一个装系统，另外一个需要挂载到系统里存数据用。</p>
<p>你装完系统的时候，数据盘是没挂载进来的</p>
<p>如果你一直不挂载数据盘的话，那你所有的改动都只影响系统盘</p>
</blockquote>
<hr>
<p><strong>## centos7下使用yum安装nginx ##</strong></p>
<p><strong>CentOS7安装Nginx三部曲</strong></p>
<p>Nginx就不多介绍了，下面是三部曲具体的操作。</p>
<p><strong>1.安装EPTL源</strong></p>
<pre><code>sudo yum install epel-release</code></pre>
<p><strong>2.安装NGINX</strong></p>
<pre><code>sudo yum install nginx</code></pre>
<p><strong>3.配置NGINX</strong></p>
<p>系统自动启动：</p>
<pre><code>sudo systemctl enable nginx.service</code></pre>
<p>立刻启动服务</p>
<pre><code>sudo systemctl start nginx.service </code></pre>
<p>防火墙配置</p>
<pre><code>sudo firewall-cmd --permanent --zone=public --add-service=http 
sudo firewall-cmd --permanent --zone=public --add-service=https
sudo firewall-cmd --reload</code></pre>
<p>Firewall启动和关闭</p>
<pre><code>systemctl start firewalld
systemctl stop firewalld</code></pre>
<p>好了，大功完成</p>
<p>我们也可以在安装完nginx后，我们可以直接输入命令：nginx<br>没动静就是好消息。</p>
<p>这里我们可以通过以下命令管理nginx:</p>
<pre><code>service nginx start
service nginx stop
service nginx restart
service nginx reload

/etc/init.d/nginx start
/etc/init.d/nginx stop
/etc/init.d/nginx restart
/etc/init.d/nginx reload</code></pre>
<p>这里也会遇到一些问题，有点时候输入命令</p>
<pre><code>netstat -a -n</code></pre>
<p>发现nginx的监听端口9000没有被监听,我们可以通过命令：</p>
<pre><code>systemctl start php-fpm.service</code></pre>
<p>来启动这个nginx，有的时候可能不成功，多试几次就好了。</p>
<hr>
<p><strong>## centos7下使用yum安装php和php-fpm ##</strong></p>
<p><strong>安装php5和php5-fpm</strong></p>
<p>先查看php版本，顺便也好知道系统中是否已经安装了php,运行命令：</p>
<pre><code>rpm -qa | grep php</code></pre>
<p>2.安装SCL</p>
<pre><code>yum install centos-release-scl</code></pre>
<p>3.安装php5</p>
<pre><code>yum install php55 php55-php php55-php-gd php55-php-mbstring</code></pre>
<p>安装完毕之后，测试一下php,运行命令：</p>
<pre><code>rpm -qa | grep php</code></pre>
<p><img src="http://i.imgur.com/Nd7TOtE.png"></p>
<p>这样就算是成功安装php了。</p>
<p>我们继续安装php-fpm，运行命令：</p>
<pre><code>yum install php php-fpm</code></pre>
<p>安装完毕之后，我们需要接着往下走</p>
<p>运行命令：</p>
<pre><code>netstat -a -n</code></pre>
<p>查看端口号是否都被监听。</p>
<p><img src="http://i.imgur.com/QHdHF8P.png"></p>
<p>我们知道mysql —&gt;3306，nginx —&gt;80，php-fpm —&gt;9000，所以fpm没有被监听，所以我们需要在启动它。于是我们找php-fpm的配置文件php-fpm.conf(我打开的php-fpm的配置文件是在etc下面,因为我没有发现php/fpm这个路径,不同操作系统可能在不同的路径下，这个关系不大)</p>
<p>添加语句：</p>
<pre><code>listen = 127.0.0.1:9000</code></pre>
<p><img src="http://i.imgur.com/PzrwRYI.png"></p>
<p>不知道怎么搞得，我加了之后运行命令</p>
<pre><code>netstat -a -n</code></pre>
<p>还是没有出现9000,最后我重启了一下nginx，重新启动了一下服务器，又好了。</p>
<p>这个时候我们需要重启一下php-fpm，可以使用以下命令管理php-fpm：</p>
<pre><code>service php-fpm start          //开启php-fpm服务
service php-fpm stop          //停止php-fpm服务
service php-fpm restart      //重启php-fpm服务
service php-fpm reload      //重载php-fpm服务

/etc/init.d/php-fpm start
/etc/init.d/php-fpm stop
/etc/init.d/php-fpm restart
/etc/init.d/php-fpm reload</code></pre>
<p>如果不出现这个情况就不管了，出现了就添加一下listen = 127.0.0.1:9000，稍后就会出现：</p>
<p><img src="http://i.imgur.com/Jcbgx61.png"></p>
<p>接下来设置一下nginx，路径在/etc/nginx/的nginx.conf，下载后编辑</p>
<p><img src="http://i.imgur.com/LuqvSQZ.png"></p>
<p>添加内容从# pass the PHP 开始</p>
<p>最后是：</p>
<pre><code># For more information on configuration, see:
#   * Official English Documentation: http://nginx.org/en/docs/
#   * Official Russian Documentation: http://nginx.org/ru/docs/

user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

# Load dynamic modules. See /usr/share/nginx/README.dynamic.
include /usr/share/nginx/modules/*.conf;

events &#123;
    worker_connections 1024;
&#125;

http &#123;
    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;
                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;
                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;

    access_log  /var/log/nginx/access.log  main;

    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 2048;

    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;

    # Load modular configuration files from the /etc/nginx/conf.d directory.
    # See http://nginx.org/en/docs/ngx_core_module.html#include
    # for more information.
    include /etc/nginx/conf.d/*.conf;

    server &#123;
        listen       80 default_server;
        listen       [::]:80 default_server;
        server_name  _;
        root         /usr/share/nginx/html;

        # Load configuration files for the default server block.
        include /etc/nginx/default.d/*.conf;

        location / &#123;
        &#125;

        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        location ~ \.php$ &#123;
        # include snippets/fastcgi-php.conf;
        #
        # # With php5-cgi alone;
          fastcgi_pass 127.0.0.1:9000;
        # fastcgi_index index.php
        # # With php5-fpm:
          fastcgi_param SCRIPT_FILENAME /usr/share/nginx/html/$fastcgi_script_name;
          include fastcgi_params;
        &#125;

        #deny access to .htaccess files, if Apache&#39;s document root
        #concurs with nginx&#39;s one
        #
        #location ~ /\.ht &#123;
        #deny all;
        #&#125;

        error_page 404 /404.html;
            location = /40x.html &#123;
        &#125;

        error_page 500 502 503 504 /50x.html;
            location = /50x.html &#123;
        &#125;
    &#125;

# Settings for a TLS enabled server.
#
#    server &#123;
#        listen       443 ssl http2 default_server;
#        listen       [::]:443 ssl http2 default_server;
#        server_name  _;
#        root         /usr/share/nginx/html;
#
#        ssl_certificate &quot;/etc/pki/nginx/server.crt&quot;;
#        ssl_certificate_key &quot;/etc/pki/nginx/private/server.key&quot;;
#        ssl_session_cache shared:SSL:1m;
#        ssl_session_timeout  10m;
#        ssl_ciphers HIGH:!aNULL:!MD5;
#        ssl_prefer_server_ciphers on;
#
#        # Load configuration files for the default server block.
#        include /etc/nginx/default.d/*.conf;
#
#        location / &#123;
#        &#125;
#
#        error_page 404 /404.html;
#            location = /40x.html &#123;
#        &#125;
#
#        error_page 500 502 503 504 /50x.html;
#            location = /50x.html &#123;
#        &#125;
#    &#125;

&#125;</code></pre>
<p>这就是nginx.conf里的全部内容，其中：</p>
<pre><code># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        location ~ \.php$ &#123;
        # include snippets/fastcgi-php.conf;
        #
        # # With php5-cgi alone;
          fastcgi_pass 127.0.0.1:9000;
        # fastcgi_index index.php
        # # With php5-fpm:
          fastcgi_param SCRIPT_FILENAME /usr/share/nginx/html/$fastcgi_script_name;
          include fastcgi_params;
        &#125;

        #deny access to .htaccess files, if Apache&#39;s document root
        #concurs with nginx&#39;s one
        #
        #location ~ /\.ht &#123;
        #deny all;
        #&#125;</code></pre>
<p>为新添加的内容。</p>
<p>配置好了nginx后，我们需要测试一下我的网站，输入：<a target="_blank" rel="noopener" href="http://ip/test.php%E7%9C%8B%E4%B8%8B%E6%98%AF%E5%90%A6%E8%83%BD%E6%AD%A3%E5%B8%B8%E8%AE%BF%E9%97%AE%EF%BC%88test.php%E6%98%AF%E6%96%B0%E6%B7%BB%E5%8A%A0%E7%9A%84%E6%B5%8B%E8%AF%95%E6%96%87%E4%BB%B6%EF%BC%89">http://IP/test.php看下是否能正常访问（test.php是新添加的测试文件）</a></p>
<p>输入地址后看到：</p>
<p><img src="http://i.imgur.com/W1Cp4Wm.png"></p>
<p>这个test.php的文件放在服务器根目录下（在/var/www/html下写一个test.php）。</p>
<p>貌似这样还是不行，于是早高人指点下原来我的网站根目录是： /usr/share/nginx/html</p>
<p>这样test.php就被放到了/usr/share/nginx/html下，这里我们还需要修改一个地方，继续回到nginx.conf里面，找到：</p>
<pre><code>fastcgi_param SCRIPT_FILENAME /var/www/html/$fastcgi_script_name;</code></pre>
<p>这个地方把/var/www/html改成我nginx的根目录,修改之后的样子是：</p>
<pre><code>fastcgi_param SCRIPT_FILENAME /usr/share/nginx/html/$fastcgi_script_name;</code></pre>
<p>重新启动一下nginx,运行命令：</p>
<pre><code>nginx -s reload</code></pre>
<p><img src="http://i.imgur.com/NDNw8EJ.png"></p>
<p><img src="http://i.imgur.com/G1kytth.png"></p>
<p>弄好了这里的时候再次输入：<a target="_blank" rel="noopener" href="http://ip/test.php,%E5%B0%B1%E6%88%90%E5%8A%9F%E4%BA%86">http://ip/test.php,就成功了</a></p>
<p>环境都做好了，把网站程序放在/usr/share/nginx/html下面即可，这个时候我突然想的是，如果我想放多个网站改如何呢？这里我们以111.com和222.com为例、先把这两个域名解析一下，都解析到这个服务器下，解析过程就不多说了，很简单。</p>
<p>这个时候分别输入：111.com和222.com的时候应该都是可以访问到：</p>
<p><img src="http://i.imgur.com/W1Cp4Wm.png"></p>
<p>说明解析成功了。</p>
<p>但是两个程序改怎么放呢？这里我们需要配置nginx。</p>
<p>把nginx主配置文件nginx.conf文件中 server{ … } 那一段拷出来。处理后111.conf如下：</p>
<pre><code>server &#123;
    listen 80;
    server_name www.111.com;
    root /usr/share/nginx/111.com;

    location / &#123;
    &#125;

    location ~ \.php$ &#123;
    fastcgi_pass 127.0.0.1:9000;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include fastcgi_params;
    &#125;

    error_page 404 /404.html;
        location = /40x.html &#123;
    &#125;

    error_page 500 502 503 504 /50x.html;
        location = /50x.html &#123;
    &#125;
&#125;</code></pre>
<p>222.conf内容如下：</p>
<pre><code>server &#123;
    listen 80;
    server_name www.222.com;
    root /usr/share/nginx/222.com;

    location / &#123;
    &#125;

    location ~ \.php$ &#123;
    fastcgi_pass 127.0.0.1:9000;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include fastcgi_params;
    &#125;

    error_page 404 /404.html;
        location = /40x.html &#123;
    &#125;

    error_page 500 502 503 504 /50x.html;
        location = /50x.html &#123;
    &#125;
&#125;</code></pre>
<p>这里为了管理，建两个目录 root/usr/share/nginx/域名1； root/usr/share/nginx/域名2，另外我们可在/etc/nginx/conf.d文件夹下新建这两个文件111.conf、222.conf。</p>
<p><img src="http://i.imgur.com/hNGIpmG.png"></p>
<p>在这个路径下存放111.conf和222.conf。</p>
<p>既然修改了，两个配置文件也要修改：</p>
<pre><code>fastcgi_param SCRIPT_FILENAME $document_root$</code></pre>
<p>最后修改的样子是：</p>
<p><img src="http://i.imgur.com/fJsWVvD.png"></p>
<pre><code>server &#123;
    listen 80;
    server_name www.111.com;
    root /usr/share/nginx/111.com;

    location / &#123;
    &#125;

    location ~ \.php$ &#123;
    fastcgi_pass 127.0.0.1:9000;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include fastcgi_params;
    &#125;

    error_page 404 /404.html;
        location = /40x.html &#123;
    &#125;

    error_page 500 502 503 504 /50x.html;
        location = /50x.html &#123;
    &#125;
&#125;</code></pre>
<p>配置完成之后，我们分别访问一下两个域名。在111.com和222.com文件夹下新建两个php文件，可以测试一下能否正常显示。前提是这两个域名需要备案。</p>
<p>最后就是分别把网站程序放在各自的文件夹下，</p>
<p><img src="http://i.imgur.com/X6715Wk.png"></p>
<p>进行安装就好了，这里我们以在国内知名度非常高的wordpress程序，先把wordpress程序上传到111.com(这里假设111.com已经备案了)，然后运行<a target="_blank" rel="noopener" href="http://111.com/wp-admin,%E5%B0%B1%E5%8F%AF%E4%BB%A5%E8%BF%9B%E8%A1%8C%E5%AE%89%E8%A3%85%E4%BA%86%E3%80%82">http://111.com/wp-admin,就可以进行安装了。</a></p>
<p>不过我这里安装的时候出现这样一个问题：就是说缺少wordpress的mysql扩展，这个问题是一个比较老的问题了，解决方案如下：</p>
<p>在php.ini文件中添加这下面这两端代码：</p>
<pre><code>extension=mysql.so
extension_dir =&quot;/usr/lib64/php/modules&quot;</code></pre>
<p><img src="http://i.imgur.com/bgTfXPG.jpg"></p>
<p>网络上的解决方案类似，这里贴出来分享下：</p>
<pre><code>（1）对于windows服务器，找开PHP安装位置，找到php.ini,打开

第一步：
确认开启以下扩展
extension=php_mysql.dll
extension=php_mysqli.dll

第二步：
; On windows:
; extension_dir = &quot;ext&quot; 扩展文件存放位置，确认以上丙个扩展文件已经存放在一个叫“ext&quot;的文件夹中，如没有，下载

第三步，服务重启，问题解决

(2)对于linux服务器，网络上解决方法如下
第一步：先用SSH登录，打开PHP.ini
#vi /etc/php.ini

第二步：php.ini中 添加
extension=mysql.so

第三步：在PHP.ini 中找到如下
extension_dir = &quot;XXXXXXX&quot;
注：XXX指扩展安装目录，centos64位的主机一般安装在extension_dir = &quot;/usr/lib64/php/modules&quot;
第四步：找到这个扩展安装目录，确认是否有mysql.so这个文件，如果没有，下载
重启服务。</code></pre>
<p>如果遇到权限不够的问题，这里需要对wordpress程序所在的文件设置一下权限，运行命令：</p>
<pre><code>chmod -R 755 /usr/share/nginx/111.com</code></pre>
<p>然后，安装php-mysql</p>
<pre><code>sudo yum php-mysql</code></pre>
<p>重启一下服务器，运行如下命令：</p>
<pre><code>reboot</code></pre>
<p>这样，基本没啥问题了。</p>
<p>欢迎同行一起交流，解决新的问题，分享经验共同学习。我的QQ：791447771</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/37/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/37/">37</a><span class="page-number current">38</span><a class="page-number" href="/page/39/">39</a><span class="space">&hellip;</span><a class="page-number" href="/page/43/">43</a><a class="extend next" rel="next" href="/page/39/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">424</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">400</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
