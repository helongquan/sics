<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"helongquan.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="日记">
<meta property="og:type" content="website">
<meta property="og:title" content="鸢尾花序">
<meta property="og:url" content="https://helongquan.github.io/page/5/index.html">
<meta property="og:site_name" content="鸢尾花序">
<meta property="og:description" content="日记">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="泉哥">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://helongquan.github.io/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>鸢尾花序</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">鸢尾花序</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2019/01/28/%E5%9C%A8magento2%E4%B8%AD%E5%88%9B%E5%BB%BA%E6%8E%A7%E5%88%B6%E5%99%A8controller%E7%9A%84%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/01/28/%E5%9C%A8magento2%E4%B8%AD%E5%88%9B%E5%BB%BA%E6%8E%A7%E5%88%B6%E5%99%A8controller%E7%9A%84%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">在magento2中创建控制器controller的方法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-01-28 22:08:39" itemprop="dateCreated datePublished" datetime="2019-01-28T22:08:39+08:00">2019-01-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:58:04" itemprop="dateModified" datetime="2020-10-11T11:58:04+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/magento2/" itemprop="url" rel="index"><span itemprop="name">magento2</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>控制器是模块开发系列和PHP MVC框架的重要组成部分。It功能就是接收到的请求、处理和呈现页面。</p>
<p>在Magento 2控制器中，模块的Controller文件夹中有一个或多个文件，其中包含包含execute()方法的类动作。有两种不同的控制器，它们是前端控制器和后端控制器。它们通常与工作流相似，但管理控制器略有不同。在管理控制器中有一个检查权限的方法，它调用表单键。</p>
<p>控制器controller是如何工作的?</p>
<p>它接收来自终端用户(浏览器或comamnd行)的请求，例如:</p>
<p><a target="_blank" rel="noopener" href="http://example.com/route_name/controller/action">http://example.com/route_name/controller/action</a></p>
<blockquote>
<p>oute_name是在routing .xml中设置的唯一名称。</p>
<p>controller是controller文件夹中的文件夹。</p>
<p>action是一个用execute方法处理请求的类。</p>
</blockquote>
<p>前端控制器是控制系统的重要组成部分之一</p>
<p>(Magento\Framework\App\FrontController), 它总是接收请求然后路由控制器，通过route_name动作让我们举一个路由请求的例子:</p>
<pre><code>foreach ($this-&gt;_routerList as $router) &#123;
try &#123;
$actionInstance = $router-&gt;match($request);
…
&#125;</code></pre>
<p>如果找到控制器类的操作，将运行execute()方法。</p>
<h2 id="如何创建控制器"><a href="#如何创建控制器" class="headerlink" title="如何创建控制器?"></a>如何创建控制器?</h2><p>要创建控制器，需要在模块的controller文件夹中创建一个文件夹，并在其中声明一个action类。例如，我们为模块 Pfay_Contacts 创建了一个索引控制器和一个索引操作:</p>
<p>步骤1: 首先创建模块的文件夹</p>
<p>从magento2目录的根目录转到/app/code文件夹。然后创建一个文件夹“Pfay”，然后在Pfay文件夹里面创建另一个文件夹“Contacts”。</p>
<p><strong>名称空间:</strong></p>
<p>您的模块位于Pfay名称空间中。您将在这个文件夹中“存储”将要创建的模块。</p>
<p>注意，永远不要修改magento2的“核心”文件，即文件夹/app/code/Magento，否则如果你想要更新平台，就会遇到大问题。</p>
<p>在magento2下声明它的模块</p>
<p>现在您已经创建了模块的文件夹，您必须向magento“声明”模块。为此，我们将创建 module.xml文件。在/app/code/Pfay/Contacts/etc文件夹中的module.xml文件如下:</p>
<pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;config xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:framework:Module/etc/module.xsd&quot;&gt;
    &lt;module name=&quot;Pfay_Contacts&quot; setup_version=&quot;2.0.0&quot;&gt;
        &lt;sequence&gt;
            &lt;module name=&quot;Magento_Cms&quot;/&gt;
        &lt;/sequence&gt;
    &lt;/module&gt;
&lt;/config&gt;</code></pre>
<p>步骤2: 我们也将创建文件“ registration file”。进入app/code/Pfay/Contacts，创建 registration.php是这样的:</p>
<pre><code>&lt;?php
\Magento\Framework\Component\ComponentRegistrar::register(
    \Magento\Framework\Component\ComponentRegistrar::MODULE,
    &#39;Pfay_Contacts&#39;,
    __DIR__
);</code></pre>
<p>当您启动以下命令时:</p>
<pre><code>php bin/magento setup:upgrade
php bin/magento setup:di:compile</code></pre>
<p>你会在命令执行过程中看到这个</p>
<pre><code>&#39;Pfay_Contacts&#39; =&gt; 1</code></pre>
<p>说明这个模块已经注册在magento中了。</p>
<p>步骤3：在文件夹app/code/Pfay/Contacts/Controller中，创建一个测试文件夹Test，并在下面创建索引 Index.php文件如下:</p>
<pre><code>&lt;?php
namespace Pfay\Contacts\Controller\Test;
class Index extends \Magento\Framework\App\Action\Action
&#123;
    public function execute()
    &#123;
        die(&#39;test index&#39;);
    &#125;
&#125;</code></pre>
<p>步骤4：创建访问控制器的路由，为了通过前端访问我们的模块，您必须为模块的前端创建路由。这里我们想通过url(<a target="_blank" rel="noopener" href="http://www.yourdomain.com/contacts/)%E8%AE%BF%E9%97%AE%E6%A8%A1%E5%9D%97%E3%80%82%E6%88%91%E4%BB%AC%E5%B0%86%E5%9C%A8etc%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%AD%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E2%80%9C">http://www.yourdomain.com/contacts/)访问模块。我们将在etc文件夹中创建一个“</a> frontend”文件夹，然后创建 routes.xml文件。 文件routes.xml代码如下: </p>
<pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;config xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:framework:App/etc/routes.xsd&quot;&gt;
    &lt;router id=&quot;standard&quot;&gt;
        &lt;route id=&quot;contacts&quot; frontName=&quot;contacts&quot;&gt;
            &lt;module name=&quot;Pfay_Contacts&quot; /&gt;
        &lt;/route&gt;
    &lt;/router&gt;
&lt;/config&gt;</code></pre>
<p>我们使用“ standard”路由器，允许访问我们的magento2模块的前端部分!我们添加带有id“contacts”的路由来识别它，以及frontName“contacts”，这是您访问前端模块的关键url。在此路径中，然后使用name属性定义模块元素，该属性包含“名称空间”+“模块名称”。</p>
<p><strong>注意：</strong>如果你创建后台路由则id应该是admin。</p>
<p>步骤5： 关于控制器的组织</p>
<p>当从模块的根声明时，我们有文件  /Controller/Test/Index，在本教程的后续步骤中，我们将告知控制器测试的Action Index。我们会通过url访问它</p>
<pre><code>http//www.magento2.lan/contacts/test/index  或者 http//www.magento2.lan/contacts/test 都可以访问</code></pre>
<p><strong>注意在访问之前：要做的以下几点工作</strong></p>
<pre><code>php bin/magento cache:clean
php bin/magento module:enable --clear-static-content Pfay_Contacts   开启模块
php bin/magento module:status
php bin/magento setup:upgrade
php bin/magento setup:di:compile
php bin/magento setup:static-content:deploy -f</code></pre>
<p>完成以上步骤才能正式访问，谨记！</p>
<p>本文只是创建一个模块的最简单的方法了，希望对大家创建一个更加复杂的模块提供一个参考。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2019/01/28/magento2%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/01/28/magento2%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/" class="post-title-link" itemprop="url">magento2命令行工具命令大全</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-01-28 19:54:25" itemprop="dateCreated datePublished" datetime="2019-01-28T19:54:25+08:00">2019-01-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:57:59" itemprop="dateModified" datetime="2020-10-11T11:57:59+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/magento2/" itemprop="url" rel="index"><span itemprop="name">magento2</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>php bin/magento</p>
<p>下面的文章包含一个命令列表(magento help )，其中包含所有可能的用例和参数。像Admin这样的命令组没有任何扩展信息，因为这是没有意义的，因为命令本身会显示一些信息，并且没有要传递的参数。</p>
<p>vagrant@mage2:/vagrant/data/magento2/bin $ php magento</p>
<p>先导航到magento2网站的根目录下，运行命令：</p>
<pre><code>php bin/magento 命令</code></pre>
<p>比如清除缓存的命令：</p>
<pre><code>php bin/magento cache:clean</code></pre>
<p>以下将会罗列出更多的命令。</p>
<p>Magento CLI版本1.0.0-beta</p>
<p><strong>Usage:</strong></p>
<pre><code>command [options] [arguments]</code></pre>
<p><strong>Options:</strong></p>
<pre><code>--quiet (-q)          Do not output any message

--verbose (-v|vv|vvv) Increase the verbosity of messages: 1 for normal output, 2 for more verbose output and 3 for debugging

--version (-V)        Display an application version

--ansi                Force ANSI output

--no-ansi             Disable ANSI output

--no-interaction (-n) Do not ask any interactive question</code></pre>
<p><strong>Available commands:</strong></p>
<pre><code>help                                      Displays help for a command

list                                      Lists commands</code></pre>
<p><strong>admin</strong></p>
<pre><code>admin:user:create                         Creates an administrator</code></pre>
<p><strong>cache</strong></p>
<pre><code>cache:clean                               Cleans cache type(s)

cache:disable                             Disables cache type(s)

cache:enable                              Enables cache type(s)

cache:flush                               Flushes cache storage used by cache type(s)

cache:status                              Checks cache status</code></pre>
<p><strong>catalog</strong></p>
<pre><code>catalog:images:resize                     Creates resized product images</code></pre>
<p><strong>cron</strong></p>
<pre><code>cron:run                                  Runs jobs by schedule</code></pre>
<p><strong>dev</strong></p>
<pre><code>dev:css:deploy                            Collects, processes and publishes source LESS files

dev:tests:run                             Runs tests

dev:xml:convert                           Converts XML file using XSL style sheets</code></pre>
<p><strong>i18n</strong></p>
<pre><code>i18n:collect-phrases                      Discovers phrases in the codebase

i18n:pack                                 Saves language package

i18n:uninstall                            Uninstalls language packages</code></pre>
<p><strong>indexer</strong></p>
<pre><code>indexer:info                              Shows allowed Indexers

indexer:reindex                           Reindexes Data

indexer:set-mode                          Sets index mode type

indexer:show-mode                         Shows Index Mode

indexer:status                            Shows status of Indexer</code></pre>
<p><strong>info</strong></p>
<pre><code>info:adminuri                             Displays the Magento Admin URI

info:backups:list                         Prints list of available backup files

info:currency:list                        Displays the list of available currencies

info:dependencies:show-framework          Shows number of dependencies on Magento framework

info:dependencies:show-Magento 2 modules            Shows number of dependencies between Magento 2 modules

info:dependencies:show-Magento 2 modules-circular   Shows number of circular dependencies between Magento 2 modules

info:language:list                        Displays the list of available language locales

info:timezone:list                        Displays the list of available timezones</code></pre>
<p><strong>maintenance</strong></p>
<pre><code>maintenance:allow-ips                     Sets maintenance mode exempt IPs

maintenance:disable                       Disables maintenance mode

maintenance:enable                        Enables maintenance mode

maintenance:status                        Displays maintenance mode status</code></pre>
<p><strong>module</strong></p>
<pre><code>module:disable                            Disables specified Magento 2 modules

module:enable                             Enables specified Magento 2 modules

module:status                             Displays status of Magento 2 modules

module:uninstall                          Uninstalls Magento 2 modules installed by composer</code></pre>
<p><strong>setup</strong></p>
<pre><code>setup:backup                              Takes backup of Magento Application code base, media and database

setup:config:set                          Creates or modifies the deployment configuration

setup:cron:run                            Runs cron job scheduled for setup application

setup:db-data:upgrade                     Installs and upgrades data in the DB

setup:db-schema:upgrade                   Installs and upgrades the DB schema

setup:db:status                           Checks if DB schema or data requires upgrade

setup:di:compile                          Generates DI configuration and all non-existing interceptors and factories

setup:di:compile-multi-tenant             Generates all non-existing proxies and factories, and pre-compile class definitions, inheritance information and plugin definitions

setup:install                             Installs the Magento application

setup:performance:generate-fixtures       Generates fixtures

setup:rollback                            Rolls back Magento Application codebase, media and database

setup:store-config:set                    Installs the store configuration

setup:uninstall                           Uninstalls the Magento application

setup:upgrade                             Upgrades the Magento application, DB data, and schema</code></pre>
<p><strong>theme</strong></p>
<pre><code>theme:uninstall                           Uninstalls theme</code></pre>
<p>管理 admin Magento 2 CLI命令</p>
<pre><code>admin:user:create</code></pre>
<p>创建Magento管理员用户帐户</p>
<pre><code>Usage:

admin:user:create [--admin-user=&quot;...&quot;] [--admin-password=&quot;...&quot;] [--admin-email=&quot;...&quot;] [--admin-firstname=&quot;...&quot;] [--admin-lastname=&quot;...&quot;] [--magento-init-params=&quot;...&quot;]

Options:

--admin-user           (Required) Admin user

--admin-password       (Required) Admin password

--admin-email          (Required) Admin email

--admin-firstname      (Required) Admin first name

--admin-lastname       (Required) Admin last name

--magento-init-params  Add to any command to customize Magento initialization parameters

                       For example: &quot;MAGE_MODE=developer&amp;MAGE_DIRS[base][path]=/var/www/example.com&amp;MAGE_DIRS[cache][path]=/var/tmp/cache&quot;

--help (-h)            Display this help message

--quiet (-q)           Do not output any message

--verbose (-v|vv|vvv)  Increase the verbosity of messages: 1 for normal output, 2 for more verbose output and 3 for debug

--version (-V)         Display this application version

--ansi                 Force ANSI output

--no-ansi              Disable ANSI output

--no-interaction (-n)  Do not ask any interactive question</code></pre>
<h3 id="缓存Magento-2-CLI命令"><a href="#缓存Magento-2-CLI命令" class="headerlink" title="缓存Magento 2 CLI命令"></a>缓存Magento 2 CLI命令</h3><p><strong>cache:status</strong></p>
<p>通过这个命令，您可以看到所有Magento 2缓存的列表，其中每个缓存都可以用于诸如clean或disable之类的缓存管理命令。</p>
<pre><code>Current status:

                       config: 1

                       layout: 1

                   block_html: 1

          view_files_fallback: 1

     viewfiles_preprocessing: 1

                  collections: 1

                       db_ddl: 1

                          eav: 1

                    full_page: 1

                    translate: 1

           config_integration: 1

       config_integration_api: 1

            config_webservice: 1</code></pre>
<p><strong>cache:clean</strong></p>
<p>按类型或全部缓存完成清除Magento 2缓存。</p>
<pre><code>Usage:

cache:clean [--all] [--bootstrap=&quot;...&quot;] [types1] ... [typesN]

Arguments:

types                 List of cache types, space separated. If omitted, all caches will be affected

Options:

--all                 All cache types

--bootstrap           add or override parameters of the bootstrap</code></pre>
<p><strong>cache:disable</strong></p>
<p>禁用Magento 2种特定缓存类型或全部缓存完成。</p>
<pre><code>Usage:

cache:disable [--all] [--bootstrap=&quot;...&quot;] [types1] ... [typesN]

Arguments:

types                 List of cache types, space separated. If omitted, all caches will be affected

Options:

--all                 All cache types

--bootstrap           add or override parameters of the bootstrap</code></pre>
<p><strong>cache:flush</strong></p>
<p>刷新Magento 2缓存存储</p>
<pre><code>Usage:

cache:flush [--all] [--bootstrap=&quot;...&quot;] [types1] ... [typesN]

Arguments:

types                 List of cache types, space separated. If omitted, all caches will be affected

Options:

--all                 All cache types

--bootstrap           add or override parameters of the bootstrap</code></pre>
<p><strong>magento2的模式设置</strong></p>
<p>建议先在magento2根目录下运行命令查看一下：</p>
<pre><code>php bin/magento list</code></pre>
<p>找到模式那里：</p>
<p><img src="https://i.imgur.com/tdQlo83.jpg"></p>
<p>可以运行这两个命令看下：</p>
<pre><code>php bin/magento deploy:mode:set
php bin/magento deploy:mode:show</code></pre>
<p>通常有两种模式：</p>
<pre><code>php bin/magento deploy:mode:set developer
php bin/magento deploy:mode:set production</code></pre>
<p>一种是开发阶段的模式，另一种是在生产环境下设置的模式，可以加快网站的响应速度。</p>
<hr>
<p>If you are like most of the developers, you will have juggled through different websites to find SSH / CLI commands for Magento 2. There is no single resource on web which has all useful commands list for Magento 2. I have been there and I know it is a sheer waste of time juggling through different sites. So, to save your time, I have compiled a list of most useful commands for Magento 2 in a single note for all the developers.</p>
<p>Below is the list of most important SSH / CLI commands for Magento 2 that I have found useful. To use these commands you will need to have SSH access to your server or use the Command Line for local access.</p>
<p><strong>Setup Upgrade Using Command Line</strong></p>
<pre><code>php bin/magento setup:upgrade</code></pre>
<p>If you don’t want to remove pub/static files while installing/updating database then use following command.</p>
<pre><code>php bin/magento setup:upgrade --keep-generated</code></pre>
<p><strong>Cache Clean Using Command Line</strong></p>
<pre><code>php bin/magento cache:clean</code></pre>
<p><strong>Cache Flush Using Command Line</strong></p>
<pre><code>php bin/magento cache:flush</code></pre>
<p><strong>View cache status Using Command Line</strong></p>
<pre><code>php bin/magento cache:status</code></pre>
<p><strong>Enable Cache Using Command Line</strong></p>
<pre><code>php bin/magento cache:enable [cache_type]</code></pre>
<p><strong>Disable Cache Using Command Line</strong></p>
<pre><code>php bin/magento cache:disable [cache_type]</code></pre>
<p><strong>Static Content Deploy Using Command Line</strong></p>
<pre><code>php bin/magento setup:static-content:deploy</code></pre>
<p><strong>Static Content Deploy For Particular Language Using Command Line</strong></p>
<pre><code>php bin/magento setup:static-content:deploy en_US</code></pre>
<p><strong>Static Content Deploy For Magento Backend Theme Using Command Line (Working on 2.1.1 or later)</strong></p>
<pre><code>php bin/magento setup:static-content:deploy --theme=&quot;Magento/backend&quot;</code></pre>
<p><strong>Static Content Deploy For Specific Themes Using Command Line (Working on 2.1.1 or later)</strong></p>
<pre><code>php bin/magento setup:static-content:deploy --theme Magento/luma --theme Magento/second_theme</code></pre>
<p><strong>Exclude Themes on Static Content Deploy and does not minify HTML files Using Command Line (Working on 2.1.1 or later)</strong></p>
<pre><code>php bin/magento setup:static-content:deploy en_US --exclude-theme Magento/luma --no-html-minify</code></pre>
<p><strong>Reindexing Using Command Line</strong></p>
<pre><code>php bin/magento indexer:reindex</code></pre>
<p><strong>View the list of indexers Using Command Line</strong></p>
<pre><code>php bin/magento indexer:info</code></pre>
<p><strong>View indexer status Using Command Line</strong></p>
<pre><code>php bin/magento indexer:status</code></pre>
<p><strong>Show the mode of all indexers Using Command Line</strong></p>
<pre><code>php bin/magento indexer:show-mode</code></pre>
<p><strong>Enable module Using Command Line</strong></p>
<pre><code>php bin/magento module:enable Namespace_Module</code></pre>
<p><strong>Disable module Using Command Line</strong></p>
<pre><code>php bin/magento module:disable Namespace_Module</code></pre>
<p><strong>Uninstall Module Using Command Line</strong></p>
<pre><code>php bin/magento module:uninstall Namespace_Module</code></pre>
<p><strong>Check Current Mode Using Command Line</strong></p>
<pre><code>php bin/magento deploy:mode:show</code></pre>
<p><strong>Change To Developer Mode Using Command Line</strong></p>
<pre><code>php bin/magento deploy:mode:set developer</code></pre>
<p><strong>Change To Production Mode Using Command Line</strong></p>
<pre><code>php bin/magento deploy:mode:set production</code></pre>
<p><strong>Run the single-tenant Compiler Using Command Line</strong></p>
<pre><code>php bin/magento setup:di:compile</code></pre>
<p>I hope this Magento technical note helped you find what you were looking for. This is a comprehensive list of all useful Magento 2 commands; bookmark it for your future reference. Do comment below if you have any other handy commands which are not included in the list.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2019/01/28/%E6%9B%B4%E6%94%B9Magento2%E5%90%8E%E5%8F%B0%E7%99%BB%E5%BD%95%E5%9C%B0%E5%9D%80URL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/01/28/%E6%9B%B4%E6%94%B9Magento2%E5%90%8E%E5%8F%B0%E7%99%BB%E5%BD%95%E5%9C%B0%E5%9D%80URL/" class="post-title-link" itemprop="url">更改magento2后台登录地址URL</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-01-28 19:18:03" itemprop="dateCreated datePublished" datetime="2019-01-28T19:18:03+08:00">2019-01-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:58:05" itemprop="dateModified" datetime="2020-10-11T11:58:05+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/magento2/" itemprop="url" rel="index"><span itemprop="name">magento2</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>更改Magento2管理面板URL</p>
<p><strong>方法1:通过管理面板</strong></p>
<p>打开你的商店的管理面板并导航到  STORES → Configuration</p>
<p><img src="https://i.imgur.com/vS7Ps9R.png"></p>
<p>向下滚动并单击   Admin under ADVANCED.</p>
<p><img src="https://i.imgur.com/86pyN1s.png"></p>
<p>现在展开管理 Admin Base URL部分。</p>
<p><img src="https://i.imgur.com/3rrFuB5.png"></p>
<p>这一种方案不太好，因为配置文件没有改变，如果忘记了后台登录地址，就只能看看数据库里面的配置了。</p>
<p><strong>方法2:编辑env.php</strong></p>
<p>打开env.php文件在文本编辑器通过app/etc目录从您的商店的根目录。现在，您将看到以下代码:</p>
<pre><code>&lt;?php

return array (
 &#39;backend&#39; =&gt;
 array (
   &#39;frontName&#39; =&gt; &#39;admin&#39;,
 )</code></pre>
<p>将上述代码替换为以下代码，将Magento2管理URL从Admin更改为Magento:</p>
<pre><code>&#39;backend&#39; =&gt;
  array (
    &#39;frontName&#39; =&gt; &#39;magento&#39;,
  ),</code></pre>
<p><strong>方法3:通过命令行</strong></p>
<p>此方法可以改变配置文件</p>
<p>将您的存储与SSH终端连接，并转到Magento2存储的根目录。现在只需运行以下命令:</p>
<pre><code>php bin/magento setup:config:set --backend-frontname=&quot;magento&quot;</code></pre>
<p>在上面的命令中，我将管理URL路径设置为magento，您可以根据自己的需要设置。<br>我已经提到并阐述了更改Magento2管理URL的三种方法。在使用您选择的方法之后，您必须清理缓存。为此，在Magento2根目录中运行以下命令:</p>
<pre><code>rm -rf var/cache/*
php bin/magento cache:clean
php bin/magento cache:flush</code></pre>
<p>这个时候，原本后台的登录地址为<a target="_blank" rel="noopener" href="http://yourdomain.com/admin%E7%9A%84%E5%8F%98%E6%88%90%E4%BA%86http://yourdomain.com/magento">http://yourdomain.com/admin的变成了http://yourdomain.com/magento</a></p>
<p>当然自己可以更换成任何自己想要的名称。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2019/01/26/magento2%E7%9A%84%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%EF%BC%88cron%EF%BC%89%EF%BC%9A%E5%AE%9A%E6%97%B6%E5%A4%87%E4%BB%BD%E4%BB%BB%E5%8A%A1%EF%BC%8C%E5%AE%9A%E6%97%B6%E6%B8%85%E7%90%86%E7%BC%93%E5%AD%98%EF%BC%8C%E5%AE%9A%E6%97%B6%E5%88%B7%E6%96%B0%E7%B4%A2%E5%BC%95%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E7%9A%84%E6%9C%80%E7%AE%80%E6%B4%81%E7%9A%84%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/01/26/magento2%E7%9A%84%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%EF%BC%88cron%EF%BC%89%EF%BC%9A%E5%AE%9A%E6%97%B6%E5%A4%87%E4%BB%BD%E4%BB%BB%E5%8A%A1%EF%BC%8C%E5%AE%9A%E6%97%B6%E6%B8%85%E7%90%86%E7%BC%93%E5%AD%98%EF%BC%8C%E5%AE%9A%E6%97%B6%E5%88%B7%E6%96%B0%E7%B4%A2%E5%BC%95%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E7%9A%84%E6%9C%80%E7%AE%80%E6%B4%81%E7%9A%84%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">magento2的定时任务（cron）：定时备份任务，定时清理缓存，定时刷新索引以及其他定时任务的最简洁的方法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-01-26 15:20:17" itemprop="dateCreated datePublished" datetime="2019-01-26T15:20:17+08:00">2019-01-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:57:59" itemprop="dateModified" datetime="2020-10-11T11:57:59+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/magento2/" itemprop="url" rel="index"><span itemprop="name">magento2</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>今天我们来说说magento2的定时任务的话题，这个很重要，特别对于需要频繁而重复的操作的地方很重要，有了定时任务我们可以减少很多辛苦的劳作。</p>
<p>本文讲解的要义如下：</p>
<ol>
<li>定时备份</li>
<li>定时清理缓存</li>
<li>定时刷新索引</li>
<li>定时发送推广电邮</li>
<li>其他定时任务</li>
</ol>
<h2 id="定时备份"><a href="#定时备份" class="headerlink" title="定时备份"></a>定时备份</h2><p>这个太重要，时不时的备份一下数据库是必要的。</p>
<p>我们先登录magento2后台，来到STORES—Configuration—ADVANCED—System—Scheduled Backup Settings，这个里面就是设置网站的定时备份任务的。</p>
<p><img src="https://i.imgur.com/bX8wEHH.jpg"></p>
<p>这个是从后台设置的，笔者经过测试，貌似没有达到预期的效果，就是没有根据笔者设定的这个进行备份。这个地方笔者<strong>稍后会更新处理</strong></p>
<p>定时备份数据库既然从后台这里有点问题，我们就采用第二方案：进入到服务器那边编写cron的脚本进行定时备份，方法如下：</p>
<p>先进入到magento所在的服务器，输入命令：</p>
<pre><code>crontab -e</code></pre>
<p>然后编写一个cron.sh脚本，笔者这里让数据库每五分钟运行一次这个脚本，写法如下：</p>
<pre><code>*/5 * * * * /home1/noctiuni/public_html/magento2_dir/cron.sh</code></pre>
<p>而这个脚本所在目录笔者放在：/home1/noctiuni/public_html/magento2_dir/cron.sh，而cron.sh脚本就是数据备份的命令了，cron.sh脚本代码如下：</p>
<pre><code>#!/bin/bash
# Name:magento2_bakmysql.sh
# This is a ShellScript For Auto DB Backup and Delete old Backup
#
backupdir=&quot;/home1/noctiuni/public_html/magento2_dir/var/backups&quot;
password=&quot;database password&quot;
time=`date &quot;+%Y-%m-%d-%H:%M&quot;`
# backup database file to local
# rm -rf $backupdir/*
mysqldump -u noctiuni_wp_q0t2 -p$password noctiuni_market&gt; $backupdir/backupdb_$time.sql</code></pre>
<p>保存，接着还有一个重要地方就是，确保这个文件的权限，必须是可以被执行的，不然就没法运行这个文件了，所以我们设置一下这个权限，在当前目录下运行命令：</p>
<pre><code>chmod -R 777 cron.sh</code></pre>
<p>这样，这个文件的权限就设置好了，然后我们5分钟以后再去目录：/home1/noctiuni/public_html/magento2_dir/var/backups查看一下是否有数据库的备份文件，如果没有差错的话基本是有备份文件的了，如果没有那么检查下是否有什么地方写错了，或者是重启以下cron这个服务，重启cron的命令网上很多。</p>
<p>这里需要说明，即使笔者把这个目录放在了magento2后台网站备份对应的目录下，在magento网站后台仍然不能显示，而且原本通过magento网站后台手动备份的数据也显示不出来，原因是服务器这边运行的自动备份命令产生的备份文件格式跟magento网站后台手动运行的备份不一样，导致这个格式混乱，影响了手动备份的数据文件的显示。解决这个问题的方法就是服务器那边运行的定时备份文件存放的目录尽量不要跟magento网站后台备份的数据库文件存放目录相同，可以放在另外一个目录下即可。</p>
<h2 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h2><p>这个定时任务的创建其实也很简单，可以参考如下两个网址：</p>
<p><a target="_blank" rel="noopener" href="https://www.hellomagento2.com/config-cron/">https://www.hellomagento2.com/config-cron/</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/adu198888/article/details/55096728">https://blog.csdn.net/adu198888/article/details/55096728</a></p>
<p>笔者现在把他们综合下，精简下：</p>
<p>在服务器任何目录下运行命令：</p>
<p>crontab -e</p>
<p>在里面添加如下代码：</p>
<pre><code>*/5 * * * * php /home1/noctiuni/public_html/magento2_dir/pub/cron.php &gt;&gt; /home1/noctiuni/public_html/magento2_dir/var/log/run_magento2_cron.log
*/5 * * * * php /home1/noctiuni/public_html/magento2_dir/bin/magento cron:run | grep -v &quot;Ran jobs by schedule&quot; &gt;&gt; /home1/noctiuni/public_html/magento2_dir/var/log/magento.cron.log</code></pre>
<p>目录改成自己的目录即可。</p>
<p>检查是否配置成功： </p>
<p>等几分钟，检查cron_schedule表中状态是否变成success</p>
<p>进入数据库，运行SQL命令：</p>
<pre><code>select * from cron_schedule</code></pre>
<p>如果有查询结果，说明这个起作用了。</p>
<p>本文会持续更新和纠正，敬请关注。</p>
<hr>
<p>**更新：2019/1/27 18:20:06 **</p>
<h2 id="定时清理缓存和定时刷新索引"><a href="#定时清理缓存和定时刷新索引" class="headerlink" title="定时清理缓存和定时刷新索引"></a>定时清理缓存和定时刷新索引</h2><p>这个地方如果不能在magento2的网站后台完成自动化，那么如果能够接触到服务器，那么就只有一种方法了，跟着上面的方法走。</p>
<p>首先：</p>
<p>先去服务器里面运行命令：</p>
<pre><code>crontab -e</code></pre>
<p>添加如下代码在后面：</p>
<pre><code>*/5 * * * * /home1/noctiuni/public_html/market/auto_clean_cache_and_index.sh</code></pre>
<p>这个代码的意思就是，每五分钟运行一下目录<code>/home1/noctiuni/public_html/market</code>下的脚本auto_clean_cache_and_index.sh</p>
<p>接着：</p>
<p>我们打开auto_clean_cache_and_index.sh这个文件，添加如下代码：</p>
<pre><code>#!/bin/bash
php bin/magento cache:clean
php bin/magento cache:flush</code></pre>
<p>保存，然后进行测试，我们先启用缓存，然后随便在后台修改点东西，通常就会在magento后台显示缓存清理的提示，这个时候我们不动它，隔5分钟后，我们再次刷新下后台，看下这个缓存的提示是否已经消失，如果消失说明这个自动清理缓存的定时任务是生效的。</p>
<p>本文会持续更新，敬请关注。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2019/01/25/magento2%E7%BD%91%E7%AB%99%E7%9A%84%E6%90%AC%E8%BF%81%E5%92%8C%E4%B8%BB%E9%A2%98%E5%AE%89%E8%A3%85%E7%9A%84%E6%96%B9%E6%B3%95%E4%BB%A5%E5%8F%8A%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/01/25/magento2%E7%BD%91%E7%AB%99%E7%9A%84%E6%90%AC%E8%BF%81%E5%92%8C%E4%B8%BB%E9%A2%98%E5%AE%89%E8%A3%85%E7%9A%84%E6%96%B9%E6%B3%95%E4%BB%A5%E5%8F%8A%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/" class="post-title-link" itemprop="url">magento2网站的搬迁和主题安装的方法以及注意事项</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-01-25 20:34:25" itemprop="dateCreated datePublished" datetime="2019-01-25T20:34:25+08:00">2019-01-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:57:59" itemprop="dateModified" datetime="2020-10-11T11:57:59+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/magento2/" itemprop="url" rel="index"><span itemprop="name">magento2</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>关于网站的迁移大同小异，今天给大家分享下magento2的迁移以及相关的问题。</p>
<h2 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h2><p>把源码拷贝到新的服务器，全部拷贝，然后把数据库文件导出来，然后导入到新的服务器的数据库中。在导入之前呢，需要做一个处理，我们打开数据库文件，然后把里面旧的域名批量替换成新的域名，这里注意下有http还有https，两处都替换下。</p>
<h2 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h2><p>在新的服务器的magento2根目录下，运行如下命令：</p>
<pre><code>rm -rf ./var/cache/
rm -rf ./var/generation/
rm -rf ./var/log/
rm -rf ./var/maps/
rm -rf ./var/page_cache/
rm -rf ./var/tmp/
rm -rf ./var/view/
rm -rf ./var/view_preprocessed/</code></pre>
<p>当然，如果可以进入到源码中也可以来到var这个文件目录下删除这些东西。接着运行如下命令：</p>
<pre><code>php bin/magento setup:upgrade
php bin/magento setup:static-content:deploy -f
php bin/magento indexer:reindex
php bin/magento cache:clean
php bin/magento cache:flush</code></pre>
<h2 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h2><p>Magento 2数据库配置文件</p>
<p>要改变你的Magento 2的数据库服务器的主机名，数据库用户名，密码或数据库名称，你需要编辑以下文件。</p>
<pre><code>/&lt;Magento Install Dir&gt;/app/etc/env.php</code></pre>
<p>导航到Magento2的安装目录，编辑 app/etc/env.php 配置文件在你喜欢的编辑器和搜索以下设置，并做必要的修改。 </p>
<pre><code>...
&#39;db&#39; =&gt; [
    &#39;table_prefix&#39; =&gt; &#39;&#39;,
    &#39;connection&#39; =&gt; [
        &#39;default&#39; =&gt; [
            &#39;host&#39; =&gt; &#39;localhost&#39;,
            &#39;dbname&#39; =&gt; &#39;magento2_migration&#39;,
            &#39;username&#39; =&gt; &#39;root&#39;,
            &#39;password&#39; =&gt; &#39;&#39;,
            &#39;active&#39; =&gt; &#39;1&#39;
        ]
    ]
],
...</code></pre>
<p>现在更新如下显示的值</p>
<pre><code>localhost： MySQL服务器的主机名。
database_username： MySQL用户来连接数据库服务器。
database_password： MySQL的用户密码。
database_name： Magento的的MySQL数据库名称。</code></pre>
<p>完成这个修改后，我们保存。</p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>我们访问下迁移后的新域名，不出差错的情况下基本就算完成了，这里需要明确一点：网站迁移前的服务器配置跟迁移后的服务器配置一致，特别是php版本，如果不符合magento2所需的php版本就会报错。当然还有其它的配置，像php的配置文件中的必要扩展需要打开。</p>
<hr>
<h2 id="magento2的主题安装"><a href="#magento2的主题安装" class="headerlink" title="magento2的主题安装"></a>magento2的主题安装</h2><p>通常，当我们购买了一个magento主题后，会有两个包：一个是quickstart包，这个包含了主题模板以及magento2的所有文件；另一个是theme包，这个就是单纯的主题文件，通常的做法就是把这个theme包的文件放在源码中。</p>
<p>放进入后，不能马上进入到magento网站后台切换使用，我们还需要做这样一件事：编译一下，在magento的根目录下运行命令：</p>
<pre><code>php bin/magento setup:upgrade
php bin/magento setup:static-content:deploy -f
php bin/magento indexer:reindex
php bin/magento cache:clean
php bin/magento cache:flush</code></pre>
<p>运行完毕后，我们进入到magento2的后台，就可以看到我们新添加的那个主题，然后选择那个主题，切换即可。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2019/01/22/wordpress%E5%90%8E%E5%8F%B0%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E5%B9%B6%E6%98%BE%E7%A4%BA%E5%9C%A8%E7%BD%91%E7%AB%99%E5%90%8E%E5%8F%B0%EF%BC%8C%E4%BB%A5%E5%AE%9E%E7%8E%B0%E5%AF%B9%E5%89%8D%E5%8F%B0%E7%94%A8%E6%88%B7%E6%B5%8F%E8%A7%88%E8%A1%8C%E4%B8%BA%E7%9A%84%E5%88%86%E6%9E%90%E7%BB%9F%E8%AE%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/01/22/wordpress%E5%90%8E%E5%8F%B0%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E5%B9%B6%E6%98%BE%E7%A4%BA%E5%9C%A8%E7%BD%91%E7%AB%99%E5%90%8E%E5%8F%B0%EF%BC%8C%E4%BB%A5%E5%AE%9E%E7%8E%B0%E5%AF%B9%E5%89%8D%E5%8F%B0%E7%94%A8%E6%88%B7%E6%B5%8F%E8%A7%88%E8%A1%8C%E4%B8%BA%E7%9A%84%E5%88%86%E6%9E%90%E7%BB%9F%E8%AE%A1/" class="post-title-link" itemprop="url">wordpress后台获取数据库表中的数据并显示在网站后台，以实现对前台用户浏览行为的分析统计以可视化的方式显示在后台</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-01-22 21:35:50" itemprop="dateCreated datePublished" datetime="2019-01-22T21:35:50+08:00">2019-01-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:58:03" itemprop="dateModified" datetime="2020-10-11T11:58:03+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wordpress/" itemprop="url" rel="index"><span itemprop="name">wordpress</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在wordpress的开发中，我们可能会需要做这样一件事：对用户的浏览信息进行统计分析，以便网站广告的投放，那么势必会对用户的浏览信息进行存储，然后进行数据的统计分析，作为网钻管理员肯定希望这个分析结果显示在网站的后台而不是前台，那么这个如何实现呢？</p>
<p>我们分几个阶段来完成这个需求：</p>
<ol>
<li>创建数据表来存储用户的浏览信息或者是点击信息。</li>
<li>创建一个页面，明确收集信息的dom节点。</li>
<li>新建一个保存用户浏览信息的后端文件，把用户的信息保存到数据去。</li>
<li>新建一个获取数据库表的数据的后端文件，把用户的浏览信息读取出来。</li>
<li>新建一个js文件，专门存放点击图片时发出的ajax请求的js代码。</li>
<li>在WordPress中获取数据库字段内容和添加主题设置菜单</li>
</ol>
<h2 id="第一步：创建数据表"><a href="#第一步：创建数据表" class="headerlink" title="第一步：创建数据表"></a>第一步：创建数据表</h2><p>笔者只收集某张图片到底有多少人点击了，以及来自哪个IP和点击的时间，所以对应的数据表的sql代码如下：</p>
<pre><code>DROP TABLE IF EXISTS `user_click`;
CREATE TABLE `user_click` (
  `url` varchar(255) DEFAULT NULL,
  `ip` varchar(255) DEFAULT NULL,
  `created_time` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of user_click
-- ----------------------------
INSERT INTO `user_click` VALUES (&#39;http://localhost:8080/wordpress/wp-content/uploads/2018/12/he.jpg&#39;, &#39;::1&#39;, &#39;2018-12-06 21:47:19&#39;);
INSERT INTO `user_click` VALUES (&#39;http://localhost:8080/wordpress/wp-content/uploads/2018/12/51911.jpg&#39;, &#39;::1&#39;, &#39;2018-12-06 22:05:33&#39;);
INSERT INTO `user_click` VALUES (&#39;http://localhost/wordpress/wp-content/uploads/2019/01/he.jpg&#39;, &#39;::1&#39;, &#39;2019-01-22 09:46:20&#39;);</code></pre>
<p>数据库表名称：user_click</p>
<h2 id="第二步：创建一个页面，明确收集信息的dom节点"><a href="#第二步：创建一个页面，明确收集信息的dom节点" class="headerlink" title="第二步：创建一个页面，明确收集信息的dom节点"></a>第二步：创建一个页面，明确收集信息的dom节点</h2><p>由于要收集某张图片被点击的次数有多少，所以我们新建一个测试页面。</p>
<p><strong>HTML代码：</strong></p>
<pre><code>&lt;div id=&quot;contact&quot;&gt;
    &lt;img src=&quot;1.jpg&quot; alt=&quot;&quot;&gt;
&lt;/div&gt;</code></pre>
<p>ID名随便取。</p>
<h2 id="第三步：新建一个保存用户浏览信息的后端文件，把用户的信息保存到数据去"><a href="#第三步：新建一个保存用户浏览信息的后端文件，把用户的信息保存到数据去" class="headerlink" title="第三步：新建一个保存用户浏览信息的后端文件，把用户的信息保存到数据去"></a>第三步：新建一个保存用户浏览信息的后端文件，把用户的信息保存到数据去</h2><p>这个文件的目的就是用来把点击之后这个信息保存到数据表中去，我们创建它，为了方便管理，我们在主题目录下创建文件夹：user_click，然后在这个文件夹下创建文件：save_click_info.php，代码如下：</p>
<pre><code>&lt;?php
//字符编码设置，以及处理跨域的问题
header(&quot;Content-type:text/html;charset=utf-8;Access-Control-Allow-Origin:*;Access-Control-Allow-Methods:GET,POST&quot;);
//获取当前文件所在目录
$gen=$_SERVER[&#39;DOCUMENT_ROOT&#39;];
//由于笔者是在本地服务器下测试的，wordpress网站存放在wordpress目录下，所以这里的配置文件目录地址是：$gen/wordpress/wp-config.php
require_once(&quot;$gen/wordpress/wp-config.php&quot;);

//链接mysql服务器 开始
$con = mysqli_connect(DB_HOST, DB_USER, DB_PASSWORD);
mysqli_select_db($con, DB_NAME);

//不同环境下获取真实的IP
// $ip = $_SERVER[&quot;REMOTE_ADDR&quot;];
$user_IP = ($_SERVER[&quot;HTTP_VIA&quot;]) ? $_SERVER[&quot;HTTP_X_FORWARDED_FOR&quot;] : $_SERVER[&quot;REMOTE_ADDR&quot;];
$ip = ($user_IP) ? $user_IP : $_SERVER[&quot;REMOTE_ADDR&quot;];
$url = $_GET[&#39;urls&#39;];
$created_time = date(&quot;Y-m-d H:i:s&quot;);

$getold = mysqli_query($con,&quot;SELECT * FROM user_click WHERE url = &#39;$url&#39; and ip = &#39;$ip&#39;&quot;);

if (mysqli_num_rows($getold) &lt; 1) &#123;
    $sql = &quot;INSERT INTO user_click (url,ip,created_time) VALUES (&#39;$url&#39;,&#39;$ip&#39;,&#39;$created_time&#39;)&quot;;
&#125;else&#123;
    $sql = &quot;UPDATE user_click SET created_time = &#39;$created_time&#39; WHERE url = &#39;$url&#39; and ip = &#39;$ip&#39;&quot;;
    exit();
&#125;

$result = mysqli_query($con,$sql);
if (!$result) &#123;
    printf(&quot;Error: %s\n&quot;, mysqli_error($con));
    exit();
&#125;
$jarr = array();
while ($rows=mysqli_fetch_array($result,MYSQLI_BOTH))&#123;
    $count=count($rows);  
    for($i=0;$i&lt;$count;$i++)&#123;
        unset($rows[$i]);  
    &#125;
    array_push($jarr,$rows);
&#125;
//查看数组
// print_r($jarr);
echo $str=json_encode($jarr,JSON_UNESCAPED_UNICODE);//将数组进行json编码，并且解决中文乱码的问题
mysqli_close($con);
?&gt;</code></pre>
<p><strong>这里需要说明的地方是</strong>：<code>mysqli_fetch_array($result,MYSQLI_BOTH)</code>这个，笔者最开始不是这样引用的，而是采用的是：</p>
<pre><code>mysqli_fetch_array($result,MYSQL_ASSOC)</code></pre>
<p>结果报错了，就是这个地方报错，却不知道到底什么报错了，报错如下：</p>
<blockquote>
<p>Warning: mysqli_fetch_array() expects parameter 2 to be integer, string given……</p>
</blockquote>
<p>后来查了下，发现把<code>MYSQLI_ASSOC</code> 换成 <code>MYSQLI_NUM</code>，即修复该问题，但是偏偏这个法子还是不能解决笔者的问题，后来就查了下这个函数的手册，发现这个函数有个说明文档：</p>
<p><a target="_blank" rel="noopener" href="http://www.w3school.com.cn/php/func_mysql_fetch_array.asp">http://www.w3school.com.cn/php/func_mysql_fetch_array.asp</a></p>
<table class="dataintable"><tbody><tr><th>参数</th><th>描述</th></tr><tr><td><i>data</i></td><td>可选。规定要使用的数据指针。该数据指针是 mysql_query() 函数产生的结果。</td></tr><tr><td><i>array_type</i></td><td><p>可选。规定返回哪种结果。可能的值：</p><ul class="listintable"><li>mysql_assoc - 关联数组</li><li>mysql_num - 数字数组</li><li>mysql_both - 默认。同时产生关联和数字数组</li></ul></td></tr></tbody></table>

<p>看了这个以后得到了启发，于是把<code>MYSQLI_ASSOC</code> 换成 <code>MYSQLI_BOTH</code>，问题搞定。</p>
<p>顺便，我们说明下这个文件的基本思路，解决跨域文件—连接wordpress的数据库信息—确保数据库信息不暴露—收集前端那边收集来的字段信息—去重—查询</p>
<h2 id="第四步：新建一个获取数据库表的数据的后端文件，把用户的浏览信息读取出来"><a href="#第四步：新建一个获取数据库表的数据的后端文件，把用户的浏览信息读取出来" class="headerlink" title="第四步：新建一个获取数据库表的数据的后端文件，把用户的浏览信息读取出来"></a>第四步：新建一个获取数据库表的数据的后端文件，把用户的浏览信息读取出来</h2><p>当我们完成数据保存后，我们就要接着创建获取数据库表中数据的文件，同样的在user_click文件夹下创建文件：get_click_info.php，代码如下：</p>
<pre><code>&lt;?php
header(&quot;Content-type:text/html;charset=utf-8;Access-Control-Allow-Origin:*;Access-Control-Allow-Methods:GET,POST&quot;);//字符编码设置

//获取当前文件所在目录
$gen=$_SERVER[&#39;DOCUMENT_ROOT&#39;];
require_once(&quot;$gen/wordpress/wp-config.php&quot;);

//链接mysql服务器 开始
$con = mysqli_connect(DB_HOST, DB_USER, DB_PASSWORD);
mysqli_select_db($con, DB_NAME);

// 检测连接
$sql = &quot;SELECT * FROM user_click&quot;;
$result = mysqli_query($con,$sql);
if (!$result) &#123;
    printf(&quot;Error: %s\n&quot;, mysqli_error($con));
    exit();
&#125;

$jarr = array();
while ($rows=mysqli_fetch_array($result,MYSQLI_BOTH))&#123;
    $count=count($rows);//不能在循环语句中，由于每次删除 row数组长度都减小  
    for($i=0;$i&lt;$count;$i++)&#123;
        unset($rows[$i]);//删除冗余数据  
    &#125;
    array_push($jarr,$rows);
&#125;
//查看数组
// print_r($jarr);
echo $str=json_encode($jarr,JSON_UNESCAPED_UNICODE);//将数组进行json编码，并且解决中文乱码的问题
mysqli_close($con);
?&gt;</code></pre>
<p>这里就不重复说明了，很简单，也很容易理解。</p>
<h2 id="第五步：新建一个js文件，专门存放点击图片时发出的ajax请求的js代码"><a href="#第五步：新建一个js文件，专门存放点击图片时发出的ajax请求的js代码" class="headerlink" title="第五步：新建一个js文件，专门存放点击图片时发出的ajax请求的js代码"></a>第五步：新建一个js文件，专门存放点击图片时发出的ajax请求的js代码</h2><p>这个过程中离不开ajax的作用，因为ajax的特性，可以静默的把点击的这个事件向后端发出请求，把dom的节点信息提交到后端的文件中去。在user_click的文件夹下创建文件：js.js，代码如下：</p>
<pre><code>$(document).ready(function()&#123;
    var host = window.location.host;
    var protocol = window.location.protocol;
    $roots = protocol+&quot;//&quot;+host;

    // 获取保存在数据库表中的信息
    htmlob= $.ajax(&#123;
        url: $roots+&quot;/wordpress/wp-content/themes/nocti/user_click/get_click_info.php&quot;,
        type: &quot;get&quot;,
        dataType: &quot;json&quot;,
        contentType: &quot;application/json&quot;,
        success: function (res) &#123;
            console.log(res);
        &#125;,
        error: function (xhr, err, exception) &#123;
            console.log(err);
        &#125;
    &#125;);

    // 保存点击图片的时候的相关信息
    $(&quot;#contact&quot;).on(&quot;click&quot;,&quot;img&quot;,function()&#123;
        var ss =new Object();
        ss.urls = $(&quot;#contact img&quot;).attr(&quot;src&quot;);
        // console.log(ss.urls);

        $.ajax(&#123;
            url: $roots+&quot;/wordpress/wp-content/themes/nocti/user_click/save_click_info.php&quot;,
            type: &quot;get&quot;,
            dataType: &quot;json&quot;,
            data: ss,
            contentType: &quot;application/json&quot;,
            success: function (res) &#123;
                console.log(res);
            &#125;,
            error: function (xhr, err, exception) &#123;
                console.log(err);
            &#125;
        &#125;);
    &#125;);
&#125;);</code></pre>
<p>完成了这些内容之后，我们就实现了获取用户在网站前台点击图片的信息，并且收集这些信息保存到数据库中去，那么接下来我们就要实现把数据库中保存的信息显示到网站的后台去。</p>
<h2 id="第六步：在WordPress中获取数据库字段内容和添加主题设置菜单"><a href="#第六步：在WordPress中获取数据库字段内容和添加主题设置菜单" class="headerlink" title="第六步：在WordPress中获取数据库字段内容和添加主题设置菜单"></a>第六步：在WordPress中获取数据库字段内容和添加主题设置菜单</h2><p>可以参考这个链接：<a target="_blank" rel="noopener" href="https://www.jb51.net/article/77852.htm">https://www.jb51.net/article/77852.htm</a></p>
<p>核心的地方在这里，实例代码如下：</p>
<pre><code>function xz_theme_options_add_page() &#123;
 $theme_page = add_theme_page(
 &#39;主题设置&#39;, //页面Titlee
 &#39;主题设置&#39;, // 在后台菜单中显示的名字
 &#39;edit_theme_options&#39;,   // 选项放置的位置
 &#39;theme_options&#39;,    // 别名,也就是get传送的参数
 &#39;xz_theme_op_page&#39; //调用显示内容调用的函数
 );
&#125;
function xz_theme_op_page ()&#123;//内容显示函数
 echo &quot;我是主题编辑页面&quot;;
&#125;
add_action( &#39;admin_menu&#39;, &#39;xz_theme_options_add_page&#39; );</code></pre>
<p>把这个代码添加到functions.php中。打开wordpress的后台效果如下：</p>
<p><img src="https://i.imgur.com/QdcWpzU.png"></p>
<p>好的，这个实现了，那么我么就把获取的数据库表中的数据显示在内容区即可。</p>
<p>也就是我们把get_click_info.php这个文件中的代码放到xz_theme_op_page() 即可，所以最后加入到functions.php中的代码如下：</p>
<pre><code>function xz_theme_options_add_page() &#123;
    $theme_page = add_theme_page(
    &#39;用户行为统计&#39;,
    &#39;用户行为统计&#39;,
    &#39;edit_theme_options&#39;,
    &#39;theme_options&#39;,
    &#39;xz_theme_op_page&#39;
    );
&#125;

function xz_theme_op_page ()&#123;

    echo &quot;&lt;div class=&#39;tongji&#39; style=&#39;padding:20px;background:#23282d;color:#fff;margin:15px&#39;&gt;&quot;;
    echo &quot;&lt;table border=&#39;1&#39; style=&#39;color:#fff;margin:15px 0px&#39;&gt;&quot;;
    echo &quot;&lt;tr&gt;&lt;th style=&#39;padding:5px&#39;&gt;被点击的链接&lt;/th&gt;&lt;th style=&#39;padding:5px&#39;&gt;用户IP&lt;/th&gt;&lt;th style=&#39;padding:5px&#39;&gt;点击时间&lt;/th&gt;&lt;/tr&gt;&quot;;
    echo &quot;这是用户访问统计页面&quot;;

    $gen=$_SERVER[&#39;DOCUMENT_ROOT&#39;];
    require_once(&quot;$gen/wordpress/wp-config.php&quot;);
    $con = mysqli_connect(DB_HOST, DB_USER, DB_PASSWORD);
    mysqli_select_db($con, DB_NAME);
    $sql = &quot;SELECT * FROM user_click&quot;;
    $result = mysqli_query($con,$sql);
    if (!$result) &#123;
        printf(&quot;Error: %s\n&quot;, mysqli_error($con));
        exit();
    &#125;

    $jarr = array();
    while ($rows=mysqli_fetch_array($result,MYSQLI_BOTH))&#123;
        $count=count($rows);
        for($i=0;$i&lt;$count;$i++)&#123;
            unset($rows[$i]);
        &#125;
        array_push($jarr,$rows);
    &#125;

    $str=json_encode($jarr,JSON_UNESCAPED_UNICODE);
    // echo $str;

    foreach (json_decode($str) as $v)
    &#123;
        echo &quot;&lt;tr&gt;&lt;td style=&#39;padding:5px&#39;&gt;&#123;$v-&gt;url&#125;&lt;/td&gt;&lt;td style=&#39;padding:5px&#39;&gt;&#123;$v-&gt;ip&#125;&lt;/td&gt;&lt;td style=&#39;padding:5px&#39;&gt;&#123;$v-&gt;created_time&#125;&lt;/td&gt;&lt;/tr&gt;&quot;;
    &#125;

    echo &quot;&lt;/table&gt;&quot;;
    echo &quot;&lt;/div&gt;&quot;;
    mysqli_close($con);
&#125;

add_action( &#39;admin_menu&#39;, &#39;xz_theme_options_add_page&#39; );</code></pre>
<p>最后的效果：</p>
<p><img src="https://i.imgur.com/kBT3GfW.jpg"></p>
<p><strong>这里说明下add_theme_page()这个函数</strong>：</p>
<pre><code>&lt;?php 
add_theme_page( $page_title, $menu_title, $capability, $menu_slug, $function); 
//page_titile-title标签的内容 
//menu_title-显示在后台左边菜单的标题 
//capability-访问这个页面需要的权限 
//menu_slug-别名，需要独一无二哦 
//function-执行的函数 
?&gt;</code></pre>
<h2 id="最后：引入必要文件"><a href="#最后：引入必要文件" class="headerlink" title="最后：引入必要文件"></a>最后：引入必要文件</h2><p>由于这个需要依赖jquery，所以需要引用jquery，添加方式就是在header.php文件的<code>&lt;/head&gt;</code>的前面添加如下代码：</p>
<pre><code>&lt;script src=&quot;&lt;?php bloginfo(&#39;template_url&#39;) ?&gt;/js/jquery-3.3.1.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;&lt;?php bloginfo(&#39;template_url&#39;); ?&gt;/user_click/js.js&quot;&gt;&lt;/script&gt;</code></pre>
<p>扩展一下：根据这个设想，我们可以在网站后台实现更多的统计分析工作，甚至实现数据可视化。本文会持续更新，大家敬请关注。</p>
<hr>
<p>**更新：2019/1/23 18:13:40 **</p>
<p>我们继续来深化一下这个案例，笔者现在想要改造的是以下几点：</p>
<ol>
<li>在wordpress后台引入外部样式表和js文件，以解决wordpress后台开发的需要。</li>
<li>通过functions.php的方式引入外部样式表和js文件以取代在公共头部和公共尾部引入样式表和js文件。</li>
<li>数据可视化，把从数据库读取来的数据做成数据图表展示到网站后台。</li>
<li>在这个过程中遇到的相关问题以及相应的解决方案。</li>
</ol>
<h2 id="在wordpress后台引入外部样式表和js文件，以解决wordpress后台开发的需要"><a href="#在wordpress后台引入外部样式表和js文件，以解决wordpress后台开发的需要" class="headerlink" title="在wordpress后台引入外部样式表和js文件，以解决wordpress后台开发的需要"></a>在wordpress后台引入外部样式表和js文件，以解决wordpress后台开发的需要</h2><p>由于后台的样式写在php文件中显得很杂乱，看起来很不美观，而且js代码也是，如果全部写在里面会导致代码高耦合，不方便管理。那么我们而可以把这些控制网站后台的自定义代码写在一个文件中，像在前台页面那样引用即可。现在我们来看下是如何做的。</p>
<p>在functions.php文件中添加如下代码：</p>
<pre><code>function admin_mycss() &#123;
    wp_register_style( &#39;user_click_css&#39;, get_template_directory_uri() . &#39;/user_click/style.css&#39; );
    wp_enqueue_style(&#39;user_click_css&#39;);
&#125;
add_action(&#39;admin_menu&#39;, &#39;admin_mycss&#39;);</code></pre>
<p><strong>说明：</strong>这里就是笔者在主题目录下创建的user_click文件夹中新建一个样式文件，命名为：style.css，然后在钩子为<code>admin_menu</code>的这个地方引入它，这是对样式表的引入方式。更多可以参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/csnewdn/article/details/54021234">https://blog.csdn.net/csnewdn/article/details/54021234</a></p>
<p>接着，我们来看下对外部js文件的引入方式，在functions.php文件中添加如下代码：</p>
<pre><code>function admin_echarts_scripts_bd() &#123;
    wp_register_script( &#39;echarts&#39;, get_template_directory_uri() . &#39;/user_click/echart/echarts.min.js&#39;, false, &#39;1.0&#39;, false );
    wp_enqueue_script( &#39;echarts&#39; );
&#125;
add_action( &#39;admin_init&#39;, &#39;admin_echarts_scripts_bd&#39;);</code></pre>
<p>函数参数如下：<code>wp_register_script( string $handle, string $src, array $deps = array(), string|bool|null $ver = false, bool $in_footer = false )</code></p>
<p>更多可以参考这个链接：<a target="_blank" rel="noopener" href="https://developer.wordpress.org/reference/functions/wp_register_script/">https://developer.wordpress.org/reference/functions/wp_register_script/</a>。</p>
<p><strong>说明：</strong>这里就是笔者在主题目录下创建的user_click文件夹中新建一个echart文件夹存放数据可视化的库文件echarts.min.js，先注册这个脚本文件，然后就是载入这个脚本文件的句柄，最后就是运用wordpress的钩子来设定这个脚本文件的引入是在什么阶段，这里是在<code>admin_init</code>（后台初始化）阶段就载入的，大家都知道js的引用顺序是有讲究的，不然就不生效，在数据可视化的demo中已经很明确的说明了这个库文件要在开始ide售后就引入，因此必须要在初始化阶段就引入。</p>
<h2 id="通过functions-php的方式引入外部样式表和js文件以取代在公共头部和公共尾部引入样式表和js文件"><a href="#通过functions-php的方式引入外部样式表和js文件以取代在公共头部和公共尾部引入样式表和js文件" class="headerlink" title="通过functions.php的方式引入外部样式表和js文件以取代在公共头部和公共尾部引入样式表和js文件"></a>通过functions.php的方式引入外部样式表和js文件以取代在公共头部和公共尾部引入样式表和js文件</h2><p>这个问题很常见，比如我们经常会在公共头部（header.php）和公共尾部（footer.php）添加一些代码，比如追踪类的代码，广告代码等等，那么如果我们不想把外部的样式文件和js文件在公共头部和公共尾部引入，怎么办呢？</p>
<p>这里我们可以通过functions.php文件引入进来，在functions.php文件中添加如下代码：</p>
<pre><code>function my_enqueue_scripts_for_user_cilck() &#123;
    if( !is_admin ) &#123;
        wp_deregister_script( &#39;jquery&#39; );
        wp_register_script( &#39;jquery&#39;, get_template_directory_uri() . &#39;/js/jquery-3.3.1.min.js&#39;, false, &#39;3.3.1&#39;, false );
        wp_register_script( &#39;user_click_js&#39;, get_template_directory_uri() . &#39;/user_click/js.js&#39;, false, &#39;1.0&#39;, false );
        wp_enqueue_script( &#39;jquery&#39; );
        wp_enqueue_script( &#39;user_click_js&#39; );
    &#125;
&#125; 
add_action( &#39;init&#39;, &#39;my_enqueue_scripts_for_user_cilck&#39; );</code></pre>
<p><strong>说明：</strong>这个是在网站前端引入的，不用于网站后台那边的样式，更多信息可以参考这个链接：<a target="_blank" rel="noopener" href="https://yusi123.com/3086.html">https://yusi123.com/3086.html</a>，这里引入了jquery和笔者在主题目录下新建的文件夹user_click中的js.js这个文件，先注册后载入，最后在网站前台初始化的时候，加载这两个文件，这里笔者作为演示而用，根据笔者的实践发现这种方式引入跟在公共头部或者公共尾部引入没有任何多大的区别，而且发现对后台的功能有影响，感觉后台响应很慢。如果在生产环境中引入控制前台样式的脚本文件和样式文件的时候，还是建议选择在公共部分引入，弊端就是每个页面都要加载一边，影响性能。</p>
<h2 id="数据可视化，把从数据库读取来的数据做成数据图表展示到网站后台"><a href="#数据可视化，把从数据库读取来的数据做成数据图表展示到网站后台" class="headerlink" title="数据可视化，把从数据库读取来的数据做成数据图表展示到网站后台"></a>数据可视化，把从数据库读取来的数据做成数据图表展示到网站后台</h2><p>这里升级一下从数据库读取过来的数据，进行可视化处理，笔者这里采用的是百度的<a target="_blank" rel="noopener" href="https://www.echartsjs.com/examples/">echarts</a>，根据前面的信息，我们知道数据表我们已经有了一个了，数据已经在数据库中了，所以我们只需要把这个数据获取出来，然后符合echarts的渲染方式，那么调用就可以完成数据可视化了。那我们开始把。</p>
<p>为了方便测试，我们在user_click文件夹下创建一个文件夹echart，去echart官网下载库文件：<a target="_blank" rel="noopener" href="https://www.echartsjs.com/download.html">echarts.min.js</a>，或者直接调用在线资源：</p>
<pre><code>&lt;script type=&quot;text/javascript&quot; src=&quot;http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js&quot;&gt;&lt;/script&gt;</code></pre>
<p>我们不妨去他们的官网下载一个简单的实例看下：</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html style=&quot;height: 100%&quot;&gt;
   &lt;head&gt;
       &lt;meta charset=&quot;utf-8&quot;&gt;
   &lt;/head&gt;
   &lt;body style=&quot;height: 100%; margin: 0&quot;&gt;
       &lt;div id=&quot;container&quot; style=&quot;height: 100%&quot;&gt;&lt;/div&gt;
       &lt;script type=&quot;text/javascript&quot; src=&quot;http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js&quot;&gt;&lt;/script&gt;
       &lt;script type=&quot;text/javascript&quot;&gt;
        var dom = document.getElementById(&quot;container&quot;);
        var myChart = echarts.init(dom);
        var app = &#123;&#125;;
        option = null;
        option = &#123;
            xAxis: &#123;
                type: &#39;category&#39;,
                data: [&#39;Mon&#39;, &#39;Tue&#39;, &#39;Wed&#39;, &#39;Thu&#39;, &#39;Fri&#39;, &#39;Sat&#39;, &#39;Sun&#39;]
            &#125;,
            yAxis: &#123;
                type: &#39;value&#39;
            &#125;,
            series: [&#123;
                data: [820, 932, 901, 934, 1290, 1330, 1320],
                type: &#39;line&#39;
            &#125;]
        &#125;;
        ;
        if (option &amp;&amp; typeof option === &quot;object&quot;) &#123;
            myChart.setOption(option, true);
        &#125;
       &lt;/script&gt;
   &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>很简单，这里先引入库文件，然后把自定义代码在后面写，html代码在最前面：</p>
<pre><code>&lt;div id=&quot;container&quot; style=&quot;height: 100%&quot;&gt;&lt;/div&gt;</code></pre>
<p>所以这个顺序不能反了，道理很简单，js里面对dom的id进行了引用，如果js写在最前面，那么就会报错。</p>
<p>前面已经演示了在wordpress后台对外部js文件的引入，所以对echart的库文件的引入已经得到解决，接着就是dom，在dom后面就是自定义js代码了，我们把如下代码加入到functions.php里面：</p>
<pre><code>echo &quot;&lt;div id=&#39;container&#39; style=&#39;height: 450px&#39;&gt;&lt;/div&gt;&quot;;
echo &quot;&lt;script type=&#39;text/javascript&#39;&gt;var dom = document.getElementById(&#39;container&#39;); var myChart = echarts.init(dom); var app = &#123;&#125;; option = null; option = &#123;xAxis: &#123;type: &#39;category&#39;, data: [&#39;Mon&#39;, &#39;Tue&#39;, &#39;Wed&#39;, &#39;Thu&#39;, &#39;Fri&#39;, &#39;Sat&#39;, &#39;Sun&#39;] &#125;, yAxis: &#123;type: &#39;value&#39;&#125;, series: [&#123;data: [820, 932, 901, 934, 1290, 1330, 1320], type: &#39;line&#39;&#125;] &#125;; if (option &amp;&amp; typeof option === &#39;object&#39;) &#123;myChart.setOption(option, true); &#125;&lt;/script&gt;&quot;;</code></pre>
<p>这些代码还是跟前面的代码一样，添加到函数<code>function xz_theme_op_page ()&#123;&#125;</code>中的合适位置即可，这样我们就完成了第一阶段，数据可视化：</p>
<p><img src="https://i.imgur.com/ow4SAum.jpg"></p>
<p>同理，我们可以用其他形式来展示数据，但是现在这些数据都是写死的，不是从数据库那边获取过来，然后渲染出来的，那么现在就要解决这个问题。为了方便测试，笔者再导入一个数据表的数据到wordpress数据库中，相应的mysql脚本文件如下：</p>
<pre><code>DROP TABLE IF EXISTS `job`;
CREATE TABLE `job` (
  `id` int(8) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) DEFAULT NULL,
  `category` varchar(255) DEFAULT NULL,
  `city` varchar(64) DEFAULT NULL,
  `pay` int(64) DEFAULT NULL,
  `url` varchar(255) DEFAULT NULL,
  `detail` text,
  `created_time` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=84 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of job
-- ----------------------------
INSERT INTO `job` VALUES (&#39;1&#39;, &#39;Windows application operations engineer&#39;, &#39;Research&#39;, &#39;Shenzhen&#39;, &#39;60000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;2&#39;, &#39;Linux application operation and maintenance engineer&#39;, &#39;Research&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;3&#39;, &#39;GNSS baseband algorithm engineer&#39;, &#39;Research&#39;, &#39;Shenzhen&#39;, &#39;7000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;4&#39;, &#39;Senior operation specialist (e-commerce)&#39;, &#39;Marketing&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;5&#39;, &#39;Operation specialist of flagship store&#39;, &#39;Marketing&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;6&#39;, &#39;Senior sales executive (Arabic)&#39;, &#39;Marketing&#39;, &#39;Beijing&#39;, &#39;8000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;7&#39;, &#39;Marketing specialist (channel marketing)&#39;, &#39;Marketing&#39;, &#39;Shenzhen&#39;, &#39;7000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;8&#39;, &#39;3D rendering engineer&#39;, &#39;Marketing&#39;, &#39;Shenzhen&#39;, &#39;9000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;9&#39;, &#39;Senior information security engineer&#39;, &#39;Information Security&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;10&#39;, &#39;Information security engineer (Python)&#39;, &#39;Information Security&#39;, &#39;Beijing&#39;, &#39;8000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;11&#39;, &#39;Information security architect&#39;, &#39;Information Security&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;12&#39;, &#39;Cross-platform development engineer (C++)&#39;, &#39;Web Enginner&#39;, &#39;Beijing&#39;, &#39;35000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;13&#39;, &#39;Front-end engineer&#39;, &#39;Web Enginner&#39;, &#39;Shenzhen&#39;, &#39;32000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;14&#39;, &#39;Golang development engineer&#39;, &#39;Web Enginner&#39;, &#39;Beijing&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;15&#39;, &#39;Safety development engineer&#39;, &#39;Web Enginner&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;16&#39;, &#39;Senior demand analyst (administrative)&#39;, &#39;Web Enginner&#39;, &#39;Shenzhen&#39;, &#39;9000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;17&#39;, &#39;The project manager&#39;, &#39;Web Enginner&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;18&#39;, &#39;Senior background development engineer (.net)&#39;, &#39;Web Enginner&#39;, &#39;Shenzhen&#39;, &#39;11000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;19&#39;, &#39;IOS development engineer (19th edition)&#39;, &#39;Web Enginner&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;20&#39;, &#39;Industry sales specialist (overseas)&#39;, &#39;Application&#39;, &#39;Shanghai&#39;, &#39;18000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;21&#39;, &#39;销售助理&#39;, &#39;Application&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-31 18:19:57&#39;);
INSERT INTO `job` VALUES (&#39;22&#39;, &#39;Industry sales specialist (security direction)&#39;, &#39;Application&#39;, &#39;Beijing&#39;, &#39;23000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-30 07:22:17&#39;);
INSERT INTO `job` VALUES (&#39;23&#39;, &#39;Industry product operation specialist&#39;, &#39;Application&#39;, &#39;Shenzhen&#39;, &#39;25000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;24&#39;, &#39;Industry solution engineer&#39;, &#39;Application&#39;, &#39;Shanghai&#39;, &#39;12000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;25&#39;, &#39;Senior marketing officer&#39;, &#39;Application&#39;, &#39;Shenzhen&#39;, &#39;19000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;26&#39;, &#39;Procurement intern (MRO)&#39;, &#39;Manager&#39;, &#39;Beijing&#39;, &#39;13000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;27&#39;, &#39;Source manager - production material direction&#39;, &#39;Manager&#39;, &#39;Shenzhen&#39;, &#39;7000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-30 07:22:30&#39;);
INSERT INTO `job` VALUES (&#39;28&#39;, &#39;Project procurement - production material direction&#39;, &#39;Manager&#39;, &#39;Shanghai&#39;, &#39;11000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;29&#39;, &#39;Customs manager/supervisor&#39;, &#39;Manager&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;30&#39;, &#39;Supplier management - electronic materials/structural parts&#39;, &#39;Manager&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;31&#39;, &#39;The commissioner of customs affairs&#39;, &#39;Manager&#39;, &#39;Zhuhai&#39;, &#39;42000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-30 07:22:39&#39;);
INSERT INTO `job` VALUES (&#39;32&#39;, &#39;Order execution specialist&#39;, &#39;Manager&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;33&#39;, &#39;Purchasing assistant&#39;, &#39;Manager&#39;, &#39;Shenzhen&#39;, &#39;30000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;34&#39;, &#39;Supply chain management trainee&#39;, &#39;Manager&#39;, &#39;Guangzhou&#39;, &#39;25000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;35&#39;, &#39;Resource development manager&#39;, &#39;Manager&#39;, &#39;Shenzhen&#39;, &#39;43000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-30 07:22:44&#39;);
INSERT INTO `job` VALUES (&#39;36&#39;, &#39;General ledger accounting&#39;, &#39;Insurance&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;37&#39;, &#39;Cost accounting&#39;, &#39;Insurance&#39;, &#39;Guangzhou&#39;, &#39;25000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;38&#39;, &#39;(senior) financial analyst&#39;, &#39;Insurance&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;39&#39;, &#39;Money commissioner&#39;, &#39;Insurance&#39;, &#39;Shanghai&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;40&#39;, &#39;Senior fund officer&#39;, &#39;Insurance&#39;, &#39;Shenzhen&#39;, &#39;35000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;41&#39;, &#39;Video editing (intern)&#39;, &#39;Design&#39;, &#39;Shenzhen&#39;, &#39;43000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-30 07:22:54&#39;);
INSERT INTO `job` VALUES (&#39;42&#39;, &#39;(advanced) visual designers&#39;, &#39;Design&#39;, &#39;Shenzhen&#39;, &#39;30000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;43&#39;, &#39;(senior) landscape architect&#39;, &#39;Design&#39;, &#39;Shanghai&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;44&#39;, &#39;(senior) packaging designer&#39;, &#39;Design&#39;, &#39;Shenzhen&#39;, &#39;25000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;45&#39;, &#39;Peripheral product designers&#39;, &#39;Design&#39;, &#39;Shenzhen&#39;, &#39;42000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-30 07:23:03&#39;);
INSERT INTO `job` VALUES (&#39;46&#39;, &#39;Interaction designer&#39;, &#39;Design&#39;, &#39;Shenzhen&#39;, &#39;10000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;47&#39;, &#39;Technical document specialist&#39;, &#39;Functional&#39;, &#39;Beijing&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;48&#39;, &#39;Administrative reception&#39;, &#39;Functional&#39;, &#39;Shenzhen&#39;, &#39;55000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;49&#39;, &#39;HRBP&#39;, &#39;Functional&#39;, &#39;Shenzhen&#39;, &#39;11000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;50&#39;, &#39;Administrative assistant (xi an)&#39;, &#39;Functional&#39;, &#39;Xian&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;51&#39;, &#39;Hr intern&#39;, &#39;Functional&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;52&#39;, &#39;General manager trainee&#39;, &#39;Functional&#39;, &#39;Shenzhen&#39;, &#39;6000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;53&#39;, &#39;Senior marketing specialist (product release direction)&#39;, &#39;Functional&#39;, &#39;Shenzhen&#39;, &#39;28000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;54&#39;, &#39;(senior) tax officer&#39;, &#39;Functional&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;55&#39;, &#39;Technical support specialist/assistant (Portuguese)&#39;, &#39;Functional&#39;, &#39;Xian&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;56&#39;, &#39;Technical support specialist (Work Force direction)&#39;, &#39;Functional&#39;, &#39;Xian&#39;, &#39;16000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;57&#39;, &#39;Spare parts management specialist&#39;, &#39;Service&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;58&#39;, &#39;Operation support specialist (call center)&#39;, &#39;Service&#39;, &#39;Guangzhou&#39;, &#39;7000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;59&#39;, &#39;Operation support specialist (system support)&#39;, &#39;Service&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;60&#39;, &#39;Technical support supervisor&#39;, &#39;Service&#39;, &#39;Xian&#39;, &#39;7000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;61&#39;, &#39;Senior data analyst (user modeling direction)&#39;, &#39;Service&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;62&#39;, &#39;Senior data analyst (data mining)&#39;, &#39;Service&#39;, &#39;Xian&#39;, &#39;8000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;63&#39;, &#39;Senior flagship store service supervisor&#39;, &#39;Service&#39;, &#39;Shenzhen&#39;, &#39;7500&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;64&#39;, &#39;Social Media Specialist&#39;, &#39;Service&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;65&#39;, &#39;Customer service specialist/assistant&#39;, &#39;Service&#39;, &#39;Xian&#39;, &#39;8000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;66&#39;, &#39;Customer service executive/assistant&#39;, &#39;Service&#39;, &#39;Xian&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;67&#39;, &#39;Deputy project manager&#39;, &#39;Others&#39;, &#39;Shenzhen&#39;, &#39;12000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;68&#39;, &#39;hon&#39;, &#39;Others&#39;, &#39;Shenzhen&#39;, &#39;18000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;69&#39;, &#39;Decoration project manager&#39;, &#39;Others&#39;, &#39;Shenzhen&#39;, &#39;12000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;70&#39;, &#39;The builder&#39;, &#39;Others&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;71&#39;, &#39;Technical engineer of the project&#39;, &#39;Others&#39;, &#39;Xian&#39;, &#39;16000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;72&#39;, &#39;QE engineer&#39;, &#39;Others&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;73&#39;, &#39;The budget commissioner,&#39;, &#39;Others&#39;, &#39;Shenzhen&#39;, &#39;17000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;74&#39;, &#39;IE engineer&#39;, &#39;Others&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;75&#39;, &#39;Product process engineer&#39;, &#39;Others&#39;, &#39;Shanghai&#39;, &#39;13800&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;76&#39;, &#39;Assistant manager for approval and construction&#39;, &#39;Others&#39;, &#39;Shenzhen&#39;, &#39;22000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;77&#39;, &#39;Studio technology (intern)&#39;, &#39;Others&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;78&#39;, &#39;Match assistant (intern)&#39;, &#39;Others&#39;, &#39;Guangzhou&#39;, &#39;20000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;79&#39;, &#39;Education course engineer&#39;, &#39;Others&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;80&#39;, &#39;STEAM course engineer&#39;, &#39;Others&#39;, &#39;Shenzhen&#39;, &#39;26000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;81&#39;, &#39;Operation intern&#39;, &#39;Others&#39;, &#39;Shenzhen&#39;, &#39;10000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;82&#39;, &#39;QC engineer&#39;, &#39;Others&#39;, &#39;Guangzhou&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);
INSERT INTO `job` VALUES (&#39;83&#39;, &#39;Tournament director (intern)&#39;, &#39;Others&#39;, &#39;Shenzhen&#39;, &#39;15000&#39;, &#39;detail.html&#39;, &#39;test info&#39;, &#39;2018-10-29 23:18:49&#39;);</code></pre>
<p>好的，现在我们的数据库中就有了两个自定义数据表（user_click和job）了。现在要做的工作全部在functions.php这个文件中，其他的都不需要做任何修改。比如对job这个数据表想要统计一下在各个城市的招聘数量的分布，那么就需要获取城市这个字段的聚合数据。这里就涉及到数据库的SQL查询了。现在有好多个城市，那么就需要以城市作为分组，然后对每个城市进行聚合查询。且看对应的SQL代码：</p>
<pre><code>$job = &quot;SELECT count(city) AS value,city AS name FROM job GROUP BY city&quot;;</code></pre>
<p>那么这个查询结果就是：</p>
<p><img src="https://i.imgur.com/BzUTz8C.jpg"></p>
<p>更多分组查询，大家可以网上搜索下，也可以参考这个链接：<a target="_blank" rel="noopener" href="http://www.w3school.com.cn/sql/sql_groupby.asp">http://www.w3school.com.cn/sql/sql_groupby.asp</a></p>
<p>我们现在采用饼图来展示这个数据试试，我们先找到饼图的demo代码：</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html style=&quot;height: 100%&quot;&gt;
   &lt;head&gt;
       &lt;meta charset=&quot;utf-8&quot;&gt;
   &lt;/head&gt;
   &lt;body style=&quot;height: 100%; margin: 0&quot;&gt;
       &lt;div id=&quot;container&quot; style=&quot;height: 100%&quot;&gt;&lt;/div&gt;
       &lt;script type=&quot;text/javascript&quot; src=&quot;http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js&quot;&gt;&lt;/script&gt;
       &lt;script type=&quot;text/javascript&quot;&gt;
            var dom = document.getElementById(&quot;container&quot;);
            var myChart = echarts.init(dom);
            var app = &#123;&#125;;
            option = null;
            app.title = &#39;环形图&#39;;
            option = &#123;
                tooltip: &#123;
                    trigger: &#39;item&#39;,
                    formatter: &quot;&#123;a&#125; &lt;br/&gt;&#123;b&#125;: &#123;c&#125; (&#123;d&#125;%)&quot;
                &#125;,
                series: [
                    &#123;
                        name:&#39;访问来源&#39;,
                        type:&#39;pie&#39;,
                        radius: [&#39;50%&#39;, &#39;70%&#39;],
                        avoidLabelOverlap: false,
                        label: &#123;
                            normal: &#123;
                                show: false,
                                position: &#39;center&#39;
                            &#125;,
                            emphasis: &#123;
                                show: true,
                                textStyle: &#123;
                                    fontSize: &#39;30&#39;,
                                    fontWeight: &#39;bold&#39;
                                &#125;
                            &#125;
                        &#125;,
                        labelLine: &#123;
                            normal: &#123;
                                show: false
                            &#125;
                        &#125;,
                        data:[
                            &#123;value:335, name:&#39;直接访问&#39;&#125;,
                            &#123;value:310, name:&#39;邮件营销&#39;&#125;,
                            &#123;value:234, name:&#39;联盟广告&#39;&#125;,
                            &#123;value:135, name:&#39;视频广告&#39;&#125;,
                            &#123;value:1548, name:&#39;搜索引擎&#39;&#125;
                        ]
                    &#125;
                ]
            &#125;;
            ;
            if (option &amp;&amp; typeof option === &quot;object&quot;) &#123;
                myChart.setOption(option, true);
            &#125;
       &lt;/script&gt;
   &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>看到这里，我们就发现这个数据格式需要是json数据格式，那么我们就需要对从数据库查询出来的数据变成json格式的，代码如下：</p>
<pre><code>$gen=$_SERVER[&#39;DOCUMENT_ROOT&#39;];
require_once(&quot;$gen/wordpress/wp-config.php&quot;);
$con = mysqli_connect(DB_HOST, DB_USER, DB_PASSWORD);
mysqli_select_db($con, DB_NAME);
$job = &quot;SELECT count(city) AS value,city AS name FROM job GROUP BY city&quot;;
$job_result = mysqli_query($con,$job);
if (!$job_result) &#123;
    printf(&quot;Error: %s\n&quot;, mysqli_error($con));
    exit();
&#125;
$jarr_job = array();
while ($rows_job=mysqli_fetch_array($job_result,MYSQLI_BOTH))&#123;
    $count_job=count($rows_job);
    for($i=0;$i&lt;$count_job;$i++)&#123;
        unset($rows_job[$i]);
    &#125;
    array_push($jarr_job,$rows_job);
&#125;
$str_job=json_encode($jarr_job,JSON_UNESCAPED_UNICODE);
// echo $str_job;

echo &quot;&lt;div id=&#39;container_b&#39; style=&#39;height: 450px&#39;&gt;&lt;/div&gt;&quot;;
echo &quot;&lt;script type=&#39;text/javascript&#39;&gt;var dom = document.getElementById(&#39;container_b&#39;); var myChart = echarts.init(dom); var app = &#123;&#125;; option = null; app.title = &#39;环形图&#39;; option = &#123;tooltip: &#123;trigger: &#39;item&#39;, formatter: &#39;&#123;a&#125; &lt;br/&gt;&#123;b&#125;: &#123;c&#125; (&#123;d&#125;%)&#39;&#125;, series: [&#123;city:&#39;访问来源&#39;, type:&#39;pie&#39;, radius: [&#39;50%&#39;, &#39;70%&#39;], avoidLabelOverlap: false, label: &#123;normal: &#123;show: false, position: &#39;center&#39;&#125;, emphasis: &#123;show: true, textStyle: &#123;fontSize: &#39;30&#39;, fontWeight: &#39;bold&#39;&#125; &#125; &#125;, labelLine: &#123;normal: &#123;show: false &#125; &#125;, data:&quot;.$str_job.&quot; &#125; ] &#125;; ; if (option &amp;&amp; typeof option === &#39;object&#39;) &#123;myChart.setOption(option, true); &#125;&lt;/script&gt;&quot;;</code></pre>
<p>这个就是对job这个数据库表查询数据出来，然后把查询结果变成json格式的数据，以符合echart的数据渲染规则，然后显示出来。细心的读者会发现这个就是前面笔者说的那个以表格的形式展示数据的方式，笔者查询数据的方式是一模一样的，只是把数据展示到可视化这边来了而已，大家可以细细体会：</p>
<pre><code>[
  &#123;value:335, name:&#39;直接访问&#39;&#125;,
  &#123;value:310, name:&#39;邮件营销&#39;&#125;,
  &#123;value:234, name:&#39;联盟广告&#39;&#125;,
  &#123;value:135, name:&#39;视频广告&#39;&#125;,
  &#123;value:1548, name:&#39;搜索引擎&#39;&#125;
]</code></pre>
<p>跟变量$str_job是一样的规则。</p>
<p>好的，我们再换一种形式，我们用条形图来展示下user_click这个数据表的数据。条形图的示例代码：</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html style=&quot;height: 100%&quot;&gt;
   &lt;head&gt;
       &lt;meta charset=&quot;utf-8&quot;&gt;
   &lt;/head&gt;
   &lt;body style=&quot;height: 100%; margin: 0&quot;&gt;
       &lt;div id=&quot;container&quot; style=&quot;height: 100%&quot;&gt;&lt;/div&gt;
       &lt;script type=&quot;text/javascript&quot; src=&quot;http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js&quot;&gt;&lt;/script&gt;
       &lt;script type=&quot;text/javascript&quot;&gt;
          var dom = document.getElementById(&quot;container&quot;);
          var myChart = echarts.init(dom);
          var app = &#123;&#125;;
          option = null;
          app.title = &#39;坐标轴刻度与标签对齐&#39;;

          option = &#123;
              color: [&#39;#3398DB&#39;],
              tooltip : &#123;
                  trigger: &#39;axis&#39;,
                  axisPointer : &#123;            // 坐标轴指示器，坐标轴触发有效
                      type : &#39;shadow&#39;        // 默认为直线，可选为：&#39;line&#39; | &#39;shadow&#39;
                  &#125;
              &#125;,
              grid: &#123;
                  left: &#39;3%&#39;,
                  right: &#39;4%&#39;,
                  bottom: &#39;3%&#39;,
                  containLabel: true
              &#125;,
              xAxis : [
                  &#123;
                      type : &#39;category&#39;,
                      data : [&#39;Mon&#39;, &#39;Tue&#39;, &#39;Wed&#39;, &#39;Thu&#39;, &#39;Fri&#39;, &#39;Sat&#39;, &#39;Sun&#39;],
                      axisTick: &#123;
                          alignWithLabel: true
                      &#125;
                  &#125;
              ],
              yAxis : [
                  &#123;
                      type : &#39;value&#39;
                  &#125;
              ],
              series : [
                  &#123;
                      name:&#39;直接访问&#39;,
                      type:&#39;bar&#39;,
                      barWidth: &#39;60%&#39;,
                      data:[10, 52, 200, 334, 390, 330, 220]
                  &#125;
              ]
          &#125;;
          if (option &amp;&amp; typeof option === &quot;object&quot;) &#123;
              myChart.setOption(option, true);
          &#125;
       &lt;/script&gt;
   &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>这个地方我们就可以看到，这个数据源的格式是数组来的，那么我们要从数据库那边获取来的数据就要变成数组才行，我们看下应该如何处理，代码如下：</p>
<pre><code>$gen=$_SERVER[&#39;DOCUMENT_ROOT&#39;];
require_once(&quot;$gen/wordpress/wp-config.php&quot;);
$con = mysqli_connect(DB_HOST, DB_USER, DB_PASSWORD);
mysqli_select_db($con, DB_NAME);
$sql = &quot;SELECT count(url) AS value,url AS name FROM user_click GROUP BY url&quot;;
$result = mysqli_query($con,$sql);
if (!$result) &#123;
    printf(&quot;Error: %s\n&quot;, mysqli_error($con));
    exit();
&#125;

$jarr = array();

while ($rows=mysqli_fetch_array($result,MYSQLI_BOTH))&#123;
    $count=count($rows);
    for($i=0;$i&lt;$count;$i++)&#123;
        unset($rows[$i]);
    &#125;
    array_push($jarr,$rows);
&#125;

$bb = array();
$cc = array();
$str=json_encode($jarr,JSON_UNESCAPED_UNICODE);

foreach (json_decode($str) as $v)
&#123;
    array_push($bb,$v-&gt;value);
    array_push($cc,$v-&gt;name);
&#125;

// var_dump($bb);
// var_dump($cc);
$bbb=json_encode($bb,JSON_UNESCAPED_UNICODE);
$ccc=json_encode($cc,JSON_UNESCAPED_UNICODE);

echo &quot;&lt;div id=&#39;container_a&#39; style=&#39;height: 450px&#39;&gt;&lt;/div&gt;&quot;;
echo &quot;&lt;script type=&#39;text/javascript&#39;&gt;var dom = document.getElementById(&#39;container_a&#39;); var myChart = echarts.init(dom); var app = &#123;&#125;; option = null; app.title = &#39;坐标轴刻度与标签对齐&#39;; option = &#123;color: [&#39;#3398DB&#39;], tooltip : &#123;trigger: &#39;axis&#39;, axisPointer : &#123;type : &#39;shadow&#39;&#125; &#125;, grid: &#123;left: &#39;3%&#39;, right: &#39;4%&#39;, bottom: &#39;3%&#39;, containLabel: true &#125;, xAxis : [&#123;type : &#39;category&#39;, data : &quot;.$ccc.&quot;, axisTick: &#123;alignWithLabel: true &#125; &#125; ], yAxis : [&#123;type : &#39;value&#39;&#125; ], series : [&#123;name:&#39;直接访问&#39;, type:&#39;bar&#39;, barWidth: &#39;60%&#39;, data:&quot;.$bbb.&quot; &#125; ] &#125;; if (option &amp;&amp; typeof option === &#39;object&#39;) &#123;myChart.setOption(option, true); &#125;&lt;/script&gt;&quot;;</code></pre>
<p>这个就是把查询的数据分成两组一组是值，一组是名称，以数组的形式保存在变量中，这里采用了php的一个方法：<code>array_push($cc,$v-&gt;name);</code>，大家可以参考这个链接：<a target="_blank" rel="noopener" href="http://www.w3school.com.cn/php/func_array_push.asp">http://www.w3school.com.cn/php/func_array_push.asp</a>，把某个字段的值先聚合再push到数组中，然后调用这个数组的数据。</p>
<p>这样就完成了数组的数据渲染，好的，在functions.php中添加的完整的代码如下：</p>
<pre><code>function xz_theme_options_add_page() &#123;
    $theme_page = add_theme_page(
    &#39;用户行为统计&#39;,
    &#39;用户行为统计&#39;,
    &#39;edit_theme_options&#39;,
    &#39;theme_options&#39;,
    &#39;xz_theme_op_page&#39;
    );
&#125;


function xz_theme_op_page ()&#123;

    echo &quot;&lt;div class=&#39;tongji&#39;&gt;&quot;;
    echo &quot;&lt;table&gt;&quot;;
    echo &quot;&lt;tr&gt;&lt;th&gt;被点击的链接&lt;/th&gt;&lt;th&gt;用户IP&lt;/th&gt;&lt;th&gt;点击时间&lt;/th&gt;&lt;/tr&gt;&quot;;
    echo &quot;&lt;h2&gt;这是用户访问统计页面&lt;/h2&gt;&quot;;


    $gen=$_SERVER[&#39;DOCUMENT_ROOT&#39;];
    require_once(&quot;$gen/wordpress/wp-config.php&quot;);
    $con = mysqli_connect(DB_HOST, DB_USER, DB_PASSWORD);
    mysqli_select_db($con, DB_NAME);
    // $sql = &quot;SELECT * FROM user_click&quot;;
    $sql = &quot;SELECT count(url) AS value,url AS name FROM user_click GROUP BY url&quot;;
    $job = &quot;SELECT count(city) AS value,city AS name FROM job GROUP BY city&quot;;
    $job_result = mysqli_query($con,$job);
    $result = mysqli_query($con,$sql);
    if (!$result) &#123;
        printf(&quot;Error: %s\n&quot;, mysqli_error($con));
        exit();
    &#125;

    if (!$job_result) &#123;
        printf(&quot;Error: %s\n&quot;, mysqli_error($con));
        exit();
    &#125;

    $jarr = array();
    $jarr_job = array();

    while ($rows=mysqli_fetch_array($result,MYSQLI_BOTH))&#123;
        $count=count($rows);
        for($i=0;$i&lt;$count;$i++)&#123;
            unset($rows[$i]);
        &#125;
        array_push($jarr,$rows);
    &#125;

    while ($rows_job=mysqli_fetch_array($job_result,MYSQLI_BOTH))&#123;
        $count_job=count($rows_job);
        for($i=0;$i&lt;$count_job;$i++)&#123;
            unset($rows_job[$i]);
        &#125;
        array_push($jarr_job,$rows_job);
    &#125;

    $bb = array();
    $cc = array();
    $str=json_encode($jarr,JSON_UNESCAPED_UNICODE);
    $str_job=json_encode($jarr_job,JSON_UNESCAPED_UNICODE);
    echo $str_job;

    foreach (json_decode($str) as $v)
    &#123;
        // echo &quot;&lt;tr&gt;&lt;td&gt;&#123;$v-&gt;url&#125;&lt;/td&gt;&lt;td&gt;&#123;$v-&gt;ip&#125;&lt;/td&gt;&lt;td&gt;&#123;$v-&gt;created_time&#125;&lt;/td&gt;&lt;/tr&gt;&quot;;
        array_push($bb,$v-&gt;value);
        array_push($cc,$v-&gt;name);
    &#125;
    echo &quot;&lt;/table&gt;&quot;;

    var_dump($bb);
    var_dump($cc);
    $bbb=json_encode($bb,JSON_UNESCAPED_UNICODE);
    $ccc=json_encode($cc,JSON_UNESCAPED_UNICODE);

    echo &quot;&lt;table&gt;&quot;;
    echo &quot;&lt;tr&gt;&lt;th&gt;城市&lt;/th&gt;&lt;th&gt;招聘职位数&lt;/th&gt;&lt;/tr&gt;&quot;;
    echo &quot;&lt;h2&gt;这是工作统计信息&lt;/h2&gt;&quot;;

    foreach (json_decode($str_job) as $m)
    &#123;
        echo &quot;&lt;tr&gt;&lt;td&gt;&#123;$m-&gt;name&#125;&lt;/td&gt;&lt;td&gt;&#123;$m-&gt;value&#125;&lt;/td&gt;&lt;/tr&gt;&quot;;
    &#125;

    echo &quot;&lt;/table&gt;&quot;;
    echo &quot;&lt;div id=&#39;container_a&#39; style=&#39;height: 450px&#39;&gt;&lt;/div&gt;&quot;;
    echo &quot;&lt;script type=&#39;text/javascript&#39;&gt;var dom = document.getElementById(&#39;container_a&#39;); var myChart = echarts.init(dom); var app = &#123;&#125;; option = null; app.title = &#39;坐标轴刻度与标签对齐&#39;; option = &#123;color: [&#39;#3398DB&#39;], tooltip : &#123;trigger: &#39;axis&#39;, axisPointer : &#123;type : &#39;shadow&#39;&#125; &#125;, grid: &#123;left: &#39;3%&#39;, right: &#39;4%&#39;, bottom: &#39;3%&#39;, containLabel: true &#125;, xAxis : [&#123;type : &#39;category&#39;, data : &quot;.$ccc.&quot;, axisTick: &#123;alignWithLabel: true &#125; &#125; ], yAxis : [&#123;type : &#39;value&#39;&#125; ], series : [&#123;name:&#39;直接访问&#39;, type:&#39;bar&#39;, barWidth: &#39;60%&#39;, data:&quot;.$bbb.&quot; &#125; ] &#125;; if (option &amp;&amp; typeof option === &#39;object&#39;) &#123;myChart.setOption(option, true); &#125;&lt;/script&gt;&quot;;

    echo &quot;&lt;div id=&#39;container_c&#39; style=&#39;height: 450px&#39;&gt;&lt;/div&gt;&quot;;
    echo &quot;&lt;script type=&#39;text/javascript&#39;&gt;var dom = document.getElementById(&#39;container_c&#39;); var myChart = echarts.init(dom); var app = &#123;&#125;; option = null; app.title = &#39;网站前台图片点击情况 - 条形图&#39;; option = &#123;title: &#123;text: &#39;网站前台图片点击情况&#39;, subtext: &#39;数据来自网络&#39;&#125;, tooltip: &#123;trigger: &#39;axis&#39;, axisPointer: &#123;type: &#39;shadow&#39;&#125; &#125;, grid: &#123;left: &#39;3%&#39;, right: &#39;4%&#39;, bottom: &#39;3%&#39;, containLabel: true &#125;, xAxis: &#123;type: &#39;value&#39;, boundaryGap: [0, 0.01] &#125;, yAxis: &#123;type: &#39;category&#39;, data: &quot;.$ccc.&quot; &#125;, series: [&#123;name: &#39;点击累计次数&#39;, type: &#39;bar&#39;, data: &quot;.$bbb.&quot; &#125; ] &#125;; ; if (option &amp;&amp; typeof option === &#39;object&#39;) &#123;myChart.setOption(option, true); &#125;&lt;/script&gt;&quot;;

    echo &quot;&lt;div id=&#39;container_b&#39; style=&#39;height: 450px&#39;&gt;&lt;/div&gt;&quot;;
    echo &quot;&lt;script type=&#39;text/javascript&#39;&gt;var dom = document.getElementById(&#39;container_b&#39;); var myChart = echarts.init(dom); var app = &#123;&#125;; option = null; app.title = &#39;环形图&#39;; option = &#123;tooltip: &#123;trigger: &#39;item&#39;, formatter: &#39;&#123;a&#125; &lt;br/&gt;&#123;b&#125;: &#123;c&#125; (&#123;d&#125;%)&#39;&#125;, series: [&#123;city:&#39;访问来源&#39;, type:&#39;pie&#39;, radius: [&#39;50%&#39;, &#39;70%&#39;], avoidLabelOverlap: false, label: &#123;normal: &#123;show: false, position: &#39;center&#39;&#125;, emphasis: &#123;show: true, textStyle: &#123;fontSize: &#39;30&#39;, fontWeight: &#39;bold&#39;&#125; &#125; &#125;, labelLine: &#123;normal: &#123;show: false &#125; &#125;, data:&quot;.$str_job.&quot; &#125; ] &#125;; ; if (option &amp;&amp; typeof option === &#39;object&#39;) &#123;myChart.setOption(option, true); &#125;&lt;/script&gt;&quot;;
    echo &quot;&lt;/div&gt;&quot;;
    mysqli_close($con);
&#125;


add_action( &#39;admin_menu&#39;, &#39;xz_theme_options_add_page&#39; );


function admin_mycss() &#123;
    wp_register_style( &#39;user_click_css&#39;, get_template_directory_uri() . &#39;/user_click/style.css&#39; );
    wp_enqueue_style(&#39;user_click_css&#39;);
&#125;
add_action(&#39;admin_menu&#39;, &#39;admin_mycss&#39;);


function admin_echarts_scripts_bd() &#123;
    wp_register_script( &#39;echarts&#39;, get_template_directory_uri() . &#39;/user_click/echart/echarts.min.js&#39;, false, &#39;1.0&#39;, false );
    wp_enqueue_script( &#39;echarts&#39; );
&#125;
add_action( &#39;admin_init&#39;, &#39;admin_echarts_scripts_bd&#39;);</code></pre>
<p>在footer.php最后的</body>前面添加代码：</p>
<pre><code>&lt;script src=&quot;&lt;?php bloginfo(&#39;template_url&#39;) ?&gt;/js/jquery-3.3.1.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;&lt;?php bloginfo(&#39;template_url&#39;) ?&gt;/user_click/js.js&quot;&gt;&lt;/script&gt;</code></pre>
<p>另外，user_click/style.css中的代码如下：</p>
<pre><code>.tongji&#123;
    background-color: #dcdcdc;
    padding: 20px;
    margin: 15px 0px;
&#125;
.tongji table&#123;
    border-collapse: collapse;
    border:1px solid #f2f2f2;
    width:100%;
    margin:15px 0px;
&#125;
.tongji table tr th,.tongji table tr td&#123;
    padding: 8px 8px;
    text-align: left;
    border: 1px solid #848484;
    color: #484848;
&#125;
.tongji h2&#123;
    font-size: 24px;
    color:red;
&#125;</code></pre>
<p>最后，wordpress后台的效果如下：</p>
<p><img src="https://i.imgur.com/p6qHwNX.jpg"></p>
<p><img src="https://i.imgur.com/LhfY8bo.jpg"></p>
<h2 id="此更新总结"><a href="#此更新总结" class="headerlink" title="此更新总结"></a>此更新总结</h2><p>这过程中遇到了些问题，比如：</p>
<p>php中的push跟javascript中的push的差异；SQL中的查询的分组；wordpress中的<a target="_blank" rel="noopener" href="https://blog.csdn.net/biggbang/article/details/81024542">钩子</a>的概念深入了解；wordpress后台引入css和js的方法和wordpress前台引入css和js的方法之间的差异；<strong>wordpress选择性加载某个js和css这个问题会在下一次更新中得到实践和解决</strong></p>
<p>本文会持续更新，敬请关注。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2019/01/21/magento2%E6%B7%BB%E5%8A%A0%E8%AF%AD%E8%A8%80%E5%8C%85%EF%BC%8C%E4%BB%A5%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%B7%BB%E5%8A%A0%E8%AF%AD%E8%A8%80%E5%8C%85%E7%9A%84%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%90%8E%E5%8F%B0%E9%93%BE%E6%8E%A5%E4%B8%8D%E8%83%BD%E7%82%B9%E5%87%BB%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%8C%E4%B8%8D%E5%90%8C%E7%AE%A1%E7%90%86%E5%91%98%E9%87%87%E7%94%A8%E4%B8%8D%E5%90%8C%E7%9A%84%E8%AF%AD%E8%A8%80%E7%95%8C%E9%9D%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/01/21/magento2%E6%B7%BB%E5%8A%A0%E8%AF%AD%E8%A8%80%E5%8C%85%EF%BC%8C%E4%BB%A5%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%B7%BB%E5%8A%A0%E8%AF%AD%E8%A8%80%E5%8C%85%E7%9A%84%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%90%8E%E5%8F%B0%E9%93%BE%E6%8E%A5%E4%B8%8D%E8%83%BD%E7%82%B9%E5%87%BB%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%8C%E4%B8%8D%E5%90%8C%E7%AE%A1%E7%90%86%E5%91%98%E9%87%87%E7%94%A8%E4%B8%8D%E5%90%8C%E7%9A%84%E8%AF%AD%E8%A8%80%E7%95%8C%E9%9D%A2/" class="post-title-link" itemprop="url">magento2添加语言包，以及解决添加语言包的过程中后台链接不能点击的问题，不同管理员采用不同的语言界面</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-01-21 17:54:59" itemprop="dateCreated datePublished" datetime="2019-01-21T17:54:59+08:00">2019-01-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:57:59" itemprop="dateModified" datetime="2020-10-11T11:57:59+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/magento2/" itemprop="url" rel="index"><span itemprop="name">magento2</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>magento2安装语言包的步骤，这里以安装中文语言包作为示例进行讲解。</p>
<p>首先：下载语言包</p>
<p><a target="_blank" rel="noopener" href="https://www.mageoo.com/wp-content/uploads/2016/11/zh_Hans_CN.zip">magento2中文语言包</a>，也可以在这里下载：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1Yo11371_1qyYay0-jVacQQ">https://pan.baidu.com/s/1Yo11371_1qyYay0-jVacQQ</a> ，提取码：w4eg </p>
<p>把下载的这个语言包放在如下目录：</p>
<pre><code>/vendor/magento/language-zh_hans_cn</code></pre>
<p>这个是中文语言包的文件夹目录，其他语言就放在对应的语言包目录下。看清楚文件夹命名方式（language-en_us）。</p>
<p>笔者在最开始了解这个系统的时候就是这样，完成这一步就火急火燎的进入到后台去，把语言设置成中文，然后清除缓存，退出再登录，发现后台语言界面确实变成了中文的，可是后天的所有链接都不能点击了。结果导致还原都还原你不了，只能进入到数据库那边做数据还原，而且笔者当时是测试的，所以就没有备份，结果不得不重新再安装一遍。</p>
<p>很多人到这里就结束了，错了！还没有结束，我们接着编译一下，在magento2的目录下运行如下命令：</p>
<pre><code>php bin/magento setup:static-content:deploy
php bin/magento setup:static-content:deploy zh_Hans_CN （ 如果报错在deploy 和zh_Hans_CN之间加一个 -f 就行）
php bin/magento indexer:reindex 刷新索引
php bin/magento cache:clean 清空缓存
php bin/magento cache:flush  刷新缓存</code></pre>
<p>为了安全起见，大家可以在后台创建一个账号，这个账号最好不是管理员账号，因为万一以这个账号登录后台切换到中文的界面的时候出错了起码可以删除这个账号。</p>
<p>接着，我们以管理员登录后台，来创建一个账号，比如test，然后把这个账号的语言设置为中文，如下图：</p>
<p><img src="https://i.imgur.com/BIOZuDD.png"></p>
<p><img src="https://i.imgur.com/c8MD7rk.png"></p>
<p>那么用test登录后台的时候，后台的界面语言就是中文的了，用其他账号登录语言不变，这样就实现了，不同管理员不同的语言界面。</p>
<p>如果想要前台使用中文，那么修改店铺配置，把Locale Options 下面的locale 设为中文，如下图： </p>
<p><img src="https://i.imgur.com/TwjRlpz.png"></p>
<p><img src="https://i.imgur.com/BNnEZkF.png"></p>
<p>有的时候，运行久了会时不时的报错，比如笔者就在本地的xampp跑好几magento2的时候，会出现这样的错误：</p>
<blockquote>
<p>Allow 。。。。vendor\magento\framework\ObjectManager\Relations\Runtime.php</p>
</blockquote>
<p>这个是内存达到上限了，关掉多余的magento2，或者是重启下集成服务器即可。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2019/01/19/%E5%88%BB%E9%AA%A8%E9%93%AD%E5%BF%83%E7%9A%84%E6%88%90%E9%95%BF%E9%9C%80%E8%A6%81%E4%B8%80%E7%95%AA%E8%A3%82%E5%BF%83%E4%B9%8B%E7%97%9B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/01/19/%E5%88%BB%E9%AA%A8%E9%93%AD%E5%BF%83%E7%9A%84%E6%88%90%E9%95%BF%E9%9C%80%E8%A6%81%E4%B8%80%E7%95%AA%E8%A3%82%E5%BF%83%E4%B9%8B%E7%97%9B/" class="post-title-link" itemprop="url">刻骨铭心的成长需要一番裂心之痛</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-01-19 20:23:06" itemprop="dateCreated datePublished" datetime="2019-01-19T20:23:06+08:00">2019-01-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:58:04" itemprop="dateModified" datetime="2020-10-11T11:58:04+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%BF%83%E5%BE%97/" itemprop="url" rel="index"><span itemprop="name">心得</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>为什么哭？</p>
<p>是因为着急吗？不！着急不应该苦，无可奈何才会苦。不知道为什么这么多企业家半夜哭醒，遇到多大的困难了？无可奈何的困难吗？</p>
<p>曾经经历过一次失败的恋爱，那段时间很难受，对什么都提不起兴趣，感觉失去了整个世界。可能是职业的原因，又或者是个人本身出现问题了，特别急躁，做什么事都是很着急的，不知道这个是什么状况。</p>
<hr>
<p>大概是年龄的焦虑，感觉人一旦到了三十岁，就应该在全方位都成熟起来，而不再是一个想法肤浅，见识浅薄的人。动则大发脾气见不得别人比自己好的人，这些都不应该在这个年纪发生的事。</p>
<p>突然想起来自己是多么失败的一个人，这个阶段发生了一些奇妙的事情，自己目前的成熟度是跟这个年龄很不匹配的，能力也不匹配；缺乏行动力，意志力特别不强。</p>
<p>人一旦焦虑急躁会说话口吃，再说笔者本身有口吃的，而这个时候就很严重，时常说话口吃，特别困难说好一句话。</p>
<p>之所以变成这样，很大可能性是从小受到的影响，从小家境贫寒，受到别人的瞧不起，因此特别能够感受到带领家人过上好日子，不受别人冷言冷语是多么痛快的一件事。</p>
<p><strong>感悟：最悲哀的事就是在错误的时候认识正确的人</strong></p>
<p>这个是笔者在一次恋爱种感受到的，对方人不错，对我也挺好，就是笔者满脑子的上班，专心自己的事情，让对方彻底失望了。其实说到底还是自己没有为结婚做好准备，导致婚姻一拖再拖，最后拖到放弃为止，那么既然如此为什么当初要认识对方，导致一阵虐心。如果是个成熟的男人，就应该知道办一件事情的最好时机，既然做了就要坚定的做完。</p>
<p>成熟是装不出来的</p>
<p>做一个懂女人的男人，女人的一切都要了解些。</p>
<p>自己的幼稚，不成熟，想问题太浅，这样的人根本不适合结婚。</p>
<p>关于婚姻，关于家庭，关于生活你懂得多少，人与人的相处你懂得多少，没有搞清楚这些谈什么结婚。</p>
<p>成熟的男人，不应该心直口快，什么都说，和盘托出，这是很不成熟的表现。</p>
<p>成熟是一种设身处地的为他人着想，做事做人都是一个新的高度和水准。</p>
<p>成熟的男人一诺千金，不要轻易许诺，答应了就一定要做到。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2019/01/17/wordpress%E7%9A%84enfold%E4%B8%BB%E9%A2%98%E5%B1%8F%E8%94%BD%E5%90%8E%E5%8F%B0%E4%B8%BB%E9%A2%98%E8%AE%BE%E7%BD%AE%E5%A4%84%E7%9A%84%E9%87%8D%E7%BD%AE%E6%8C%89%E9%92%AE%EF%BC%8C%E4%BB%A5%E5%8F%8A%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA%E7%AD%89%E9%80%89%E9%A1%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/01/17/wordpress%E7%9A%84enfold%E4%B8%BB%E9%A2%98%E5%B1%8F%E8%94%BD%E5%90%8E%E5%8F%B0%E4%B8%BB%E9%A2%98%E8%AE%BE%E7%BD%AE%E5%A4%84%E7%9A%84%E9%87%8D%E7%BD%AE%E6%8C%89%E9%92%AE%EF%BC%8C%E4%BB%A5%E5%8F%8A%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA%E7%AD%89%E9%80%89%E9%A1%B9/" class="post-title-link" itemprop="url">wordpress的enfold主题屏蔽后台主题设置处的重置按钮，以及导入导出等选项</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-01-17 15:07:05" itemprop="dateCreated datePublished" datetime="2019-01-17T15:07:05+08:00">2019-01-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:58:03" itemprop="dateModified" datetime="2020-10-11T11:58:03+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wordpress/" itemprop="url" rel="index"><span itemprop="name">wordpress</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>通常情况下，我们在采用enfold主题的时候会有一个对主题的各种设置的地方，如下图：</p>
<p><img src="https://i.imgur.com/uRn2brR.jpg"></p>
<p>而这几个地方我们通常不怎么用，而且也很危险，特别是重置那个按钮，当你设置了各种选项后谁还会重置？而且这个重置这个按钮也很容易被误点击当做保存，如果这样的话将会失去所有的设置，打回原形，如果没有备份的话，因此去掉这个重置会更好，而且导入demo，以及主题更新这些都是危险的操作，屏蔽掉会更有利。我们看下如何处理这个。</p>
<p>在enfold主题里面的functions.php文件中添加如下代码：</p>
<pre><code>add_action(&#39;admin_head&#39;, &#39;remove_reset_button&#39;);
function remove_reset_button() &#123;
echo &#39;&lt;style&gt;
.avia_footer_reset&#123; display: none !important; &#125; 
&lt;/style&gt;&#39;;
&#125;

add_action(&#39;admin_head&#39;, &#39;hide_theme_options&#39;);

function hide_theme_options() &#123;
echo &#39;&lt;style&gt;
#wpbody-content #avia_options_page .avia_button.avia_button_grey.avia_reset,#wpbody-content #avia_options_page .avia_section_header.goto_update,#wpbody-content #avia_options_page .avia_section_header.goto_upload,#wpbody-content #avia_options_page .avia_section_header.goto_demo &#123;
display: none !important;
&#125;
&lt;/style&gt;&#39;;
&#125;</code></pre>
<p>保存，然后再次打开wordpress后台，来到主题设置这里，我们会发现，以上红色框框中的那个几个没有了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2019/01/09/magento1-x%E7%9A%84porto%E4%B8%BB%E9%A2%98%E5%AF%B9%E4%BA%A7%E5%93%81%E5%88%86%E7%B1%BB%E9%A1%B5%E7%9A%84%E9%87%8D%E6%9E%84%E4%B9%8B%E6%98%BE%E7%A4%BA%E5%BD%93%E5%89%8D%E5%88%86%E7%B1%BB%E7%9A%84%E5%AD%90%E5%88%86%E7%B1%BB%E4%BB%A5%E5%8F%8A%E7%BC%A9%E7%95%A5%E5%9B%BE%EF%BC%8C%E4%BB%A5%E5%8F%8A%E8%B0%83%E7%94%A8%E5%BD%93%E5%89%8D%E5%88%86%E7%B1%BB%E7%9A%84%E6%89%80%E6%9C%89%E5%90%8E%E4%BB%A3%E5%88%86%E7%B1%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/01/09/magento1-x%E7%9A%84porto%E4%B8%BB%E9%A2%98%E5%AF%B9%E4%BA%A7%E5%93%81%E5%88%86%E7%B1%BB%E9%A1%B5%E7%9A%84%E9%87%8D%E6%9E%84%E4%B9%8B%E6%98%BE%E7%A4%BA%E5%BD%93%E5%89%8D%E5%88%86%E7%B1%BB%E7%9A%84%E5%AD%90%E5%88%86%E7%B1%BB%E4%BB%A5%E5%8F%8A%E7%BC%A9%E7%95%A5%E5%9B%BE%EF%BC%8C%E4%BB%A5%E5%8F%8A%E8%B0%83%E7%94%A8%E5%BD%93%E5%89%8D%E5%88%86%E7%B1%BB%E7%9A%84%E6%89%80%E6%9C%89%E5%90%8E%E4%BB%A3%E5%88%86%E7%B1%BB/" class="post-title-link" itemprop="url">magento1.x的porto主题对产品分类页的重构之显示当前分类的子分类以及缩略图，以及调用当前分类的所有后代分类和侧边栏调用首页垂直菜单的方法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-01-09 19:30:30" itemprop="dateCreated datePublished" datetime="2019-01-09T19:30:30+08:00">2019-01-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:57:58" itemprop="dateModified" datetime="2020-10-11T11:57:58+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/magento1/" itemprop="url" rel="index"><span itemprop="name">magento1</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>今天笔者分享一个magento商城网站中很普遍的一个需求：在分类页中如果有子分类，那么显示子分类到内容区，并且显示缩略图；需求二就是在当前分类页中显示当前分类的所有后台分类，包括子分类。</p>
<p>最开始是这样的：</p>
<p><img src="https://i.imgur.com/JTybwzS.jpg"></p>
<p>那么如果想要把这个当前子目录显示到右边内容区，并且显示子目录的缩略图出来。怎么办呢？现在就以porto主题为例。</p>
<p>思路：</p>
<ul>
<li>问题是一个模板文件的范畴，因此我们只需修改模板文件即可。</li>
<li>问题的核心是调用子分类和缩略图。</li>
</ul>
<p><strong>首先：</strong>我们找到对应的模板文件：</p>
<pre><code>/app/design/frontend/smartwave/porto/template/catalog/category/category_nav.phtml</code></pre>
<p>最开始这个文件的内容如下：</p>
<pre><code>&lt;?php $_categories = $this-&gt;getCurrentChildCategories() ?&gt;
&lt;?php $_count = is_array($_categories)?count($_categories):$_categories-&gt;count(); ?&gt;
&lt;?php
    function cmpCatPosition($a, $b) &#123;
        if ($a-&gt;position == $b-&gt;position)
            return 0;
        return ($a-&gt;position &gt; $b-&gt;position) ? 1 : -1;
    &#125;
    function getChildrenCategoriesHtml($_category)&#123;
        $children = explode( &quot;,&quot;, $_category-&gt;getChildren() );
        //usort($children, &#39;cmpCatPosition&#39;);
        $content = &#39;&#39;;
        $content .= &#39;&lt;li class=&quot;&#39;;
        if(!$children[0])
            $content .= &#39;has-no-children&#39;;
        else
            $content .= &#39;has-children&#39;;
        $content .= &#39;&quot;&gt;&#39;;
        $content .= &#39;&lt;a href=&quot;&#39;.$_category-&gt;getUrl().&#39;&quot; &#39;;
        $content .= &#39;&gt;&#39;.$_category-&gt;getName().&#39;&lt;/a&gt;&#39;;
        if($children[0])&#123;
            $content .= &#39;&lt;a href=&quot;javascript:void(0)&quot; class=&quot;plus&quot;&gt;&lt;i class=&quot;icon-plus-squared&quot;&gt;&lt;/i&gt;&lt;/a&gt;&#39;;
            $content .= &#39;&lt;ul&gt;&#39;;
            foreach($children as $child)&#123;
                $_subcat = Mage::getModel( &#39;catalog/category&#39; )-&gt;load( $child );
                $content .= getChildrenCategoriesHtml($_subcat);
            &#125;
            $content .= &#39;&lt;/ul&gt;&#39;;
        &#125;
        $content .= &#39;&lt;/li&gt;&#39;;
        return $content;
    &#125;
?&gt;
&lt;?php if($_count): ?&gt;
&lt;div class=&quot;block block-category-nav&quot;&gt;
    &lt;h2&gt;nocti categories&lt;/h2&gt;
    &lt;div class=&quot;block-title&quot;&gt;
        &lt;strong&gt;&lt;span&gt;&lt;?php echo Mage::registry(&#39;current_category&#39;)-&gt;getName(); ?&gt;&lt;/span&gt;&lt;/strong&gt;
    &lt;/div&gt;
    &lt;div class=&quot;block-content&quot;&gt;
        &lt;ul class=&quot;category-list&quot;&gt;
        &lt;?php foreach ($_categories as $_category): ?&gt;
            &lt;?php
            if($_category-&gt;getIsActive())&#123;
                echo getChildrenCategoriesHtml($_category);
            &#125;
            ?&gt;
        &lt;?php endforeach ?&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
    jQuery(function($)&#123;
        $(&quot;.block.block-category-nav .block-title&quot;).click(function()&#123;
            if($(this).hasClass(&quot;closed&quot;))&#123;
                $(&quot;.block.block-category-nav .block-content&quot;).slideDown();
                $(this).removeClass(&quot;closed&quot;);
            &#125; else &#123;
                $(&quot;.block.block-category-nav .block-content&quot;).slideUp();
                $(this).addClass(&quot;closed&quot;);
            &#125;
        &#125;);
        $(&quot;.block.block-category-nav .category-list a.plus&quot;).click(function()&#123;
            if($(this).parent().hasClass(&quot;opened&quot;))&#123;
                $(this).parent().children(&quot;ul&quot;).slideUp();
                $(this).parent().removeClass(&quot;opened&quot;);
                $(this).children(&quot;i.icon-minus-squared&quot;).removeClass(&quot;icon-minus-squared&quot;).addClass(&quot;icon-plus-squared&quot;);
            &#125; else &#123;
                $(this).parent().children(&quot;ul&quot;).slideDown();
                $(this).parent().addClass(&quot;opened&quot;);
                $(this).children(&quot;i.icon-plus-squared&quot;).removeClass(&quot;icon-plus-squared&quot;).addClass(&quot;icon-minus-squared&quot;);
            &#125;
        &#125;);
    &#125;);
&lt;/script&gt;
&lt;/div&gt;
&lt;?php endif; ?&gt;</code></pre>
<p>这个文件实现的功能就是获取当前分类的所有后台分类包括子分类。现在我们需要修改这个文件以达到我们的目的，为了方便还原笔者把这个文件备份下。现在我们开始修改：</p>
<p>首先分析上面的代码：遍历当前分类的后代分类的函数是<code>getChildrenCategoriesHtml()</code>，而获取当前分类的函数是来自：</p>
<pre><code>&lt;?php $_categories = $this-&gt;getCurrentChildCategories() ?&gt;</code></pre>
<p>好的，明确这两点之后我们先找到getCurrentChildCategories()这个函数到底在哪里。我们可以把源码下载下来在sublime里面进行源码全搜索，会搜索出一这个函数在哪些文件中。最后我们定位到：</p>
<pre><code>/app/code/core/Mage/Catalog/Block/Navigation.php</code></pre>
<p>这个文件打开它，找到这个函数，它的代码如下：</p>
<pre><code>public function getCurrentChildCategories()
    &#123;
        $layer = Mage::getSingleton(&#39;catalog/layer&#39;);
        $category   = $layer-&gt;getCurrentCategory();
        /* @var $category Mage_Catalog_Model_Category */
        $categories = $category-&gt;getChildrenCategories();
        $productCollection = Mage::getResourceModel(&#39;catalog/product_collection&#39;);
        $layer-&gt;prepareProductCollection($productCollection);
        $productCollection-&gt;addCountToCategories($categories);
        return $categories;
&#125;</code></pre>
<p>我们需要把这个函数修改下，让这个函数获取的子分类有缩略图的这个字段，修改成如下代码：</p>
<pre><code>public function getCurrentChildCategories()
   &#123;
        $layer = Mage::getSingleton(&#39;catalog/layer&#39;);
        $category   = $layer-&gt;getCurrentCategory();
        /* @var $category Mage_Catalog_Model_Category */
        $collection = Mage::getModel(&#39;catalog/category&#39;)-&gt;getCollection();
        /* @var $collection Mage_Catalog_Model_Resource_Eav_Mysql4_Category_Collection */
        $collection-&gt;addAttributeToSelect(&#39;url_key&#39;)
            -&gt;addAttributeToSelect(&#39;name&#39;)
            -&gt;addAttributeToSelect(&#39;is_anchor&#39;)
            -&gt;addAttributeToSelect(&#39;image&#39;)
            -&gt;addAttributeToFilter(&#39;is_active&#39;, 1)
            -&gt;addIdFilter($category-&gt;getChildren())
            -&gt;setOrder(&#39;position&#39;, &#39;ASC&#39;)
            -&gt;joinUrlRewrite()
            -&gt;load();

        $productCollection = Mage::getResourceModel(&#39;catalog/product_collection&#39;);
        $layer-&gt;prepareProductCollection($productCollection);
        $productCollection-&gt;addCountToCategories($collection);
        return $collection;
    &#125;</code></pre>
<p>这里变化的就是中间那里。我们修改完成后保存。现在我们解决了获取图片的这个问题了。</p>
<p>虽然获取图片这个字段已经有了，那么还得调用才能显示到模板文件，所以我们现在就解决下调用当前分类的子分类的图片问题。因此我们在函数getChildrenCategoriesHtml里面的合适位置，添加如下代码到category_nav.phtml文件中：</p>
<pre><code>$content .=&#39;&lt;img src=&quot;&#39;.$_category-&gt;getImageUrl().&#39;&quot; style=&quot;max-width:140px;display:block;&quot;&gt;&#39;;</code></pre>
<p><img src="https://i.imgur.com/sjq0XSo.jpg"></p>
<p>这个就是获取分类图片的代码：</p>
<pre><code>$_category-&gt;getImageUrl()</code></pre>
<p>或者是给缩略语加上对应的链接的话：</p>
<pre><code>&lt;a href=&quot;&lt;?php echo $_category-&gt;getUrl() ?&gt;&quot;&gt;&lt;img src=&quot;&lt;?php echo $_category-&gt;getImageUrl(); ?&gt;&quot; /&gt;&lt;/a&gt;</code></pre>
<p>完成这个之后，虽然是可以把分类的图片调用出来，可是调用的是把当前分类的所有后台分类都调用出来，当然后台分类不多还好，万一当前这个分类有好几级，那么后台分类可能会很多，那么用户体验不是很好，那么可否只显示当前分类的子分类，而不显示子分类的子分类以及后面的那些？答案是可以的。我们回到文件category_nav.phtml中，我们通过分析发现控制子分类是来自这里的：</p>
<pre><code>$children = explode( &quot;,&quot;, $_category-&gt;getChildren() );</code></pre>
<p>从这个函数可以看出，这里是调用所有子分类（也就是笔者所说的后台分类）。我们只需要把这里修改下，改成：</p>
<pre><code>$children = explode( &quot;,&quot;, $_category );</code></pre>
<p>这样就不调用后台所有分类而是只调用当前分类的子分类了。整个category_nav.phtml文件修改后如下：</p>
<pre><code>&lt;div class=&quot;nocti_custom_some&quot;&gt;
    &lt;div class=&quot;newsgg&quot;&gt;
        &lt;?php $_categories = $this-&gt;getCurrentChildCategories() ?&gt;
        &lt;?php $_count = is_array($_categories)?count($_categories):$_categories-&gt;count(); ?&gt;
        &lt;?php
            function cmpCatPosition($a, $b) &#123;
                if ($a-&gt;position == $b-&gt;position)
                    return 0;
                return ($a-&gt;position &gt; $b-&gt;position) ? 1 : -1;
            &#125;
            function getChildrenCategoriesHtml($_category)&#123;
                // $children = explode( &quot;,&quot;, $_categories-&gt;getChildren() );
                $children = explode( &quot;,&quot;, $_category );
                //usort($children, &#39;cmpCatPosition&#39;);
                $content = &#39;&#39;;
                $content .= &#39;&lt;span class=&quot;&#39;;
                if(!$children[0])
                    $content .= &#39;has-no-children&#39;;
                else
                    $content .= &#39;has-children&#39;;
                $content .= &#39;&quot;&gt;&#39;;
                $content .=&#39;&lt;img src=&quot;&#39;.$_category-&gt;getImageUrl().&#39;&quot; style=&quot;max-width:140px;display:block;&quot;&gt;&#39;;
                $content .= &#39;&lt;a href=&quot;&#39;.$_category-&gt;getUrl().&#39;&quot;&#39;;
                $content .= &#39;&gt;&#39;.$_category-&gt;getName().&#39;&lt;/a&gt;&#39;;
                if($children[0])&#123;
                    $content .= &#39;&lt;a href=&quot;javascript:void(0)&quot; class=&quot;plus&quot;&gt;&lt;i class=&quot;icon-plus-squared&quot;&gt;&lt;/i&gt;&lt;/a&gt;&#39;;
                    $content .= &#39;&lt;div&gt;&#39;;
                    foreach($children as $child)&#123;
                        $_subcat = Mage::getModel( &#39;catalog/category&#39; )-&gt;load( $child );
                        $content .= getChildrenCategoriesHtml($_subcat);
                    &#125;
                    $content .= &#39;&lt;/div&gt;&#39;;
                &#125;
                $content .= &#39;&lt;/span&gt;&#39;;
                return $content;
            &#125;
        ?&gt;
        &lt;?php if($_count): ?&gt;
        &lt;div class=&quot;block block-category-nav&quot;&gt;
            &lt;div class=&quot;block-title&quot;&gt;
                &lt;strong&gt;&lt;span&gt;&lt;?php echo Mage::registry(&#39;current_category&#39;)-&gt;getName(); ?&gt;&lt;/span&gt;&lt;/strong&gt;
            &lt;/div&gt;
            &lt;div class=&quot;block-content&quot;&gt;
                &lt;div class=&quot;category-list&quot;&gt;
                &lt;?php foreach ($_categories as $_category): ?&gt;
                    &lt;?php
                    if($_category-&gt;getIsActive())&#123;
                        echo getChildrenCategoriesHtml($_category);
                    &#125;
                    ?&gt;
                &lt;?php endforeach ?&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;script type=&quot;text/javascript&quot;&gt;
            jQuery(function($)&#123;
                $(&quot;.block.block-category-nav .block-title&quot;).click(function()&#123;
                    if($(this).hasClass(&quot;closed&quot;))&#123;
                        $(&quot;.block.block-category-nav .block-content&quot;).slideDown();
                        $(this).removeClass(&quot;closed&quot;);
                    &#125; else &#123;
                        $(&quot;.block.block-category-nav .block-content&quot;).slideUp();
                        $(this).addClass(&quot;closed&quot;);
                    &#125;
                &#125;);
                $(&quot;.block.block-category-nav .category-list a.plus&quot;).click(function()&#123;
                    if($(this).parent().hasClass(&quot;opened&quot;))&#123;
                        $(this).parent().children(&quot;div&quot;).slideUp();
                        $(this).parent().removeClass(&quot;opened&quot;);
                        $(this).children(&quot;i.icon-minus-squared&quot;).removeClass(&quot;icon-minus-squared&quot;).addClass(&quot;icon-plus-squared&quot;);
                    &#125; else &#123;
                        $(this).parent().children(&quot;div&quot;).slideDown();
                        $(this).parent().addClass(&quot;opened&quot;);
                        $(this).children(&quot;i.icon-plus-squared&quot;).removeClass(&quot;icon-plus-squared&quot;).addClass(&quot;icon-minus-squared&quot;);
                    &#125;
                &#125;);
            &#125;);
        &lt;/script&gt;
        &lt;/div&gt;
        &lt;?php endif; ?&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
<p>那么如何把这个显示到右边的内容区呢？其实很简单了，方法有两个：一个是改写分类页模板文件；另外一个方法是通过jquery把侧边栏的那个菜单调用到右边内容区，然后修改下样式即可。</p>
<p>笔者采用后面一个方法，为了方便对dom元素进行操作，笔者为这个代码片段的最外层添加了一个div。好的，通过开发者工具判断，最后相应的js代码如下：</p>
<pre><code>&lt;script&gt;
    jQuery(document).ready(function()&#123;

      if(jQuery(&quot;.sidebar&quot;).find(&quot;.nocti_custom_some&quot;).length &gt;= 1)&#123;
        var currentSubcategories = jQuery(&quot;.nocti_custom_some&quot;).html();
        jQuery(&quot;.sidebar .nocti_custom_some&quot;).empty();
        jQuery(&quot;.category-products&quot;).before(currentSubcategories);
      &#125;

    &#125;);
&lt;/script&gt;</code></pre>
<p>当然我们为了更严谨我们可以进一步判断，如果两者都存在的情况下才执行代码，比如：</p>
<pre><code>&lt;script&gt;
    jQuery(document).ready(function()&#123;

      if(jQuery(&quot;.sidebar&quot;).find(&quot;.nocti_custom_some&quot;).length &gt;= 1)&#123;
        var currentSubcategories = jQuery(&quot;.nocti_custom_some&quot;).html();
        if(jQuery(&quot;.main-container&quot;).find(&quot;.category-products&quot;).length &gt;= 1)&#123;
            jQuery(&quot;.sidebar .nocti_custom_some&quot;).empty();
            jQuery(&quot;.category-products&quot;).before(currentSubcategories);
        &#125;
      &#125;

    &#125;);
&lt;/script&gt;</code></pre>
<p>这个代码解释了一切，就是把侧边栏的显示当前分类的子分类及其缩略图移到右边内容区的产品分类的前面位置。把js代码放在模板文件的合适位置即可，保存。最后我们看的效果如下：</p>
<p><img src="https://i.imgur.com/k5PcAAO.jpg"></p>
<p>当然，如果想要显示当前分类的所有后台分类的话，直接把上面修改完后的category_nav.phtml文件里的代码：</p>
<pre><code>// $children = explode( &quot;,&quot;, $_categories-&gt;getChildren() );
$children = explode( &quot;,&quot;, $_category );</code></pre>
<p>改成：</p>
<pre><code>$children = explode( &quot;,&quot;, $_categories-&gt;getChildren() );
// $children = explode( &quot;,&quot;, $_category );</code></pre>
<p>即可。这些细微的修改需要读者仔细领悟，了解这些函数的原理，当我们对magento的这些常用的函数了如指掌后相信会在同行中脱颖而出。</p>
<hr>
<p>题外话，用过magento的porto主题的读者可能很想要侧边栏有个像首页那样的垂直菜单。因为目前只有首页有，如果想要侧边栏有怎么办呢？这个菜单：</p>
<p><img src="https://i.imgur.com/4blB29R.jpg"></p>
<p>其实我们只需要找到首页垂直菜单对应的模板文件，我们不妨来到首页，里面就有一个垂直菜单的调用代码：</p>
<pre><code>&#123;&#123;block type="core/template" template="smartwave/megamenu/html/sidemenu.phtml"&#125;&#125;</code></pre>
<p>这个目录我们很快可以找到，然后打开它，里面的代码如下：</p>
<pre><code>&lt;?php $menuHelper = Mage::helper(&#39;megamenu&#39;); ?&gt;
&lt;?php $menuData = $menuHelper-&gt;getMenuData(); extract($menuData); ?&gt;
&lt;?php $only_categories = $this-&gt;getOnlyCategories(); ?&gt;
&lt;ul class=&quot;menu side-menu&quot;&gt;
    &lt;?php echo $menuHelper-&gt;getMenuContent($only_categories); ?&gt;
&lt;/ul&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
//&lt;![CDATA[
var SW_MENU_POPUP_WIDTH = &lt;?php echo $_popupWidth; ?&gt;;
jQuery(function($)&#123;
    $(&#39;.menu.side-menu&#39;).et_menu(&#123;
        type: &quot;default&quot;
    &#125;);
&#125;);
//]]&gt;
&lt;/script&gt;</code></pre>
<p>那么我们如果想要在左侧边栏调用的话我们只需要找到目录：</p>
<pre><code>app/design/frontend/smartwave/porto/template/page/2columns-left.phtml</code></pre>
<p>把以上代码添加进去，最后如下：</p>
<pre><code>...
&lt;div class=&quot;main-container col2-left-layout&quot;&gt;
    &lt;div class=&quot;main container&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-main col-sm-9 f-right&quot;&gt;
                &lt;?php echo $this-&gt;getChildHtml(&#39;global_messages&#39;) ?&gt;
                &lt;?php echo $this-&gt;getChildHtml(&#39;content&#39;) ?&gt;
            &lt;/div&gt;
            &lt;div class=&quot;col-left sidebar f-left col-sm-3&quot;&gt;

                // add menu start
                &lt;div class=&quot;extra_add_menu&quot;&gt;
                    &lt;?php $menuHelper = Mage::helper(&#39;megamenu&#39;); ?&gt;
                    &lt;?php $menuData = $menuHelper-&gt;getMenuData(); extract($menuData); ?&gt;
                    &lt;?php $only_categories = $this-&gt;getOnlyCategories(); ?&gt;
                    &lt;ul class=&quot;menu side-menu&quot;&gt;
                        &lt;?php echo $menuHelper-&gt;getMenuContent($only_categories); ?&gt;
                    &lt;/ul&gt;
                &lt;/div&gt;
                &lt;script type=&quot;text/javascript&quot;&gt;
                //&lt;![CDATA[
                var SW_MENU_POPUP_WIDTH = &lt;?php echo $_popupWidth; ?&gt;;
                jQuery(function($)&#123;
                    $(&#39;.menu.side-menu&#39;).et_menu(&#123;
                        type: &quot;default&quot;
                    &#125;);
                &#125;);
                //]]&gt;
                &lt;/script&gt;
                // add menu end

                &lt;?php echo $this-&gt;getChildHtml(&#39;left&#39;) ?&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
...</code></pre>
<p>这样我们就可以在侧边栏那里显示了：</p>
<p><img src="https://i.imgur.com/OsbHl0v.jpg"></p>
<p>当然了，还有其他的一些东西值得我们去挖掘。笔者分享到此结束，如有任何问题可与笔者取得联络。</p>
<p><strong>更新</strong>2019/1/15 10:33:34 </p>
<p>根据以上这个方法貌似有点小问题，缩略图显示不出来，这个时候，笔者又开始了新的探索，即使笔者根据上面的方法添加了，打开分类页还是这样的：</p>
<p><img src="https://i.imgur.com/7FPJG72.jpg"></p>
<p>也就是分类图还是没有显示出来，这个时候我们就需要调用当前分类的子分类的缩略图，一样的方式，我们通过全文搜索：Browse By，最终定位到这个来自：</p>
<pre><code>/app/design/frontend/smartwave/porto/template/catalog/navigation/left.phtml</code></pre>
<p>这个文件的代码如下：</p>
<pre><code>&lt;?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2014 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */

/**
 * Category left navigation
 *
 * @see Mage_Catalog_Block_Navigation
 */
?&gt;
&lt;?php if (!Mage::registry(&#39;current_category&#39;)) return ?&gt;
&lt;?php $_categories = $this-&gt;getCurrentChildCategories() ?&gt;
&lt;?php $_count = is_array($_categories)?count($_categories):$_categories-&gt;count(); ?&gt;
&lt;?php if($_count): ?&gt;
&lt;div class=&quot;block block-layered-nav&quot;&gt;
    &lt;div class=&quot;block-title&quot;&gt;
        &lt;strong&gt;&lt;span&gt;&lt;?php echo $this-&gt;__(&#39;Browse By&#39;) ?&gt;&lt;/span&gt;&lt;/strong&gt;
    &lt;/div&gt;
    &lt;div class=&quot;block-content&quot;&gt;
        &lt;dl id=&quot;narrow-by-list2&quot;&gt;
            &lt;dt&gt;&lt;?php echo $this-&gt;__(&#39;Category&#39;) ?&gt;&lt;/dt&gt;
            &lt;dd&gt;
                &lt;ol&gt;
                &lt;?php foreach ($_categories as $_category): ?&gt;
                    &lt;?php if($_category-&gt;getIsActive()): ?&gt;
                    &lt;li&gt;
                        &lt;a href=&quot;&lt;?php echo $this-&gt;getCategoryUrl($_category) ?&gt;&quot;&lt;?php if ($this-&gt;isCategoryActive($_category)): ?&gt; class=&quot;current&quot;&lt;?php endif; ?&gt;&gt;&lt;?php echo $this-&gt;escapeHtml($_category-&gt;getName()) ?&gt;&lt;/a&gt; (&lt;?php echo $_category-&gt;getProductCount() ?&gt;)
                    &lt;/li&gt;
                    &lt;?php endif; ?&gt;
                &lt;?php endforeach ?&gt;
                &lt;/ol&gt;
            &lt;/dd&gt;
        &lt;/dl&gt;
        &lt;script type=&quot;text/javascript&quot;&gt;decorateDataList(&#39;narrow-by-list2&#39;)&lt;/script&gt;
        &lt;script type=&quot;text/javascript&quot;&gt;
            jQuery(function($)&#123;
                $(&quot;#narrow-by-list2 dt&quot;).click(function()&#123;
                    if($(this).next(&quot;dd&quot;).css(&quot;display&quot;) == &quot;none&quot;)&#123;
                        $(this).next(&quot;dd&quot;).slideDown(200);
                        $(this).removeClass(&quot;closed&quot;);
                    &#125; else &#123;
                        $(this).next(&quot;dd&quot;).slideUp(200);
                        $(this).addClass(&quot;closed&quot;);
                    &#125;
                &#125;);
            &#125;);
        &lt;/script&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;?php endif; ?&gt;</code></pre>
<p>找到合适的位置添加缩略图的调用代码：</p>
<pre><code>&lt;a class=&quot;suoluetu&quot; href=&quot;&lt;?php echo $_category-&gt;getUrl() ?&gt;&quot;&gt;&lt;img src=&quot;&lt;?php echo $_category-&gt;getImageUrl() ?&gt;&quot;&gt;&lt;/a&gt;</code></pre>
<p>修改后代码如下：</p>
<pre><code>...
&lt;dl id=&quot;narrow-by-list2&quot;&gt;
    &lt;dt&gt;&lt;?php echo $this-&gt;__(&#39;Category&#39;) ?&gt;&lt;/dt&gt;
    &lt;dd&gt;
        &lt;ol&gt;
        &lt;?php foreach ($_categories as $_category): ?&gt;
            &lt;?php if($_category-&gt;getIsActive()): ?&gt;
            &lt;li&gt;
                &lt;a class=&quot;suoluetu&quot; href=&quot;&lt;?php echo $_category-&gt;getUrl() ?&gt;&quot;&gt;&lt;img src=&quot;&lt;?php echo $_category-&gt;getImageUrl() ?&gt;&quot;&gt;&lt;/a&gt;
                &lt;a href=&quot;&lt;?php echo $this-&gt;getCategoryUrl($_category) ?&gt;&quot;&lt;?php if ($this-&gt;isCategoryActive($_category)): ?&gt; class=&quot;current&quot;&lt;?php endif; ?&gt;&gt;&lt;?php echo $this-&gt;escapeHtml($_category-&gt;getName()) ?&gt;&lt;/a&gt; (&lt;?php echo $_category-&gt;getProductCount() ?&gt;)
            &lt;/li&gt;
            &lt;?php endif; ?&gt;
        &lt;?php endforeach ?&gt;
        &lt;/ol&gt;
    &lt;/dd&gt;
    &lt;hr style=&quot;clear:both;padding: 10px 0px;&quot;&gt;
&lt;/dl&gt;
...</code></pre>
<p>最后，经过css的调整，我们得到如下效果：</p>
<p><img src="https://i.imgur.com/2gDeSS1.jpg"></p>
<p>那剩下的就是通过js的方式把侧边栏的这个分类调用到右边内容区的上方即可，js代码如下：</p>
<pre><code>&lt;script&gt;
jQuery(document).ready(function()&#123;

  if(jQuery(&quot;.sidebar&quot;).find(&quot;#narrow-by-list2&quot;).length &gt;= 1)&#123;
    var currentSubcategorie_2 = jQuery(&quot;#narrow-by-list2&quot;).html();
    if(jQuery(&quot;.main-container&quot;).find(&quot;.category-products&quot;).length &gt;= 1)&#123;
      jQuery(&quot;.sidebar #narrow-by-list2&quot;).empty();
      jQuery(&quot;.category-products&quot;).prepend(currentSubcategorie_2).addClass(&#39;cate_content&#39;);
    &#125;
  &#125;

&#125;);
&lt;/script&gt;</code></pre>
<p>最后效果如下：</p>
<p><img src="https://i.imgur.com/3bkdxhj.jpg"></p>
<p>好的，关于调用缩略图的方案到此为止，本文还会持续更新，敬请关注。</p>
<p>参考链接：</p>
<p><a target="_blank" rel="noopener" href="https://www.templatemonster.com/help/magento-listing-sub-categories-on-a-category-page.html">https://www.templatemonster.com/help/magento-listing-sub-categories-on-a-category-page.html</a><br><a target="_blank" rel="noopener" href="https://community.magento.com/t5/Magento-1-x-Programming/Display-subcategories-in-parent-category-with-category-images-in/m-p/15379#M3265">https://community.magento.com/t5/Magento-1-x-Programming/Display-subcategories-in-parent-category-with-category-images-in/m-p/15379#M3265</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/43/">43</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">泉哥</p>
  <div class="site-description" itemprop="description">日记</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">424</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">400</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">泉哥</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
