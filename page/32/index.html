<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"helongquan.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="日记">
<meta property="og:type" content="website">
<meta property="og:title" content="鸢尾花序">
<meta property="og:url" content="https://helongquan.github.io/page/32/index.html">
<meta property="og:site_name" content="鸢尾花序">
<meta property="og:description" content="日记">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="泉哥">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://helongquan.github.io/page/32/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>鸢尾花序</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">鸢尾花序</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2017/07/23/WordPress-%E4%B8%B4%E6%97%B6%E9%80%89%E9%A1%B9%EF%BC%88Transients-API%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/07/23/WordPress-%E4%B8%B4%E6%97%B6%E9%80%89%E9%A1%B9%EF%BC%88Transients-API%EF%BC%89/" class="post-title-link" itemprop="url">WordPress 临时选项（Transients API）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-07-23 16:24:22" itemprop="dateCreated datePublished" datetime="2017-07-23T16:24:22+08:00">2017-07-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:14" itemprop="dateModified" datetime="2020-10-11T11:53:14+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>WordPress 2.8 版本添加了叫做 Transients 的 API，虽然已经过去了很久，但是现在了解的人非常少，实际上它非常有用。</p>
<p>本文我将详细的介绍 Transients 是什么、怎么使用、它与 Options 和缓存之间有什么不同以及能利用 Transients 干什么。</p>
<p><strong>Transients 是什么？</strong></p>
<p>Transients 中文直译为“瞬间、转瞬即逝的”，是 WordPress 中用于存储缓存和临时数据的 API，以 “key-value” 的形式保存数据，你可以给它设置一个到期时间，时间过后清除储存的数据。非常类似于 ThinkPHP 框架中的 S() 函数。</p>
<p>目前 Transients 并没有一个官方的中文名，这里我暂时叫做临时选项，但并不准确的，所以还是尽量使用英文称呼。</p>
<p>默认情况下，Transients 被利用 Options API 储存在 wp_options 表，但是每次储存会生成两条记录，分别是数据内容和它的到期时间。</p>
<p>如果你安装了类似 Memcached 的外部对象缓存插件，WordPress 则会把 Transients 数据直接放到缓存里，提高读取速度。</p>
<p><strong>使用 Transients</strong></p>
<p>对临时选项（Transients）的操作有三种，分别是获取、添加和删除，每个操作都有对应的函数，并且每个函数还有一个用来在多站点模式下储存全局数据的版本。</p>
<p>利用三个基本函数，就可以基本满足绝大多数对于临时数据的操作需要。</p>
<p><strong>添加</strong></p>
<p>使用 set_transient() 函数添加（或更新）一个临时选项，这个函数有三个参数：</p>
<p>$transient</p>
<p>（字符串）（必须）临时选项的名字。名字的长度不能超过 40 个字符，否则将无法建立 Transients。</p>
<p>$value</p>
<p>（混合）（必须）临时选项的值。可以保存除了句柄（resource）之外的任何数据类型，以后获取时也会返回同样的数据类型。</p>
<p>$expiration</p>
<p>（整数）（可选）临时选项的有效时间（秒），从创建时开始，过了规定时长后会自动删除。Transients 可能提前消失（比如启用外部对象缓存或数据库升级），但正常情况下不会在过期之后依然存在。</p>
<p>举一个例子：</p>
<pre><code>set_transient( &#39;site_name&#39;, &#39;EndSkin&#39;, 60 * 60 );</code></pre>
<p>这里保存了一个叫做 “site_name” 的临时选项，值为 “EndSkin”，有效期一小时，过期后自动删除。</p>
<p>返回值为是否保存成功，如果保存成功则返回 True，否则返回 False。</p>
<blockquote>
<p>注意：如果把临时选项的有效期留空或者设置成 “0”，则永不过期；永不过期的 Transients 会自动加载（即在加载任何页面的一开始会统一载入到缓存，安装了外部对象缓存插件除外）。</p>
</blockquote>
<p><strong>获取</strong></p>
<p>获取一个临时选项需要使用 get_transient() 函数，它只有一个参数：</p>
<p>$transient</p>
<p>（字符串）（必须）临时选项的名字。</p>
<pre><code>$value = get_transient( &#39;site_name&#39; );
if( $value === false )&#123;
    //Transients 已过期或者未找到
&#125;</code></pre>
<p>如果临时选项已过期或者不存在则返回 False，否则返回它的值。</p>
<p>注意：因为过期或未找到的时候会返回 False，所以不建议在 Transients 中存储布尔值。如果真的需要存储布尔值，可以使用整型数字来代替，即 1 和 0。</p>
<p><strong>删除</strong></p>
<p>要删除一个临时选项，可以使用 delete_transient() 函数，它也只有一个参数：</p>
<pre><code>$transient</code></pre>
<p>（字符串）（必须）临时选项的名字。</p>
<p>例子：</p>
<pre><code>delete_transient( &#39;site_name&#39; );</code></pre>
<p>如果删除成功，则返回 False；如果因为未找到 Transients 或者其它原因删除失败则返回 False。</p>
<p><strong>多站点</strong></p>
<p>上面的三个函数可以应对绝大多数情况，但如果网站是多站点模式，则创建的临时选项只能用于当前的站点。如果需要创建和使用所有站点公用的 Transients，可以使用 set_site_transient()、get_site_transient() 和 delete_site_transient() 函数，用法和上边介绍的函数一样。</p>
<p><strong>Transients 与 Options 和缓存的区别</strong></p>
<p>上面说到，Transients API 实际上是利用 Options API 和使用了外部对象缓存插件的缓存来存储数据，那他们直接有什么区别的？</p>
<p><strong>与 Options</strong></p>
<p>首先，使用 Options 的目的是在数据库永久储存数据，比如网站的设置、数据库版本等等，这些数据没有过期时间，只能手动删除，和一个网站同生同灭；而 Transients 则不同，他可能随时消失，而且支持设置到期时间，意味着它注定不能用来储存永久数据。</p>
<p><strong>与缓存</strong></p>
<p>有人会好奇了，如果不是永久储存数据，也同样可以设置到期时间，那它和缓存有什么区别呢？这里就要说到 WordPress 数据缓存的原理。在没有使用类似 Memcached 的外部对象缓存插件时，缓存数据只能被储存到 PHP 变量里，意味着一次请求结束所有缓存都没了，所以只能用来存储一些简单的 SQL 的查询结果以避免没必要的重复查询，只有使用了外部对象缓存插件，才可以将数据缓存到下一次请求；而 Transients 则可以在不支持跨请求缓存的情况下把数据保存到数据库，它实际上是一种强制的跨请求数据缓存，因为数据保存成功后，一定可以在下一次请求的时候使用。</p>
<p><strong>Transients 的用途和例子</strong></p>
<p>Transients 大概有缓存和储存临时数据两种用途，下边我来举几个例子，分别介绍一下基本的用法。</p>
<p><strong>缓存标签云集</strong></p>
<p>本站的标签云集页面展示了所有的标签，并且每个标签都显示了它的最新文章。</p>
<p><img src="http://i.imgur.com/6Imiaa8.png"></p>
<p>这个标签云页面虽然很漂亮，但是生成起来却非常麻烦。首先需要获取到网站所有的标签，然后再循环输出标签，循环到每个标签的时候需要单独去查询这个标签的最新文章，也就是页面所展示的每一个标签都需要经历一次单独的 SQL 查询。</p>
<p>标签比较少的时候还好说，但日后内容慢慢变多以后，生成这个标签云集需要大量的时间，而且也要耗费非常多的服务器资源。</p>
<p>这时候可以把标签云集的内容缓存起来。生成好 HTML 代码之后先保存到 Transients 里，然后再输出，下次再加载时直接从 Transients 里获取 HTML 代码，只需要一条甚至零条 SQL 就能获取到整个标签云集的代码：</p>
<pre><code>//获取标签云集
function Bing_page_tags()&#123;
    if( ( $cache = get_transient( &#39;page_tags_list&#39; ) ) !== false ) return $cache;//如果有 Transients 缓存则直接返回
    //如果没有缓存则开始生成 HTML 代码
    $code = &#39;&#39;;
    if( $tags = get_tags( &#39;orderby=count&amp;order=DESC&#39; ) )&#123;
        foreach( $tags as $tag )&#123;
            $code .= &#39;&lt;li class=&quot;tag-box&quot;&gt;&#39;;
                $post = current( get_posts( array(
                    &#39;tag_id&#39;         =&gt; $tag-&gt;term_id,
                    &#39;posts_per_page&#39; =&gt; 1
                ) ) );
                $code .= &quot;&lt;p class=&#39;tag-name&#39;&gt;$tag-&gt;name&lt;/p&gt;&quot;;
                $code .= sprintf( &#39;&lt;a href=&quot;%s&quot;&gt;%s&lt;/a&gt;&#39;, esc_url( get_permalink( $post ) ), get_the_title( $post ) );
            $code .= &#39;&lt;/li&gt;&#39;;
        &#125;
        $code .= &quot;&lt;ul id=&#39;tags_list&#39;&gt;$code&lt;/ul&gt;&quot;;
    &#125;
    //建立 Transients 缓存并返回代码
    set_transient( &#39;page_tags_list&#39;, $code, DAY_IN_SECONDS );//缓存有效 24 小时
    return $code;
&#125;</code></pre>
<p>上面的代码用来生成标签云集的 HTML 代码，并且缓存 24 小时（DAY_IN_SECONDS 为时间常量，表示 24 小时的秒数），如果存在缓存则直接返回，不用再次生成，避免大量 SQL 查询。</p>
<p>不过仅仅是上边的代码还是不够完美的，虽然一次缓存最多只会存在 24 小时，但是这期间修改标签或文章却无法立即显示，所以还需要在特定事件清除缓存：</p>
<pre><code>//清除标签云集缓存
function Bing_clear_page_tags_cache()&#123;
    delete_transient( &#39;page_tags_list&#39; );//删除 Transients 缓存
&#125;
add_action( &#39;save_post&#39;, &#39;Bing_clear_page_tags_cache&#39; );//创建和编辑文章
add_action( &#39;deleted_post&#39;, &#39;Bing_clear_page_tags_cache&#39; );//删除文章
add_action( &#39;created_post_tag&#39;, &#39;Bing_clear_page_tags_cache&#39; );//创建标签
add_action( &#39;edited_post_tag&#39;, &#39;Bing_clear_page_tags_cache&#39; );//编辑标签
add_action( &#39;delete_post_tag&#39;, &#39;Bing_clear_page_tags_cache&#39; );//删除标签</code></pre>
<p>缓存标签云集的用法主要适用于将需要耗费大量时间和服务器资源来生成的内容缓存到 Transients 里，下一次调用时从 Transients 里获取，大大节省时间和服务器资源。</p>
<p><strong>缓存天气</strong></p>
<p>Transients 还经常被用作缓存从网络 API 获取的内容，比如赛事排行榜和天气预报等等。因为服务器发送网络链接需要耗费一定的时间，如果每次加载页面都请求一次，会大大拖慢加载速度，这时就可以缓存到 Transients 里，每隔一段时间再重新请求一次。</p>
<p>下面的例子从中国气象局的 API 获取北京现在的天气，并缓存下来：</p>
<pre><code>//获取北京现在的天气
function Bing_weather_Beijing()&#123;
    if( ( $cache = get_transient( &#39;weather_Beijing&#39; ) ) !== false ) return $cache;//先从缓存获取，如果有则直接返回

    //从 API 获取数据
    $api = &#39;http://www.weather.com.cn/adat/cityinfo/101010100.html&#39;;
    $response = wp_remote_get( $api );
    if( is_wp_error( $response ) || wp_remote_retrieve_response_code( $response ) !== 200 ) return;

    //解析数据
    $result = json_decode( wp_remote_retrieve_body( $response ) );
    if( empty( $result-&gt;weatherinfo ) ) return;

    //生成数据
    $weather = &quot;北京现在 &#123;$result-&gt;weatherinfo-&gt;temp1&#125; 到 &#123;$result-&gt;weatherinfo-&gt;temp2&#125;，&#123;$result-&gt;weatherinfo-&gt;weather&#125;。\n&quot;;
    $weather .= &#39;最后更新：&#39; . $result-&gt;weatherinfo-&gt;ptime;

    //缓存数据并返回
    set_transient( &#39;weather_Beijing&#39;, $weather, HOUR_IN_SECONDS );//缓存一小时，到期重新获取
    return $weather;
&#125;</code></pre>
<p>因为天气并不是实时更新，所以在 Transients 里缓存一小时，缓存过期之后再去重新获取数据。</p>
<p><strong>邮件登录</strong></p>
<p>除了能缓存之外，Transients 还能保存一些有时间限制的 Key、授权代码之类的信息。</p>
<p>下面这个例子是用发送邮件的形式登录账号。原理是提交邮箱时生成一个用于登录账号的 Key，通过这个 Key 就能登录使用该邮箱的账号，下面只展示生成和校验 Key 部分的代码：</p>
<pre><code>//生成邮件登录 key
function Bing_set_mail_login_key( $user_id )&#123;
    $user_id = (int) $user_id;
    if( !( $user = get_userdata( $user_id ) ) ) return;
    $key = md5( wp_generate_password() );//生成 Key
    $result = set_transient( &#39;mail_login_key_user_&#39; . $user_id, $key, MINUTE_IN_SECONDS * 15 );//保存 Key；15 分钟后过期无效
    if( $result ) return $key;//保存成功则返回 Key，用于发邮件
&#125;

//使用邮件 key 登录
function Bing_mail_key_login( $user_id, $key )&#123;
    $user_id = (int) $user_id;
    $user = get_userdata( $user_id );
    if( !$user || empty( $key ) ) return;
    $transient_key = get_transient( &#39;mail_login_key_user_&#39; . $user_id );//获取保存的 Key
    if( $transient_key === false ) wp_die( &#39;Key 无效或者已过期&#39; );//Key 无效或者已过期
    if( $transient_key == $key )&#123;
        delete_transient( &#39;mail_login_key_user_&#39; . $user_id );//Key 有效，登录之前先删除 Key
        //登录并跳转到后台
        wp_set_current_user( $user_id, $user-&gt;user_login );
        wp_set_auth_cookie( $user_id );
        do_action( &#39;wp_login&#39;, $user-&gt;user_login );
        wp_safe_redirect( admin_url() );
        die;
    &#125;
&#125;</code></pre>
<p>上面的代码有两个函数，一个用来生成并保存登录 Key，一个用来校验 Key 和登录，其中 Key 保存在可以设置期限的 Transients 里，非常方便。</p>
<p>上面的代码有两个函数，一个用来生成并保存登录 Key，一个用来校验 Key 和登录，其中 Key 保存在可以设置期限的 Transients 里，非常方便。</p>
<p><strong>其它</strong></p>
<p>关于临时选项（Transients）就介绍到之类，结尾最后强调一下 Transients 的特点：</p>
<ul>
<li>Transients 并不是永久储存，它的数据可能随时消失，即使还没有到期；但是在到期之后它不会再继续“存在”</li>
<li>Transients 可能存储在数据库里，也可能存储在外部对象缓存里</li>
<li>如果需要缓存一些很轻松就能获取到的内容，请不要使用 Transients，而是缓存</li>
<li>Transients 会在一些时候自动消失（例如数据库升级和启用外部对象缓存），所以不用担心它会永远留在服务器中，成为垃圾</li>
<li>Transients 的名字是独一无二的</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2017/07/23/6-%E4%B8%AA%E5%B8%AE%E5%8A%A9%E4%BD%A0%E5%BC%80%E5%8F%91-WordPress-%E7%9A%84%E5%AE%9E%E7%94%A8%E6%8F%92%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/07/23/6-%E4%B8%AA%E5%B8%AE%E5%8A%A9%E4%BD%A0%E5%BC%80%E5%8F%91-WordPress-%E7%9A%84%E5%AE%9E%E7%94%A8%E6%8F%92%E4%BB%B6/" class="post-title-link" itemprop="url">6 个帮助你开发 WordPress 的实用插件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-07-23 15:40:00" itemprop="dateCreated datePublished" datetime="2017-07-23T15:40:00+08:00">2017-07-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:36" itemprop="dateModified" datetime="2020-10-11T11:53:36+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在开发 WordPress 主题或者插件的时候，对代码进行调试是很麻烦的工作。尤其是在功能需求比较深入之后，代码会越来越复杂，联动的模块也比较多，如果不谨慎的一步步调试，等到最终出 BUG 之后再想发现是哪里不对，是非常浪费时间的。</p>
<p>之前我一直使用 var_dump() 打印变量加上 die() 结束程序，简单粗暴的获取我想要的信息，但是这样效率真的非常低，因为经常需要到 WordPress 核心中去寻找相关文件，添加调试代码。在需要修改数据来调试的时候，更是得反复添加各种临时写的代码，来回在编辑器切换文件和光标，有时候打开的东西实在太多，都忘了一开始想要干什么……</p>
<p>后来，我发现了一些非常好用的调试工具，可以帮我更轻松的完成这些复杂的调试工作，除了 PHP 本身的调试工具之外，本文我将主要介绍专为辅助开发而设计的 WordPress 插件，全部都是曾经帮助过我解决问题的精品插件。</p>
<p>在正式开始之前，我先把即将介绍的插件统一进行一个大致的归类，单独介绍每个插件的时候，都会提到它拥有的一个或多个分类，方便大家找到自己想要的插件。</p>
<p>「信息获取」：即时获取有用的开发信息，并且通过清晰的方式呈现出来，有些会额外提供一些方便浏览的小功能，比自己直接打印变量友好的多。<br>「数据分析」：通过对一些数据或文件进行分析，找出程序存在的问题，比如性能问题和安全问题，帮助你优化改进和修复 BUG。<br>「调试操作」：创造调试程序的环境，解决手忙脚乱改东改西的困扰；很多这种插件对普通用户也有一定的使用价值，线上网站中也能用得到。<br>「错误记录」：记录在程序运行中出现的一些错误，并且生成日志，在人工不能及时发现问题的时候，记录下程序存在的隐患。<br>另外，如果大家正在使用文章中没有提到的，并且是开发调试相关的好插件，可以在留言中分享出来，方便更多的人！</p>
<p><strong>Query Monitor</strong></p>
<p>这是一个非常典型的「信息获取」类插件，可以在程序运行过程中记录下数据库查询、钩子、脚本和 HTTP 请求等信息，然后在页面下方生成清晰的表格，让我们可以方便、快速的获取这些信息，无论前台还是后台。</p>
<p>安装之后，它会在管理工具栏上生成导航，显示页面生成时间、内存用量、数据库查询时间和数据库查询次数；鼠标悬浮后，点击下边对应的按钮，就能定位到自己想要的信息。</p>
<p><img src="http://i.imgur.com/aNYtKnk.jpg"></p>
<p>在插件生成的表格中，会把数据库查询、在钩子上挂载函数、和设置临时选项等操作记录全部显示出来，并且会提示这件事是核心、主题还是哪个插件干的，以及对应的文件和行数，方便你找到它。</p>
<p>此外，这个插件还有简单的「数据分析」功能。举几个例子，它可以帮你找出非常耗费时间的，或是重复的数据库查询，然后就可以针对此来优化代码，使其更加高效；还有，能分两方面综合分析出数据库查询的来源，点击对应的来源就可以看到该来源发出的所有查询请求。</p>
<p><img src="http://i.imgur.com/zQTCGC2.png"></p>
<p>总之，Query Monitor 是我这篇文章介绍的所有插件中，功能最强大的，也是最推荐安装的，它解决了我很多开发调试的困难，也节省了我大量的时间，现在是我本地环境的必备插件，相信你也可以用得到。</p>
<p>另外，与此插件功能类似的还有一个叫做 Debug Objects 的插件，但是我下载之后发现并没有比 Query Monitor 多出什么特别的好功能，而且 UI 排版设计的不太好，像一个半成品，就专门不推荐给大家了，有兴趣的同学可以自己去下载看一看。</p>
<p><strong>Debug Bar</strong></p>
<p>相比于上边介绍的 Query Monitor 插件，Debug Bar 在「信息获取」类插件中，或许显得有些简陋：同样需要在管理工具栏上点击「Debug」按钮打开，但它只能显示出基本的数据库查询、缓存、错误信息和服务器软件版本等信息。</p>
<p><img src="http://i.imgur.com/ghTVflV.jpg"></p>
<p>所以，我真正推荐它的原因在于另一个插件：Debug Bar Console，使用之后可以扩展出「调试操作」功能。当你安装了 Debug Bar 之后再安装 Debug Bar Console 插件，在插件的界面中会出现一个控制台，你可以直接在上边运行 PHP 代码或者使用 SQL 操作数据库，支持代码高亮。</p>
<p>比如我这里更新一个选项或者查询数据库：</p>
<p><img src="http://i.imgur.com/Igr4o6D.jpg"></p>
<p>我就会经常在编写一个功能的时候，想要修改某些数据来调试我的代码，或者想找个地方测试函数的返回值是否正确。有了这个插件之后，就可以不用在编辑器中切换文件和光标来添加测试代码，而是直接在控制台中完成。</p>
<p><strong>Log Deprecated Notices</strong></p>
<p>这个插件用来记录过时组件的使用情况，是一个典型的「错误记录」类插件。如果有人使用了过时的函数、文件和函数参数，插件就会把它记录下来，并且同时记录下调用的地点和时间，并且在查看的时候给出代替方法，方便你去修改。</p>
<p>安装插件之后，可以在后台菜单「工具」下的「Deprecated Calls」进入日志，页面中的列表显示了记录下来的日志，并且在列表上方提供了筛选日志类型，以及可以选择哪个版本过时的日志。</p>
<p><img src="http://i.imgur.com/pPN5czC.png"></p>
<p>在开发中，我强烈建议不要使用已经过时的组件。虽然它们有很多还可以正常的工作，但是随着被标记为过时（Deprecated），说明它们已经被 WordPress 官方所抛弃，不会再被继续更新，也不如规范的方法高效；而且，如果以后想要继续扩展功能，使用大量的过时组件更会变的一团糟。</p>
<p>所以，在开发环境中安装 Log Deprecated Notices 插件，并且时常去看看吧！顺便说一句，以上的三个插件均是在 WordPress 的官方文档中提到过的，推荐安装尝试一下。</p>
<p><strong>WP Crontrol</strong></p>
<p>如果你曾经开发过需要借助定时任务完成的功能，很可能会和我产生一样的困扰，那就是：调试起来非常困难。首先，要测试好能否在各种情况下成功添加一条定时任务进入队列，还要确保定时执行的函数能够顺利完成它的任务，也得反复思考和测试各种参数是否合理，以及由此引起的性能问题。最重要的是，这些信息都不是直接摆在你面前的，需要手动翻看数据库里的各种信息，反复添加删除来测试，麻烦的让人头疼。</p>
<p>直到我发现了 WP Crontrol 插件，它是一个集「信息获取」和「调试操作」为一体的定时任务调试插件，完美的解决了上边提到的问题，能帮助我们节省大量时间，轻松调试定时任务。</p>
<p>插件的功能分两部分，分别用来管理定时任务队列和频率时间表。第一个在后台菜单「工具」下的「Cron Events」页面，可以创建、编辑和删除定时任务。</p>
<p><img src="http://i.imgur.com/bDLNV9f.png"></p>
<p>在上边插件生成的表格中，可以清楚的查看到所有现存的定时任务，我们可以直接在可视化界面编辑、立即运行或者删除掉一条任务，在开发相关功能的时候非常实用。</p>
<p>在同页面下方，可以快速创建定时任务；插件还提供了直接在网页中编写 PHP 代码，并且定时执行的功能，可以说无论是开发调试还是日常应用都是非常方便的。</p>
<p><img src="http://i.imgur.com/vBsP58E.png"></p>
<p>在后台菜单「设置」里的「Cron Schedules」页面中，可以管理定时任务的频率时间表。在这里可以查看到所有设定的频率，也能添加新的，或者一键把自定义的频率删除。</p>
<blockquote>
<p>截止文章发布时，插件的最新版本 1.3 有一个小 BUG：使用立即运行定时任务功能时，如果该定时任务本身的下次运行时间在 10 分钟之内，就不会立即运行该定时任务。</p>
</blockquote>
<blockquote>
<p>BUG 产生的原理在于：插件实现立即运行的机制是创建一个同样的定时任务，然后下次运行时间设置为当前，这样的话，如果原有定时任务和新建的定时任务相差不超过 10 分钟，WordPress 就会触发保护机制，不会重复添加时间过于相近的相同的定时任务，导致运行失败。</p>
</blockquote>
<p><strong>Plugin Toggle</strong></p>
<p>经常会有一些同学找到我，说自己的网站出现了一些不知道怎么产生的故障，这时我一般会建议他们切换回默认的主题、停用所有插件，来排查问题出在谁身上。</p>
<p>最终，大多数情况都是某些插件出现了 BUG 或者和别的什么产生了冲突，这时候只能逐一的启用插件，找出罪魁祸首。一般需要在插件列表页启用一个插件，然后再切换到出故障的页面刷新，接着再切换回插件列表页，反复循环。如果你安装的插件很多，或者网站速度比较慢，这个排查过程会非常耗时。</p>
<p>这个时候，你就需要具有「调试操作」功能的 Plugin Toggle 插件了。在安装了它之后，管理工具栏上会出现叫做「Plugins」的按钮，鼠标放上去就会弹出网站的插件列表，灰色为关闭的插件，白色是启用了的。</p>
<p><img src="http://i.imgur.com/NL43t06.png"></p>
<p>点击插件的名字，它就会自动切换开关状态，并且立即刷新页面，减少排查故障的步骤，从而节省出大量时间。</p>
<p><strong>User Switching</strong></p>
<p>在开发和用户相关的功能时，经常需要切换不同的用户来测试功能，比如功能权限是否正常，以及用户之间能否完成互动等等。来回切换不同的用户非常麻烦，需要反复的注销、登录，这时候就可以使用具有「调试操作」功能的 User Switching 插件来帮助我们。</p>
<p>在安装之后，进入后台用户列表，鼠标悬浮在要切换的用户上，点击「切换用户」就可以立即进入它的视角。</p>
<p><img src="http://i.imgur.com/rHzk4as.png"></p>
<p>测试完成之后，也可以一键切换回原来的账号。插件不仅仅可以进行用户直接的切换，还能模拟注销状态，然后在测试完成后一键登录回来。</p>
<p><img src="http://i.imgur.com/5RSd0Bd.png"></p>
<p><strong>Monster Widget</strong></p>
<p>在开发主题的小工具功能时，需要针对每个小工具写大量的 CSS 样式，我以前会花费很多时间，在后台把它们一个一个的拖动到侧边栏上并设置好，然后才能开始样式代码的编写。</p>
<p>直到我发现了 Monster Widget 插件，只要你安装了它，在后台的小工具页面就会出现一个叫做「Monster」的工具。</p>
<p><img src="http://i.imgur.com/Yt5j4PA.png"></p>
<p>把它拖动到页面，所有的小工具就都会自动出现在前台侧边栏里啦！非常方便吧，不仅不用再像一个小白一样重复做简单的拖动操作，连设置都免了，因为插件本身就自带了一套常用的设置。</p>
<p>接下来，我们就可以专心为这些工具们一个一个的编写样式了，再也不用把时间浪费在一些毫无意义的事情上，而拥有这一切，只需要安装一个叫做 Monster Widget 的插件。</p>
<p>唯一遗憾的是，插件只能帮我们把核心自带的小工具展示出来，而主题和其它插件注册的自定义小工具还需要我们手动添加和设置。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2017/07/23/GitHub-Pages-Hexo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/07/23/GitHub-Pages-Hexo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/" class="post-title-link" itemprop="url">GitHub Pages + Hexo搭建博客</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-07-23 12:55:05" itemprop="dateCreated datePublished" datetime="2017-07-23T12:55:05+08:00">2017-07-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:33" itemprop="dateModified" datetime="2020-10-11T11:53:33+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>一、 前言</strong></p>
<p>这是一篇使用GitHub Pages和Hexo搭建免费独立博客的总结。</p>
<p>我所总结的是单纯地利用GitHub Pages搭建自己独立博客的过程，并没有额外使用独立域名之类的。</p>
<p>如果是小小白，可以先花时间去了解下：</p>
<pre><code>Git
GitHub
GitHub Pages
Hexo
Markdown</code></pre>
<hr>
<p><strong>二、 必要配置</strong></p>
<p>2.1 GitHub Pages 仓库</p>
<p><strong>2.1.1 创建对应仓库</strong></p>
<p>在自己的GitHub账号下创建一个新的仓库，命名为username.github.io（username是你的账号名)。</p>
<p>在这里，要知道，GitHub Pages有两种类型：User/Organization Pages 和 Project Pages，而我所使用的是User Pages。</p>
<p>简单来说，User Pages 与 Project Pages的区别是：</p>
<p>User Pages 是用来展示用户的，而 Project Pages 是用来展示项目的。</p>
<p>用于存放 User Pages 的仓库必须使用username.github.io的命名规则，而 Project Pages 则没有特殊的要求。</p>
<p>User Pages 将使用仓库的 master 分支，而 Project Pages 将使用 gh-pages 分支。</p>
<p>User Pages 通过 http(s)://username.github.io 进行访问，而 Projects Pages通过 http(s)://username.github.io/projectname 进行访问。</p>
<p><strong>2.1.2 相关资料</strong></p>
<pre><code>GitHub Pages Basics / User, Organization, and Project Pages</code></pre>
<p>2.2 Git</p>
<p>2.2.1 安装 Git</p>
<p>在windows下安装git比较常用的有两种方式：</p>
<p>Git 官方版本的安装</p>
<pre><code>GitHub for Windows</code></pre>
<p><strong>2.2.2 配置 Git</strong></p>
<p>当安装完Git应该做的第一件事情就是设置用户名称和邮件地址。这样做很重要，因为每一个Git的提交都会使用这些信息，并且它会写入你的每一次提交中，不可更改：</p>
<pre><code>$ git config --global user.name &quot;username&quot;
$ git config --global user.email &quot;username@example.com&quot;</code></pre>
<p>对于user.email，因为在GitHub的commits信息上是可见的，所以如果你不想让人知道你的email，可以Keeping your email address private:</p>
<p>在GitHub右上方点击你的头像，选择”Settings”；</p>
<p>在右边的”Personal settings”侧边栏选择”Emails”；</p>
<p>选择”Keep my email address private”。</p>
<p>这样，你就可以使用如下格式的email进行配置：</p>
<pre><code>$ git config --global user.email &quot;username@users.noreply.github.com&quot;</code></pre>
<p>2.2.3 相关资料</p>
<pre><code>安装 Git
配置 Git
Setting your email in Git
Keeping your email address private</code></pre>
<p><strong>2.3 Git 与 GitHub</strong></p>
<hr>
<p>2.3.1 git与github的区别</p>
<p>这里，我们要区分清楚git与github。</p>
<p>git是一个版本控制的工具，而github有点类似于远程仓库，用于存放用git管理的各种项目。</p>
<pre><code>2.3.2 与github建立联系</code></pre>
<p>为了能够在本地使用git管理github上的项目，需要进行一些配置，这里介绍SSH的方法。</p>
<p>2.3.2.1 检查电脑是否已经有SSH keys。</p>
<pre><code>$ ls -al ~/.ssh
# Lists the files in your .ssh directory, if they exist</code></pre>
<p>默认情况下，public keys的文件名是以下的格式之一：id_dsa.pub、id_ecdsa.pub、id_ed25519.pub、id_rsa.pub。因此，如果列出的文件有public和private钥匙对（例如id_ras.pub和id_rsa），证明已存在SSH keys。</p>
<p><strong>2.3.2.2 如果没有SSH key，则生成新的SSH key</strong></p>
<pre><code>$ ssh-keygen -t rsa -b 4096 -C &quot;your_email@example.com&quot;
# Creates a new ssh key, using the provided email as a label</code></pre>
<p>之后一路回车即可。</p>
<p><strong>2.3.2.3 向ssh-agent添加key</strong></p>
<p>首先确保ssh-agent可运行：</p>
<pre><code># start the ssh-agent in the background
$ ssh-agent -s</code></pre>
<p>然后添加SSH key：</p>
<pre><code>$ ssh-add ~/.ssh/id_rsa</code></pre>
<p><strong>2.3.2.4 在GitHub添加SSH key</strong></p>
<p>首先，拷贝key：</p>
<pre><code>clip &lt; ~/.ssh/id_rsa.pub
# Copies the contents of the id_rsa.pub file to your cllipboard</code></pre>
<p>然后，在GitHub右上方点击头像，选择”Settings”，在右边的”Personal settings”侧边栏选择”SSH Keys”。接着粘贴key，点击”Add key”按钮。最后，测试链接：</p>
<pre><code>$ ssh -T git@github.com
# Attempts to ssh to GitHub</code></pre>
<p>如果你看到：</p>
<pre><code>The authenticity of host &#39;github.com (207.97.227.239)&#39; can&#39;t be established.
RSA key fingerprint is 16:27:ac:a5:76:28:2d:36:63:1b:56:4d:eb:df:a6:48.
Are you sure you want to continue connecting (yes/no)?</code></pre>
<p>就键入：yes。之后将会看到如下信息：</p>
<pre><code>Hi username! You&#39;ve successfully authenticated, but GitHub does not
provide shell access.</code></pre>
<p><strong>2.3.3 相关资料</strong></p>
<p>Generating SSH keys</p>
<hr>
<p><strong>2.4 Hexo</strong></p>
<p><strong>2.4.1 安装Hexo</strong></p>
<p>安装Hexo相当简单。在安装之前，必须检查电脑中是否已经安装下列应用程序：</p>
<pre><code>Node.js
Git</code></pre>
<p>如果您的电脑中已经安装上述必备程序，那么恭喜您！接下来只需要使用 npm 即可完成 Hexo 的安装。</p>
<pre><code>$ npm install -g hexo-cli</code></pre>
<p><strong>2.4.2 使用Hexo建站</strong></p>
<p>安装完后，在你喜欢的文件夹内（例如D：\Hexo），点击鼠标右键选择Git bash，输入以下指令：</p>
<pre><code>$ hexo init</code></pre>
<p>该命令会在目标文件夹内建立网站所需要的所有文件。接下来是安装依赖包：</p>
<pre><code>$ npm install</code></pre>
<p>这样，我们就已经搭建起本地的Hexo博客了。可以先执行以下命令（在对应文件夹下），然后再浏览器输入localhost:4000查看。</p>
<pre><code>$ hexo generate
$ hexo server</code></pre>
<p>这个博客只是本地的，别人是浏览不了的，之后需要部署到GitHub上。</p>
<p><strong>2.4.3 相关资料</strong></p>
<p>Hexo 官方文档</p>
<p>三、一般的搭建方法</p>
<p>在上面，我们已经配置好了所需的所有东西，也成功地搭建了一个本地Hexo博客。现在，需要使用GitHub Pages搭建一个别人能够访问的Hexo博客了。</p>
<p>3.1 使用默认theme</p>
<p>我们继续使用上面的文件夹D:\Hexo（也可以新建一个文件夹重新生成），然后编辑该文件夹下的_config.yml。</p>
<p>默认生成的_config.yml：</p>
<pre><code># Deployment
## Docs: http://hexo.io/docs/deployment.html
deploy:
  type:</code></pre>
<p>修改后的_config.yml：</p>
<pre><code>deploy:
  type: git
  repo: 对应仓库的SSH地址（可以在GitHub对应的仓库中复制）
  branch: 分支（User Pages为master，Project Pages为gh-pages）</code></pre>
<p>为了能够使Hexo部署到GitHub上，需要安装一个插件：</p>
<pre><code>$ npm install hexo-deployer-git --save</code></pre>
<p>然后，执行下列指令即可完成部署：</p>
<pre><code>$ hexo generate
$ hexo deploy</code></pre>
<p>之后，可以通过在浏览器键入：username.github.io进行浏览，开心吧~</p>
<p><strong>3.2 其他theme</strong></p>
<p>如果想要使用其他主题，可以使用git clone将别人的主题拷贝到D:\Hexo\themes下，然后将_config.yml中的theme: landscape改为对应的主题名字。</p>
<p>详细步骤可以参考网上的指南。</p>
<hr>
<p><strong>四、 优化部署与管理</strong></p>
<p><strong>4.1 概述</strong></p>
<p>Hexo部署到GitHub上的文件，是.md（你的博文）转化之后的.html（静态网页）。因此，当你重装电脑或者想在不同电脑上修改博客时，就不可能了。</p>
<p>其实，Hexo生成的网站文件中有.gitignore文件，因此它的本意也是想我们将Hexo生成的网站文件存放到GitHub上进行管理的（而不是用U盘或者云备份）。这样，不仅解决了上述的问题，还可以通过git的版本控制追踪你的博文的修改过程，是极赞的。</p>
<p>但是，如果每一个GitHub Pages都需要创建一个额外的仓库来存放Hexo网站文件，会很麻烦。</p>
<p>所以，我利用了分支！！！</p>
<p>简单地说，每个想建立GitHub Pages的仓库，起码有两个分支，一个用来存放Hexo网站的文件，一个用来发布网站。</p>
<p>下面以我的博客作为例子详细地讲述。</p>
<p><strong>4.2 我的博客搭建流程</strong></p>
<p>创建仓库，helongquan.github.io；</p>
<p>创建两个分支：master 与 hexo；</p>
<p>设置hexo为默认分支（因为我们只需要手动管理这个分支上的Hexo网站文件）；</p>
<p>使用git clone <a href="mailto:&#103;&#105;&#116;&#x40;&#x67;&#105;&#116;&#x68;&#x75;&#x62;&#46;&#99;&#x6f;&#x6d;">&#103;&#105;&#116;&#x40;&#x67;&#105;&#116;&#x68;&#x75;&#x62;&#46;&#99;&#x6f;&#x6d;</a>:helongquan/helongquan.github.io.git拷贝仓库；</p>
<p>在本地helongquan.github.io文件夹下通过Git bash依次执行npm install hexo、hexo init、npm install 和 npm install hexo-deployer-git（此时当前分支应显示为hexo）;</p>
<p>修改_config.yml中的deploy参数，分支应为master；</p>
<p>依次执行git add .、git commit -m “…”、git push origin hexo提交网站相关的文件；</p>
<p>执行hexo generate -d生成网站并部署到GitHub上。</p>
<p>这样一来，在GitHub上的helongquan.github.io仓库就有两个分支，一个hexo分支用来存放网站的原始文件，一个master分支用来存放生成的静态网页。</p>
<p><strong>4.3 我的博客管理流程</strong></p>
<p><strong>4.3.1 日常修改</strong></p>
<p>在本地对博客进行修改（添加新博文、修改样式等等）后，通过下面的流程进行管理：</p>
<p>依次执行git add .、git commit -m “…”、git push origin hexo指令将改动推送到GitHub（此时当前分支应为hexo）；</p>
<p>然后才执行<code>hexo generate -d</code>发布网站到master分支上。</p>
<p>虽然两个过程顺序调转一般不会有问题，不过逻辑上这样的顺序是绝对没问题的（例如突然死机要重装了，悲催….的情况，调转顺序就有问题了）。</p>
<p><strong>4.3.2 本地资料丢失</strong></p>
<p>当重装电脑之后，或者想在其他电脑上修改博客，可以使用下列步骤：</p>
<p>使用git clone <a href="mailto:&#103;&#105;&#x74;&#x40;&#x67;&#105;&#x74;&#104;&#117;&#98;&#x2e;&#99;&#x6f;&#x6d;">&#103;&#105;&#x74;&#x40;&#x67;&#105;&#x74;&#104;&#117;&#98;&#x2e;&#99;&#x6f;&#x6d;</a>:helongquan/helongquan.github.io.git拷贝仓库（默认分支为hexo）；<br>在本地新拷贝的helongquan.github.io文件夹下通过Git bash依次执行下列指令：npm install hexo、npm install、npm install hexo-deployer-git（记得，不需要hexo init这条指令）。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2017/07/23/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%80%9A%E8%BF%87%E4%B8%80%E9%94%AEweb%E5%AE%89%E8%A3%85%E5%90%8E%E5%AE%89%E8%A3%85WCDP%E7%9A%84%E9%BB%98%E8%AE%A4%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/07/23/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%80%9A%E8%BF%87%E4%B8%80%E9%94%AEweb%E5%AE%89%E8%A3%85%E5%90%8E%E5%AE%89%E8%A3%85WCDP%E7%9A%84%E9%BB%98%E8%AE%A4%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/" class="post-title-link" itemprop="url">云服务器通过一键web安装后安装WCDP的默认登录信息是什么？</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-07-23 10:57:33" itemprop="dateCreated datePublished" datetime="2017-07-23T10:57:33+08:00">2017-07-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:52:50" itemprop="dateModified" datetime="2020-10-11T11:52:50+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一般情况下Linux服务器都是黑麻麻一片的，对于很多人来说都不太习惯操作，事实上，通过为服务器安装一个WDCP是可以对服务器进行一个可视化的管理，方便了操作，具体怎么安装WDCP这个我就不多说了，我已经写了一些教程，今天就说一点，当我们安装好WDCP后，通过访问地址：<a href="http://ip:8080，就可以访问到服务器的WDCP界面，然后这个登录账号密码是什么呢？我们不知道，默认登录信息如下：">http://ip:8080，就可以访问到服务器的WDCP界面，然后这个登录账号密码是什么呢？我们不知道，默认登录信息如下：</a></p>
<pre><code>账号名：admin
密码：wdlinux.cn</code></pre>
<p>我们登录后，可以在WDCP后台修改，切记一定要修改，不然，别人可以通过默认的账号密码登录你的服务器的。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2017/07/21/WordPress%E5%BC%95%E5%85%A5css-js%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/07/21/WordPress%E5%BC%95%E5%85%A5css-js%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">WordPress引入css/js两种方法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-07-21 11:36:09" itemprop="dateCreated datePublished" datetime="2017-07-21T11:36:09+08:00">2017-07-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:09" itemprop="dateModified" datetime="2020-10-11T11:53:09+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>WordPress引入css/js 是我们制作主题时首先面对的一个难点，任何一款主题都要加载自己的css,js,甚至很有可能还需要加载Jquery文件,网上方法特多，说法不一，我们今天借鉴wordpress官方最新的twentysixteen主题来学习总结一下WordPress引入css/js各种常用方法，以及最优化的加载方法。</p>
</blockquote>
<p><strong>其实网上的N种方法总结起来就两种：</strong></p>
<p>一、模板文件header.php中直接引入文件</p>
<p>二、在主题的functions.php中通过WP自带的函数wp_enqueue_scripts来加载JS文件，通过<code>wp_enqueue_style</code>来加载Css样式</p>
<p>1、模板文件header.php中直接引入文件</p>
<p>这是最好懂，最直白，最不好的方法在模板文件header.php中直接引入文件</p>
<pre><code>&lt;script type=&#39;text/javascript&#39; src=&#39;http://www.jquery.com/js/jquery/1.10.2/jquery-1.10.2.min.js&#39;&gt;&lt;/script&gt;
&lt;script type=&#39;text/javascript&#39; src=&#39;http://www.511yj.com/css/bootstrapwp.js&#39;&gt;&lt;/script&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;http://www.511yj.com/css/bootstrapwp.css&quot;&gt;</code></pre>
<p>你觉得这样很无聊的话，还可以这样</p>
<pre><code>&lt;link rel=&quot;stylesheet&quot; href=&quot;&lt;?php echo get_template_directory_uri(); ?&gt;/style.css&quot;&gt;
&lt;script src=&quot;&lt;?php echo get_template_directory_uri(); ?&gt;/bootstrap/js/bootstrap.js&quot;&gt;&lt;/script&gt;</code></pre>
<p>通过函数<code>get_template_directory_uri()</code>获得主题目录 通过echo输出。</p>
<p><strong>注意啦以下方法虽然放在了functions.php中，表面感觉好了点……</strong></p>
<pre><code>&lt;?php
 function add_stylesheet_to_head() &#123;
    echo &quot;&lt;link href=&#39;http://fonts.useso.com/css?family=Open+Sans:300,400,600&amp;subset=latin,latin-ext&#39; rel=&#39;stylesheet&#39;&gt;&quot;;
&#125;
 add_action( &#39;wp_head&#39;, &#39;add_stylesheet_to_head&#39; );
?&gt;</code></pre>
<p>但是WordPress 不能确定是否在在页面加载了JS，Css文件，如果另一个插件使用相同的JS，Css文件，就无法检查JS，Css文件是否已经被包含在页面中。然后插件第二次加载同一个文件，造成重复的代码，响应速度变慢。</p>
<p><strong>二、引入WordPress优化解决方案：注册和排队</strong></p>
<p>1、注册</p>
<p><code>wp_register_style()</code> 函数进行注册：</p>
<pre><code>&lt;?php wp_register_style( $handle, $src, $deps, $ver, $media ); ?&gt;</code></pre>
<p>参数：<br>$handle（字符串，必需）是你的样式表唯一名称。其他函数将使用这个“handle”来排队并打印样式表。</p>
<p>$src（字符串，必需）指的是样式表的URL。您可以使用函数，如 get_template_directory_uri() 来获取主题目录中的样式文件。永远不要去想硬编码了！</p>
<p>$deps （数组，可选）处理相关样式的名称。如果丢失某些其他样式文件将导致你的样式表将无法正常工作，你可以使用该参数设置“依赖关系”。</p>
<p>$ver （字符串或布尔型，可选）版本号。你可以使用你的主题的版本号或任何一个你想要的。如果您不希望使用一个版本号，将其设置为null。默认为false，这使得WordPress的添加自己的版本号。</p>
<p>$media （字符串，可选）是指CSS的媒体类型，比如“screen”或“handheld”或“print”。如果你不知道是否需要使用这个，那就不使用它。默认为“all”。</p>
<p><strong>例子：</strong></p>
<pre><code>wp_register_style(
    &#39;my-bootstrap-extension&#39;, // 名称
    get_template_directory_uri() . &#39;/css/my-bootstrap-extension.css&#39;, // 样式表的路径
    array( &#39;bootstrap-main&#39; ), // 依存的其他样式表
    &#39;1.2&#39;, // 版本号
    &#39;screen&#39;, // CSS 媒体类型
);</code></pre>
<p><code>wp_register_style()</code> 函数进行注册：</p>
<pre><code>&lt;?php wp_enqueue_script( $handle, $src, $deps, $ver, $in_footer ); ?&gt;</code></pre>
<p><strong>参数</strong></p>
<p>$handle（字符串）（必需）脚本名称。小写字符串。默认值：None</p>
<p>$src（字符串）（可选）WordPress根目录下的脚本路径示例：”/wp-includes/js/scriptaculous/scriptaculous.js”。该参数只在WordPress不了解脚本情况时使用。默认值：None</p>
<p>$deps（数组）（可选）脚本所依靠的句柄组成的数组；加载该脚本前需要加载的其它脚本。若没有依赖关系，返回false。该参数只在WordPress不了解脚本情况时使用。默认值：array()</p>
<p>$ver（字符串）（可选）指明脚本版本号的字符串（若存在版本号）。默认为false。该参数可确保即使在启用缓存的状态下，发送给客户端的仍然是正确版本，因此如果版本号可用且对脚本有意义，包含该版本号。默认值：false</p>
<p>$in_footer（布尔型）（可选）通常情况下脚本会被放置在区块中。如果该函数为true，脚本则会出现在区块的最下方。要求主题在适当的位置中包含有wp_footer()钩子。（WordPress新功能）默认值：false</p>
<p><strong>例子：</strong></p>
<pre><code>&lt;?php
function my_enqueue_scripts() &#123;
if( !is_admin ) &#123; // 前台加载的脚本与样式表
// 去除已注册的 jquery 脚本
wp_deregister_script( &#39;jquery&#39; );
// 注册 jquery 脚本
wp_register_script( &#39;jquery&#39;, get_template_directory_uri() . &#39;/js/jquery.js&#39;, false, &#39;1.0&#39;, false );
// 提交加载 jquery 脚本
wp_enqueue_script( &#39;jquery&#39; );
 &#125; 
&#125; 
// 添加回调函数到 init 动作上
add_action( &#39;init&#39;, &#39;my_enqueue_scripts&#39; );
?&gt;</code></pre>
<p>当css/js很多，并且要分情况加载时，需要使用<code>wp_register_script()</code>和<code>wp_register_style()</code>函数，可以更好的管理资源，避免重复劳动。下面的示例代码中，先在<code>init action</code>上把所有需要用到样式表都注册一遍，之后不管想在哪里引入，都可以简单的用<code>wp_enqueue_style( $handle )</code>来加载。</p>
<pre><code>// 在init action处注册脚本，可以与其它逻辑代码放在一起
function my_init()&#123;
    $url = get_template_directory_uri();
    // 注册样式表
    $styles = array(
        &#39;style1&#39; =&gt; $url . &#39;/css/style1.css&#39;,
        &#39;style2&#39; =&gt; $url . &#39;/css/style2.css&#39;,
        &#39;style3&#39; =&gt; $url . &#39;/css/style3.css&#39;
    );
     foreach( $styles as $k =&gt; $v )&#123;
        wp_register_style( $k, $v, false );
    &#125; 
    // 注册脚本     
    // 其它需要在init action处运行的脚本
&#125;
add_action( &#39;init&#39;, &#39;my_init&#39; );</code></pre>
<p>注册脚本时需要运行<code>$wp_scripts-&gt;add( $handle, $src, $deps, $ver )</code>;，若脚本没有注册直接使用<code>wp_enqueue_script</code>，需要先调用add方法，也就是说重复enqueue一个脚本就会运行多次add方法，降低了程序的效率。</p>
<p>在WordPress中，注册样式是“可选的”。如果你的样式不会被其他插件使用，或者你不打算使用任何代码来再次加载它，你可以自由地排队样式而不需要注册它。继续看看它是如何实现的。</p>
<p><strong>2、排队</strong></p>
<p><code>wp_register_style()</code> 函数是不强制使用的，我要告诉你，你可以用两种不同的方式使用<code>wp_enqueue_style()</code>：</p>
<pre><code>&lt;?php
 // 如果我们之前已经注册过样式
wp_enqueue_style( &#39;my-bootstrap-extension&#39; ); 
// 如果我们之前没有注册，我们不得不设置 $src 参数！
wp_enqueue_style(
    &#39;my-bootstrap-extension&#39;,
    get_template_directory_uri() . &#39;/css/my-bootstrap-extension.css&#39;,
    array( &#39;bootstrap-main&#39; ),
    null, // 举例不适用版本号
    // ...并且没有指定CSS媒体类型
); 
?&gt;</code></pre>
<p>切记：如果一个插件将要用到你的样式表，或者你打算将在你的主题的不同地方进行加载，你绝对应该先注册。</p>
<p><strong>3、加载样式到我们的网站</strong></p>
<p>我们不能在主题中随便找个地方使用 wp_enqueue_style() 函数 - 我们需要使用“动作”钩子。还有我们可以使用各种用途的三个动作钩子：</p>
<pre><code>wp_enqueue_scripts 用来在网站前台加载脚本和CSS
admin_enqueue_scripts 用来在后台加载脚本和CSS
login_enqueue_scripts 用来在WP登录页面加载脚本和CSS</code></pre>
<p>以下是这些钩子的示例：</p>
<pre><code>&lt;?php
 // 在网站前台加载css
function mytheme_enqueue_style() &#123;
    wp_enqueue_style( &#39;mytheme-style&#39;, get_stylesheet_uri() ); 
&#125;
add_action( &#39;wp_enqueue_scripts&#39;, &#39;mytheme_enqueue_style&#39; );

// 在后台加载css
function mytheme_enqueue_options_style() &#123;
    wp_enqueue_style( &#39;mytheme-options-style&#39;, get_template_directory_uri() . &#39;/css/admin.css&#39; ); 
&#125;
add_action( &#39;admin_enqueue_scripts&#39;, &#39;mytheme_enqueue_options_style&#39; );

// 在登录页面加载css
function mytheme_enqueue_login_style() &#123;
    wp_enqueue_style( &#39;mytheme-options-style&#39;, get_template_directory_uri() . &#39;/css/login.css&#39; ); 
&#125;
add_action( &#39;login_enqueue_scripts&#39;, &#39;mytheme_enqueue_login_style&#39; );
?&gt;</code></pre>
<p><strong>4、另外一个函数：wp_print_scripts()</strong></p>
<p>虽然将 JavaScript 文件都放到页面末尾加载对于页面加载速度很有帮助，但是请注意，所谓页面末尾指的是在 WordPress 的 <code>wp_footer()</code>函数中调用，这个函数通常刚好位于页面的 标签前面（当然是末尾了）。</p>
<p>有时候我们可能会在 wp_footer 函数出现之前就需要用到某些 JavaScript，比如 jquery.js 文件。</p>
<p>这样的情况也是很常见的。比如我单独创建了一个链接页面，在这个页面中我使用了 jQuery 方法来获取链接网站的 favicon。很显然，我只需要在这唯一一个页面使用这部分代码，所以将这段代码直接放在这个页面模板中是最好的做法。</p>
<p>问题来了：这部分内容显然是在<code>wp_footer</code>之前出现的，那么这段代码就在 jquery.js 文件之前出现了，导致该代码段实际上无法工作，因为调用 jQuery 方法的代码段必须比 jquery.js 文件后加载。</p>
<p>那么如何处理这种特殊情况呢？其实也很简单。以上面的情景为例，既然我们需要先调用 jquery.js 文件，那我们就在该代码段之前直接输出需要的 jquery.js 文件，不使用 <code>wp_enqueue_script()</code> 函数，而改用<code>wp_print_scripts() </code>函数。</p>
<p><code>wp_enqueue_script() </code>与 <code>wp_print_scripts()</code> 的区别是：<code>wp_enqueue_script()</code> 是告诉 WordPress “我在这个页面上需要用到某个 JavaScript 文件，你可要记得加载啊”。WordPress 默认在 <code>wp_head()</code> 中处理，而我们改为在 <code>wp_footer()</code> 中处理。<code>wp_print_scripts()</code> 则直接在你使用此方法的位置输出需要的 JavaScript 文件，而不是加入到 WordPress 的处理任务中。<br>如果我们在页面的中间使用，</p>
<pre><code>&lt;?php wp_print_scripts(&#39;jquery&#39;); ?&gt;</code></pre>
<p>直接输出了 jquery.js 文件（通常是其压缩版本 jquery.min.js），那么即使其它的插件或者什么东西使用，</p>
<pre><code>&lt;?php wp_enqueue_script(&#39;jquery&#39;); ?&gt;</code></pre>
<p>告诉 WordPress 需要加载 jquery.js，WordPress 在 wp_footer() 中处理的时候也会先检查前面是不是已经有了，如果有了就不会再重新加载一次。</p>
<p><strong>5、一些额外的函数</strong></p>
<p>WordPress 有一些关于 CSS 非常有用的函数：他们允许我们打印内嵌样式，查看样式文件的排队状态，添加元数据以及注销样式。</p>
<p>添加动态内联样式：<code>wp_add_inline_style()</code></p>
<p>如果你的主题有选项可自定义主题的样式，你可以使用 wp_add_inline_style() 函数来打印内置的样式：</p>
<pre><code>function mytheme_custom_styles() &#123;
    wp_enqueue_style( &#39;custom-style&#39;, get_template_directory_uri() . &#39;/css/custom-style.css&#39; );
    $bold_headlines = get_theme_mod( &#39;headline-font-weight&#39; ); // 比方说，它的值是粗体“bold”
    $custom_inline_style = &#39;.headline &#123; font-weight: &#39; . $bold_headlines . &#39;; &#125;&#39;;
    wp_add_inline_style( &#39;custom-style&#39;, $custom_inline_style );
&#125;
add_action( &#39;wp_enqueue_scripts&#39;, &#39;mytheme_custom_styles&#39; );</code></pre>
<p>方便快捷。但请记住：你必须使用与后面要添加的内联样式样式表相同的handle名称。</p>
<p>添加元数据到样式表：<code>wp_style_add_data()</code></p>
<p><code>wp_style_add_data() </code>是一个非常棒的函数，它可以让你添加元数据到你的样式中，包括条件注释、RTL的支持和更多！</p>
<pre><code>&lt;?php
// wp_style_add_data() 示例
function mytheme_extra_styles() &#123;
    wp_enqueue_style( &#39;mytheme-ie&#39;, get_template_directory_uri() . &#39;/css/ie.css&#39; );
    wp_style_add_data( &#39;mytheme-ie&#39;, &#39;conditional&#39;, &#39;lt IE 9&#39; );
    /*
     * alternate usage:
     * $GLOBALS[&#39;wp_styles&#39;]-&gt;add_data( &#39;mytheme-ie&#39;, &#39;conditional&#39;, &#39;lte IE 9&#39; );
     * wp_style_add_data() is cleaner, though.
     */
&#125;

add_action( &#39;wp_enqueue_scripts&#39;, &#39;mytheme_ie_style&#39; );

?&gt;</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2017/07/21/wordpress%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E5%A4%96%E9%83%A8js%E5%92%8Ccss%E6%A0%B7%E5%BC%8F%E6%96%87%E4%BB%B6%E7%9A%84%E5%BC%95%E5%85%A5%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/07/21/wordpress%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E5%A4%96%E9%83%A8js%E5%92%8Ccss%E6%A0%B7%E5%BC%8F%E6%96%87%E4%BB%B6%E7%9A%84%E5%BC%95%E5%85%A5%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">wordpress插件开发中的外部js和css样式文件的引入问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-07-21 10:46:37" itemprop="dateCreated datePublished" datetime="2017-07-21T10:46:37+08:00">2017-07-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:14" itemprop="dateModified" datetime="2020-10-11T11:53:14+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>这篇文章主要是为了解决以前我开发的一个插件，本来呢，在本地服务器上测试是没问题的，但是放在线上的网站测试就有问题，每次激活插件的时候，就提示“有133个异常输出，xxx”,看着就特别着急。于是我开始了一系列的修复工作，打开数据库发现异常的字段，是由于我引入外部样式或者是外部的js文件的时候，采用的是这样方式：</p>
<pre><code>echo &#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&#39;.$url.&#39;wp-content/plugins/helgqu_totop/custom.css&quot; /&gt;&#39;;</code></pre>
<p>这样导致异常输出。事实上引入外部样式也有这样另外的方式，就是使用 <code>wp_head</code> 函数。<code>wp_head</code> 函数用来输出一些自定义或者系统定义的内容，我们有时候会使用下面代码引用文件：</p>
<pre><code>&lt;?php
    add_action(&#39;wp_head&#39;, &#39;wpjam_normal_script&#39;);
    function wpjam_normal_script() &#123;
    echo &#39;资源文件的链接&#39;;
    &#125;
?&gt;</code></pre>
<p>将上面代码复制到 functions.php 文件中，即可引用对应的文件。这种方法没错，但是存在潜在的风险。</p>
<p><strong>WordPress 的排队引用（Enqueue Scripts）资源机制</strong></p>
<hr>
<p>这是重点要说的方法，在 WordPress 中引用资源，应该使用 <code>wp_enqueue_script</code> 这个函数，函数名中有个单词 enqueue 是排队或者排序的意思。众所周知，WordPress 有很多的插件，几乎每个插件都会引用一些资源文件，难免会有两个插件引用的资源发生冲突等，这样会变得不稳定而且可能会影响效率。</p>
<p>使用这种方式引用，和对应文件以及核心代码分离的，如果用户想要禁用某个资源，直接删除、修改、注释掉即可，而不需要从核心代码中修改。</p>
<p>此外，WordPress 中内置了一些常用的库（例如 jQuery、jQuery UI 等），我们可以使用 <code>wp_enqueue_script</code> 这个函数直接调用内置库，可以节约代码量，更加清晰规范。内置的已经定义库的列表和标识符（handle）请点击<a target="_blank" rel="noopener" href="http://codex.wordpress.org/Function_Reference/wp_register_script#Handles_and_Their_Script_Paths_Registered_by_WordPress">这里查看</a>。</p>
<p>如果使用这个函数来引用自己的 JS 和 CSS 文件，首先需要使用 <code>wp_register_script</code> 这个函数注册一个标识（handle），然后使用 <code>wp_enqueue_script</code> 函数调取这个标志对应的资源。</p>
<p><strong>WordPress 合理引入 JS 和 CSS 的方法</strong></p>
<hr>
<p>可以使用下面代码为你的插件引入 plugin.css 文件。</p>
<pre><code>&lt;?php
// 添加外部样式
function wpjam_add_styles_2() &#123;
  wp_register_style(&#39;plugin_stylesheet_2&#39;, plugins_url(&#39;css/bootstrap.min.css&#39;, __FILE__));
  wp_enqueue_style(&#39;plugin_stylesheet_2&#39;);
&#125;
add_action( &#39;wp_enqueue_scripts&#39;, &#39;wpjam_add_styles_2&#39; );   
?&gt;</code></pre>
<p>如果是多个的话，就像这样添加：</p>
<pre><code>&lt;?php
// 添加外部样式
function wpjam_add_styles_2() &#123;
  wp_register_style(&#39;plugin_stylesheet_2&#39;, plugins_url(&#39;css/bootstrap.min.css&#39;, __FILE__));
  wp_enqueue_style(&#39;plugin_stylesheet_2&#39;);
&#125;
add_action( &#39;wp_enqueue_scripts&#39;, &#39;wpjam_add_styles_2&#39; ); 

function wpjam_add_styles_3() &#123;
  wp_register_style(&#39;plugin_stylesheet_3&#39;, plugins_url(&#39;css/jumbotron-narrow.css&#39;, __FILE__));
  wp_enqueue_style(&#39;plugin_stylesheet_3&#39;);
&#125;
add_action( &#39;wp_enqueue_scripts&#39;, &#39;wpjam_add_styles_3&#39; );
?&gt;</code></pre>
<p>这样就被正确的引入了样式表文件，这里我先说下插件的文件结构如下：</p>
<p><img src="http://i.imgur.com/ns5Mf7e.png"></p>
<p>上面先用 <code>wp_register_style</code> 函数创建了一个标识符为 plugin_stylesheet 的资源，随后将其排队请求添加到 <code>wp_enqueue_style action</code> 中。</p>
<p>很显然 <code>wp_register_script</code> 函数它可以有五个参数：</p>
<ul>
<li>$handle：资源标识符，供 wp_enqueue_script 调用。</li>
<li>$src：资源的位置。相对地址或者绝对地址或者使用 WordPress 内置的函数获取地址等。常用定位函数有 plugins_url、get_template_directory_uri 等。</li>
<li>$deps：依赖关系。如果引用的是 jQuery 插件，需要依赖 jQuery 组建，那么就需要填写上 jQuery。注意，以数组的形式传递。</li>
<li>$ver：资源版本，可选的。</li>
<li>$in_footer：是否放在底部。一般来说，JS 文件要放在页面的底部，就可以设置这个参数为 True，留空或者 False 会输出到顶部。</li>
</ul>
<p><strong>下面看一个引用 JavaScript 文件的比较完整的例子：</strong></p>
<pre><code>&lt;?php
function wpjam_add_scripts_5() &#123;
  wp_register_script(&#39;nocti_plugin_script_5&#39;, plugins_url(&#39;js/anchor.js&#39;, __FILE__), array(&#39;jquery&#39;),&#39;1.1&#39;, true);
  wp_enqueue_script(&#39;nocti_plugin_script_5&#39;);
&#125;
add_action( &#39;wp_enqueue_scripts&#39;, &#39;wpjam_add_scripts_5&#39; );
?&gt;</code></pre>
<p>如果想要引用多个javascript，那么直接这样引入：</p>
<pre><code>&lt;?php
function wpjam_add_scripts_5() &#123;
  wp_register_script(&#39;nocti_plugin_script_5&#39;, plugins_url(&#39;js/anchor.js&#39;, __FILE__), array(&#39;jquery&#39;),&#39;1.1&#39;, true);
  wp_enqueue_script(&#39;nocti_plugin_script_5&#39;);
&#125;
add_action( &#39;wp_enqueue_scripts&#39;, &#39;wpjam_add_scripts_5&#39; ); 

function wpjam_add_scripts_6() &#123;
  wp_register_script(&#39;nocti_plugin_script_6&#39;, plugins_url(&#39;js/jquery.full-search.js&#39;, __FILE__));
  wp_enqueue_script(&#39;nocti_plugin_script_6&#39;);
&#125;
add_action( &#39;wp_enqueue_scripts&#39;, &#39;wpjam_add_scripts_6&#39; );
?&gt;</code></pre>
<p><strong>在 WordPress 主题开发中使用 wp_enqueue_script 引入资源</strong></p>
<p>上面的例子都是以插件开发引用资源为例，在主题中引用的方法相似，主要的区别就在于使用对应的函数获取主题目录从而得到主题下面的资源文件地址。</p>
<p>可以使用 <a target="_blank" rel="noopener" href="http://codex.wordpress.org/Function_Reference/get_template_directory_uri">get_template_directory_uri</a> 这个函数来获取当前主题的目录，如果你使用的是子主题，那么需要使用 <a target="_blank" rel="noopener" href="http://codex.wordpress.org/Function_Reference/get_stylesheet_directory_uri">get_stylesheet_directory_uri</a> 这个函数来获取父主题的目录从而得到对应资源。</p>
<p>这个问题就是我目前要解决的两个插件开发过程中引入外部文件的方法，旨在修正过去低级粗糙的开发方式。</p>
<p>我这里给出一个案例：为wordpress的某个页面添加一个插件并且对这个页面进行单页搜索，当然如果你直接用浏览器的ctrl+f我绝对支持你这么做，因为这个插件没有这种方式人性化，但它是我迈出新的一步，后面会继续改善。</p>
<p>页面的html代码：</p>
<pre><code>&lt;div class=&quot;container&quot;&gt;
        &lt;div class=&quot;row marketing&quot;&gt;
            &lt;div class=&quot;col-lg-12&quot; id=&quot;result-list&quot;&gt;
                &lt;h4 id=&quot;a&quot;&gt;javascript前言&lt;/h4&gt;
                &lt;p&gt;一直在学习javascript，也有看过《犀利开发Jquery内核详解与实践》，对这本书的评价只有两个字犀利，可能是对javascript理解的还不够透彻异或是自己太笨，更多的是自己不擅于思考懒得思考以至于里面说的一些精髓都没有太深入的理解。 鉴于想让自己有一个提升，进不了一个更加广阔的天地，总得找一个属于自己的居所好好生存，所以平时会有意无意的去积累一些使用jQuerry的常用知识，特别是对于性能要求这一块，总是会想是不是有更好的方式来实现。 下面是我总结的一些小技巧，仅供参考。(我先会说一个总标题，然后用一小段话来说明这个意思 再最后用一个demo来简单言明)
                &lt;/p&gt;
                &lt;h4 id=&quot;b&quot;&gt;避免全局查找&lt;/h4&gt;
                &lt;p&gt;在一个函数中会用到全局对象存储为局部变量来减少全局查找，因为访问局部变量的速度要比访问全局变量的速度更快些
                    &lt;pre&gt;
                            function search() &#123;
                                //当我要使用当前页面地址和主机域名
                                alert(window.location.href + window.location.host);
                            &#125;
                            //最好的方式是如下这样  先用一个简单变量保存起来
                            function search() &#123;
                                var location = window.location;
                                alert(location.href + location.host);
                            &#125;
                    &lt;/pre&gt;
                &lt;/p&gt;
                &lt;h4 id=&quot;c&quot;&gt;定时器&lt;/h4&gt;
                &lt;p&gt;
                    如果针对的是不断运行的代码，不应该使用setTimeout，而应该是用setInterval，因为setTimeout每一次都会初始化一个定时器，而setInterval只会在开始的时候初始化一个定时器
                    &lt;pre&gt;
                      var timeoutTimes = 0;
                         function timeout() &#123;
                             timeoutTimes++;
                             if (timeoutTimes &lt; 10) &#123;
                                 setTimeout(timeout, 10);
                             &#125;
                         &#125;
                         timeout();
                         //可以替换为：
                         var intervalTimes = 0;
                         function interval() &#123;
                             intervalTimes++;
                             if (intervalTimes &gt;= 10) &#123;
                                 clearInterval(interv);
                             &#125;
                         &#125;
                         var interv = setInterval(interval, 10);
                    &lt;/pre&gt;
                &lt;/p&gt;
                &lt;h4 id=&quot;e&quot;&gt;字符串连接&lt;/h4&gt;
                &lt;p&gt;
                    如果要连接多个字符串，应该少使用+=，如 s+=a; s+=b; s+=c; 应该写成s+=a + b + c； 而如果是收集字符串，比如多次对同一个字符串进行+=操作的话，最好使用一个缓存，使用JavaScript数组来收集，最后使用join方法连接起来
                    &lt;pre&gt;
                      var buf = [];
                          for (var i = 0; i &lt; 100; i++) &#123;
                              buf.push(i.toString());
                          &#125;
                          var all = buf.join(&quot;&quot;);
                    &lt;/pre&gt;
                &lt;/p&gt;
                &lt;h4&gt;避免with语句&lt;/h4&gt;
                &lt;p&gt;和函数类似 ，with语句会创建自己的作用域，因此会增加其中执行的代码的作用域链的长度，由于额外的作用域链的查找，在with语句中执行的代码肯定会比外面执行的代码要慢，在能不使用with语句的时候尽量不要使用with语句。
                    &lt;pre&gt;
                      with (a.b.c.d) &#123;
                                property1 = 1;
                                property2 = 2;
                            &#125;
                            //可以替换为：
                            var obj = a.b.c.d;
                            obj.property1 = 1;
                            obj.property2 = 2;
                    &lt;/pre&gt;
                &lt;/p&gt;
                &lt;h4 id=&quot;f&quot;&gt;各种类型转换&lt;/h4&gt;
                &lt;p&gt;
                &lt;pre&gt;
                  var myVar = &quot;3.14159&quot;,
                  str = &quot;&quot; + myVar, //  to string
                  i_int = ~ ~myVar,  //  to integer
                  f_float = 1 * myVar,  //  to float
                  b_bool = !!myVar,  /*  to boolean - any string with length
                                          and any number except 0 are true */
                  array = [myVar];  //  to array
                  &lt;/pre&gt;
                &lt;/p&gt;
                &lt;h4 id=&quot;g&quot;&gt;多个类型声明&lt;/h4&gt;
                &lt;p&gt;在JavaScript中所有变量都可以使用单个var语句来声明，这样就是组合在一起的语句，以减少整个脚本的执行时间，就如上面代码一样，上面代码格式也挺规范，让人一看就明了。
                &lt;/p&gt;
                &lt;div id=&quot;h&quot;&gt;
                    &lt;p&gt;
                        博客从最初的域名购买，到上线已经有四年的时间了，这四年的时间，有笑过，有怨过，有悔过，有执着过，也有放弃过…但最后还是坚持了下来，时间如此匆匆，等再回过头已来不及去弥补… 其实蛮遗憾的，话说这四年，并不是很专注于它，起初的建立是因为“面子”，一个网页设计师怎能没有一个属于自己的博客网站，域名几番斟酌选了yangqq(唯一用心的选了域名)，选好后，草草的用了两天时间，设计了一个简单的博客模板，接下来用了漏洞百出的asp程序(自己瞎改)，从网上copy了很多文章，放到网站上，就这样，我满心欢喜…博客从此也就搁置了。就像玩拼图，趁着三分热度和新奇，一鼓作气完成了，就随意的丢在犄角旮旯了，再也没有兴趣…
                    &lt;/p&gt;
                &lt;/div&gt;
                &lt;div id=&quot;i&quot;&gt;
                    &lt;p&gt;
                        直到我要利用它，博客搭建半年的时间，更新一两次，但是文章都乱七八糟，不是原创，偶尔会写写心情。从内容上来说，还是可以了。就这样，我骄傲的自以为是，拿着这样一个博客网站还有曾经做过的企业政府网站案例去朋友推荐的大公司应聘，最后我被无情的拒绝了，好在他们的技术人员也认真看了我的博客，告知我应该多注重div，css…其实我也有点儿不服气，甚至有点儿恼羞成怒，对他们说，“我诚心加入，既然你们不需要，那这就是你们的损失！”
                    &lt;/p&gt;
                &lt;/div&gt;
                &lt;div id=&quot;j&quot;&gt;
                    &lt;p&gt;
                        那一次应聘，给了我狠狠的一击，也就这样，我删掉了曾经被我copy过来的文章，重新开始…不再那么自以为是，认认真真的研究，做好每一次的案例。两年的时间，博客也有些起色和人气…
                    &lt;/p&gt;
                &lt;/div&gt;
                &lt;div id=&quot;k&quot;&gt;
                    &lt;p&gt;
                        虽说我这博客起初搭建一分钱没花，但这么长时间了，渐渐有了想再利用它赚钱的想法，放了一些联盟广告，因为访问量不高，收入非常可怜，甚至是没有点击量！干脆就撤了广告，再后来，注重优化，目的还是拉广告，效果也很好，收到了好多email，5块钱一个广告文字链接，一个月的广告收入不到60块钱，自诩有人看得上也不错了，可是再怎么审核的链接，跟博客类型不一样，同样属于垃圾链接，就这样的恶性循环，我的网站被百度降权，整整一个月都没有排名...
                    &lt;/p&gt;
                &lt;/div&gt;
                &lt;div id=&quot;l&quot;&gt;
                    &lt;p&gt;
                        找到这个问题，广告链接到期后就没有再续，又一次重新开始。不仅仅是换模板，程序也换。总结了很多程序，最终选择了当初我认为最难拿捏的帝国cms。asp虽然熟悉好控制，但是漏洞太多，经常被挂彩！wordpress也用过，但是加载的插件确实太多，响应时间慢，关键是百度只收录首页！！之所以说用帝国也是被逼的，是因为起初我也就是怕难，总是找各种各样的理由，不去研究，后来老老实实花了几天时间认真看教程后，才觉得其实并不难，难得就是不突破自己那一关去学习，去接受！
                    &lt;/p&gt;
                &lt;/div&gt;
                &lt;div id=&quot;m&quot;&gt;
                    &lt;p&gt;
                        现在也又很多新手不知道怎么使用模板，也不知道用什么程序。每一次问到我用什么程序的时候，其实蛮纠结的，我想推荐你们使用帝国吧，但是10个人里面有9个人都说难，而且以为装了帝国，套上模板组就可以使用了，于是问题就一个接一个来了，其实只要认真看教程，没有那么多问题....“认真看教程！”同样的话，我也不知道说了多少遍了，听进去的人也是少数，又想用，又怕难，又不学，唉，着实着急啊....通常你如果还这样的话，我劝你放弃使用帝国吧！
                    &lt;/p&gt;
                &lt;/div&gt;
                &lt;div id=&quot;n&quot;&gt;
                    &lt;p&gt;
                        话题又扯远了，博客使用帝国cms后，因为全静态页面，百度收录很快，首页“个人博客”关键词排名也上来了，第一页有时候能搜索出来，就这样，二三页的徘徊，我就开始琢磨怎么样排到前三名。仔细研究排前三位的博客代码，还有关键字词。他们的首页结构都没有我做得好，甚至还用最原始的table布局。但是它的首页关键词优化的不错，于是仿着他们的title和关键词，做了首页的修改。仍然没有起色，反而降了，又怎么办呢？得找吸引人的地方，个人博客如果不是想自己个人欣赏，那最好学会分享，哪有人会天天来关注你这些琐碎的生活片段…
                    &lt;/p&gt;
                &lt;/div&gt;
                &lt;div id=&quot;o&quot;&gt;
                    &lt;p&gt;
                        于是我的博客多了个栏目，把自己擅长做得，喜欢的模板分享出来。没想到效果很明显，就连2000人的QQ群都不够用了…就这样坚持到现在，偶尔更新文章和分享模板，博客的权重，访问量都在一点一点增长，有人说我的博客不怎么更新，为什么权重还那么高？我说“文章贵在精，而不在多”。曾经我天天更新文章，但都是伪原创，自认为付出了那么多，肯定得有回报，其实不然。每天一篇伪原创还不及我一个月一篇原创文章效果好，因“站”而异吧。如果你每天都有自己的原创文章，那值得提倡，像我这种绞尽脑汁都出不了一个主题的，还是规矩的定时更新就行啦…
                    &lt;/p&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;</code></pre>
<p>大家可能不知道，它的原始样本是这样的：</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;zh&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge,chrome=1&quot;&gt; 
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
  &lt;title&gt;单页面文字搜索定位&lt;/title&gt;
  &lt;link href=&quot;css/bootstrap.min.css&quot;  type=&quot;text/css&quot; rel=&quot;stylesheet&quot;&gt;
  &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/htmleaf-demo.css&quot;&gt;
  &lt;link href=&quot;css/jumbotron-narrow.css&quot; rel=&quot;stylesheet&quot;&gt;
  &lt;!--[if IE]&gt;
    &lt;script src=&quot;http://libs.useso.com/js/html5shiv/3.7/html5shiv.min.js&quot;&gt;&lt;/script&gt;
  &lt;![endif]--&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class=&quot;container&quot;&gt;
    &lt;div class=&quot;header clearfix&quot;&gt;
      &lt;h3 class=&quot;text-muted&quot;&gt;Full text search&lt;/h3&gt;
    &lt;/div&gt;
    &lt;div class=&quot;jumbotron&quot;&gt;
      &lt;form&gt;
        &lt;div class=&quot;form-group form-group-search&quot;&gt;
          &lt;h1&gt;&lt;label for=&quot;exampleInputEmail1&quot;&gt;搜索内容&lt;/label&gt;&lt;/h1&gt;
          &lt;input type=&quot;search&quot; class=&quot;form-control&quot; id=&quot;search&quot; placeholder=&quot;请输入本页面内容&quot;&gt;
          &lt;div class=&quot;search-result&quot; style=&quot;display:none&quot;&gt;
            &lt;h4&gt;标题&lt;/h4&gt;
            &lt;ul class=&quot;result-section&quot;&gt;
              &lt;li&gt;&lt;a href=&quot;&quot;&gt;dsfsdfsdf&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;&quot;&gt;sdfsdf&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
            &lt;h4&gt;内容&lt;/h4&gt;
            &lt;ul class=&quot;result-content&quot;&gt;
              &lt;li&gt;&lt;a href=&quot;&quot;&gt;sdfsdf&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;&quot;&gt;sdfsd&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/form&gt;
      &lt;p class=&quot;lead&quot;&gt;单页面全文搜索插件，支持瞄点跳转，依赖Jquery、bootstrap。&lt;/p&gt;
    &lt;/div&gt;
    &lt;div class=&quot;row marketing&quot;&gt;
      &lt;div class=&quot;col-lg-12&quot; id=&quot;result-list&quot;&gt;
        &lt;h4 id=&quot;a&quot;&gt;javascript前言&lt;/h4&gt;
        &lt;p&gt;一直在学习javascript，也有看过《犀利开发Jquery内核详解与实践》，对这本书的评价只有两个字犀利，可能是对javascript理解的还不够透彻异或是自己太笨，更多的是自己不擅于思考懒得思考以至于里面说的一些精髓都没有太深入的理解。 鉴于想让自己有一个提升，进不了一个更加广阔的天地，总得找一个属于自己的居所好好生存，所以平时会有意无意的去积累一些使用jQuerry的常用知识，特别是对于性能要求这一块，总是会想是不是有更好的方式来实现。 下面是我总结的一些小技巧，仅供参考。(我先会说一个总标题，然后用一小段话来说明这个意思
          再最后用一个demo来简单言明)
        &lt;/p&gt;
        &lt;h4 id=&quot;b&quot;&gt;避免全局查找&lt;/h4&gt;
        &lt;p&gt;在一个函数中会用到全局对象存储为局部变量来减少全局查找，因为访问局部变量的速度要比访问全局变量的速度更快些
          &lt;pre&gt;
        function search() &#123;
            //当我要使用当前页面地址和主机域名
            alert(window.location.href + window.location.host);
        &#125;
        //最好的方式是如下这样  先用一个简单变量保存起来
        function search() &#123;
            var location = window.location;
            alert(location.href + location.host);
        &#125;
&lt;/pre&gt;
        &lt;/p&gt;
        &lt;h4 id=&quot;c&quot;&gt;定时器&lt;/h4&gt;
        &lt;p&gt;
          如果针对的是不断运行的代码，不应该使用setTimeout，而应该是用setInterval，因为setTimeout每一次都会初始化一个定时器，而setInterval只会在开始的时候初始化一个定时器
          &lt;pre&gt;
  var timeoutTimes = 0;
     function timeout() &#123;
         timeoutTimes++;
         if (timeoutTimes &lt; 10) &#123;
             setTimeout(timeout, 10);
         &#125;
     &#125;
     timeout();
     //可以替换为：
     var intervalTimes = 0;
     function interval() &#123;
         intervalTimes++;
         if (intervalTimes &gt;= 10) &#123;
             clearInterval(interv);
         &#125;
     &#125;
     var interv = setInterval(interval, 10);
&lt;/pre&gt;
        &lt;/p&gt;
        &lt;h4 id=&quot;e&quot;&gt;字符串连接&lt;/h4&gt;
        &lt;p&gt;
          如果要连接多个字符串，应该少使用+=，如 s+=a; s+=b; s+=c; 应该写成s+=a + b + c； 而如果是收集字符串，比如多次对同一个字符串进行+=操作的话，最好使用一个缓存，使用JavaScript数组来收集，最后使用join方法连接起来
          &lt;pre&gt;
  var buf = [];
      for (var i = 0; i &lt; 100; i++) &#123;
          buf.push(i.toString());
      &#125;
      var all = buf.join(&quot;&quot;);
&lt;/pre&gt;
        &lt;/p&gt;
        &lt;h4&gt;避免with语句&lt;/h4&gt;
        &lt;p&gt;和函数类似 ，with语句会创建自己的作用域，因此会增加其中执行的代码的作用域链的长度，由于额外的作用域链的查找，在with语句中执行的代码肯定会比外面执行的代码要慢，在能不使用with语句的时候尽量不要使用with语句。
          &lt;pre&gt;
  with (a.b.c.d) &#123;
            property1 = 1;
            property2 = 2;
        &#125;
        //可以替换为：
        var obj = a.b.c.d;
        obj.property1 = 1;
        obj.property2 = 2;
&lt;/pre&gt;
        &lt;/p&gt;
        &lt;h4 id=&quot;f&quot;&gt;各种类型转换&lt;/h4&gt;
        &lt;p&gt;&lt;pre&gt;
          var myVar = &quot;3.14159&quot;,
        str = &quot;&quot; + myVar, //  to string
        i_int = ~ ~myVar,  //  to integer
        f_float = 1 * myVar,  //  to float
        b_bool = !!myVar,  /*  to boolean - any string with length
                                and any number except 0 are true */
        array = [myVar];  //  to array
        &lt;/pre&gt;&lt;/p&gt;
        &lt;h4 id=&quot;g&quot;&gt;多个类型声明&lt;/h4&gt;
        &lt;p&gt;在JavaScript中所有变量都可以使用单个var语句来声明，这样就是组合在一起的语句，以减少整个脚本的执行时间，就如上面代码一样，上面代码格式也挺规范，让人一看就明了。
        &lt;/p&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;script src=&quot;http://libs.useso.com/js/jquery/1.9.1/jquery.min.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
  &lt;script&gt;window.jQuery || document.write(&#39;&lt;script src=&quot;js/jquery-1.9.1.min.js&quot;&gt;&lt;\/script&gt;&#39;)&lt;/script&gt;
  &lt;script type=&quot;text/javascript&quot; src=&quot;js/anchor.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery.full-search.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot;&gt;
      $(function() &#123;
        $(&#39;#search&#39;).fullsearch(&#123;
          highlight: true,
          search_data: &quot;.search-result&quot;,
          search_title: &quot;.result-section&quot;,
          search_content: &quot;.result-content&quot;,
          list: &quot;#result-list&quot;,
          nodata: &quot;未找到相关数据&quot;,
        &#125;);
      &#125;);
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>好了，然后我就把其中的js和css抽离出来，写成一个悬浮插件，内容就是页面的内容，不过这里有个很大的缺陷，细心的人可能会发现，我在每个div那里都添加了一个id，主要是为了跳转，实现锚点定位。当我们把这个插件用在了一个陌生的网站的时候，我们不可能每个页面都要这样去添加id和class，还有就是能够响应查询内容只能在id为result-list的这个div中的内容。所以缺陷是存在的。我的下一个目标是能否直接不管页面的内容是什么直接把查询范围设定为整个页面，而且不需要每个区块都要添加id。</p>
<p>这也是我打算开发一个单页搜索直接定位的插件，有待改善，下载地址：<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1jIQhopg">点这里</a>，密码：qk8i。为了能够更好的理解这个原理，大家可以参考我另一篇文章：<a href="http://helongquan.github.io/2017/07/20/%E5%9F%BA%E4%BA%8Ebootstrap%E7%9A%84%E5%8D%95%E9%A1%B5%E6%90%9C%E7%B4%A2%E6%96%B9%E6%A1%88/">基于bootstrap的单页搜索方案</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2017/07/20/%E5%9F%BA%E4%BA%8Ebootstrap%E7%9A%84%E5%8D%95%E9%A1%B5%E6%90%9C%E7%B4%A2%E6%96%B9%E6%A1%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/07/20/%E5%9F%BA%E4%BA%8Ebootstrap%E7%9A%84%E5%8D%95%E9%A1%B5%E6%90%9C%E7%B4%A2%E6%96%B9%E6%A1%88/" class="post-title-link" itemprop="url">基于bootstrap的单页搜索方案</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-07-20 15:07:32" itemprop="dateCreated datePublished" datetime="2017-07-20T15:07:32+08:00">2017-07-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:01" itemprop="dateModified" datetime="2020-10-11T11:53:01+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一款基于Bootstrap的单页面文字搜索jQuery插件。通过搜索关键字，插件会在下拉列表中高亮列出关键字和所在的各个段落，用户点击相应的搜索下拉列表项即可跳转到相应的地方。</p>
<p><strong>适用方法</strong></p>
<p>使用该文字搜索插件需要在页面中引入Bootstrap相关文件，以及jQuery和jquery.full-search.js文件，为了实现瞄点跳转，还需要引入anchor.js文件。</p>
<pre><code>&lt;link href=&quot;css/bootstrap.min.css&quot;  type=&quot;text/css&quot; rel=&quot;stylesheet&quot;&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery.min.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;js/anchor.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery.full-search.js&quot;&gt;&lt;/script&gt;</code></pre>
<p>** HTML结构**</p>
<p>你可以创建一个<code>&lt;input&gt;</code>元素用于制作搜索框。</p>
<pre><code>&lt;input type=&quot;search&quot; class=&quot;form-control&quot; id=&quot;search&quot; placeholder=&quot;请输入本页面内容&quot;&gt;</code></pre>
<p>然后创建一个搜索列表的HTML模板。</p>
<pre><code>&lt;div class=&quot;search-result&quot; style=&quot;display:none&quot;&gt;
  &lt;h4&gt;标题&lt;/h4&gt;
  &lt;ul class=&quot;result-section&quot;&gt;
    &lt;li&gt;&lt;a href=&quot;&quot;&gt;dsfsdfsdf&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;&quot;&gt;sdfsdf&lt;/a&gt;&lt;/li&gt;

  &lt;/ul&gt;
  &lt;h4&gt;内容&lt;/h4&gt;
  &lt;ul class=&quot;result-content&quot;&gt;
    &lt;li&gt;&lt;a href=&quot;&quot;&gt;sdfsdf&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;&lt;a href=&quot;&quot;&gt;sdfsd&lt;/a&gt;&lt;/li&gt;

  &lt;/ul&gt;
&lt;/div&gt; </code></pre>
<p>最后将你需要进行搜索的内容放入一个带唯一ID号的容器中。</p>
<pre><code>&lt;div class=&quot;col-lg-12&quot; id=&quot;result-list&quot;&gt;
  &lt;!-- 可对以下内容中的文字进行搜索 --&gt;
  &lt;h4 id=&quot;a&quot;&gt;Lorem ipsum dolor sit amet&lt;/h4&gt;
  &lt;p&gt;......&lt;/p&gt;

  &lt;h4 id=&quot;b&quot;&gt;Morbi fermentum&lt;/h4&gt;
  &lt;p&gt;......&lt;/p&gt;

  ...

&lt;/div&gt;</code></pre>
<p><strong>初始化插件</strong></p>
<p>在页面DOM元素加载完毕之后，可以通过fullsearch()方法来初始化该文字搜索插件。</p>
<pre><code>$(&#39;#search&#39;).fullsearch(&#123;
  highlight: true,
  search_data: &quot;.search-result&quot;,
  search_title: &quot;.result-section&quot;,
  search_content: &quot;.result-content&quot;,
  list: &quot;#result-list&quot;,
  nodata: &quot;没有找到相关数据&quot;
&#125;);</code></pre>
<p><strong>配置参数</strong></p>
<pre><code>highlight：是否高亮搜索关键字。
search_data：搜索结果存放的容器的class类。
search_title：搜索的标题容器。
search_content：搜索的结果容器。
list：要进行搜索的容器。
nodata：没有找到结果时的提示文本。</code></pre>
<p>这里我需要补充一些非常重要的东西：</p>
<p>最开始我发现了一下问题，为了充分的测试这个效果，我把很多内容添加在了这个html页面中，然后开始在前面的搜索框中搜索我后面添加的内容，可是无论我怎么输入都是没法搜索出来，这让我很郁闷，于是开始找，排查了各种原因后，发现在这个参数的配置这里找到了灵感。我需要说下，我完整的代码是这样的：</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;zh&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge,chrome=1&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;单页面文字搜索定位&lt;/title&gt;
    &lt;link href=&quot;css/bootstrap.min.css&quot; type=&quot;text/css&quot; rel=&quot;stylesheet&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/htmleaf-demo.css&quot;&gt;
    &lt;link href=&quot;css/jumbotron-narrow.css&quot; rel=&quot;stylesheet&quot;&gt;
    &lt;!--[if IE]&gt;
    &lt;script src=&quot;http://libs.useso.com/js/html5shiv/3.7/html5shiv.min.js&quot;&gt;&lt;/script&gt;
  &lt;![endif]--&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;div class=&quot;jumbotron&quot;&gt;
            &lt;form&gt;
                &lt;div class=&quot;form-group form-group-search&quot;&gt;
                    &lt;h1&gt;&lt;label for=&quot;exampleInputEmail1&quot;&gt;搜索内容&lt;/label&gt;&lt;/h1&gt;
                    &lt;input type=&quot;search&quot; class=&quot;form-control&quot; id=&quot;search&quot; placeholder=&quot;请输入本页面内容&quot;&gt;
                    &lt;div class=&quot;search-result&quot; style=&quot;display:none&quot;&gt;
                        &lt;h4&gt;标题&lt;/h4&gt;
                        &lt;ul class=&quot;result-section&quot;&gt;
                            &lt;li&gt;&lt;a href=&quot;&quot;&gt;dsfsdfsdf&lt;/a&gt;&lt;/li&gt;
                            &lt;li&gt;&lt;a href=&quot;&quot;&gt;sdfsdf&lt;/a&gt;&lt;/li&gt;
                        &lt;/ul&gt;
                        &lt;h4&gt;内容&lt;/h4&gt;
                        &lt;ul class=&quot;result-content&quot;&gt;
                            &lt;li&gt;&lt;a href=&quot;&quot;&gt;sdfsdf&lt;/a&gt;&lt;/li&gt;
                            &lt;li&gt;&lt;a href=&quot;&quot;&gt;sdfsd&lt;/a&gt;&lt;/li&gt;
                        &lt;/ul&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/form&gt;
            &lt;p class=&quot;lead&quot;&gt;单页面全文搜索插件，支持瞄点跳转，依赖Jquery、bootstrap。&lt;/p&gt;
        &lt;/div&gt;
        &lt;div class=&quot;row marketing&quot;&gt;
            &lt;div class=&quot;col-lg-12&quot; id=&quot;result-list&quot;&gt;
                &lt;h4 id=&quot;a&quot;&gt;javascript前言&lt;/h4&gt;
                &lt;p&gt;一直在学习javascript，也有看过《犀利开发Jquery内核详解与实践》，对这本书的评价只有两个字犀利，可能是对javascript理解的还不够透彻异或是自己太笨，更多的是自己不擅于思考懒得思考以至于里面说的一些精髓都没有太深入的理解。 鉴于想让自己有一个提升，进不了一个更加广阔的天地，总得找一个属于自己的居所好好生存，所以平时会有意无意的去积累一些使用jQuerry的常用知识，特别是对于性能要求这一块，总是会想是不是有更好的方式来实现。 下面是我总结的一些小技巧，仅供参考。(我先会说一个总标题，然后用一小段话来说明这个意思 再最后用一个demo来简单言明)
                &lt;/p&gt;
                &lt;h4 id=&quot;b&quot;&gt;避免全局查找&lt;/h4&gt;
                &lt;p&gt;在一个函数中会用到全局对象存储为局部变量来减少全局查找，因为访问局部变量的速度要比访问全局变量的速度更快些
                    &lt;pre&gt;
                            function search() &#123;
                                //当我要使用当前页面地址和主机域名
                                alert(window.location.href + window.location.host);
                            &#125;
                            //最好的方式是如下这样  先用一个简单变量保存起来
                            function search() &#123;
                                var location = window.location;
                                alert(location.href + location.host);
                            &#125;
                    &lt;/pre&gt;
                &lt;/p&gt;
                &lt;h4 id=&quot;c&quot;&gt;定时器&lt;/h4&gt;
                &lt;p&gt;
                    如果针对的是不断运行的代码，不应该使用setTimeout，而应该是用setInterval，因为setTimeout每一次都会初始化一个定时器，而setInterval只会在开始的时候初始化一个定时器
                    &lt;pre&gt;
                      var timeoutTimes = 0;
                         function timeout() &#123;
                             timeoutTimes++;
                             if (timeoutTimes &lt; 10) &#123;
                                 setTimeout(timeout, 10);
                             &#125;
                         &#125;
                         timeout();
                         //可以替换为：
                         var intervalTimes = 0;
                         function interval() &#123;
                             intervalTimes++;
                             if (intervalTimes &gt;= 10) &#123;
                                 clearInterval(interv);
                             &#125;
                         &#125;
                         var interv = setInterval(interval, 10);
                    &lt;/pre&gt;
                &lt;/p&gt;
                &lt;h4 id=&quot;e&quot;&gt;字符串连接&lt;/h4&gt;
                &lt;p&gt;
                    如果要连接多个字符串，应该少使用+=，如 s+=a; s+=b; s+=c; 应该写成s+=a + b + c； 而如果是收集字符串，比如多次对同一个字符串进行+=操作的话，最好使用一个缓存，使用JavaScript数组来收集，最后使用join方法连接起来
                    &lt;pre&gt;
                      var buf = [];
                          for (var i = 0; i &lt; 100; i++) &#123;
                              buf.push(i.toString());
                          &#125;
                          var all = buf.join(&quot;&quot;);
                    &lt;/pre&gt;
                &lt;/p&gt;
                &lt;h4&gt;避免with语句&lt;/h4&gt;
                &lt;p&gt;和函数类似 ，with语句会创建自己的作用域，因此会增加其中执行的代码的作用域链的长度，由于额外的作用域链的查找，在with语句中执行的代码肯定会比外面执行的代码要慢，在能不使用with语句的时候尽量不要使用with语句。
                    &lt;pre&gt;
                      with (a.b.c.d) &#123;
                                property1 = 1;
                                property2 = 2;
                            &#125;
                            //可以替换为：
                            var obj = a.b.c.d;
                            obj.property1 = 1;
                            obj.property2 = 2;
                    &lt;/pre&gt;
                &lt;/p&gt;
                &lt;h4 id=&quot;f&quot;&gt;各种类型转换&lt;/h4&gt;
                &lt;p&gt;
                &lt;pre&gt;
                  var myVar = &quot;3.14159&quot;,
                  str = &quot;&quot; + myVar, //  to string
                  i_int = ~ ~myVar,  //  to integer
                  f_float = 1 * myVar,  //  to float
                  b_bool = !!myVar,  /*  to boolean - any string with length
                                          and any number except 0 are true */
                  array = [myVar];  //  to array
                  &lt;/pre&gt;
                &lt;/p&gt;
                &lt;h4 id=&quot;g&quot;&gt;多个类型声明&lt;/h4&gt;
                &lt;p&gt;在JavaScript中所有变量都可以使用单个var语句来声明，这样就是组合在一起的语句，以减少整个脚本的执行时间，就如上面代码一样，上面代码格式也挺规范，让人一看就明了。
                &lt;/p&gt;
                &lt;div&gt;
                    &lt;p&gt;
                        博客从最初的域名购买，到上线已经有四年的时间了，这四年的时间，有笑过，有怨过，有悔过，有执着过，也有放弃过…但最后还是坚持了下来，时间如此匆匆，等再回过头已来不及去弥补… 其实蛮遗憾的，话说这四年，并不是很专注于它，起初的建立是因为“面子”，一个网页设计师怎能没有一个属于自己的博客网站，域名几番斟酌选了yangqq(唯一用心的选了域名)，选好后，草草的用了两天时间，设计了一个简单的博客模板，接下来用了漏洞百出的asp程序(自己瞎改)，从网上copy了很多文章，放到网站上，就这样，我满心欢喜…博客从此也就搁置了。就像玩拼图，趁着三分热度和新奇，一鼓作气完成了，就随意的丢在犄角旮旯了，再也没有兴趣…
                    &lt;/p&gt;
                &lt;/div&gt;
                &lt;div&gt;
                    &lt;p&gt;
                        直到我要利用它，博客搭建半年的时间，更新一两次，但是文章都乱七八糟，不是原创，偶尔会写写心情。从内容上来说，还是可以了。就这样，我骄傲的自以为是，拿着这样一个博客网站还有曾经做过的企业政府网站案例去朋友推荐的大公司应聘，最后我被无情的拒绝了，好在他们的技术人员也认真看了我的博客，告知我应该多注重div，css…其实我也有点儿不服气，甚至有点儿恼羞成怒，对他们说，“我诚心加入，既然你们不需要，那这就是你们的损失！”
                    &lt;/p&gt;
                &lt;/div&gt;
                &lt;div&gt;
                    &lt;p&gt;
                        那一次应聘，给了我狠狠的一击，也就这样，我删掉了曾经被我copy过来的文章，重新开始…不再那么自以为是，认认真真的研究，做好每一次的案例。两年的时间，博客也有些起色和人气…
                    &lt;/p&gt;
                &lt;/div&gt;
                &lt;div&gt;
                    &lt;p&gt;
                        虽说我这博客起初搭建一分钱没花，但这么长时间了，渐渐有了想再利用它赚钱的想法，放了一些联盟广告，因为访问量不高，收入非常可怜，甚至是没有点击量！干脆就撤了广告，再后来，注重优化，目的还是拉广告，效果也很好，收到了好多email，5块钱一个广告文字链接，一个月的广告收入不到60块钱，自诩有人看得上也不错了，可是再怎么审核的链接，跟博客类型不一样，同样属于垃圾链接，就这样的恶性循环，我的网站被百度降权，整整一个月都没有排名...
                    &lt;/p&gt;
                &lt;/div&gt;
                &lt;div&gt;
                    &lt;p&gt;
                        找到这个问题，广告链接到期后就没有再续，又一次重新开始。不仅仅是换模板，程序也换。总结了很多程序，最终选择了当初我认为最难拿捏的帝国cms。asp虽然熟悉好控制，但是漏洞太多，经常被挂彩！wordpress也用过，但是加载的插件确实太多，响应时间慢，关键是百度只收录首页！！之所以说用帝国也是被逼的，是因为起初我也就是怕难，总是找各种各样的理由，不去研究，后来老老实实花了几天时间认真看教程后，才觉得其实并不难，难得就是不突破自己那一关去学习，去接受！
                    &lt;/p&gt;
                &lt;/div&gt;
                &lt;div&gt;
                    &lt;p&gt;
                        现在也又很多新手不知道怎么使用模板，也不知道用什么程序。每一次问到我用什么程序的时候，其实蛮纠结的，我想推荐你们使用帝国吧，但是10个人里面有9个人都说难，而且以为装了帝国，套上模板组就可以使用了，于是问题就一个接一个来了，其实只要认真看教程，没有那么多问题....“认真看教程！”同样的话，我也不知道说了多少遍了，听进去的人也是少数，又想用，又怕难，又不学，唉，着实着急啊....通常你如果还这样的话，我劝你放弃使用帝国吧！
                    &lt;/p&gt;
                &lt;/div&gt;
                &lt;div&gt;
                    &lt;p&gt;
                        话题又扯远了，博客使用帝国cms后，因为全静态页面，百度收录很快，首页“个人博客”关键词排名也上来了，第一页有时候能搜索出来，就这样，二三页的徘徊，我就开始琢磨怎么样排到前三名。仔细研究排前三位的博客代码，还有关键字词。他们的首页结构都没有我做得好，甚至还用最原始的table布局。但是它的首页关键词优化的不错，于是仿着他们的title和关键词，做了首页的修改。仍然没有起色，反而降了，又怎么办呢？得找吸引人的地方，个人博客如果不是想自己个人欣赏，那最好学会分享，哪有人会天天来关注你这些琐碎的生活片段…
                    &lt;/p&gt;
                &lt;/div&gt;
                &lt;div&gt;
                    &lt;p&gt;
                        于是我的博客多了个栏目，把自己擅长做得，喜欢的模板分享出来。没想到效果很明显，就连2000人的QQ群都不够用了…就这样坚持到现在，偶尔更新文章和分享模板，博客的权重，访问量都在一点一点增长，有人说我的博客不怎么更新，为什么权重还那么高？我说“文章贵在精，而不在多”。曾经我天天更新文章，但都是伪原创，自认为付出了那么多，肯定得有回报，其实不然。每天一篇伪原创还不及我一个月一篇原创文章效果好，因“站”而异吧。如果你每天都有自己的原创文章，那值得提倡，像我这种绞尽脑汁都出不了一个主题的，还是规矩的定时更新就行啦…
                    &lt;/p&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;script src=&quot;js/jquery-1.9.1.min.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
    window.jQuery || document.write(&#39;&lt;script src=&quot;js/jquery-1.9.1.min.js&quot;&gt;&lt;\/script&gt;&#39;)
    &lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;js/anchor.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery.full-search.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot;&gt;
    $(function() &#123;
        $(&#39;#search&#39;).fullsearch(&#123;
            highlight: true,
            search_data: &quot;.search-result&quot;,
            search_title: &quot;.result-section&quot;,
            search_content: &quot;.result-content&quot;,
            list: &quot;#result-list&quot;,
            nodata: &quot;未找到相关数据&quot;,
        &#125;);
    &#125;);
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>最开始我的代码并不是这样的，才导致问题发生了，发生在哪里呢？</p>
<p>在这里：<code>&lt;div class=&quot;col-lg-12&quot; id=&quot;result-list&quot;&gt;</code>，最开始我把新添加的那些博客文字，添加到了这个div的外面，就是没有被这个div所包含，所以，我新添加的内容成为不在搜索范围的内容了，自然就会在输入框输入文字的时候不被索引到。细心的你也许发现了这个玄机，在代码：</p>
<pre><code>&lt;script type=&quot;text/javascript&quot;&gt;
    $(function() &#123;
        $(&#39;#search&#39;).fullsearch(&#123;
            highlight: true,
            search_data: &quot;.search-result&quot;,
            search_title: &quot;.result-section&quot;,
            search_content: &quot;.result-content&quot;,
            list: &quot;#result-list&quot;,
            nodata: &quot;未找到相关数据&quot;,
        &#125;);
    &#125;);
&lt;/script&gt;</code></pre>
<p>中已经很明确的指出了要搜索的区域，<code>list:&quot;#result-list&quot;</code>就是这里，我们可以设置其他的，只要一一对应div中的id即可，还有一个问题就是，标题和内容的锚点设置，看下面：</p>
<pre><code>&lt;h4 id=&quot;c&quot;&gt;定时器&lt;/h4&gt;

&lt;h4 id=&quot;e&quot;&gt;字符串连接&lt;/h4&gt;
...</code></pre>
<p>这些都添加了id,目的就是为了能够在搜索显示的列表中，点击直接移动到目标位置。所以，尽管我添加了一些文本，但是我的文本所在的div没有添加id，所以我在搜索的时候，即使搜索出来了，点击后还是不能跳转到目标的位置的。</p>
<p>当然，这个还有很多改善的空间，而且实用型不是特别大，因此，相比于直接通过浏览器进行搜索的便利性来说，这个还是有点差别的。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2017/07/15/%E9%80%9A%E8%BF%87javascript%E5%BC%95%E5%85%A5%E5%A4%96%E9%83%A8layer-js%E8%84%9A%E6%9C%AC%E8%BF%90%E7%94%A8%E5%9C%A8wordpress%E6%9F%90%E4%B8%AA%E9%A1%B5%E9%9D%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/07/15/%E9%80%9A%E8%BF%87javascript%E5%BC%95%E5%85%A5%E5%A4%96%E9%83%A8layer-js%E8%84%9A%E6%9C%AC%E8%BF%90%E7%94%A8%E5%9C%A8wordpress%E6%9F%90%E4%B8%AA%E9%A1%B5%E9%9D%A2/" class="post-title-link" itemprop="url">通过javascript引入外部layer.js脚本运用在wordpress某个页面</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-07-15 12:08:45" itemprop="dateCreated datePublished" datetime="2017-07-15T12:08:45+08:00">2017-07-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:52:55" itemprop="dateModified" datetime="2020-10-11T11:52:55+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在开始琢磨研究着把优秀的第三方库引用到wordpress平台的过程中，我尝试了多种方法，全局引用，局部引用，为什么这么折腾自己，我仅仅是为了满足日益变化的客户需求而做的小设计。</p>
<p>这篇文章的中心是围绕引入外部layer.js，而不是硬生生的把layer这个文件放进网站的文件夹里去，也不是硬生生的把js的引用放进header.php文件里，而是通过javascript的方式在某个页面进行引用，好了直接上代码：</p>
<pre><code>&lt;script&gt;
  document.write(&quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;http://www.habotalk.com/hlq_layer/hlq_layer.js\&quot;&gt;&quot;+ &quot;&lt;\/script&gt;&quot;);
&lt;/script&gt;</code></pre>
<p>在我的测试页面所在的域名不是<a target="_blank" rel="noopener" href="http://www.habotalk.com,请记住!/">www.habotalk.com，请记住！</a></p>
<p>然后我添加我的目标元素，给他们添加两张图片吧，然后在添加图片所在的区块设置一个ID，这个必须的，id设置为nocti_layer-photos，</p>
<p>好的，然后在图片区域的最后面，或者页面的最后面添加一个自定义的js代码：</p>
<pre><code>&lt;script&gt;          
    layer.photos(&#123;          
     photos: &#39;#nocti_layer-photos&#39;          
     ,anim: 5 //0-6的选择，指定弹出图片动画类型          
    &#125;);           
&lt;/script&gt;</code></pre>
<p>整体结构如下：</p>
<p><img src="http://i.imgur.com/i8BZYWd.jpg"></p>
<p>很清楚了吧，我的写作目标永远是把读者定位到中低级别的。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2017/07/15/wordpress%E4%B8%AD%E7%A7%BB%E6%A4%8Dlayer%E7%9A%84%E7%9B%B8%E5%86%8C%E5%BC%B9%E7%AA%97%E5%8A%9F%E8%83%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/07/15/wordpress%E4%B8%AD%E7%A7%BB%E6%A4%8Dlayer%E7%9A%84%E7%9B%B8%E5%86%8C%E5%BC%B9%E7%AA%97%E5%8A%9F%E8%83%BD/" class="post-title-link" itemprop="url">wordpress中运用layer和swiper相结合实现图片轮播和弹窗功能以及相关的问题解决方案</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-07-15 10:42:25" itemprop="dateCreated datePublished" datetime="2017-07-15T10:42:25+08:00">2017-07-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:58:02" itemprop="dateModified" datetime="2020-10-11T11:58:02+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>这是我写的又一篇关于wordpress和layer联姻的博客了，今天的主题是相册功能，通俗的说就是，在wordpress中引用layer的特性，达到wordpress自身所不具备的功能，增强wordpress网站的表达能力和显示能力。</p>
<p>跟前面一样先引入layer这个文件夹，然后进行一个调用，这里我进行了一项大胆的尝试，用javascript动态的添加id和属性，让原本不具备layer相册功能，变得具备了相册功能。</p>
<p>预期效果是这样的：</p>
<p><img src="http://i.imgur.com/MXyFott.jpg"></p>
<p>我新建了一个测试页面，放了三张图片，在一个区块下进行测试，并且为这个区块设了一个ID为<code>layer-photos-demo</code>。代码如下：</p>
<pre><code>&lt;script&gt;
    window.onload=function()&#123;
    var mec=document.getElementById(&#39;layer-photos-demo&#39;).setAttribute(&#39;class&#39;,&#39;layer-photos-demo&#39;);
    var nocti_img_1=document.getElementById(&#39;layer-photos-demo&#39;).querySelectorAll(img)[0].setAttribute(&#39;layer-pid&#39;,&#39;nocti_img_demo_1&#39;);
    var nocti_img_1=document.getElementById(&#39;layer-photos-demo&#39;).querySelectorAll(img)[0].setAttribute(&#39;layer-src&#39;,&#39;http://nocti.spartanya.com/wp-content/uploads/2017/07/246.jpg&#39;);
    nocti_img_1.onclick=tanchuang;
    function tanchuang()&#123;
        layer.photos(&#123;
          photos: &#39;#layer-photos-demo&#39;
          ,anim: 5
        &#125;);
    &#125;
&#125;
&lt;/script&gt;</code></pre>
<p>这个的意思就是在id为nocti_layer-photos-demo的区块中添加一个属性class为layer-photos-demo的，然后选择这个ID下的所有图片，并且为第一张图片设置属性。当然了，这个ID可以根据自己需要设置，不用一模一样。但是区块ID必须跟<code>photos: &#39;#nocti_layer-photos-demo&#39;</code>这个ID一样才行，因为这个是绑定了事件的了。</p>
<p>根据实践，我没有这么做，而是直接在这个区块添加ID，然后在这个区块的底部，也就是所有需要弹窗效果的图片后面添加如下代码：</p>
<pre><code>&lt;script&gt;          
layer.photos(&#123;          
 photos: &#39;#nocti_layer-photos-demo&#39;          
 ,anim: 5 //0-6的选择，指定弹出图片动画类型          
&#125;);           
&lt;/script&gt;</code></pre>
<p>然后就行了，这里值得提醒的是，这个ID，必须跟区块的ID一致，然后就达到了预期的效果。不能打乱了layer这个文件夹的内部结构，整体引用就行，这个跟jquery的引用还是有点不一样的。</p>
<p>这里说一下的是，这个可以根据上面的参数设置显示效果，0-6，参数不一样，点击后的显示效果就不一样。</p>
<p>这里补充一下，有个客户很纠细节，我们都知道layer这个相册功能，是没有关闭按钮的，点击空白处就可以关闭的，可是这个客户很奇怪，想要弹出来不关闭，需要点击关闭按钮才能够把图片关闭掉，这个该怎么办呢？</p>
<p>笔者这里的方法是运用layer的其他关闭按钮的弹窗方案，进行改装一下，比如如下这个案例：</p>
<p>完整代码：</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Document&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;css/swiper.min.css&quot;&gt;
    &lt;script src=&quot;http://libs.baidu.com/jquery/2.1.1/jquery.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;layer.js&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css&quot;&gt;
    &lt;style&gt;
        body &#123;
          background: #eee;
          font-size: 14px;
          color:#000;
          margin: 0;
          padding: 0;
        &#125;
        .swiper-container &#123;
          width: 100%;
          margin: 20px auto;
        &#125;
        .swiper-slide &#123;
          text-align: center;
          font-size: 18px;
          background: #fff;
          display: -webkit-box;
          display: -ms-flexbox;
          display: -webkit-flex;
          display: flex;
          -webkit-box-pack: center;
          -ms-flex-pack: center;
          -webkit-justify-content: center;
          justify-content: center;
          -webkit-box-align: center;
          -ms-flex-align: center;
          -webkit-align-items: center;
          align-items: center;
        &#125;
        .swiper-slide img&#123;
          width: 100%;
          cursor: zoom-in;
        &#125;
        .swiper-button-prev, .swiper-container-rtl .swiper-button-next,.swiper-button-next, .swiper-container-rtl .swiper-button-prev &#123;
          background: aliceblue !important;
          border-radius: 50%;
      &#125;
      .swiper-button-prev&#123;
        left: -20px;
      &#125;
      .swiper-button-next&#123;
        right: -20px;
      &#125;
      .swiper-button-next, .swiper-button-prev &#123;
          width: 50px;
          height: 55px;
          top:47%;
      &#125;
      .swiper-button-prev .fa&#123;
        left: 25px;
          top: 7px;
          font-size: 36px;
          position: absolute;
      &#125;
      .swiper-button-next .fa&#123;
        right: 25px;
          top: 7px;
          font-size: 36px;
          position: absolute;
      &#125;
      .swiper-container-horizontal&gt;.swiper-pagination-bullets, .swiper-pagination-custom, .swiper-pagination-fraction &#123;
          bottom: -20px;
      &#125;
      .swiper-container &#123;
          overflow: visible;
      &#125;
    &lt;/style&gt;

&lt;/head&gt;
&lt;body&gt;
  &lt;!-- Swiper --&gt;
&lt;div class=&quot;swiper-container&quot; id=&quot;lunbotu&quot;&gt;
  &lt;div class=&quot;swiper-wrapper&quot;&gt;
    &lt;div class=&quot;swiper-slide&quot;&gt;&lt;img src=&quot;http://ayl.vazpra.com/wp-content/uploads/2018/11/details-page-slider1.jpg&quot; alt=&quot;1&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;swiper-slide&quot;&gt;&lt;img src=&quot;http://ayl.vazpra.com/wp-content/uploads/2018/11/details-page-slider1.jpg&quot; alt=&quot;2&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;swiper-slide&quot;&gt;&lt;img src=&quot;http://ayl.vazpra.com/wp-content/uploads/2018/11/details-page-slider1.jpg&quot; alt=&quot;3&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;swiper-slide&quot;&gt;&lt;img src=&quot;http://ayl.vazpra.com/wp-content/uploads/2018/11/details-page-slider1.jpg&quot; alt=&quot;4&quot;&gt;&lt;/div&gt;
  &lt;/div&gt;

  &lt;div class=&quot;swiper-pagination&quot;&gt;&lt;/div&gt;

  &lt;div class=&quot;sp_next&quot;&gt;
     &lt;div class=&quot;swiper-button-next&quot;&gt;
        &lt;i class=&quot;fa fa-angle-right&quot;&gt;&lt;/i&gt;
      &lt;/div&gt;
  &lt;/div&gt;
  &lt;div class=&quot;sp_prev&quot;&gt;
    &lt;div class=&quot;swiper-button-prev&quot;&gt;
      &lt;i class=&quot;fa fa-angle-left&quot;&gt;&lt;/i&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;script src=&quot;js/swiper.min.js&quot;&gt;&lt;/script&gt;

&lt;script&gt;
    var appendNumber = 4;
    var prependNumber = 1;
    var swiper = new Swiper(&#39;.swiper-container&#39;, &#123;
      slidesPerView: 4,
      centeredSlides: true,
      spaceBetween: 20,
      loop : true,
      mousewheel: true,
      pagination: &#123;
        el: &#39;.swiper-pagination&#39;,
        clickable: true,
      &#125;,
      breakpoints: &#123;
        1024: &#123;
          slidesPerView: 3,
          spaceBetween: 40,
        &#125;,
        768: &#123;
          slidesPerView: 2,
          spaceBetween: 30,
        &#125;,
        640: &#123;
          slidesPerView: 2,
          spaceBetween: 20,
        &#125;,
        320: &#123;
          slidesPerView: 1,
          spaceBetween: 10,
        &#125;
      &#125;,
      navigation: &#123;
        nextEl: &#39;.swiper-button-next&#39;,
        prevEl: &#39;.swiper-button-prev&#39;,
      &#125;,
    &#125;);
&lt;/script&gt;

&lt;script&gt;
jQuery(&quot;#lunbotu img&quot;).click(function()&#123;  
    var doMain = jQuery(this)[0].src;
    var imgAlt = jQuery(this)[0].alt;
    layer.open(&#123;
      shade: [0.5, &#39;#000&#39;, false] 
      ,type: 1
      ,fix: false
      ,btnAlign: &#39;c&#39;
      ,area: [&#39;800px&#39;, &#39;650px&#39;]
      ,maxmin: true
      ,title: [imgAlt, false]
      ,content: &#39;&lt;img src=&#39;+doMain+&#39;&gt;&#39;
    &#125;);
  &#125;);
&lt;/script&gt;

&lt;style&gt;
@media(max-width:767px)&#123;
  .layui-layer-content&#123;
    max-width:330px !important;
    width:100%;
    display: block;
    margin: 0 auto;
  &#125;
  .layer-anim &#123;
    max-width: 350px !important;
    max-height: 305px !important;
    display: block;
    margin: 0 auto;
    left: 3% !important;
    top: 10% !important;
&#125;

&#125;
&lt;/style&gt;


&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>这个地方说明一下，这里包含了swiper的slider方案，然后在这个基础上添加了layer.js进行点击slider的图片进行弹窗，我们侧重点是说明layer弹窗的问题，这个demo的打包下载源码如下：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/13jMxJFg3qutMWEsbKruqXQ">https://pan.baidu.com/s/13jMxJFg3qutMWEsbKruqXQ</a>，密码：nct9</p>
<p>根据前文说到的，想要图片又相册的效果，就是弹窗的效果，那么只需要根据前面的：</p>
<pre><code>&lt;script&gt;
layer.photos(&#123;          
 photos: &#39;#lunbotu&#39;          
 ,anim: 5
,closeBtn: 1
&#125;);
&lt;/script&gt;</code></pre>
<p>当然还有必要引用（layer.js和jquery）,可是现在我们不用这个相册功能，因为客户想要有关闭按钮的，而且点击图片弹出来之后，如果不点击关闭按钮是不能关闭弹窗的。我们运用的是：</p>
<pre><code>layer.open(&#123;
  type: 2 //此处以iframe举例
  ,title: &#39;当你选择该窗体时，即会在最顶端&#39;
  ,area: [&#39;390px&#39;, &#39;260px&#39;]
  ,maxmin: true
  ,content: &#39;&lt;div&gt;&lt;h2&gt;hello world&lt;/h2&gt;&lt;/div&gt;&#39;
&#125;);</code></pre>
<p>类似这样的就有关闭按钮了，想要找到更多有关闭按钮的，去<a target="_blank" rel="noopener" href="https://www.layui.com/demo/layer.html">官网</a>了解更多。根据这个启发，笔者就在想，可否通过js的方式，点击图片然后启动这个弹窗，然后弹窗里面显示当前图片，这个用js理论是没问题的，最后实践证明是可行的。笔者的代码：</p>
<pre><code>&lt;script&gt;
jQuery(&quot;#lunbotu img&quot;).click(function()&#123;  
    var doMain = jQuery(this)[0].src;  //获取当前图片的地址
    var imgAlt = jQuery(this)[0].alt;   //获取当前图片的alt属性的值
    layer.open(&#123;
      shade: [0.5, &#39;#000&#39;, false] 
      ,type: 1
      ,fix: false
      ,btnAlign: &#39;c&#39;
      ,area: [&#39;800px&#39;, &#39;650px&#39;]
      ,maxmin: true
      ,title: [imgAlt, false]
      ,content: &#39;&lt;img src=&#39;+doMain+&#39;&gt;&#39;
    &#125;);
  &#125;);
&lt;/script&gt;</code></pre>
<p>最后的效果：</p>
<p><img src="https://i.imgur.com/KG6KWWE.jpg"></p>
<p>当然这个在手机版上有点自适应问题，大家可能需要写下媒体查询，确保自适应良好，笔者的自适应写法如下：</p>
<pre><code>&lt;style&gt;
@media(max-width:767px)&#123;
  .layui-layer-content&#123;
    max-width:330px !important;
    width:100%;
    display: block;
    margin: 0 auto;
  &#125;
  .layer-anim &#123;
    max-width: 350px !important;
    max-height: 305px !important;
    display: block;
    margin: 0 auto;
    left: 3% !important;
    top: 10% !important;
&#125;

&#125;
&lt;/style&gt;</code></pre>
<p>然后说一下另外一个效果：</p>
<p><img src="http://i.imgur.com/jOcYUC1.jpg"></p>
<p>这个的实现方式如下是这样的。</p>
<p>完整代码如下：</p>
<pre><code>&lt;script&gt;
    window.onload=function()&#123;
    document.querySelectorAll(&#39;.bbs&#39;)[0].onclick=tz2;
    function tz2(event)&#123;
        event.preventDefault();
        ;!function()&#123;
          layer.prompt(&#123;title: &#39;输入密码，并确认&#39;, formType: 1&#125;, function(pass, index)&#123;
          layer.close(index);
          layer.prompt(&#123;title: &#39;随便写点，并确认&#39;, formType: 2&#125;, function(text, index)&#123;
          layer.close(index);
          layer.msg(&#39;您的密码是：&#39;+ pass +&#39;，您最后写下了：&#39;+text);
          &#125;);
        &#125;);
        &#125;()
    &#125;

    document.querySelectorAll(&#39;.bbs&#39;)[1].onclick=tz3;
    function tz3(event)&#123;
        event.preventDefault();
        ;!function()&#123;
          layer.prompt(&#123;title: &#39;阿里巴巴山洞的口诀&#39;, formType: 1&#125;, function(pass, index)&#123;
          layer.close(index);
          layer.prompt(&#123;title: &#39;记录下你拿走了哪些宝贝&#39;, formType: 2&#125;, function(text, index)&#123;
          layer.close(index);
          layer.msg(&#39;您的口诀是：&#39;+ pass +&#39;，你拿走了这些宝贝：&#39;+text);
          &#125;);
        &#125;);
        &#125;()
    &#125;

    document.querySelectorAll(&#39;.bbs&#39;)[2].onclick=tz4;
    function tz4(event)&#123;
        event.preventDefault();
        ;!function()&#123;
          layer.prompt(&#123;title: &#39;请输入你的密码，然后点确认&#39;, formType: 1&#125;, function(pass, index)&#123;
          layer.close(index);
          layer.prompt(&#123;title: &#39;今天你有什么要写的？&#39;, formType: 2&#125;, function(text, index)&#123;
          layer.close(index);
          layer.msg(&#39;您的密码是：&#39;+ pass +&#39;，您最后写下了：&#39;+text);
          &#125;);
        &#125;);
        &#125;()
    &#125;

&#125;
&lt;/script&gt;

&lt;style&gt;
.bbs&#123;
    background: #59778f;
    padding: 10px 20px;
    color: #fff;
    margin: 5px;
    text-align: center;
    border-radius: 5px;
    cursor:pointer;
&#125;
&lt;/style&gt;</code></pre>
<p>把这个自定义代码放在.bbs类后面的区块，然后点击就行了，里面的内容可以自定义的更换。前提是你引入了layer,当然也需要引入jquery，一般wordpress在头部都会引入jquery这个库，如果没有达到预期的效果，先检查他们的先后顺序，由于layer.js依赖jquery.js所以，在jquery后面引入，但是必须先于目标元素的前面引入。</p>
<p>因此，瘦身后的完成代码如下：</p>
<pre><code>&lt;script&gt;
    window.onload=function()&#123;
    document.querySelectorAll(&#39;.bbs&#39;)[0].onclick=tz2;
    function tz2(event)&#123;
        event.preventDefault();
        ;!function()&#123;
          layer.prompt(&#123;title: &#39;输入密码，并确认&#39;, formType: 1&#125;, function(pass, index)&#123;
          layer.close(index);
          layer.prompt(&#123;title: &#39;随便写点，并确认&#39;, formType: 2&#125;, function(text, index)&#123;
          layer.close(index);
          layer.msg(&#39;您的密码是：&#39;+ pass +&#39;，您最后写下了：&#39;+text);
          &#125;);
        &#125;);
        &#125;()
    &#125;

    document.querySelectorAll(&#39;.bbs&#39;)[1].onclick=tz3;
    function tz3(event)&#123;
        event.preventDefault();
        ;!function()&#123;
          layer.prompt(&#123;title: &#39;阿里巴巴山洞的口诀&#39;, formType: 1&#125;, function(pass, index)&#123;
          layer.close(index);
          layer.prompt(&#123;title: &#39;记录下你拿走了哪些宝贝&#39;, formType: 2&#125;, function(text, index)&#123;
          layer.close(index);
          layer.msg(&#39;您的口诀是：&#39;+ pass +&#39;，你拿走了这些宝贝：&#39;+text);
          &#125;);
        &#125;);
        &#125;()
    &#125;

    document.querySelectorAll(&#39;.bbs&#39;)[2].onclick=tz4;
    function tz4(event)&#123;
        event.preventDefault();
        ;!function()&#123;
          layer.prompt(&#123;title: &#39;请输入你的密码，然后点确认&#39;, formType: 1&#125;, function(pass, index)&#123;
          layer.close(index);
          layer.prompt(&#123;title: &#39;今天你有什么要写的？&#39;, formType: 2&#125;, function(text, index)&#123;
          layer.close(index);
          layer.msg(&#39;您的密码是：&#39;+ pass +&#39;，您最后写下了：&#39;+text);
          &#125;);
        &#125;);
        &#125;()
    &#125;

&#125;
&lt;/script&gt;


&lt;script&gt;          
    layer.photos(&#123;          
     photos: &#39;#nocti_layer-photos-demo&#39;          
     ,anim: 4 //0-6的选择，指定弹出图片动画类型          
    &#125;);           
&lt;/script&gt;

&lt;style&gt;
.bbs&#123;
    background: #59778f;
    padding: 10px 20px;
    color: #fff;
    margin: 5px;
    text-align: center;
    border-radius: 5px;
    cursor:pointer;
&#125;
&lt;/style&gt;</code></pre>
<p>到此为止，更多问题可以联系笔者，旨在共同交流。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://helongquan.github.io/2017/07/14/%E9%98%BF%E9%87%8C%E4%BA%91Linux%E4%B8%80%E9%94%AE%E5%AE%89%E8%A3%85web%E7%8E%AF%E5%A2%83%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="泉哥">
      <meta itemprop="description" content="日记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸢尾花序">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/07/14/%E9%98%BF%E9%87%8C%E4%BA%91Linux%E4%B8%80%E9%94%AE%E5%AE%89%E8%A3%85web%E7%8E%AF%E5%A2%83%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B-1/" class="post-title-link" itemprop="url">阿里云Linux一键安装web环境使用教程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-07-14 20:31:04" itemprop="dateCreated datePublished" datetime="2017-07-14T20:31:04+08:00">2017-07-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:06" itemprop="dateModified" datetime="2020-10-11T11:53:06+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>以前是万网虚拟主机空间越发的不够了，想换服务器由于备案在万网为了方便只好选择了阿里云空间。</p>
<p>配置环境阿里云Linux一键安装web环境是一个方便广大网站建设者的环境配置，省去了使用面板不安全占用系统内存的诸多问题，方便的建设PHP环境省去了，人工配置的繁琐节省时间。</p>
<p>如果是新手建议安装面板解决问题，毕竟这个环境还是需要手动配置的，如果你安装之后不懂可以在阿里云后台申请阿里云的工程师帮您解决问题。</p>
<p>如果是1G内存以上的ECS可以使用WDCP这个使用的比较多久是版本不怎么更新安全性还是可以的。小于1g内存的可以使用自己的路面板或AMH这个AMH好像收费的不过不贵的。收费才能长久开发的推荐使用。自己的路免费的好像不怎么更新了。</p>
<p>安装须知</p>
<p>1、此安装包可在阿里云所有linux系统上部署安装，此安装包包含的软件及版本为：</p>
<pre><code>nginx：1.0.15、1.2.5、1.4.4

apache：2.2.22、2.4.2

mysql：5.1.73、5.5.35、5.6.15

php：5.3.18、5.4.23、5.5.7

php扩展：memcache、Zend Engine/ OPcache

ftp：（yum/apt-get安装）

phpwind：8.7 GBK

phpmyadmin：4.1.8</code></pre>
<p>2、请使用最新的一键安装包脚本安装，以前老版本都存在bug，会导致安装异常以及安装的环境混乱。</p>
<p>3、执行一键安装包(./install.sh)，会自动清理之前一键安装包安装过的环境。</p>
<p>如果您已经安装过一键安装包，再次执行安装，如若有重要数据，请自行备份/alidata目录。</p>
<p>4、一键安装包会将软件安装在/alidata目录下。</p>
<p>如果您的系统不存在数据盘，则一键安装包会将软件安装到系统/alidata目录下。</p>
<p>如果您的系统存在数据盘，且还没有格式化挂载数据盘。则一键安装包会自动帮您格式化第一块数据盘，并挂载在/alidata目录下。</p>
<p>如果您的系统存在数据盘，且已格式化并挂载了第一块数据盘。一键安装包会将第一块数据盘再次挂载到/alidata目录下，并不影响您之前的挂载目录的使用。比如下图所示，安装前，已经挂载了mnt目录。安装后，一键安装包再次挂载/alidata目录。</p>
<p>如果您的系统存在数据盘，且已格式化数据盘，但没有挂载数据盘。一键安装包会将第一块数据盘挂载到/alidata目录下。</p>
<p>5、怎么样卸载一键安装包？</p>
<p>可以执行以下命令完成卸载：</p>
<pre><code>chmod  777 -R sh-1.3.0/

cd sh-1.3.0/

./uninstall.sh</code></pre>
<p>在安装前，需要准备两个工具，xftp和xshell,安装步骤就不解释了，很简单。当我们安装完毕后，准备好服务器的登录信息，登录xshell，进入到根目录：</p>
<pre><code>cd /</code></pre>
<p>然后用xftp上传环境安装文件sh-1.5.5这个文件，下载地址请参考我其中的一篇文章。</p>
<p>然后输入命令：</p>
<pre><code>chmod –R 777 sh-1.3.0
cd sh-1.3.0
./install.sh</code></pre>
<p>出现了一个选择提示，进入web服务器的选择界面。这里您可以根据需要选择apache或者nginx服务器。1是nginx 2是apache一般选择1就可以了。（简单的讲解下在高并发连接的情况下，Nginx是Apache服务器不错的替代品。Nginx同时也可以作为7层负载均衡服务器来使用。根据我的测试结果，Nginx 0.8.46 + PHP 5.2.14 (FastCGI) 可以承受3万以上的并发连接数，相当于同等环境下Apache的10倍。）这里就不多讲了可以自己百度一下。<br>这里我们选择nginx，输入1，回车</p>
<p>然后根据提示，选择自己的配置，我选择尽量高的配置。然后会出现一个配置列表：</p>
<p><img src="http://i.imgur.com/bDdXnGV.jpg"></p>
<p>这个时候出入y，然后就开始安装了，你也可以去干点别的了。</p>
<p>到这个界面说明安装已经结束了，我们可以输入以下命令再次验证是不是已经安装成功</p>
<p><img src="http://i.imgur.com/xMlbXws.jpg"></p>
<p>接着在命令行里输入： cat account.log就可以看到默认的密码了。</p>
<p>ftp的用户名是：wwwmysql的用户名是：root</p>
<p>以上密码都是系统随机设置的安全性很高的，可以修改也可以不修改的。</p>
<p><img src="http://i.imgur.com/YtF33E4.jpg"></p>
<p>这里需要提醒的是：如果平时的维护，想要查看这个账号信息，不能在根目录下运行这个cat account.log的，细心的人会看到路径在sh-1.5.5这个目录下面运行才行。所以这里需要注意。</p>
<p>如何管理mysql呢这个很简单</p>
<p>在地址栏输入您的服务器IP/phpmyadmin/</p>
<p>就会看到登陆页面了。输入上面随机的密码就可以了</p>
<p><img src="http://i.imgur.com/JylzhY5.jpg"></p>
<p>安装网站程序这个阿里云的环境默认带一个phpwind论坛的大家可以测试下，在浏览器中输入您的域名会IP就可以出来安全界面了按照提示进行安装就可以了。看下图片就知道了.</p>
<p>我们可以删除这个论坛的程序，进入到phpwind里面，除了phpmyadmin这个文件夹不能删除之外，其他的都可以删除。然后把自己需要部署的web程序放进去就行了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/31/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/31/">31</a><span class="page-number current">32</span><a class="page-number" href="/page/33/">33</a><span class="space">&hellip;</span><a class="page-number" href="/page/43/">43</a><a class="extend next" rel="next" href="/page/33/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">泉哥</p>
  <div class="site-description" itemprop="description">日记</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">424</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">400</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">泉哥</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
