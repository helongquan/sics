<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/11/sics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/11/sics/" class="post-title-link" itemprop="url">sics</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-10-11 11:33:35 / Modified: 11:34:30" itemprop="dateCreated datePublished" datetime="2020-10-11T11:33:35+08:00">2020-10-11</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="测试文档"><a href="#测试文档" class="headerlink" title="测试文档"></a>测试文档</h2><p>测试需要，期待更新。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/11/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/11/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-11 10:52:51" itemprop="dateCreated datePublished" datetime="2020-10-11T10:52:51+08:00">2020-10-11</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/08/21/Tp5%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%89%8D%E7%AB%AFajax%E8%BF%94%E5%9B%9E%E5%80%BC%E5%89%8D%E6%9C%89-php%E7%AC%A6%E5%8F%B7%E8%80%8C%E4%B8%94%E5%89%8D%E5%8F%B0%E9%A1%B5%E9%9D%A2%E4%B8%AD%E7%9A%84%E6%9C%80%E5%89%8D%E9%9D%A2%E4%B9%9F%E6%9C%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/21/Tp5%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%89%8D%E7%AB%AFajax%E8%BF%94%E5%9B%9E%E5%80%BC%E5%89%8D%E6%9C%89-php%E7%AC%A6%E5%8F%B7%E8%80%8C%E4%B8%94%E5%89%8D%E5%8F%B0%E9%A1%B5%E9%9D%A2%E4%B8%AD%E7%9A%84%E6%9C%80%E5%89%8D%E9%9D%A2%E4%B9%9F%E6%9C%89/" class="post-title-link" itemprop="url">Tp5项目中前端ajax返回值前有php符号而且前台页面中的最前面也有</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-21 19:15:09" itemprop="dateCreated datePublished" datetime="2019-08-21T19:15:09+08:00">2019-08-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:58:02" itemprop="dateModified" datetime="2020-10-11T11:58:02+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tp5/" itemprop="url" rel="index"><span itemprop="name">tp5</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Tp5 ajax返回值前有<code>&lt;?php</code></p>
<p>情况如下，我在处理一个文件上传的问题，从前端发起ajax请求到后端去，通过</p>
<pre><code>console.log(evt.target.responseText);</code></pre>
<p>打印返回值的时候，发现：</p>
<pre><code>&lt;?php&#123;&quot;code&quot;:1&#125;</code></pre>
<p>截图如下：</p>
<p><img src="https://i.imgur.com/tZPqslV.png"></p>
<p>后来，排查的时候发现前端页面的顶部也有：</p>
<pre><code>&lt;!--?php&lt;!DOCTYPE html--&gt;
&lt;html&gt;
...</code></pre>
<p>截图如下：</p>
<p><img src="https://i.imgur.com/mKSTw26.png"></p>
<p>然后经过排查发现在模块的common.php文件中找到解决方案，通常来说tp5里面的这个文件里面就是一段代码：</p>
<pre><code>&lt;?php</code></pre>
<p>确没有闭合，这样导致的问题就是，该模块下的所有视图文件的头部就会被添加上了这个东西，解决这个问题很简单，把各个模块中的common.php文件，凡是没有写闭合标签的，都加上<code>?&gt;</code>，把common.php文件改成：</p>
<pre><code>&lt;?php

?&gt;</code></pre>
<p>问题解决。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/08/21/HTML5%E7%BB%93%E5%90%88javascript%E5%AE%9E%E7%8E%B0%E9%BC%A0%E6%A0%87%E6%8B%96%E6%8B%BDdom%E7%9A%84%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/21/HTML5%E7%BB%93%E5%90%88javascript%E5%AE%9E%E7%8E%B0%E9%BC%A0%E6%A0%87%E6%8B%96%E6%8B%BDdom%E7%9A%84%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">HTML5结合javascript实现鼠标拖拽dom的详解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-21 09:27:09" itemprop="dateCreated datePublished" datetime="2019-08-21T09:27:09+08:00">2019-08-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:57:57" itemprop="dateModified" datetime="2020-10-11T11:57:57+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/html5/" itemprop="url" rel="index"><span itemprop="name">html5</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>很久前就想记录下关于H5中的拖拽相关问题的详解，今日做个记录，如有不严谨的地方，欢迎斧正。</p>
<p>在阅读笔者的这篇文章之前，建议读者先去以下这几个网站实践一下，以便能够深刻地掌握和理解。</p>
<p>首推：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/HTML_Drag_and_Drop_API">https://developer.mozilla.org/en-US/docs/Web/API/HTML_Drag_and_Drop_API</a></p>
<p>基于jquery的拖拽实例：<a target="_blank" rel="noopener" href="https://github.com/pluslicy/drag">https://github.com/pluslicy/drag</a>，可以在这里下载，也可以在笔者分享的这个链接下载：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1TBaicpr6phksPJyLz6QUVw">https://pan.baidu.com/s/1TBaicpr6phksPJyLz6QUVw</a> 提取码：8o5z </p>
<p>我们进入到本文的正题中，关于拖拽我们需要知道以下这些概念：</p>
<p>定义和用法</p>
<p>在拖放的过程中会触发以下事件：</p>
<p>在拖动目标上触发事件 (源元素):</p>
<ul>
<li>ondragstart - 用户开始拖动元素时触发</li>
<li>ondrag - 元素正在拖动时触发</li>
<li>ondragend - 用户完成元素拖动后触发</li>
</ul>
<p>释放目标时触发的事件:</p>
<ul>
<li>ondragenter - 当被鼠标拖动的对象进入其容器范围内时触发此事件</li>
<li>ondragover - 当某被拖动的对象在另一对象容器范围内拖动时触发此事件</li>
<li>ondragleave - 当被鼠标拖动的对象离开其容器范围内时触发此事件</li>
<li>ondrop - 在一个拖动过程中，释放鼠标键时触发此事件</li>
</ul>
<p><strong>浏览器支持</strong></p>
<p>Internet Explorer 9+, Firefox, Opera, Chrome, 和 Safari 支持拖动。</p>
<p>注意:Safari 5.1.2不支持拖动；在拖动元素时，每隔 350 毫秒会触发 ondragover 事件。</p>
<p>实例代码：</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Document&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;script&gt;
        function dragstart_handler(ev) &#123;
         // Add the target element&#39;s id to the data transfer object
         ev.dataTransfer.setData(&quot;app&quot;, ev.target.id);
         ev.dataTransfer.setData(&quot;content&quot;, ev.target.innerHTML);
         ev.dataTransfer.setData(&quot;name&quot;, ev.target.dataset.name);
         ev.dataTransfer.setData(&quot;class&quot;, ev.target.className);
         ev.dataTransfer.setData(&quot;href&quot;, ev.target.href);
         ev.dataTransfer.setData(&quot;src&quot;, ev.target.src);
         ev.dataTransfer.setData(&quot;alt&quot;, ev.target.alt);
         ev.dataTransfer.dropEffect = &quot;move&quot;;
        &#125;
        function dragover_handler(ev) &#123;
         ev.preventDefault();
         ev.dataTransfer.dropEffect = &quot;move&quot;
        &#125;
        function drop_handler(ev) &#123;
         ev.preventDefault();
         // Get the id of the target and add the moved element to the target&#39;s DOM
         var info = &#123;
             id: ev.dataTransfer.getData(&quot;app&quot;),
             content: ev.dataTransfer.getData(&quot;content&quot;),
             name: ev.dataTransfer.getData(&quot;name&quot;),
             class: ev.dataTransfer.getData(&quot;class&quot;),
             link: ev.dataTransfer.getData(&quot;href&quot;),
             src: ev.dataTransfer.getData(&quot;src&quot;),
             alt: ev.dataTransfer.getData(&quot;alt&quot;),
         &#125;
         var data = ev.dataTransfer.getData(&quot;app&quot;);

         // var content = ev.dataTransfer.getData(&quot;content&quot;);
         // var name = ev.dataTransfer.getData(&quot;name&quot;);
         // var classs = ev.dataTransfer.getData(&quot;class&quot;);
         // console.log(info);
         ev.target.appendChild(document.getElementById(data));
         tips(info);
        &#125;
        function tips(get_info)&#123;
            console.log(&quot;你移动了元素的位置&quot;);
            console.log(get_info);
        &#125;
    &lt;/script&gt;

    &lt;p id=&quot;p1&quot; data-name=&quot;zhangsan&quot; class=&quot;container&quot; draggable=&quot;true&quot; ondragstart=&quot;dragstart_handler(event)&quot;&gt;This element is draggable.&lt;/p&gt;
    &lt;img src=&quot;../logo.jpg&quot; ondragstart=&quot;dragstart_handler(event)&quot; id=&quot;tupian&quot; data-name=&quot;lisi&quot; class=&quot;img-container&quot; alt=&quot;茄子&quot;&gt;
    &lt;a href=&quot;http://www.baidu.com/&quot; ondragstart=&quot;dragstart_handler(event)&quot; id=&quot;tiaozhuan&quot; data-name=&quot;boming&quot; class=&quot;link-container&quot;&gt;跳转链接&lt;/a&gt;
    &lt;div id=&quot;target&quot; ondrop=&quot;drop_handler(event)&quot; ondragover=&quot;dragover_handler(event)&quot;&gt;Drop Zone&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>更多的知识，参考链接：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/sqh17/p/8676983.html">https://www.cnblogs.com/sqh17/p/8676983.html</a>。</p>
<p>默认的HTML元素支持拖动的是链接和图片，也就是说这两类无需为标签添加<code>draggable=&quot;true&quot;</code></p>
<h2 id="第一步：拖动什么"><a href="#第一步：拖动什么" class="headerlink" title="第一步：拖动什么"></a>第一步：拖动什么</h2><p>这里用到 ondragstart 和 setData()</p>
<p>然后，规定当元素被拖动时，会发生什么。</p>
<p>在上面的例子中，ondragstart 属性调用了一个函数，<code>dragstart_handler(event)</code>，它规定了被拖动的数据。</p>
<p>dataTransfer.setData() 方法设置被拖数据的数据类型和值：</p>
<pre><code>function dragstart_handler(ev) &#123;
    // Add the target element&#39;s id to the data transfer object
    ev.dataTransfer.setData(&quot;app&quot;, ev.target.id);
    ev.dataTransfer.setData(&quot;content&quot;, ev.target.innerHTML);
    ev.dataTransfer.setData(&quot;name&quot;, ev.target.dataset.name);
    ev.dataTransfer.setData(&quot;class&quot;, ev.target.className);
    ev.dataTransfer.dropEffect = &quot;move&quot;;
&#125;</code></pre>
<p>在这个例子中，为了更充分地说明，笔者分别获取了dom中可能出现的各种属性的值：</p>
<pre><code>// 获取拖拽对象的id
ev.target.id</code></pre>
<p>打印输出：p1</p>
<pre><code>// 获取拖拽对象的所在dom的文本
ev.target.innerHTML</code></pre>
<p>打印输出：This element is draggable.</p>
<pre><code>// 获取拖拽对象的自定义属性(data-name)的值
ev.target.dataset.name</code></pre>
<p>打印输出：zhangsan</p>
<pre><code>// 获取拖拽对象的class
ev.target.className</code></pre>
<p>打印输出：container</p>
<pre><code>// 如果是链接的话，获取拖拽对象的链接
ev.target.href</code></pre>
<p>打印输出：<a target="_blank" rel="noopener" href="http://www.baidu.com/">http://www.baidu.com/</a></p>
<pre><code>// 如果是图片的话，获取拖拽对象的图片地址
ev.target.src</code></pre>
<p>打印输出：<a target="_blank" rel="noopener" href="http://localhost/logo.jpg">http://localhost/logo.jpg</a></p>
<pre><code>// 如果是图片的话，获取拖拽对象的图片的替代文本
ev.target.alt</code></pre>
<p>打印输出：茄子</p>
<p>这里就不用一个个的举例出来了，常用的就这么些，如果这些还不能满足需求，直接用自定义属性，到时候想要多少就用多少。</p>
<p>上面的那个打印输出的前提是先设置拖拽目标要获取哪些内容，然后到目标区域drop的时候通过getData()函数获取前面dragstart那里setData()函数中的设置的内容。然后输出即可，大家可以看下示例代码里面，很简单。</p>
<h2 id="第二步：放到何处（ondragover）"><a href="#第二步：放到何处（ondragover）" class="headerlink" title="第二步：放到何处（ondragover）"></a>第二步：放到何处（ondragover）</h2><p>ondragover 事件规定在何处放置被拖动的数据。</p>
<p>默认情况，是无法将数据/元素放置到其他元素中。如果需要设置允许放置，我们必须阻止对元素的默认处理方式。</p>
<p>这要通过调用 ondragover 事件的 event.preventDefault() 方法：</p>
<pre><code>event.preventDefault()</code></pre>
<p>还有一个这样的函数：</p>
<pre><code>ev.dataTransfer.dropEffect = &quot;move&quot;</code></pre>
<p>这个时候我们需要了解下dataTransfer.dropEffect这个的用法，根据<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer/dropEffect">官网</a>解释：</p>
<p><strong>copy</strong></p>
<pre><code>A copy of the source item is made at the new location.</code></pre>
<p><strong>move</strong></p>
<pre><code>An item is moved to a new location.</code></pre>
<p><strong>link</strong></p>
<pre><code>A link is established to the source at the new location.</code></pre>
<p><strong>none</strong></p>
<pre><code>The item may not be dropped. </code></pre>
<p>本示例用到move，那么就是把一个元素移动到另外一个地方。</p>
<h2 id="第三步：进行放置-ondrop"><a href="#第三步：进行放置-ondrop" class="headerlink" title="第三步：进行放置 - ondrop"></a>第三步：进行放置 - ondrop</h2><p>这个就是像降落伞着陆的意思，被拖拽的目标被放置在新的目标位置，这个时候需要发生一些事情，或者说我们希望它发生一些事情，比如我把一张图片拖动到目标位置的时候，我希望显示这张图片的相关信息，或者我拖放了一个文本，叫做张三的人名，那么我希望把这个文本拖放到目标位置后，显示张三的相关的信息等等。</p>
<p>当放置被拖数据时，会发生 drop 事件。</p>
<p>在上面的例子中，ondrop 属性调用了一个函数，drop_handler(event)：</p>
<pre><code>function drop_handler(ev) &#123;
     ev.preventDefault();
     // Get the id of the target and add the moved element to the target&#39;s DOM
     var info = &#123;
         id: ev.dataTransfer.getData(&quot;app&quot;),
         content: ev.dataTransfer.getData(&quot;content&quot;),
         name: ev.dataTransfer.getData(&quot;name&quot;),
         class: ev.dataTransfer.getData(&quot;class&quot;),
         link: ev.dataTransfer.getData(&quot;href&quot;),
         src: ev.dataTransfer.getData(&quot;src&quot;),
         alt: ev.dataTransfer.getData(&quot;alt&quot;),
     &#125;
     var data = ev.dataTransfer.getData(&quot;app&quot;);

     // var content = ev.dataTransfer.getData(&quot;content&quot;);
     // var name = ev.dataTransfer.getData(&quot;name&quot;);
     // var classs = ev.dataTransfer.getData(&quot;class&quot;);
     // console.log(info);
     ev.target.appendChild(document.getElementById(data));
     tips(info);
&#125;</code></pre>
<p><strong>代码解释：</strong></p>
<ul>
<li>调用 preventDefault() 来避免浏览器对数据的默认处理（drop 事件的默认行为是以链接形式打开）</li>
<li>通过 <code>dataTransfer.getData()</code> 方法获得被拖的数据。该方法将返回在 <code>setData()</code> 方法中设置为相同类型的任何数据，为了方便测试和信息的管理，笔者这里把所有的都以对象字面量的方式放在一个info对象中。</li>
<li>被拖数据是被拖元素的 id (“app”)，也就是drag里面的那个<code>ev.target.id</code>（被拖拽目标的ID）</li>
<li>把被拖元素追加到放置的元素（目标元素）中。</li>
</ul>
<p>这样就实现了拖动目标元素到新的位置。</p>
<p><strong>dataTransfer对象</strong></p>
<p>在拖曳操作的过程中，我们可以用过dataTransfer对象来传输数据，以便在拖曳操作结束的时候对数据进行其他的操作。这个也是在本实例中应用频率较高的一个对象。</p>
<p><strong>火狐浏览器拖拽问题</strong></p>
<p>但是进行到这儿在火狐浏览器中发现一个问题：</p>
<p>html5的拖拽，用了preventDefault防止弹出新页面，但在火狐下不管用？</p>
<p>解决办法：</p>
<pre><code>document.body.ondrop = function (event) &#123;
    event.preventDefault();
    event.stopPropagation();
&#125;</code></pre>
<p>也就是添加一个阻止事件冒泡的发生即可。</p>
<p>这里，笔者再补充一些东西，我们可以在鼠标拖拽的三个阶段添加一些函数，让拖拽变得更加丰富，比如在拖拽的阶段，我希望目标的背景颜色变成红色，那么怎么做呢？</p>
<p>我们写一个函数：</p>
<pre><code>function changeColor(ev)&#123;
    ev.target.style.background = &#39;red&#39;;
&#125;</code></pre>
<p>这个函数有一个参数，然后把这个函数放在：</p>
<pre><code>function dragstart_handler(ev) &#123;
    ...
    changeColor(ev);
&#125;</code></pre>
<p>这个里面，当我们开始拖动元素的时候，被拖动的元素的背景颜色就变成红色的了。当然，我们完全可以把<code>changeColor(ev)</code>变得更加丰富，以便完成更加复杂的需求。</p>
<p>如果我们在拖动完成放置到目标区域的时候，发生一些事情的时候，怎么办，还是一样的，根据前面的这个来，我们也写一个函数：</p>
<pre><code>function tips(get_info)&#123;
    console.log(&quot;你移动了元素的位置&quot;);
    console.log(get_info);
&#125;</code></pre>
<p>这个函数是用来在浏览器的控制台打印拖动的时候要获取的数据。这里也是需要传递一个参数。然后把这个函数放在：</p>
<pre><code>function drop_handler(ev) &#123;
    ...
    var info = &#123;
         id: ev.dataTransfer.getData(&quot;app&quot;),
         content: ev.dataTransfer.getData(&quot;content&quot;),
         name: ev.dataTransfer.getData(&quot;name&quot;),
         class: ev.dataTransfer.getData(&quot;class&quot;),
         link: ev.dataTransfer.getData(&quot;href&quot;),
         src: ev.dataTransfer.getData(&quot;src&quot;),
         alt: ev.dataTransfer.getData(&quot;alt&quot;),
     &#125;
    tips(info);
&#125;</code></pre>
<p>这个的目的就是，当拖拽元素到目标区域的时候，会执行tips()函数。我们也可以对tips()函数里面添加一些更丰富的逻辑处理代码，以实现更加复杂的业务需求。</p>
<p>比如，很常用的就是一个ajax的异步请求，这个很有用。</p>
<hr>
<p>前面的这个是用javascript的方式实现的，很多函数都是直接写在HTML中，这样不利于解耦，代码维护起来有点麻烦，如果分离的话，可以参考第二方案，这个不是笔者自己写的，采纳别人的，方案二仅仅作为参考，分享来用。</p>
<h2 id="方案二：jquery-HTML5实现拖拽"><a href="#方案二：jquery-HTML5实现拖拽" class="headerlink" title="方案二：jquery+HTML5实现拖拽"></a>方案二：jquery+HTML5实现拖拽</h2><p>HTML代码：</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;拖拽&lt;/title&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery-3.2.1.min.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;js/tbl.js&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;css/style.css&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;b&gt;types:&lt;/b&gt; &lt;ul class=&quot;canDrog&quot;&gt;
            &lt;li draggable=&quot;true&quot; data-text=&quot;optimal&quot;&gt;optimal&lt;/li&gt;
            &lt;li draggable=&quot;true&quot; data-text=&quot;good&quot;&gt;good&lt;/li&gt;
            &lt;li draggable=&quot;true&quot; data-text=&quot;medium&quot;&gt;medium&lt;/li&gt;
            &lt;li draggable=&quot;true&quot; data-text=&quot;badly&quot;&gt;badly&lt;/li&gt;
        &lt;/ul&gt;

        &lt;table class=&quot;dataTbl&quot;&gt;
            &lt;thead&gt;
                &lt;tr&gt;
                    &lt;th style=&quot;width: auto&quot;&gt;section/weeks&lt;/th&gt;
                    &lt;th style=&quot;width: 16%&quot;&gt;Monday &lt;/th&gt;
                    &lt;th style=&quot;width: 16%&quot;&gt;Tuesday&lt;/th&gt;
                    &lt;th style=&quot;width: 16%&quot;&gt;Wednesday &lt;/th&gt;
                    &lt;th style=&quot;width: 16%&quot;&gt;Thursday&lt;/th&gt;
                    &lt;th style=&quot;width: 16%&quot;&gt;Friday&lt;/th&gt;
                &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
                &lt;tr&gt;
                    &lt;td&gt;section_one&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;section_two&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;section_three&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;section_four&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;section_five&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                    &lt;td draggable=&quot;true&quot; &gt;&lt;/td&gt;
                &lt;/tr&gt;
            &lt;/tbody&gt;
        &lt;/table&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>js代码（tbl.js中的所有代码）：</p>
<pre><code>$(function()&#123;

    //解决火狐弹出新选项卡的问题
    $(&quot;.container&quot;).bind(&#39;drop&#39;,function(event)&#123;
        event.preventDefault();
        event.stopPropagation();
    &#125;);

    //拖拽开始时将被拖拽元素透明度设置为50%
    $(&#39;.canDrog &gt; li&#39;).bind(&#39;dragstart&#39;,function(event)&#123;
        var event = event.originalEvent;
        event.target.style.opacity = .5;
        var dataText = $(event.target).attr(&#39;data-text&#39;);
        //firefox 必须添加
        event.dataTransfer.setData(&quot;text&quot;,dataText);
    &#125;);

    //拖拽过程不执行任何操作。将会被持续触发
    $(&#39;.canDrog &gt; li&#39;).bind(&#39;drag&#39;,function(event)&#123;&#125;);

    //拖拽之后恢复被拖拽元素的透明度
    $(&#39;.canDrog &gt; li&#39;).bind(&#39;dragend&#39;,function(event)&#123;
        var event = event.originalEvent;
        event.target.style.opacity = 1;
    &#125;);


    //将元素拖入当前元素
    $(&#39;.dataTbl&#39;).bind(&#39;dragenter&#39;,&#39;td&#39;,function(event)&#123;
        var event = event.originalEvent;
        event.target.style.backgroundColor=&#39;#fdfdfd&#39;;
    &#125;);
    //google chrome,opera需要添加
    $(&quot;.dataTbl&quot;).bind(&quot;dragover&quot;,&#39;td&#39;,function(e)&#123;
        e.originalEvent.preventDefault();  
    &#125;)  
    //将元素拖离当前元素
    $(&#39;.dataTbl&#39;).bind(&#39;dragleave&#39;,&#39;td&#39;,function(event)&#123;
        var event = event.originalEvent;
        event.target.style.backgroundColor=&#39;&#39;;
    &#125;);

    //将元素释放到当前元素中
    $(&#39;.dataTbl&#39;).bind(&#39;drop&#39;,&#39;td&#39;,function(event)&#123;
        var event = event.originalEvent;
        var text = event.dataTransfer.getData(&quot;text&quot;);
        //重置背景色
        event.target.style.backgroundColor=&#39;&#39;;
        //添加拖拽元素的类型
        $(event.target).removeClass();
        $(event.target).addClass(text);
        $(event.target).text(text);

        event.preventDefault();
        event.stopPropagation();
    &#125;);
&#125;);</code></pre>
<p>大家可以参考下。这个很直观，也很经典。</p>
<p>笔者在运用这个这地方的时候，有点小问题，就是笔者的被拖拽的目标是通过js动态生成的dom，也就是说在html代码之后生成的，那么没法被监听到。所以这里需要做个处理。</p>
<p><strong>首先</strong>，我们要确保<code>$(&#39;.dataTbl&#39;)</code>这个jquery对象不是动态生成的，而是原本就存在的。</p>
<p><strong>接着</strong>，把<code>bind</code>改成<code>on</code>，然后写法可以自行参考下jquery中on的写法。</p>
<p>经过纠正之后，笔者用在本地项目的时候，js代码写法如下：</p>
<pre><code>$(document).ready(function() &#123;

    // 拖拽事件处理代码 开始
    // 解决在火狐浏览器上拖放的目标被在新的浏览器标签上打开
    $(&quot;#media_manage .content&quot;).on(&#39;drop&#39;, function(event) &#123;
        event.preventDefault();
        event.stopPropagation();
    &#125;);

    $(&quot;#media_manage .content&quot;).on(&#39;dragstart&#39;,&#39;.media-item&#39;, function(event) &#123;
        var event = event.originalEvent;
        event.target.style.opacity = 0.5;
        var dataText = $(event.target).attr(&#39;data-alt&#39;);
        var dataLink = $(event.target).attr(&#39;data-link&#39;);
        //firefox 必须添加
        event.dataTransfer.setData(&quot;alt&quot;,dataText);
        event.dataTransfer.setData(&quot;link&quot;,dataLink);
    &#125;);

    //拖拽过程不执行任何操作。将会被持续触发
    $(&#39;#media_manage .content&#39;).on(&#39;drag&#39;,&#39;.media-item&#39;,function(event)&#123;&#125;);

    //拖拽之后恢复被拖拽元素的透明度
    $(&#39;#media_manage .content&#39;).on(&#39;dragend&#39;,&#39;.media-item&#39;,function(event)&#123;
        var event = event.originalEvent;
        event.target.style.opacity = 1;
    &#125;);

    //将元素拖入当前元素
    $(&#39;#media_manage .content&#39;).on(&#39;dragenter&#39;,&#39;#media_result&#39;,function(event)&#123;
        var event = event.originalEvent;
        event.target.style.backgroundColor=&#39;#fdfdfd&#39;;
    &#125;);

    //google chrome,opera需要添加
    $(&quot;#media_manage .content&quot;).on(&quot;dragover&quot;,&#39;#media_result&#39;,function(e)&#123;
        e.originalEvent.preventDefault();  
    &#125;);

    //将元素拖离当前元素
    $(&#39;#media_manage .content&#39;).on(&#39;dragleave&#39;,&#39;#media_result&#39;,function(event)&#123;
        var event = event.originalEvent;
        event.target.style.backgroundColor=&#39;&#39;;
    &#125;);

    //将元素释放到当前元素中
    $(&#39;#media_manage .content&#39;).on(&#39;drop&#39;,&#39;#media_result&#39;,function(event)&#123;
        var event = event.originalEvent;
        var text = event.dataTransfer.getData(&quot;alt&quot;);
        var link = event.dataTransfer.getData(&quot;link&quot;);
        //重置背景色
        event.target.style.backgroundColor=&#39;&#39;;
        //添加拖拽元素的类型
        $(event.target).removeClass();
        $(event.target).addClass(text);
        // $(event.target).text(text);
        // $(event.target).prepend(link);
        $(event.target).html(text+&quot; - &quot;+link);
        getStudentInfomation(text,link);

        event.preventDefault();
        event.stopPropagation();
    &#125;);

    // 拖拽事件处理代码 结束

&#125;)

function getStudentInfomation(student,link)&#123;
    $.ajax(&#123;
        url:&quot;./api/media/getStudentInfomation?student=&quot;+student,
        type: &quot;get&quot;,
        dataType: &quot;json&quot;,
        contentType: &quot;application/json&quot;,
        success: function(res)&#123;
            console.log(res.data);
            res = res.data;
            var html = &#39;&lt;div class=&quot;media&quot;&gt;&#39;;
            html += &#39;&lt;div class=&quot;media-left&quot;&gt;&lt;a href=&quot;#&quot;&gt;&#39;;

            if(res[0].headimg == null)&#123;
                html += &#39;&lt;img class=&quot;media-object&quot; src=&quot;./public/uploads/wordpress.jpg&quot;&gt;&#39;;
            &#125;else&#123;
                html += &#39;&lt;img class=&quot;media-object&quot; src=&quot;&#39;+res[0].headimg+&#39;&quot;&gt;&#39;;
            &#125;

            html += &#39;&lt;/a&gt;&lt;/div&gt;&#39;;
            html += &#39;&lt;div class=&quot;media-body&quot;&gt;&#39;;
            html += &#39;&lt;h4 class=&quot;media-heading&quot; id=&quot;user_name&quot;&gt;学生：&lt;a href=&quot;&#39;+link+&#39;&quot; target=&quot;_blank&quot;&gt;&#39;+res[0].name+&#39;&lt;/a&gt;&lt;/h4&gt;&#39;;
            html += &#39;&lt;p&gt;&lt;span&gt;年级：&#39;+res[0].grade+&#39;&lt;/span&gt;&amp;nbsp;&amp;nbsp;&lt;span&gt;年纪&#39;+res[0].age+&#39;&lt;/span&gt;&lt;/p&gt;&#39;;
            html += &#39;&lt;p&gt;手机号：&#39;+res[0].mobile+&#39;&lt;/p&gt;&#39;;
            html += &#39;&lt;p&gt;地址：&#39;+res[0].address+&#39;&lt;/p&gt;&#39;;
            html += &#39;&lt;/div&gt;&#39;;
            $(&quot;#pic_infomation_result&quot;).html(html);
        &#125;,
        error: function(xhr, err, exception)&#123;
            console.log(err);
        &#125;
    &#125;)
&#125;</code></pre>
<p>HTML代码如下：</p>
<pre><code>&lt;div id=&quot;media_manage&quot;&gt;
    &lt;div class=&quot;content&quot;&gt;
        &lt;p&gt;媒体中心&lt;/p&gt;
        &lt;div class=&quot;content-block&quot;&gt;
           &lt;div id=&quot;schedule_student_list&quot;&gt;
              // 这里会有一些动态的dom生成，动态生成的dom会成为被拖拽的目标
           &lt;/div&gt;
            &lt;div class=&quot;media-grid&quot;&gt;
                &lt;div class=&quot;media-item&quot;&gt;
                    &lt;img src=&quot;./public/uploads/1.jpg&quot; data-link=&quot;./index&quot; data-alt=&quot;刘备&quot;&gt;
                &lt;/div&gt;
                &lt;div class=&quot;media-item&quot;&gt;
                    &lt;img src=&quot;./public/uploads/2.jpg&quot; data-link=&quot;./student&quot; data-alt=&quot;孙权&quot;&gt;
                &lt;/div&gt;
                &lt;div class=&quot;media-item&quot;&gt;
                    &lt;img src=&quot;./public/uploads/3.jpg&quot; data-link=&quot;https://www.layui.com&quot; data-alt=&quot;曹操&quot;&gt;
                &lt;/div&gt;
                &lt;div class=&quot;media-item&quot;&gt;
                    &lt;img src=&quot;./public/uploads/4.jpg&quot; data-link=&quot;https://www.baidu.com&quot; data-alt=&quot;关羽&quot;&gt;
                &lt;/div&gt;
                &lt;div class=&quot;media-item&quot;&gt;
                    &lt;img src=&quot;./public/uploads/5.jpg&quot; data-link=&quot;http://localhost/tp5/index&quot; data-alt=&quot;张骞&quot;&gt;
                &lt;/div&gt;
                &lt;div class=&quot;media-item&quot;&gt;
                    &lt;img src=&quot;./public/uploads/6.jpg&quot; data-link=&quot;http://localhost/tp5/index&quot; data-alt=&quot;赵云&quot;&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;hr&gt;
        &lt;div id=&quot;media_result&quot;&gt;拖放图片到此区域识别真伪&lt;/div&gt;
        &lt;div id=&quot;pic_infomation_result&quot; class=&quot;content-block&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
<p>这样当我拖动元素的时候，就不会出现没法拖放到目标区域的问题了。</p>
<p>最后，作为一个小demo，笔者实现了这样一个：拖动图片到指定的区域，然后可以显示图片的相关信息，同时可以以图片的某些值作为参数来发起ajax请求，然后查询出更多跟图片相关的信息。</p>
<p>上图：</p>
<p><img src="https://i.imgur.com/o1IeBQj.png"></p>
<p>本文会持续更新，敬请关注。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/08/16/tp5%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95%E4%B9%8B%E6%A8%A1%E6%9D%BF%E7%9A%84%E8%BF%90%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/16/tp5%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95%E4%B9%8B%E6%A8%A1%E6%9D%BF%E7%9A%84%E8%BF%90%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/" class="post-title-link" itemprop="url">tp5调试记录之模板的运用注意事项</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-16 10:05:13" itemprop="dateCreated datePublished" datetime="2019-08-16T10:05:13+08:00">2019-08-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:58:02" itemprop="dateModified" datetime="2020-10-11T11:58:02+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>今天分享下关于采用TP5.1的时候，关于渲染控制器的内容，关于渲染控制器的返回结果其实已经在另外一篇关于TP5的文章中说到了，今天作为补充，这里主要是为了纠正上一篇文章说到的不足的地方。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/08/14/%E5%9C%A8%E6%9C%AC%E5%9C%B0xampp%E9%9B%86%E6%88%90%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%BC%80%E5%8F%91%E9%83%A8%E7%BD%B2tp5-1%E9%A1%B9%E7%9B%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/14/%E5%9C%A8%E6%9C%AC%E5%9C%B0xampp%E9%9B%86%E6%88%90%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%BC%80%E5%8F%91%E9%83%A8%E7%BD%B2tp5-1%E9%A1%B9%E7%9B%AE/" class="post-title-link" itemprop="url">在本地xampp集成环境下开发部署tp5.1项目</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-14 15:14:47" itemprop="dateCreated datePublished" datetime="2019-08-14T15:14:47+08:00">2019-08-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:58:04" itemprop="dateModified" datetime="2020-10-11T11:58:04+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tp5/" itemprop="url" rel="index"><span itemprop="name">tp5</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文纲领：</p>
<ol>
<li>把tp5搭建在xampp上运行</li>
<li>用tp5中的三层分离模式中的视图层来渲染控制器中的查询结果</li>
<li>为该项目建立前后台，分别采用不同的UI框架</li>
<li>编写api，运用api到前后台的逻辑操作中</li>
<li>隐藏public和index.php</li>
<li>tp5中文件上传或图片上传的功能</li>
</ol>
<hr>
<h2 id="把tp5搭建在xampp上运行"><a href="#把tp5搭建在xampp上运行" class="headerlink" title="把tp5搭建在xampp上运行"></a>把tp5搭建在xampp上运行</h2><p>我们直接在网上搜索一下xampp这个集成环境，然后根据自己的操作系统来选择对应的版本，本文主要是为了运行tp5，所以xampp中的php，mysql版本必须符合TP5的最低要求。</p>
<p><code>ThinkPHP5.1</code>的环境要求如下：</p>
<pre><code>PHP &gt;= 5.6.0
PDO PHP Extension
MBstring PHP Extension</code></pre>
<p>为了避免乱码产生，以及必要的扩展，需要去php.ini和mysql.ini这两个文件中进行相应的修改即可，然后重启服务器。</p>
<p>由于TP5.1是需要通过composer来安装的，官网已经取消了源码下载安装的方式，这个大家可以在TP5的<a target="_blank" rel="noopener" href="https://www.kancloud.cn/manual/thinkphp5_1/353948">文档</a>中了解。</p>
<blockquote>
<p>5.1版本开始，官网不再提供下载版本，请使用Composer或者git方式安装和更新。</p>
</blockquote>
<p>笔者在这个地方遇到了问题：</p>
<p>根据tp5教程，我用git的方式下载了tp5的源码，访问<a target="_blank" rel="noopener" href="http://localhost/thinkphp5/public/%E5%8F%91%E7%8E%B0%E9%81%87%E5%88%B0%E5%A6%82%E4%B8%8B%E7%9A%84%E9%97%AE%E9%A2%98%E3%80%82">http://localhost/thinkphp5/public/发现遇到如下的问题。</a></p>
<p>报错如下：</p>
<pre><code>Warning: require(D:\xampp\htdocs\thinkphp5\public/../vendor/autoload.php): failed to open stream: No such file or directory in D:\xampp\htdocs\thinkphp5\public\index.php on line 15Fatal error: require(): Failed opening required &#39;D:\xampp\htdocs\thinkphp5\public/../vendor/autoload.php&#39; (include_path=&#39;D:\xampp\php\PEAR&#39;) in D:\xampp\htdocs\thinkphp5\public\index.php on line 15</code></pre>
<p>后来在找到了最终的解决方案：</p>
<blockquote>
<p>答案一：你composer都没装</p>
<p>答案二：5.1不支持下载安装的 只能用composer安装</p>
</blockquote>
<p>后来重新采用composer方式进行TP5的部署，报错搞定！</p>
<h2 id="用tp5中的三层分离模式中的视图层来渲染控制器中的查询结果"><a href="#用tp5中的三层分离模式中的视图层来渲染控制器中的查询结果" class="headerlink" title="用tp5中的三层分离模式中的视图层来渲染控制器中的查询结果"></a>用tp5中的三层分离模式中的视图层来渲染控制器中的查询结果</h2><p>笔者曾经采用过tp5单纯地作为后端来提供api服务，前端没有采用tp5的视图层来提供解决方案。</p>
<p>这次，笔者想通过视图层来渲染控制器的返回结果。</p>
<p>在采用视图层遇到的问题的解决方案：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/milli236/article/details/86360444">https://blog.csdn.net/milli236/article/details/86360444</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000011454909/a-1020000011455818">https://segmentfault.com/q/1010000011454909/a-1020000011455818</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6a0ee69b047b">https://www.jianshu.com/p/6a0ee69b047b</a></p>
<p>来个最简单的示例：</p>
<p>控制器我们就用默认的Index.php</p>
<pre><code>&lt;?php
namespace app\index\controller;

use think\View;

class Index
&#123;
    public function index()
    &#123;
        return view(&#39;index&#39;);
    &#125;

&#125;</code></pre>
<p>这个就是一个很简单的控制器，这个里面返回的就是一个视图，我们首先需要引入视图这个类。</p>
<pre><code>use think\View</code></pre>
<p>然后，我们通过路由访问控制器中的index这个函数的时候，会被index模块中的view下的Index文件夹中的index.html来显示。</p>
<p>我们扩展一下，如果我们在Index控制器中写了另外一个函数，比如：</p>
<pre><code>public function student()
&#123;
    return view(&#39;student&#39;);
&#125;</code></pre>
<p>那么，我们访问student这个函数的时候，负责显示结果的是index模块中的view文件夹中的index文件中的student.html。如果我们没有事先新建这个文件，那么就会报错，说找不到这个文件，新建即可。</p>
<p>我们继续扩展，比如如果我们再index这个模块中新建了另外一个控制器叫做Student.php，里面的代码如下：</p>
<pre><code>&lt;?php
namespace app\index\controller;
use think\View;

class Student
&#123;
    public function index()
    &#123;
        return view(&#39;student&#39;);
    &#125;
&#125;</code></pre>
<p>当我们访问Student.php这个控制器中的index函数的时候，负责在前台显示的是index模块下的view文件夹下的student文件夹下的student.html，如果我们没有事先创建这个文件或者文件夹，就会报错：</p>
<pre><code>模板文件不存在:H:\xampp\htdocs\tp5\application\index\view\student\student.html</code></pre>
<p>这样应该就很明白了吧，是一个很严格的对应，我们现在修改上面那个函数：</p>
<pre><code>public function index()
&#123;
    return view(&#39;index&#39;);
&#125;</code></pre>
<p>当我们访问Student.php这个控制器中的index函数的时候，负责在前台显示的是index模块下的view文件夹下的student文件夹下的index.html，如果我们没有事先创建这个文件或者文件夹，就会报错：</p>
<pre><code>模板文件不存在:H:\xampp\htdocs\tp5\application\index\view\student\index.html</code></pre>
<p>好的，我们经过这么一个折腾，关于控制器中的返回结果由视图的哪个文件显示已经非常清楚了。</p>
<h2 id="编写api，运用api到前后台的逻辑操作中"><a href="#编写api，运用api到前后台的逻辑操作中" class="headerlink" title="编写api，运用api到前后台的逻辑操作中"></a>编写api，运用api到前后台的逻辑操作中</h2><p>前面说了当我们访问控制器中的某个方法，如何访问呢？路由是怎么进行的？</p>
<p>这个我们不妨去看下TP5中的说明：</p>
<p><a target="_blank" rel="noopener" href="https://www.kancloud.cn/manual/thinkphp5_1/353962">https://www.kancloud.cn/manual/thinkphp5_1/353962</a></p>
<p>这个路由的设置规则就是我们常说的api了，我们把控制器的每一个函数跟我们配置好的路由一一对应起来，我们就可以在浏览器的地址栏中访问这个了。比如：</p>
<pre><code>...
Route::rule(&#39;index&#39;,&#39;index/Index/index&#39;,&#39;GET|POST&#39;);
Route::rule(&#39;student&#39;,&#39;index/Student/index&#39;,&#39;GET|POST&#39;);
Route::rule(&#39;frontpage/student&#39;,&#39;index/Index/student&#39;,&#39;GET|POST&#39;);

Route::get(&#39;demo/showInfo&#39;, &#39;demo/Index/showInfo&#39;);

Route::get(&#39;think&#39;, function () &#123;
    return &#39;hello,ThinkPHP5!&#39;;
&#125;);
...</code></pre>
<p>这些代码是写在route文件夹下的route.php文件中。当然还可以写在其他文件中，可以自己定义，具体的参考TP5<a target="_blank" rel="noopener" href="https://www.kancloud.cn/manual/thinkphp5_1/353962">相应的文档</a>。</p>
<p>通常会写很多个规则，假设我们想要访问index模块中的Student控制器中的index()函数的内容，那么我们只需要在浏览器中输入：</p>
<pre><code>http://localhost/tp5/public/student</code></pre>
<p>就可以访问了。</p>
<p>大家可以留意下路由配置的各种写法。</p>
<h2 id="为该项目建立前后台，分别采用不同的UI框架，以及引入外部文件的方法"><a href="#为该项目建立前后台，分别采用不同的UI框架，以及引入外部文件的方法" class="headerlink" title="为该项目建立前后台，分别采用不同的UI框架，以及引入外部文件的方法"></a>为该项目建立前后台，分别采用不同的UI框架，以及引入外部文件的方法</h2><p>为了更认真地做这个测试项目，笔者在application下建立两个文件夹，名字自己随便取：</p>
<pre><code>admin文件夹
index模块</code></pre>
<p>当然，也可以通过命令来快速新建一个模块：</p>
<p><strong>模块生成</strong></p>
<p>切换到命令行模式下，进入到应用根目录，也就是tp5这个文件夹下，并执行如下指令：</p>
<pre><code>php think build --module admin
php think build --module index</code></pre>
<p>然后，就可以把路由规则分别写好，访问前台的路由，访问后台的路由等等。</p>
<p>这样就可以把前后台的各种逻辑操作隔离开来了。</p>
<p>模块分开了之后，我们还要处理前后台的UI的问题，为了快速而便捷地搭建界面笔者采用引入第三方的框架，根据项目需求和业务规则大家自行采用即可。比如bootsrap,layui等。</p>
<p>而这些第三方框架放在哪个目录呢？<strong>放在tp5/public/static中</strong>，然后如何引用呢？这个取决于项目的路径，假设我们的项目不是在web服务器的二级目录下，是在生产环境中，我们在视图文件中的引入如下：</p>
<pre><code>&lt;link rel=&quot;stylesheet&quot; href=&quot;./public/static/css/bootstrap.min.css&quot;/&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;./public/static/css/amazeui.min.css&quot;/&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;./public/static/css/style.css&quot;/&gt;
&lt;script src=&quot;./public/static/js/jquery-3.3.1.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;./public/static/js/amazeui.min.js&quot;&gt;&lt;/script&gt;</code></pre>
<p>其实跟普通的引入差不多，当然我这样写是基于笔者当前测试项目路径而言的，也是跟配置有关的，如果大家发现路径有问题，稍作修改即可，就可以正确引入外部的js和css文件了。</p>
<h2 id="隐藏public和index-php"><a href="#隐藏public和index-php" class="headerlink" title="隐藏public和index.php"></a>隐藏public和index.php</h2><p>由于笔者是在本地环境进行测试的，那么老是访问的时候有个public在url中，那么如何取消public呢，这样就可以直接通过：</p>
<pre><code>http://localhost/tp5/student</code></pre>
<p>访问，而不用通过：</p>
<pre><code>http://localhost/tp5/public/student</code></pre>
<p>这样也显得简短。有的时候，我们在用tp5来访问的时候，需要</p>
<pre><code>http://localhost/tp5/index.php/public/student</code></pre>
<p>才能正确访问，这个中间多了一个index.php，显得很累赘，那么如何取消index.php和隐藏public呢？请往下看：</p>
<p>参考这个教程：<a target="_blank" rel="noopener" href="https://blog.csdn.net/fangkang7/article/details/83068645">https://blog.csdn.net/fangkang7/article/details/83068645</a></p>
<p>步骤写一下吧：</p>
<p>1.将public下的index.php和.htaccess文件移到根目录下</p>
<p>2.修改index.php文件</p>
<p>注意这里，需要修改，把原来的：</p>
<pre><code>require __DIR__ . &#39;/../thinkphp/base.php&#39;;</code></pre>
<p>改成如下：</p>
<pre><code>require __DIR__ . &#39;/thinkphp/base.php&#39;;</code></pre>
<p>3.修改.htaccess文件</p>
<p>把原来的</p>
<pre><code>&lt;IfModule mod_rewrite.c&gt;
  Options +FollowSymlinks -Multiviews
  RewriteEngine On

  RewriteCond %&#123;REQUEST_FILENAME&#125; !-d
  RewriteCond %&#123;REQUEST_FILENAME&#125; !-f
  RewriteRule ^(.*)$ index.php/$1 [QSA,PT,L]
&lt;/IfModule&gt;</code></pre>
<p>改成如下：</p>
<pre><code>&lt;IfModule mod_rewrite.c&gt;
  Options +FollowSymlinks -Multiviews
  RewriteEngine On

  RewriteCond %&#123;REQUEST_FILENAME&#125; !-d
  RewriteCond %&#123;REQUEST_FILENAME&#125; !-f
  RewriteRule ^(.*)$ index.php?s=$1 [QSA,PT,L]
&lt;/IfModule&gt;</code></pre>
<p>然后重启以下服务器，就可以直接用</p>
<pre><code>http://localhost/tp5</code></pre>
<p>访问项目了。</p>
<h2 id="项目的增删改查等操作的功能编写"><a href="#项目的增删改查等操作的功能编写" class="headerlink" title="项目的增删改查等操作的功能编写"></a>项目的增删改查等操作的功能编写</h2><p>一个web项目无非就是一些增加内容，删除内容，更新内容，查询内容等操作，而这些操作都是有前后端相互配合的，后端把增删改查等逻辑api写好，是否接受参数等，把使用方法写成文档是规范的做法，为了测试我们就不写文档了，然后前端就根据api的用法像后端传递必要的参数，比如要查询某个学生的信息，那么后端的api需要接受来自前端传递一个学生号，那么前端在采用ajax发起http请求的时候，就要携带这个参数，具体写法，大家可以网上搜索下，关于ajax请求的写法很丰富。</p>
<p>通过前端向后端发起请求，获取响应结果，然后渲染出来，这个就是前端需要完成的。渲染在哪里呢？正是本文前面探讨过的，要显示在视图文件中，方法前面已经说了。访问不同的路由用不同的视图文件渲染。</p>
<p>关于TP5的数据操作是很重要的，这个可以说是他们的核心了，大家可以参考链接：<a target="_blank" rel="noopener" href="https://www.kancloud.cn/manual/thinkphp5_1/353997">https://www.kancloud.cn/manual/thinkphp5_1/353997</a></p>
<p>比如，</p>
<p><strong>要查询表的结果</strong>：</p>
<pre><code>public function getStudent()
&#123;
    $data = Db::table(&#39;student&#39;)
        -&gt;select();
    return json($data);
&#125;</code></pre>
<p>把这个写成一个api，前端就可以发起ajax请求了。</p>
<p><strong>删除表的某条记录</strong>：</p>
<pre><code>public function deleteStudent()
&#123;
    $student_id = input(&#39;get.id/d&#39;);
    Db::table(&#39;student&#39;)-&gt;where(&#39;id&#39;,$student_id)-&gt;delete();
    $result = array(&#39;code&#39; =&gt; 1, &#39;msg&#39; =&gt; &quot;OK&quot;);
    return json($result);
&#125;</code></pre>
<p>说明：删除记录，需要从前端传递参数到后端，这里就是根据前端穿度的一个id作为参数来让数据表进行删除操作。</p>
<p><strong>更新表的某条记录</strong>：</p>
<pre><code>public function updateStudent()
&#123;
    $student_name = input(&#39;get.name/s&#39;);
    $student_grade = input(&#39;get.grade/d&#39;);
    $student_mobile = input(&#39;get.mobile/s&#39;);
    $student_address = input(&#39;get.address/s&#39;);
    $student_age = input(&#39;get.age/d&#39;);
    $student_id = input(&#39;get.id/d&#39;);
    $data = [
        &#39;name&#39; =&gt; $student_name,
        &#39;grade&#39; =&gt; $student_grade,
        &#39;mobile&#39; =&gt; $student_mobile,
        &#39;address&#39; =&gt; $student_address,
        &#39;age&#39; =&gt; $student_age
    ];
    Db::name(&#39;student&#39;)-&gt;where(&#39;id&#39;,$student_id)-&gt;update($data);
    $result = array(&#39;code&#39; =&gt; 1, &#39;msg&#39; =&gt; &quot;OK&quot;);
    return json($result);
&#125;</code></pre>
<p>说明：更新那么就意味着需要传递参数到后端去，所以前面的这些：</p>
<pre><code>$student_name = input(&#39;get.name/s&#39;);
$student_grade = input(&#39;get.grade/d&#39;);
$student_mobile = input(&#39;get.mobile/s&#39;);
$student_address = input(&#39;get.address/s&#39;);
$student_age = input(&#39;get.age/d&#39;);
$student_id = input(&#39;get.id/d&#39;);</code></pre>
<p>都是从前端传递过来的，通过get或者post都可以，具体用法可以参考<a target="_blank" rel="noopener" href="https://www.kancloud.cn/manual/thinkphp5_1/353987">TP5的文档</a>，写法很丰富。</p>
<p><strong>添加表的记录</strong>：</p>
<pre><code>public function addStudent()
&#123;
    $student_name = input(&#39;get.name/s&#39;);
    $student_grade = input(&#39;get.grade/d&#39;);
    $student_mobile = input(&#39;get.mobile/s&#39;);
    $student_address = input(&#39;get.address/s&#39;);
    $student_age = input(&#39;get.age/d&#39;);
    $data = [
        &#39;name&#39; =&gt; $student_name,
        &#39;grade&#39; =&gt; $student_grade,
        &#39;mobile&#39; =&gt; $student_mobile,
        &#39;address&#39; =&gt; $student_address,
        &#39;age&#39; =&gt; $student_age
    ];
    Db::name(&#39;student&#39;)-&gt;insert($data);
    $result = array(&#39;code&#39; =&gt; 1, &#39;msg&#39; =&gt; &quot;OK&quot;);
    return json($result);
&#125;</code></pre>
<p>说明，同上，也是传递参数，这些参数会被保存到数据表中。然后返回添加结果，以便让前端开发人员知道发起的ajax请求后的反馈结果，是成功了还是失败了。</p>
<p>当然，这个是最简单的写法，随着业务的复杂，这些函数会变得异常的复杂，但是万变不离其宗，复杂的逻辑都是由一个个简单的基础的逻辑组合起来的。</p>
<p>完成了这个之后，笔者粘贴一张在后台查询学生信息的效果图：</p>
<p><img src="https://i.imgur.com/5SZ9mwq.png"></p>
<p>这一个表里面就包含了典型的增删改查四个要点了。</p>
<p>事实上，tp5后台也是一个前端，只不过对用户的访问进行了一个控制，所以前端怎么跟后端打交道呢？来一个典型的前端的ajax请求吧。</p>
<pre><code>function addUser()&#123;
    var student = new Object();
    student.name = $(&#39;#myModal input[name=&quot;user_name&quot;]&#39;).val();
    student.address = $(&#39;#myModal input[name=&quot;user_address&quot;]&#39;).val();
    student.mobile = $(&#39;#myModal input[name=&quot;user_mobile&quot;]&#39;).val();
    student.grade = $(&#39;#myModal input[name=&quot;user_grade&quot;]&#39;).val();
    student.age = $(&#39;#myModal input[name=&quot;user_age&quot;]&#39;).val();

    $.ajax(&#123;
        url:&quot;./api/student/addStudent&quot;,
        type: &quot;get&quot;,
        data: student,
        dataType: &quot;json&quot;,
        contentType: &quot;application/json&quot;,
        success: function(res)&#123;
            console.log(res);
        &#125;,
        error: function(xhr, err, exception)&#123;
            console.log(err);
        &#125;
    &#125;)
&#125;</code></pre>
<p>这个是一个典型的添加用户信息的js写法，实例化一个对象，然后发起ajax请求，把对象传递到后端去，如果传递成功能后，在控制台打印后端的处理结果。</p>
<h2 id="tp5中文件上传或图片上传的功能"><a href="#tp5中文件上传或图片上传的功能" class="headerlink" title="tp5中文件上传或图片上传的功能"></a>tp5中文件上传或图片上传的功能</h2><p>在本地测试的过程中，这里很常见的一个就是图片或者文件的上传，比如某个用户注册了，然后进到用户个人中心后，更新或者上传自己的个人头像，这个该如何实现呢？</p>
<p>笔者在解决这个问题的时候也是折腾了一些时间，深感不易，这里做个记录，以后就不用动脑子了，</p>
<p>视图文件中的代码：</p>
<pre><code>&lt;form action=&quot;./api/user/uploadFile&quot; enctype=&quot;multipart/form-data&quot; method=&quot;post&quot; id=&quot;user_avatar_form&quot;&gt;
  &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;pic&quot;&gt;
  &lt;input type=&quot;hidden&quot; name=&quot;username&quot; value=&quot;&quot;&gt;
  &lt;input type=&quot;submit&quot; class=&quot;layui-btn layui-btn-sm&quot; value=&quot;提交&quot;&gt;
&lt;/form&gt;</code></pre>
<p>说明：如果大家出现了上传图片之后图片没有在public目录的uploads文件夹被存下来，或者出现</p>
<pre><code>Call to a member function move() on null</code></pre>
<p>这种情况的时候，其实是下方后端中的<code>$file</code>变量是空的，其实是表单中不记得写</p>
<pre><code>enctype=&quot;multipart/form-data&quot;</code></pre>
<p>这个属性了，加在form标签中即可（上方已经加了）。里面包含了后端的api，</p>
<pre><code>api/user/uploadFile</code></pre>
<p>这里用表单的方式，目前笔者只有用表单实现得最顺手，当然应该也有不用表单的实现方法的。</p>
<p>然后控制器中的完整的代码：</p>
<pre><code>&lt;?php
namespace app\admin\controller;

use think\Controller;
use think\Request;
use think\Response;
use think\DB;
use think\View;
use think\facade\App;

class Index extends controller
&#123;

    public function uploadFile()&#123;

        $rootPath = App::getRootPath();
        if(!defined(&#39;DS&#39;)) define(&#39;DS&#39;, DIRECTORY_SEPARATOR);

         // 获取表单上传文件 例如上传了001.jpg
        $file = request()-&gt;file(&#39;file&#39;);
        // 移动到框架应用根目录/public/uploads/ 目录下
        $info = $file-&gt;validate([&#39;ext&#39;=&gt;&#39;jpg,png,gif&#39;])-&gt;move($rootPath . &#39;public&#39; . DS . &#39;uploads&#39;);
        if($info)&#123;
            $filePath = &#39;public&#39; . DS . &#39;uploads/&#39;.$info-&gt;getSaveName();
            $user_name = $_POST[&#39;username&#39;];
            $getInfo = $info-&gt;getInfo();
            //获取图片的原名称
            $name = $getInfo[&#39;name&#39;];
            //整理数据,写入数据库
            $data = [
                &#39;path&#39; =&gt; $filePath,
                &#39;user&#39; =&gt; $user_name,
                &#39;name&#39; =&gt; $name,
                &#39;create_time&#39; =&gt; date(&#39;Y-m-d H:i:s&#39;)
            ];

            $result = Db::name(&#39;user_image&#39;)-&gt;where(&#39;user&#39;,$user_name)-&gt;find();

            if ($result == null) &#123;
                Db::name(&#39;user_image&#39;)-&gt;insert($data);
            &#125;else&#123;
                Db::name(&#39;user_image&#39;)-&gt;where(&#39;user&#39;,$user_name)-&gt;update($data);
            &#125;
        &#125;else&#123;
            // 上传失败获取错误信息
            echo $file-&gt;getError();
        &#125;

        // 更新或者添加操作完成后重定向到指定的路由
        $this-&gt;redirect(&#39;/tp5/admin&#39;);
    &#125;

 &#125;    </code></pre>
<p>说明：这个就是用来处理文件或者图片上传的后端代码，需要引入必要的依赖，在头部那里都写了，然后呢就是：</p>
<pre><code>$rootPath = App::getRootPath();
if(!defined(&#39;DS&#39;)) define(&#39;DS&#39;, DIRECTORY_SEPARATOR);</code></pre>
<p>说到这两条代码，最开始笔者在参考<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/baf92d85da68">这篇文章</a>的时候，发现是这样写的：</p>
<pre><code>$info = $file-&gt;validate([&#39;ext&#39;=&gt;&#39;jpg,png,gif&#39;])-&gt;move(ROOT_PATH . &#39;public&#39; . DS . &#39;uploads&#39;);</code></pre>
<p>如果这样用点击提交的时候，就会报错：</p>
<pre><code>Use of undefined constant ROOT_PATH - assumed &#39;ROOT_PATH&#39;</code></pre>
<p>一看报错就去查了下TP5.1中的ROOT_PATH，这个说未定义常量根路径。然后网上找了下，说要这样用：</p>
<pre><code>// 引入依赖
use think\facade\App;

$rootPath = App::getRootPath();</code></pre>
<p>然后，当我改成：</p>
<pre><code>$info = $file-&gt;validate([&#39;ext&#39;=&gt;&#39;jpg,png,gif&#39;])-&gt;move($rootPath . &#39;public&#39; . DS . &#39;uploads&#39;);</code></pre>
<p>的时候，再次尝试添加图片和文件的时候，还是报错，报的错误如下：</p>
<pre><code>Use of undefined constant DS - assumed &#39;DS&#39;</code></pre>
<p>还是跟前面的那个报错一样的，要解决下DS这个的问题，<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/18503023/joomla-3-0-ds-does-not-workuse-of-undefined-constant-ds">网上</a>找了下，说添加如下代码即可：</p>
<pre><code>if(!defined(&#39;DS&#39;)) define(&#39;DS&#39;, DIRECTORY_SEPARATOR);</code></pre>
<p>添加完了之后，就不会出现报错了，然后我们就在数据库建一个表，用来存放上传和添加的图片信息。</p>
<pre><code>SET FOREIGN_KEY_CHECKS=0;

-- ----------------------------
-- Table structure for user_image
-- ----------------------------
DROP TABLE IF EXISTS `user_image`;
CREATE TABLE `user_image` (
  `path` varchar(255) CHARACTER SET utf8 DEFAULT NULL,
  `name` varchar(255) CHARACTER SET utf8 DEFAULT NULL,
  `create_time` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  `user` varchar(255) CHARACTER SET utf8 DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;</code></pre>
<p>默认情况下TP5.1下的public文件夹没有uploads这个文件夹，需要手动创建。</p>
<p>接着继续讲，如果想要调用上传照片时候的限制的话这样写：</p>
<pre><code>$info = $file-&gt;validate([&#39;size&#39;=&gt;5242880,&#39;ext&#39;=&gt;&#39;jpg,png,gif&#39;])-&gt;move(ROOT_PATH.&#39;public&#39;.DS.&#39;uploads&#39;);</code></pre>
<p>其中参数size代表上传的照片最大大小，ext代表支持上传的类型。</p>
<p>然后就是获取前端传递过来的参数，然后就可以进行插入或者更新操作了。</p>
<p>里面的逻辑已经很清晰了，先判断一下这个用户是否有头像，如有，那么就执行更新操作，如果没有就执行添加操作。</p>
<pre><code>$result = Db::name(&#39;user_image&#39;)-&gt;where(&#39;user&#39;,$user_name)-&gt;find();

if ($result == null) &#123;
    Db::name(&#39;user_image&#39;)-&gt;insert($data);
&#125;else&#123;
    Db::name(&#39;user_image&#39;)-&gt;where(&#39;user&#39;,$user_name)-&gt;update($data);
&#125;</code></pre>
<p>好的，接着我们需要明白这样一个问题：</p>
<blockquote>
<p>前端采用form表单提交的话，会导致直接跳转到form里面的action的路径去，这个时候，我们需要跳回来才行，笔者尝试过前端的方式进行跳转，甚至尝试着用ajax的方式来解决表单提交，这些相信都是可以解决的，后来用了最省事的方法，直接在后端那边处理跳转的问题。</p>
</blockquote>
<p>解决form表单提交后跳回来，我们只需要对action对应的api进行修改，我们查阅TP5.1的重定向或者采用php原生的跳转都是可以的，这里就用TP5.1的redirect方法进行跳转。</p>
<p>在uploadFile()函数中的最后添加如下代码：</p>
<pre><code>$this-&gt;redirect(&#39;/tp5/admin&#39;);</code></pre>
<p>这个就是跳转到<code>http://www.yourdomain.com/tp5/admin</code>，由于笔者用的是二级目录（localhost/tp5）做的测试，所以就换成了<code>/tp5/admin</code>，如果真正用到生产环境的时候，不以二级目录的方式的话，那么这样写即可：</p>
<pre><code>$this-&gt;redirect(&#39;/admin&#39;);</code></pre>
<p>当我加完之后呢，前台尝试了下还是不行，点击提交居然不跳转，后来<a target="_blank" rel="noopener" href="https://blog.csdn.net/amberom/article/details/79006145">查阅资料</a>发现，原来缺少这两个东西：</p>
<pre><code>use think\Controller;
class Index extends controller</code></pre>
<p>于是加上去，然后再试一下就可以完美的跳转了，事实上TP5.1的跳转还有别的用法，比如延迟跳转等等，可以自行网站<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/9b9d9d68e1aa">查阅</a>。</p>
<p>解释完毕，当然这里仅仅是把做常规的操作实现了，当然如果想要更加严格的逻辑控制，自己可以添加一些进去。</p>
<p>本文会持续更新，敬请关注。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/08/10/%E5%85%B3%E4%BA%8E%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%92%8C%E7%BD%91%E7%AB%99%E4%BB%8E%E6%B5%8B%E8%AF%95%E7%89%88%E5%88%B0%E4%B8%8A%E7%BA%BF%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%A1%88%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/10/%E5%85%B3%E4%BA%8E%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%92%8C%E7%BD%91%E7%AB%99%E4%BB%8E%E6%B5%8B%E8%AF%95%E7%89%88%E5%88%B0%E4%B8%8A%E7%BA%BF%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%A1%88%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">关于域名解析和网站从测试版到上线的两种方案笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-10 16:02:01" itemprop="dateCreated datePublished" datetime="2019-08-10T16:02:01+08:00">2019-08-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:58:04" itemprop="dateModified" datetime="2020-10-11T11:58:04+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%9F%9F%E5%90%8D/" itemprop="url" rel="index"><span itemprop="name">域名</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>关于域名的一些基本知识</strong></p>
<p>baidu.com 4399.com等，这些都是域名，但是如果前面加上www. 那么它们就不是域名了，而是网站名了。</p>
<p>解析<a target="_blank" rel="noopener" href="http://www.163.com/index.html">http://www.163.com/index.html</a></p>
<p>1.<code>http://</code> 这个是协议，也是HTTP超文本传输协议，也就是网页在网上传输的协议.</p>
<p>2.<code>www</code> 这个是服务器名，代表超文本服务器</p>
<p>3.<code>163.com</code>这是一个域名，用来定位网站的独一无二的名字</p>
<p>4.<code>www.163.com</code>这是一个网站名，有服务器名+域名组成</p>
<p>5.<code>/</code>这个是根目录，也就是说，通过网站名找到服务器，然后在服务器存放网页的根目录</p>
<p>6.<code>index.html</code>这个是根目录下的默认网页</p>
<p>7.<code>http://www.163.com/index.html</code> 这个是URL，统一资源定位符，全球性地址，用于定位网上的资源.</p>
<hr>
<h4 id="网站上线的两种方法："><a href="#网站上线的两种方法：" class="headerlink" title="网站上线的两种方法："></a>网站上线的两种方法：</h4><p>为了方便讲解，我们约定一下，客户域名这里以test.com为例，我方为客户设计网站的时候用的测试域名为：test.badu.com，我方上线网站的服务器称为bluehost.</p>
<p><strong>方法一：通过IP解析上线网站</strong></p>
<p>首先，让客户进入到自己的域名test.com的域名管理后台，做个解析，把IP指向bluehost的IP。</p>
<p>如果，bluehost的web服务器的根目录下只有一个网站，那么访问test.com的时候，就可以访问bluehost根目录的内容了；如果bluehost里面有多个网站，那么需要做虚拟主机配置，让其支持多个网站，专业的说法就是多站点配置。</p>
<p>然后，就是把test.badu.com的源码迁移到bluehost的web根目录下。</p>
<p>接着，把数据库文件从测试网站迁移到上线的bluehost主机中的数据库中，而且要把数据库中的测试网站（test.badu.com）域名批量替换成上线的域名（比如客户网站域名为：test.com），然后导入这个sql文件到上线的bluehost的数据库中。</p>
<p>对应好了之后，访问网站前台就可以看到test.com跟test.badu.com的一模一样了。</p>
<p><strong>优点</strong>：简单，方便，直观。</p>
<p><strong>缺点</strong>：网站迁移的时候，需要经常修改解析记录。不安全，如果有多个网站的时候，需要额外做虚拟化。</p>
<hr>
<p><strong>方法二：通过DNS解析上线网站</strong></p>
<blockquote>
<p>网站从测试版（设计阶段）到上线（生成环境阶段）的整个过程。</p>
</blockquote>
<p><strong>首先</strong>，客户在自己的网站域名管理后台把域名的DNS更改到我们的bluehost服务器的DNS。</p>
<p><strong>接着</strong>，我们把测试版的网站的源码移动到上线的bluehost的主机上以存放网站的源码。</p>
<p><strong>然后</strong>，把数据库文件从测试网站迁移到上线的bluehost主机中的数据库中，而且要把数据库中的测试网站（test.badu.com）域名批量替换成上线的域名（比如客户网站域名为：test.com），然后导入这个sql文件到上线的bluehost的数据库中。</p>
<p><strong>最后</strong>，我方登录上线网站所在的bluehost账号，进去后，添加test.com到bluehost里面即可。</p>
<p>到前台访问：test.com就可以看到的所有东西跟测试版网站（test.badu.com）的一样，上线完成！</p>
<p><strong>优点</strong>：如果管理着多个网站，有多个bluehost服务器，当哪天其中某个网站出现故障的时候，就可以通过chrome浏览器插件（Open SEO Stats）快速定位到是哪台主机，进而快速的解决问题。</p>
<p>如果网站从一个bluehost迁移到另外一个bluehost的时候，不需要再次通知客户修改IP解析到新的IP，减少麻烦。</p>
<p><strong>缺点</strong>：这种情况是适合主机服务商支持添加域名到服务器中，主机商提供DNS值的情况。</p>
<p>本文会持续更新，敬请关注。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/08/09/%E4%BB%A5shopify%E7%9A%84section%E6%96%B9%E6%A1%88%E5%AE%9E%E7%8E%B0%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6%E9%A1%B5%E9%9D%A2%E5%B8%83%E5%B1%80%E7%9A%84%E8%87%AA%E7%94%B1%E5%88%87%E6%8D%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/09/%E4%BB%A5shopify%E7%9A%84section%E6%96%B9%E6%A1%88%E5%AE%9E%E7%8E%B0%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6%E9%A1%B5%E9%9D%A2%E5%B8%83%E5%B1%80%E7%9A%84%E8%87%AA%E7%94%B1%E5%88%87%E6%8D%A2/" class="post-title-link" itemprop="url">以shopify的section方案实现模板文件页面布局的自由切换</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-09 09:02:20" itemprop="dateCreated datePublished" datetime="2019-08-09T09:02:20+08:00">2019-08-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:58:03" itemprop="dateModified" datetime="2020-10-11T11:58:03+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/shopify/" itemprop="url" rel="index"><span itemprop="name">shopify</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>用过wordpress的人大概都知道，我们新建一个页面的时候，是可以灵活地选择页面的布局：左侧边栏，右侧边栏，无侧边栏等，这样可以根据页面的内容灵活选择是否有侧边栏，以及侧边栏的位置，而笔者在使用shopify的时候发现没有这么灵活，必须新建三个模板文件才能解决针对三个布局（无侧边栏，左侧边栏，右侧边栏）的需求。</p>
<p>试想一下，如果我们有很多个页面模板，比如：FAQ页面模板文件、联系我们页面模板文件、视频页面模板文件、博客模板文件等等。</p>
<p>这个时候，如果想要这些模板文件（比如FAQ页面）可以随时有侧边栏和无侧边栏的时候，我们不得不为FAQ页面单独建一个有左侧边栏的FAQ模板文件，一个有右侧边栏的FAQ模板文件，以及无侧边栏的FAQ模板文件，根据这个情况，那么我们将会要创建一个倍数级的页面模板文件。这样显得非常的不灵活。</p>
<blockquote>
<p>笔者的设想是shopify的网站管理员能够在后台随时可以切换某个页面的布局，设置完了后，即刻在前台页面体现出来。</p>
</blockquote>
<p>为了实现shopify的页面布局能够灵活的切换，我们就以主题源码中的templates的<code>page.liquid</code>页面模板为例：</p>
<pre><code>&lt;div class=&quot;grid&quot;&gt;
    &lt;div class=&quot;grid__item&quot;&gt;
        &lt;div class=&quot;section-header&quot;&gt;
          &lt;h1 class=&quot;section-header-title&quot;&gt;&#123;&#123; page.title &#125;&#125;&lt;/h1&gt;
        &lt;/div&gt;

        &lt;div class=&quot;rte&quot;&gt;
          &#123;&#123; page.content &#125;&#125;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
<p>通常是这样的，我们删除这个，然后找一个有侧边栏的模板文件，很幸运，我在博客页面模板文件中找到有侧边栏的方案，根据分解把决定布局的部分剥离出来。</p>
<p>左侧边栏的dom结构如下：</p>
<pre><code>&lt;div class=&quot;grid__item wide-one-quarter post-large-one-quarter large-one-quarter left-sidebar&quot;&gt;
  左侧边栏的内容
&lt;/div&gt;
&lt;div class=&quot;grid__item wide-three-quarters post-large-three-quarters large-three-quarters&quot;&gt;
  内容区
&lt;/div&gt;</code></pre>
<p>右侧边栏的dom结构如下：</p>
<pre><code>&lt;div class=&quot;grid__item wide-three-quarters post-large-three-quarters large-three-quarters&quot;&gt;
  内容区
&lt;/div&gt;
&lt;div class=&quot;grid__item wide-one-quarter post-large-one-quarter large-one-quarter right-sidebar&quot;&gt;
  右侧边栏的内容
&lt;/div&gt;</code></pre>
<p>那么，无侧边栏的dom结构我们直接采用默认的即可：</p>
<pre><code>&lt;div class=&quot;grid__item&quot;&gt;
    &lt;div class=&quot;rte&quot;&gt;
      内容区
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
<p>现在，我们就完成了三种页面布局的骨架了。剩下就是做逻辑控制即可。</p>
<p>如何让网站管理员可以灵活的更换布局呢？这个时候我们想到了shopify里面的section，这个文件夹里面存放都是一些可以在网站进行自定义设置的功能区块，一个新的设想孕育了，就是新建一个section，然后通过下拉的形式进行选择不同的值，然后模板文件通过获取section里面设置的值进行加载控制流中的内容。</p>
<p>我们在Sections文件夹中新建一个section，命名为：sidebar-switch，代码如下：</p>
<pre><code>&#123;% schema %&#125;
	  &#123;
	    "name": "Sidebar switch",
	    "settings": [
	      &#123;
	        "type": "select",
	        "id": "sidebar_type",
	        "label": "Sidebar type",
	        "default": "fullwidth",
	        "options": [
	          &#123;
	            "value": "fullwidth",
	            "label": "Fullwidth"
	          &#125;,
	          &#123;
	            "value": "right",
	            "label": "Right"
	          &#125;,
	          &#123;
	            "value": "left",
	            "label": "Left"
	          &#125;
	        ]
	      &#125;
	    ]
	  &#125;
	&#123;% endschema %&#125;
&#123;&#123;section.settings.sidebar_type&#125;&#125;</code></pre>
<p>看了这个代码，作为读者的你可能有点奇怪，<code>section.settings.sidebar_type</code>怎么写在最后呢？为何没有默认生成的样式和脚本的标签呢？因为我发现在模板文件那边加载这个section之后，这个设置的值虽然现实出来了，但是后面莫名地有很多空格，通过开发者工具就可以看得很清楚。经过层层排查，于是就把：</p>
<pre><code>&#123;% stylesheet %&#125;
	&#123;% endstylesheet %&#125;

&#123;% javascript %&#125;
	&#123;% endjavascript %&#125;</code></pre>
<p>这两个删除了，因为目前不需要，然后再把渲染设置的值的那个放在最后，这样就不会有空格了。</p>
<p>完成了这个之后，我们就在页面模板里面载入这个section文件。</p>
<pre><code>&#123;% section 'sidebar-switch' %&#125;</code></pre>
<p>然后就可以显示section里面的设置的值了，可是如何让这个值参与到控制流里面进行条件语句的控制呢？</p>
<p>我的逻辑设想如下：</p>
<pre><code>if(no sidebar)&#123;
  无侧边栏的dom
&#125;

if(rightsidebar)&#123;
  右边侧边栏的dom
&#125;

if(leftsidebar)&#123;
  左边侧边栏的dom
&#125;</code></pre>
<p>这个已经很清晰了，我们需要把section里面的值放在if里面的条件判断那里，这个时候我们需要运用到liquid的<a target="_blank" rel="noopener" href="https://liquid.bootcss.com/tags/variable/">capture</a></p>
<p>说明：将 capture 开始与结束标记之间的字符串捕获之后赋值给一个变量。通过 <code>capture</code> 创建的变量都是字符串。</p>
<p>输入</p>
<pre><code>&#123;% capture my_variable %&#125;I am being captured.&#123;% endcapture %&#125;
&#123;&#123; my_variable &#125;&#125;</code></pre>
<p>输出</p>
<pre><code>I am being captured.</code></pre>
<p>好的，那么我们就可以这样用了：</p>
<pre><code>&#123;% capture my_variable %&#125;&#123;% section 'sidebar-switch' %&#125;&#123;% endcapture %&#125;</code></pre>
<p>这样我们就可以把从section里面设置的值<strong>包含的dom结构</strong>保存在变量my_variable中。</p>
<p>注意：这里我们获取到的东西不仅仅是section那边设置的值，而是包含了一个dom元素，根据浏览器开发者工具定位发现，此时的变量my_variable的所有内容是：</p>
<pre><code>&lt;div id=&quot;shopify-section-sidebar-switch&quot; class=&quot;shopify-section&quot;&gt;right&lt;/div&gt;</code></pre>
<p>比如设置为左的时候，变量my_variable的所有内容是：</p>
<pre><code>&lt;div id=&quot;shopify-section-sidebar-switch&quot; class=&quot;shopify-section&quot;&gt;left&lt;/div&gt;</code></pre>
<p>无侧边栏的时候，变量my_variable的所有内容是：</p>
<pre><code>&lt;div id=&quot;shopify-section-sidebar-switch&quot; class=&quot;shopify-section&quot;&gt;fullwidth&lt;/div&gt;</code></pre>
<p>所以这个时候我们需要对他进行剪切过滤了，只保留right,left,fullwidth，那么我们就不得不要了解shopify的另外一个东西了：<code>slice</code></p>
<p>用法：只传入一个参数时将返回此参数作为下标所对应的单个字符。第二个参数是可选的，用于指定返回的子字符串的长度。</p>
<p>输入</p>
<pre><code>&#123;&#123; "Liquid" | slice: 0 &#125;&#125;</code></pre>
<p>输出</p>
<pre><code>L</code></pre>
<p>输入</p>
<pre><code>&#123;&#123; "Liquid" | slice: 2, 5 &#125;&#125;</code></pre>
<p>输出</p>
<pre><code>quid</code></pre>
<p>更多用法，请参考链接：<a target="_blank" rel="noopener" href="https://liquid.bootcss.com/filters/slice/">https://liquid.bootcss.com/filters/slice/</a></p>
<p>明白了这个用法的时候，我们就开始切割了，为了方便，笔者对section那里做了一个改进，改成如下：</p>
<pre><code>&#123;% schema %&#125;
	  &#123;
	    "name": "Sidebar switch",
	    "settings": [
	      &#123;
	        "type": "select",
	        "id": "sidebar_type",
	        "label": "Sidebar type",
	        "default": "0",
	        "options": [
	          &#123;
	            "value": "0",
	            "label": "Fullwidth"
	          &#125;,
	          &#123;
	            "value": "1",
	            "label": "Right"
	          &#125;,
	          &#123;
	            "value": "2",
	            "label": "Left"
	          &#125;
	        ]
	      &#125;
	    ]
	  &#125;
	&#123;% endschema %&#125;
&#123;&#123;section.settings.sidebar_type&#125;&#125;</code></pre>
<p>那么此时变量my_variable的所有内容变成类似如下：</p>
<pre><code>&lt;div id=&quot;shopify-section-sidebar-switch&quot; class=&quot;shopify-section&quot;&gt;0&lt;/div&gt;
&lt;div id=&quot;shopify-section-sidebar-switch&quot; class=&quot;shopify-section&quot;&gt;1&lt;/div&gt;
&lt;div id=&quot;shopify-section-sidebar-switch&quot; class=&quot;shopify-section&quot;&gt;2&lt;/div&gt;</code></pre>
<p>那么我们在创建一个变量sdb：</p>
<pre><code>&#123;% capture sdb %&#125;&#123;&#123;my_variable | slice:-7,1&#125;&#125;&#123;% endcapture %&#125;</code></pre>
<p>这个变量用来保存剪切过滤后的section那边传来的值，也就是去掉dom标签，只保留文本。</p>
<p>那么我们就可以运用liquid里面的if语句进行判断了，我们就需要了解<strong>if语句</strong></p>
<p>用法：只有当某个条件为 true 时才执行一段代码。</p>
<pre><code>&#123;% if adb == '0' %&#125;
	  无侧边栏
	&#123;% endif %&#125;

&#123;% if adb == '1' %&#125;
	  右侧边栏
	&#123;% endif %&#125;

&#123;% if adb == '2' %&#125;
	  左侧边栏
	&#123;% endif %&#125;</code></pre>
<p>完成这个之后，我们只需要把里面填充前面的三种布局dom即可，最后演化成如下：</p>
<pre><code>&lt;div class=&quot;grid&quot;&gt;

    &lt;div class=&quot;section-header&quot;&gt;
      &lt;h1 class=&quot;section-header-title&quot;&gt;&#123;&#123; page.title &#125;&#125;&lt;/h1&gt;
    &lt;/div&gt;

    &#123;% section 'sidebar-switch' %&#125;
    &#123;% capture my_variable %&#125;&#123;% section 'sidebar-switch' %&#125;&#123;% endcapture %&#125;
    &#123;% capture sdb %&#125;&#123;&#123;my_variable | slice:-7,1&#125;&#125;&#123;% endcapture %&#125;

    &#123;% if sdb == '0' %&#125;
	      <div class="grid__item">
	          <div class="rte">
	            &#123;&#123; page.content &#125;&#125;
	          </div>
	      </div>
	    &#123;% endif %&#125;

    &#123;% if sdb == '1' %&#125;
	      <div class="grid__item wide-three-quarters post-large-three-quarters large-three-quarters">
	        &#123;&#123; page.content &#125;&#125;
	      </div>
	      <div class="grid__item wide-one-quarter post-large-one-quarter large-one-quarter right-sidebar">
	        &#123;% include 'page-rightsidebar' %&#125;
	      </div>
	    &#123;% endif %&#125;

    &#123;% if sdb == '2' %&#125;
	      <div class="grid__item wide-one-quarter post-large-one-quarter large-one-quarter left-sidebar">
	        &#123;% include 'page-leftsidebar' %&#125;
	      </div>
	      <div class="grid__item wide-three-quarters post-large-three-quarters large-three-quarters">
	        &#123;&#123; page.content &#125;&#125;
	      </div>
	    &#123;% endif %&#125;

&lt;/div&gt;</code></pre>
<p>这样管理员在shopify后台定制的那里设置的时候，就可以看到根据的设置进行加载了。<strong>Templates</strong>文件夹里面的<code>page.liquid</code>模板文件和<strong>Sections</strong>里面的<code>sidebar-switch.liquid</code>文件的代码可以在这里下载。</p>
<p>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1hFNImIXjpIXDCAsMQFWtPg">https://pan.baidu.com/s/1hFNImIXjpIXDCAsMQFWtPg</a> 提取码：y6sr </p>
<p>本文完毕，敬请关注。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/08/06/%E7%BD%91%E9%A1%B5%E8%AE%BE%E8%AE%A1%E4%B8%AD%E9%87%87%E7%94%A8css%E8%83%8C%E6%99%AF%E4%BD%8D%E7%A7%BB%E5%92%8Ccss3%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7clip-path%E5%AE%8C%E6%88%90%E4%B8%8D%E8%A7%84%E5%88%99%E7%89%B9%E6%95%88%E8%AE%BE%E8%AE%A1%E7%9A%84%E9%9C%80%E6%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/06/%E7%BD%91%E9%A1%B5%E8%AE%BE%E8%AE%A1%E4%B8%AD%E9%87%87%E7%94%A8css%E8%83%8C%E6%99%AF%E4%BD%8D%E7%A7%BB%E5%92%8Ccss3%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7clip-path%E5%AE%8C%E6%88%90%E4%B8%8D%E8%A7%84%E5%88%99%E7%89%B9%E6%95%88%E8%AE%BE%E8%AE%A1%E7%9A%84%E9%9C%80%E6%B1%82/" class="post-title-link" itemprop="url">网页设计中采用css背景位移和css3的新特性clip path完成不规则特效设计的需求</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-06 14:52:07" itemprop="dateCreated datePublished" datetime="2019-08-06T14:52:07+08:00">2019-08-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:58:06" itemprop="dateModified" datetime="2020-10-11T11:58:06+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/css/" itemprop="url" rel="index"><span itemprop="name">css</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>很久没有写一些关于css的设计问题了，今天刚好有这么一个问题，感觉挺有意思的一个斜角设计效果，用到了一些相关的技巧，用以记录下。</p>
<p>本文两个问题：</p>
<blockquote>
<p>采用背景位移实现鼠标悬浮的时候，图片进行更换成另外一个效果或者另外一张图片；采用css3的新特性实现图片的斜角设计，鼠标悬浮的时候，发生一些效果的变化。</p>
</blockquote>
<p>预期的效果截图如下：</p>
<p><img src="https://i.imgur.com/FpqTofk.png"></p>
<p><img src="https://i.imgur.com/LwDq55Y.png"></p>
<p>鼠标悬浮上去之后：</p>
<p><img src="https://i.imgur.com/BAHb6fd.png"></p>
<p>背景位移的案例示例代码：</p>
<pre><code>&lt;div class=&quot;wayne_container&quot;&gt;
    &lt;div class=&quot;wayne_item&quot;&gt;
        &lt;div class=&quot;way_item_img&quot;&gt;&lt;/div&gt;
        &lt;h2&gt;hello world&lt;/h2&gt;
    &lt;/div&gt;
    &lt;div class=&quot;wayne_item&quot;&gt;
        &lt;div class=&quot;way_item_img&quot;&gt;&lt;/div&gt;
        &lt;h2&gt;hello world&lt;/h2&gt;
    &lt;/div&gt;
    &lt;div class=&quot;wayne_item&quot;&gt;
        &lt;div class=&quot;way_item_img&quot;&gt;&lt;/div&gt;
        &lt;h2&gt;hello world&lt;/h2&gt;
    &lt;/div&gt;
    &lt;div class=&quot;wayne_item&quot;&gt;
        &lt;div class=&quot;way_item_img&quot;&gt;&lt;/div&gt;
        &lt;h2&gt;hello world&lt;/h2&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;style&gt;
    .wayne_container&#123;
        display: flex;
    &#125;
    .wayne_item&#123;
        flex: 1;
        padding:10px;
        text-align: center;
    &#125;
    .way_item_img&#123;
        background-image: url(&#39;laser-icon.png&#39;);
        background-position:0px 0px;
        width: 100px;
        height: 100px;
        transition: 0.1s ease;
        margin: auto;
        background-size: 100%;
    &#125;
    .wayne_item:hover .way_item_img&#123;
        background-position:0px 100px;
    &#125;
    @media screen and (max-width: 760px)&#123;
        .wayne_container &#123;
            display: block !important;
        &#125;
        .wayne_item &#123;
            float: left;
            width: 50%;
        &#125;
        .wayne_item h2&#123;
          font-size: 16px;
          margin: 8px 0px;
        &#125;
    &#125;
&lt;/style&gt;</code></pre>
<p>我们需要一张图片，图片里面有一张图片的两种形式：悬浮之前的样式；悬浮之后的样式，为了确保一致，这两种状态的尺寸是一致的。</p>
<p>图片如下：</p>
<p><img src="https://i.imgur.com/ZrzAqiS.png"></p>
<p>其中一张图片的尺寸为：<code>100px*100px</code>;所以这张大图我们的尺寸为<code>100px*200px</code>;</p>
<p>用浏览器打开就可以看到相应的效果了。更多而可以参考<a target="_blank" rel="noopener" href="https://www.w3school.com.cn/cssref/pr_background-position.asp">背景位移</a></p>
<h2 id="关于css3的clip-path特性在斜角设计上的运用"><a href="#关于css3的clip-path特性在斜角设计上的运用" class="headerlink" title="关于css3的clip path特性在斜角设计上的运用"></a>关于css3的clip path特性在斜角设计上的运用</h2><p>这个直接上一个demo示例即可：</p>
<pre><code>&lt;style&gt;
    .slide-entry&#123;
       width: 100%;
       max-width: 400px;
    &#125;
    .slide-entry-excerpt .slider_imggs:after&#123;
      background: linear-gradient(rgba(255,255,255,1),rgba(255,255,255,1));
      -webkit-clip-path: polygon(0 0,0 0,100% 100%,0 100%);
      clip-path: polygon(0 0,0 0,100% 100%,0 100%);
      bottom: -10px;
      left: -2px;
      content: &quot;&quot;;
      transition: all 250ms ease-in-out;
      position: absolute;
      height: 65px;
      transition: 0.5s ease;
      width: 120%;
    &#125;
    .slider_imggs&#123;
      margin-bottom: 15px;
    &#125;
    .extra_info&#123;
      opacity: 0;
      display: none;
      transition: 0.5s ease;
    &#125;
    .extra_info a&#123;
      opacity: 0;
      transition: 0.5s ease;
    &#125;
    .slider_imggs .wgng img&#123;
      display: block;
      max-width: 400px;
    &#125;
    .slide-entry-excerpt:hover .extra_info&#123;
        height: 100%;
        opacity: 1;
        display: block;
        background: rgba(184, 137, 15, 0.7);
        width: 100%;
        display: block;
        position: absolute;
        z-index: 9999;
    &#125;
    .slide-entry-excerpt:hover .extra_info a&#123;
        position: absolute;
        top: calc(100%/2 - 40px);
        left: calc(100%/2 - 40px);
        opacity: 1;
        width: 100%;
        max-width: 80px;
    &#125;
    .slider_imggs&#123;
      position: relative;
    &#125;
    .slide-entry-excerpt:hover .slider_imggs:after&#123;
      height: auto;
    &#125;
&lt;/style&gt;

&lt;div class=&quot;slide-entry flex_column av_one_fourth first&quot;&gt;
    &lt;div class=&quot;slide-entry-excerpt entry-content&quot; itemprop=&quot;text&quot;&gt;
        &lt;div class=&quot;slider_ittem&quot;&gt;
            &lt;div class=&quot;slider_imggs&quot;&gt;
                &lt;span class=&quot;extra_info&quot;&gt;&lt;a href=&quot;#&quot;&gt;&lt;img src=&quot;http://bai.noctivr.com/wp-content/uploads/2019/08/icon.png&quot;&gt;&lt;/a&gt;&lt;/span&gt;
                &lt;div class=&quot;wgng&quot;&gt;&lt;img src=&quot;http://bai.noctivr.com/wp-content/uploads/2019/08/advantage-shorten-lead-time.jpg&quot;&gt;&lt;/div&gt;
            &lt;/div&gt;
            &lt;h3&gt;Military &amp;amp; Defense&lt;/h3&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
<p>这里只需要把dom结构设计好，剩下的就是分别处理好鼠标悬浮前和鼠标悬浮后的效果，然后把斜角加进去，然后把细节处理好就行了，本文不是为了提供一个现成的方案，而是提供一个思路，一种启示。我们可以在这个基础上变化成更多的风格。</p>
<p>比如：从左到右的倾斜；从右到左的倾斜，从中间出发到两边的倾斜等等。这个我们可以选择一个在线的图形裁剪工具：<a target="_blank" rel="noopener" href="http://tools.jb51.net/code/css3path">http://tools.jb51.net/code/css3path</a></p>
<p>会根据自己想要的形状进行裁剪，最后生成代码，直接粘贴即可。</p>
<p>比如我想要从中间出发，向两边倾斜怎么做？我们直接从上面的那个示例代码中获得启示：采用css的伪类，有两个伪类，一个是after我们已经用了，那么还有一个before还没用到，所以我们只需要在那个代码的基础上添加如下代码即可：</p>
<pre><code>.slide-entry-excerpt .slider_imggs:before&#123;
  background: linear-gradient(rgba(255,255,255,1),rgba(255,255,255,1));
  -webkit-clip-path: polygon(0 100%, 100% 100%, 100% 10%);
  clip-path: polygon(0 100%, 100% 100%, 100% 10%);
  bottom: -10px;
  right: -2px;
  content: &quot;&quot;;
  transition: all 250ms ease-in-out;
  position: absolute;
  height: 65px;
  transition: 0.5s ease;
  width: 120%;
&#125;</code></pre>
<p>我们可以看出与after相比，其实唯一不同的地方就是clip-path的属性值了。这个就是采用在线生成工具生成的，当然我们也可以去查查这个新特性的文档，自己设置。</p>
<p>添加后，效果就是中间是尖的，像一支铅笔那样：</p>
<p><img src="https://i.imgur.com/h3NcgGI.png"></p>
<p>其他的，大家可以根据自己的需要自己发挥。</p>
<p>当然：笔者还有一个建议，如果自己不知道倾斜的这个效果怎么写的，可以在网上搜索一下，然后找一个有倾斜效果的网站，然后根据开发者工具查找即可，很快就可以定位到这个效果的css代码的。</p>
<h2 id="解决div里面img图片下方有空白的问题"><a href="#解决div里面img图片下方有空白的问题" class="headerlink" title="解决div里面img图片下方有空白的问题"></a>解决div里面img图片下方有空白的问题</h2><p>在开发的过程中，我发现插入一张图片后，下面想紧跟着一个带背景色的div，不管我怎么折腾他都有一条白边。后来研究了一下发现自己对img标签了解的真不够深入。</p>
<p>根据上方的代码：</p>
<pre><code>...
&lt;div class=&quot;slider_imggs&quot;&gt;
    &lt;span class=&quot;extra_info&quot;&gt;&lt;a href=&quot;#&quot;&gt;&lt;img src=&quot;http://bai.noctivr.com/wp-content/uploads/2019/08/icon.png&quot;&gt;&lt;/a&gt;&lt;/span&gt;
    &lt;div class=&quot;wgng&quot;&gt;&lt;img src=&quot;http://bai.noctivr.com/wp-content/uploads/2019/08/advantage-shorten-lead-time.jpg&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
...</code></pre>
<p>这个里面就有一个典型的img在div里面的情况，当我们什么也不处理的时候，会发现在div里面的img后面有个白色的空间，无论怎么处理都没法去掉。</p>
<blockquote>
<p>首先要知道产生这部分空白区域的原理。<br>图片的display属性默认是inline，而这个属性的vertical-align的默认值是baseline。所以就会出现上图的情况（图片底部出现一个小留白区域）。</p>
</blockquote>
<p>那么这个问题的解决方案如下：</p>
<p><strong>方法1：对这个div里面的img由行类元素变成块级元素。</strong></p>
<pre><code>div.wgng img &#123;
    display: block;
&#125;</code></pre>
<p>这样留白就消失，当然如果此时想要有留白只需要通过padding的方式添加即可。</p>
<p><strong>方法2：</strong></p>
<pre><code>div.wgng img &#123;
    vertical-align: middle;
&#125;</code></pre>
<p>既然分析到img的vertical-align默认属性导致出现留白问题，所以直接修改vertical-align属性值就行咯。</p>
<p><strong>方法3：</strong></p>
<pre><code>div.wgng img &#123;
    margin-bottom: -10px;
&#125;</code></pre>
<p>把img元素的底部外边距改成负值，同样可以实现去留白的效果。<br>这里修改的值的大小，会影响整个页面的布局。<br>修改的足够小（比如-100px），图片的留白部分就会消失，但是img之后的元素会被动上移，且会藏在img标签的下面。甚至一不小心就很容易把img后面的内容网上移得太多，导致内容显示不全。<br>如下图所示：</p>
<p><img src="https://i.imgur.com/BOKlzzW.png"></p>
<p>其中，section里面的内容也会被覆盖一部分。</p>
<p>所以我这个案例修改成-10就ok了。</p>
<blockquote>
<p>因为这个方法可能会导致出现一些意想不到的事情，所以不建议用这个方法。</p>
</blockquote>
<p><strong>方法4：</strong></p>
<pre><code>div.wgng &#123;
    font-size: 0;
&#125;</code></pre>
<p>由上面的分析得到，出现留白的原因是因为垂直对齐的方式所导致的，所以可以修改父元素的font-size，把父元素的字体大小改为0，所以就没什么垂直对齐所言咯。</p>
<p>要注意的是：这个修改会影响class=”banner”这个元素里面的字体（因为字体属性能继承）。</p>
<p>同时需要注意的是：font-size要放在img的父元素里<code>div.wgng</code>，不能直接放在img样式里面。</p>
<p><strong>方法5：</strong></p>
<pre><code>div.wgng &#123;
    line-height: 0;
&#125;</code></pre>
<p>把img的父元素行高设成0，这样也就没什么垂直对齐所言。</p>
<p>需要注意的点和方法4所需注意的点差不多。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/07/31/%E8%BF%90%E7%94%A8javascript%E5%AF%B9shopify%E7%9A%84%E4%BA%A7%E5%93%81%E8%AF%A6%E6%83%85%E9%A1%B5%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E5%9C%A8%E7%BA%BF%E8%AF%A2%E7%9B%98%E6%8C%89%E9%92%AE%EF%BC%8C%E7%84%B6%E5%90%8E%E8%8E%B7%E5%8F%96%E4%BA%A7%E5%93%81%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF%E5%BF%AB%E9%80%9F%E6%8F%90%E4%BA%A4%E8%AF%A2%E7%9B%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/31/%E8%BF%90%E7%94%A8javascript%E5%AF%B9shopify%E7%9A%84%E4%BA%A7%E5%93%81%E8%AF%A6%E6%83%85%E9%A1%B5%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E5%9C%A8%E7%BA%BF%E8%AF%A2%E7%9B%98%E6%8C%89%E9%92%AE%EF%BC%8C%E7%84%B6%E5%90%8E%E8%8E%B7%E5%8F%96%E4%BA%A7%E5%93%81%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF%E5%BF%AB%E9%80%9F%E6%8F%90%E4%BA%A4%E8%AF%A2%E7%9B%98/" class="post-title-link" itemprop="url">运用javascript对shopify的产品详情页添加一个在线询盘按钮，然后获取产品的基本信息快速提交询盘</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-07-31 15:01:26" itemprop="dateCreated datePublished" datetime="2019-07-31T15:01:26+08:00">2019-07-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:58:06" itemprop="dateModified" datetime="2020-10-11T11:58:06+08:00">2020-10-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/shopify/" itemprop="url" rel="index"><span itemprop="name">shopify</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文是基于笔者经常测试的一个shopify主题mixer，笔者想要实现一个这样啊的需求，就是在产品详情页添加一个按钮，用户点击这个按钮的时候，就可以跳转到联系我们页面，然后把该产品的基本信息，比如：产品标题，产品链接，产品属性，产品价格等等填充到联系我们页面的表单中，如果用户登录了的话，还可以获取用户名称用户的电邮自动填充到联系表单中，用户只需要点击提交即可快速询盘了。这个对于用户而言是一个很好的体验。</p>
<p>问题来了，那么怎么做呢？</p>
<p>为了测试方便而不影响正在使用的这个产品详情的模板文件，笔者在后台的主题定制里面的Edit code那里，点击进去找到主题源码的Templates文件夹，点击新建一个模板，然后模板选择product，名字自己随便填写一个，比如：style2</p>
<p>然后就会有默认的代码，通常这个默认的代码就是主题默认的产品详情页的模板代码，我们只需要在这个基础上进行添加即可。</p>
<p>找到合适的位置，我们添加一个按钮：</p>
<pre><code>&lt;a href=&quot;#&quot; style=&quot;display:inline-block;background: #FF5722;padding:8px 20px;border-radius:3px;color: #fff;&quot; id=&quot;contact_to_quotation&quot; target=&quot;_blank&quot;&gt;contact us to quotation&lt;/a&gt;&lt;/p&gt;</code></pre>
<p>然后我们就把javascript代码添加在这个产品的模板文件的最后面：</p>
<pre><code>&lt;script&gt;
  jQuery(function($) &#123;

    $(&quot;#contact_to_quotation&quot;).click(function(event)&#123;
       // 阻止事件冒泡的发生
       event.preventDefault();
       // 获取产品的基本信息，比如产品的标题，页面的链接，产品的价格等等
       var production_info = new Object();
           production_info.title = $(&quot;.product-single__title&quot;).text();
           production_info.url = window.location.href;
           production_info.ProductPrice = $(&quot;#ProductPrice&quot;).text();
           production_info.production_rendor = $(&quot;.product-vendor&quot;).text();
       // 跳转到联系我们页面去，这里笔者采用相对路径的方式，然后追加参数，而这些参数值就是产品的一些基本信息
       window.location.href=&quot;/pages/contact-us?title=&quot;+production_info.title+&quot;&amp;url=&quot;+production_info.url+&quot;&amp;ProductPrice=&quot;+production_info.ProductPrice+&quot;&amp;rendor=&quot;+production_info.production_rendor;

       // 阻止默认事件，由于这个是a标签，所以默认事件会是一个链接到某个地方的默认行为，通过添加return false就可以阻止这个默认行为
       return false;
    &#125;);

  &#125;);   

&lt;/script&gt;</code></pre>
<p>保存这个产品模板文件，然后新建一个产品，然后在右下角Product template那个位置选择刚才新建的这个产品模板文件（product style2），然后在前台就可以看产品详情页里有一个按钮。</p>
<p><img src="https://i.imgur.com/p9cwOjK.png"></p>
<p>点击这个按钮后，就可以看到一个页面发生了跳转，而且跳转到联系我们页面的时候可以在地址栏那里看到一些参数，而这些参数的值将会被填充在联系表单中，而如何填充到某个表单里面去呢？</p>
<p>我们继续往下看。</p>
<p>我们需要在Templates文件夹下找到联系我们页面的那个模板文件，笔者这里是page.contact.liquid，打开文件，在最后面添加如下的javascript代码：</p>
<pre><code>&lt;script&gt;
  // 获取url中的参数函数
  function getUrlParam(name) &#123;
      var reg = new RegExp(&quot;(^|&amp;)&quot; + name + &quot;=([^&amp;]*)(&amp;|$)&quot;); //构造一个含有目标参数的正则表达式对象
      var r = window.location.search.substr(1).match(reg); //匹配目标参数
      if (r != null) return decodeURI(r[2]);
      return null; //返回参数值
  &#125;

  jQuery(function($) &#123;
    // 把url里面的参数值获取保存在变量中
    var quotation_product_url = getUrlParam(&#39;url&#39;);
    var quotation_product_title = getUrlParam(&#39;title&#39;);
    var quotation_product_price = getUrlParam(&#39;ProductPrice&#39;);
    var quotation_product_price_rendor = getUrlParam(&#39;rendor&#39;);
    // 把获取到的参数值以一行显示一个的方式显示出来，所以这里后面添加了一个换行符\n
    var product_info = &#39;product title:&#39;+quotation_product_title+&#39;\n&#39;;
        product_info += &#39;product url:&#39;+quotation_product_url+&#39;\n&#39;;
        product_info += &#39;product price:&#39;+quotation_product_price+&#39;\n&#39;;
    product_info += &#39;rendor:&#39;+quotation_product_price_rendor+&#39;\n&#39;;
    // 把加工后的信息填充到指定的位置，这里是ID为ContactFormMessage的dom中。
    $($(&quot;#ContactFormMessage&quot;).text(product_info));
  &#125;);

&lt;/script&gt;</code></pre>
<p>这样的话就可以看到在联系表单中ID为ContactFormMessage的textarea中显示了如下信息：</p>
<pre><code>product title:Antique ceramic ware
product url:https://test.myshopify.com/products/antique-ceramic-ware
product price:$0.10
rendor:              Brand:              NOC</code></pre>
<p>效果图如下：</p>
<p><img src="https://i.imgur.com/DmA1uEI.png"></p>
<p>由于笔者这里仅仅是用作测试，所以随便获取了几个信息进行了展示，如果用于生产环境中可能会更多，更严格，逻辑控制更严谨，完成了这一步我们基本就算完成了这个需求了。更多的可以学习下javascript。</p>
<hr>
<p>**更新：2019/8/7 16:19:19 **</p>
<p>我们扩展一下，我们可以运用这个方式来实现网站的批量询价的目的，当用户想要对多个产品进行询盘的时候，如果一个一个的进行发送会很费时费劲，我们可以让用户加入购物车，然后在购物页面获取所有产品的信息列表，然后在购物车页面添加一个联系表单，然后把所有的产品信息列表填充到联系表单中，用户只需要填写必要的信息，比如电子邮箱，名称即可提交询盘了。</p>
<p>这个如何实现呢？</p>
<p>这个方案跟前面的有点不一样，前面的那个是获取url链接里面的参数值。而这里不需要获取url链接里面的参数值，而是直接获取页面中的dom的文本数据，然后提取出来。</p>
<p>这里笔者就以shopify里面的购物车页面作为讲解，我们先添加几个产品到购物车页面，然后我们进入到购物车页面，那么我们就可以看到购物车页面有几个产品，以列表的形式被罗列出来。</p>
<p>我们只需要找到购入车页面添加联系表单：</p>
<pre><code>&lt;h2&gt;&lt;a href=&quot;#&quot; id=&quot;cart_quotation&quot;&gt;Quotation now&lt;/a&gt;&lt;/h2&gt;
&lt;div class=&quot;nocti_contact_form&quot;&gt;
  &lt;div class=&quot;contact-form-section&quot;&gt;
    &#123;% form 'contact' %&#125;
	    &#123;% if form.posted_successfully? %&#125;
	    <p class="note form-success">
	      &#123;&#123; 'contact.form.post_success' | t &#125;&#125;
	    </p>
	    &#123;% endif %&#125;
	
	    &#123;&#123; form.errors | default_errors &#125;&#125;
	    &#123;% assign name_attr = 'contact.form.name' | t | handle %&#125;
	
	    <label for="ContactFormName" class="label--hidden">&#123;&#123; 'contact.form.name' | t &#125;&#125;</label>
	    <input type="text" id="ContactFormName" name="contact[&#123;&#123; name_attr &#125;&#125;]" placeholder="&#123;&#123; 'contact.form.name' | t &#125;&#125;" autocapitalize="words" value="&#123;% if form[name_attr] %&#125;&#123;&#123; form[name_attr] &#125;&#125;&#123;% elsif customer %&#125;&#123;&#123; customer.name &#125;&#125;&#123;% endif %&#125;">
	
	    <label for="ContactFormEmail" class="label--hidden">&#123;&#123; 'contact.form.email' | t &#125;&#125;</label>
	    <input type="email" id="ContactFormEmail" name="contact[email]" placeholder="&#123;&#123; 'contact.form.email' | t &#125;&#125;" autocorrect="off" autocapitalize="off" value="&#123;% if form.email %&#125;&#123;&#123; form.email &#125;&#125;&#123;% elsif customer %&#125;&#123;&#123; customer.email &#125;&#125;&#123;% endif %&#125;">
	
	    <label for="ContactFormMessage" class="label--hidden">&#123;&#123; 'contact.form.message' | t &#125;&#125;</label>
	    <textarea rows="7" id="ContactFormMessage" name="contact[body]" placeholder="&#123;&#123; 'contact.form.message' | t &#125;&#125;">&#123;% if form.body %&#125;&#123;&#123; form.body &#125;&#125;&#123;% endif %&#125;</textarea>
	
	    <button type="submit" class="btn">&#123;&#123; 'contact.form.send' | t &#125;&#125;</button>
	    &#123;% endform %&#125;
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
<p>把这个代码放在合适的位置即可。我们就可以在购物车页面中看到一个联系表单，这个联系表单代码是从笔者这个主题中获取的，可能不同的主题联系表单代码有所不一样，大家找到自己主题中的联系表单代码加入进来即可。</p>
<p>在购物车页面利用开发者工具定位，然后获取产列表的dom，这个就不多说了，实现的js代码如下：</p>
<pre><code>&lt;script&gt;
  jQuery(function($) &#123;

    var products_list = $(&quot;.cart__row .grid__item .cart_items&quot;);

    var pro_mesage = &#39;&#39;;
    for(var i = 0; i &lt; products_list.length; i++)&#123;
      pro_mesage += &#39;产品名称：&#39;+$.trim($(products_list[i]).find(&#39;.cart-title a&#39;).text());
      pro_mesage += &#39;\n&#39;;
      pro_mesage += &#39;产品价格：&#39;+$(products_list[i]).parent().siblings().find(&quot;.product_jiage&quot;).text().replace(/[ ]/g,&#39;&#39;);
      pro_mesage += &#39;\n&#39;;
      pro_mesage += &#39;产品链接：&#123;&#123;shop.url&#125;&#125;&#39;+$(products_list[i]).find(&quot;.cart-title a&quot;).attr(&quot;href&quot;).replace(/[ ]/g,&#39;&#39;);
      pro_mesage += &#39;\n&#39;;
      pro_mesage += &#39;\n&#39;;
    &#125;

    if (products_list.length &gt;= 1) &#123;
      $($(&quot;#ContactFormMessage&quot;).text(pro_mesage));
    &#125;
  &#125;);

&lt;/script&gt;</code></pre>
<p>这个需要说明几个地方。</p>
<ol>
<li>去掉文本前面和后面的空格</li>
<li>去掉文本中所有的空格</li>
<li>shopify中在js中置入shopify系统的代码</li>
</ol>
<p><strong>去掉文本前面和后面的空格</strong></p>
<p>当笔者获取dom的文本后填入联系表单的时候，发现老是有空格，而这个空格是在dom中本身就存在的，如果填入有空格就显得很不整齐，所以需要清除掉。</p>
<p>去除值两边的空格用函数：<code>$.trim()</code>;</p>
<pre><code>$.trim(这里面就是jquery获取的dom文本)</code></pre>
<p>在本示例中就是：</p>
<pre><code>$.trim($(products_list[i]).find(&#39;.cart-title a&#39;).text())</code></pre>
<p><strong>去掉文本中所有的空格</strong></p>
<p>去除值所有的空格，包括两边的和中间的：<code>replace(/[ ]/g,&#39;&#39;)</code></p>
<blockquote>
<p>注意：中括号里是一个空格</p>
</blockquote>
<p>本示例中的用法如下：</p>
<pre><code>$(products_list[i]).find(&quot;.cart-title a&quot;).attr(&quot;href&quot;).replace(/[ ]/g,&#39;&#39;);</code></pre>
<p>这个就是用来去掉链接中的所有空格。</p>
<p>网上示例：</p>
<pre><code>$(&#39;#name&#39;).val().replace(/[ ]/g,&#39;&#39;);</code></pre>
<p>参考链接：<a target="_blank" rel="noopener" href="https://www.csdn.net/gather_2d/OtTaEgxsNTc3LWJsb2cO0O0O.html">https://www.csdn.net/gather_2d/OtTaEgxsNTc3LWJsb2cO0O0O.html</a></p>
<p><strong>shopify中在js中置入shopify系统的代码</strong></p>
<p>在本示例中，这个地方获取的a标签的href的属性值为相对路径，而我要填充的需要一个完整的产品链接，所以需要获取的url，当然这个方法有很多种，最常用的是<a target="_blank" rel="noopener" href="https://www.cnblogs.com/youcong/p/9477965.html">javascript获取当前url</a>的信息。</p>
<p>而在本示例中，我就不用这种方法了，因为cart.liquid这个是一个liquid文件，所以是支持和允许采用liquid语法的，所以根据对shopify的文档的查阅发现，获取网站url的代码为：</p>
<pre><code>&#123;&#123;shop.url&#125;&#125;</code></pre>
<p>所以我们拼接起来即可：</p>
<pre><code>pro_mesage += &#39;产品链接：&#123;&#123;shop.url&#125;&#125;&#39;+$(products_list[i]).find(&quot;.cart-title a&quot;).attr(&quot;href&quot;).replace(/[ ]/g,&#39;&#39;);</code></pre>
<p>然后，我们就可以完成这个产品信息列表的自动填充到联系表单里了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/43/">43</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">424</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">400</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
