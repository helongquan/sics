<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/36/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/36/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2017/05/08/%E5%85%AC%E7%BD%91%E4%B8%8E%E7%A7%81%E7%BD%91%E7%9A%84%E7%9F%A5%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/05/08/%E5%85%AC%E7%BD%91%E4%B8%8E%E7%A7%81%E7%BD%91%E7%9A%84%E7%9F%A5%E8%AF%86/" class="post-title-link" itemprop="url">公网与私网的知识</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-05-08 09:44:15" itemprop="dateCreated datePublished" datetime="2017-05-08T09:44:15+08:00">2017-05-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:02" itemprop="dateModified" datetime="2020-10-11T11:53:02+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="http://i.imgur.com/dh4Mnyf.jpg"></p>
<p>我们在申请阿里云服务器的时候，我们会发现他们提供一个公网IP，私网IP，我们通常用公网IP开解析域名，根据上面的示意图来看，公网IP是面对外部的访问的一张“门牌号”，我们可能会觉得奇怪，全世界IP很有限，为啥阿里云能够有这么多IP呢？事实上，阿里云确实购买了这么多，所以阿里云直接买的是IP，通过硬件虚拟化然后变成多个虚拟机售卖，所以我们在用FTP登录云服务器的时候，会用公网IP，私网IP是针对阿里云服务器内部各个服务器或者是虚拟机之间互相访问的，就是说各个虚拟机是同一个网络的，网络号是一样的。他们是同一个局域网的。</p>
<p><img src="http://i.imgur.com/xs5Ir4y.jpg"></p>
<p>两台电脑如何相互认识呢？就是通过IP来进行识别的，我们在家用的那种路由器，弄一个WIFI，那么连上这个WIFI的客户端，就是在同一个网络，如果我们手动修改的话，可以让他们不在同一个网络，只需修改网络号就行了，就是修改他们的子网掩码，所以门牌号不是电脑而是一张网卡，只要有一张网卡就能作为身份来相互识别，同样的，如果没有网卡，那么电脑是不能被相互识别的。在同一个局域网中ip可以手动逐个添加，也可以自动分配，这个概念就是DHCP，我们可以想一下，如果在一个局域网里面有很多台电脑，逐个添加IP是比较费时费力的。所以用动态分配就是最好的方法。有的时候我们发现我们的电脑可能连不上网，其他的客户端却能连得上，这里十有八九是启用了静态IP，改成动态ip就行了。也有可能是我们的路由器里面的DHCP关闭了，启用试试看。</p>
<p><img src="http://i.imgur.com/rEonKHt.jpg"></p>
<p>这里我顺便说一下ip的一些事情，一个ip号包括两个部分，一部分是网络号，用来表示这个是属于什么网络的（A网、B网、C网），这个举个例子192.168.1.1/8，这个表示这个是A网，因为一个ip有32节，每一节有8位数，所以8表示前面的8位是网络号（192），后面的24是主机号（168.1.1），从这里可以看出，A网可容纳的主机最多，网络最少，最多可建255个网络；192.168.1.1/16，这个表示这个是B网，因为一个ip有32节，每一节有8位数，所以16表示前面的16位是网络号（192.168），后面的16是主机号（1.1），从这里可以看出，B网可容纳的主机比A网的少，B网的主机有255<em>255台，网络数比A网多，可建255</em>255台主机；192.168.1.1/24，这个表示这个是C网，因为一个ip有32节，每一节有8位数，所以24表示前面的24位是网络号（192.168.1），后面的8位是主机号（1），最多可容纳255台主机，从这里可以看出，C网可容纳的主机比B网的少，网络数比B网多，可以包含255<em>255</em>255台主机；</p>
<p>ip的个数是有限的，再则还有一些私有地址：</p>
<pre><code>A网的私有地址：127.0.0.1

B网的私有地址：172.16.0.0--172.31.255.255

C网的私有地址：192.168.0.0-192.168.255.255</code></pre>
<p><img src="http://i.imgur.com/855CXjT.jpg"></p>
<p>我们可能会想，我们的IP后面没有这个/8或者是/24，如何知道是什么网络呢？这里我们必须说的是子网掩码255.255.255.0这个表示的是前面24位为网络号，如果是255.255.0.0，那么表示前面的16位为网络号，就是通过子网掩码来表示是什么网络的，这里我们需要做一个说明，子网掩码的二进制表示法：11111111.11111111.11111001.00000000，子网掩码的规则是，前面必须全部为1，且不能中断，直到中断的地方为止，后面的表示主机号，面的表示网络号，所以根据计算1<em>（2^7）+1</em>（2^6）+1<em>（2^5）+1</em>（2^4）+1<em>（2^3）+0</em>（2^2）+0*（2^1）+1（2^0）=249，那么这个子网掩码为：255.255.249.0，有的时候我们可能会发现有255.255.250.0这种子网掩码，就是这个原因，但是一般情况下都是255.255.255.0</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2017/05/05/VMware%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B%E7%9A%84%E8%BE%9B%E9%85%B8%E7%BB%8F%E5%8E%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/05/05/VMware%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B%E7%9A%84%E8%BE%9B%E9%85%B8%E7%BB%8F%E5%8E%86/" class="post-title-link" itemprop="url">VMware安装过程的辛酸经历</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-05-05 12:45:20" itemprop="dateCreated datePublished" datetime="2017-05-05T12:45:20+08:00">2017-05-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:16" itemprop="dateModified" datetime="2020-10-11T11:53:16+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>虚拟机安装教程：<a target="_blank" rel="noopener" href="http://qbview.url.cn/getResourceInfo?appid=31&url=http://www.2cto.com/os/201109/102806.html?nsukey=sLDV0cC6jZ%252FbtdEenV87LPetCVZhEhbmH2BFC53hPcGHW99c6IxqxF%252BeYqjd6XvfFY6UT8wUWu5Br7wFs6xDmR6FehUfQj463Z17qYuA9PDVL7154vi2CRnC2JrwWTV76KGDtquPi3YxV3S%252FL0iHX6nSaczyVdMHsYWoVaVSL5RJE1SBPzdm6ybyWXhgb6M3&version=10000&doview=1&ua=Mozilla/5.0+(Windows+NT+6.1;+WOW64;+rv:53.0)+Gecko/20100101+Firefox/53.0&keeplink=0&reformat=0">http://qbview.url.cn/getResourceInfo?appid=31&amp;url=http%3A%2F%2Fwww.2cto.com%2Fos%2F201109%2F102806.html%3Fnsukey%3DsLDV0cC6jZ%252FbtdEenV87LPetCVZhEhbmH2BFC53hPcGHW99c6IxqxF%252BeYqjd6XvfFY6UT8wUWu5Br7wFs6xDmR6FehUfQj463Z17qYuA9PDVL7154vi2CRnC2JrwWTV76KGDtquPi3YxV3S%252FL0iHX6nSaczyVdMHsYWoVaVSL5RJE1SBPzdm6ybyWXhgb6M3&amp;version=10000&amp;doview=1&amp;ua=Mozilla%2F5.0+(Windows+NT+6.1%3B+WOW64%3B+rv%3A53.0)+Gecko%2F20100101+Firefox%2F53.0&amp;keeplink=0&amp;reformat=0</a></p>
<p>根据教程走，我想应该是没啥问题的，可是即使这样，很多东西可能决定了，跟着教程走，还要去经历一场虐心之旅。从我开始把硬件虚拟化的辛酸经历作为开始吧。</p>
<p>最开始由于家里台式机配置不够高，都已经8年了，所以这让我走了很多不该走的路，当时的VMware都已经到了6.5版了，很多都没有32位的了，为了迎合这台电脑的配置，硬是花了一整天时间找这个软件，找了很久，fuck!</p>
<p>后来安装一看，卧槽，没有网络适配器，就是这个软件里面没有网卡驱动，所以又去找个网卡，把这个.vib文件写入这个软件里面，具体怎么写，这里有个<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1bpgq2x5">教程</a> 密码：rkq8，用了一个叫做定制iso的软件，<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1geUDa9d">ESXi5-CPT-v2.2.1-ESXi-Customizer-v2.7.2</a>，提取密码：773n，后来发现，安装到存储虚拟机位置的那一步的时候死活都显示不了宿主机磁盘，就是没法读取，只显示了一个安装虚拟机的那个U盘，当然，如果这个U盘空间足够大的话当然是可以用来存放虚拟机，但是我觉得不太可行，我们当时也想过这样的方法，就是再插一个空间大点的U盘，用来装这个虚拟机系统，为上面的服务提供磁盘空间。毕竟这个还是不是最靠谱的方法，我们就在想，如果让他能够读取本地磁盘，或者是说是什么原因让本地磁盘没法被读取，我们想到了磁盘驱动，后来我们下载了一个磁盘驱动，通过定制软件，把这个驱动程序定制到了那个已经定制了网卡驱动的iso文件上去，这样这个虚拟机安装包就具备了网卡驱动和磁盘驱动的两个驱动，后来问题终于解决了。</p>
<p>文件下载地址：<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1dEFNZxR">点击这里</a> 密码：tqnn</p>
<p>在安装虚拟机的时候遇到过很多的问题，虽然根据教程走很简单，你永远不知道在你的机器上会发生什么事，好的，我把我安装虚拟机的问题自己解决方案分享给大家</p>
<p>先去官网<a target="_blank" rel="noopener" href="http://www.vmware.com/cn.html%E4%B8%8B%E8%BD%BD%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%EF%BC%8C%E6%88%96%E8%80%85%E6%98%AF%E7%A8%B3%E5%AE%9A%E7%89%88%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%B2%A1%E9%94%99%E7%9A%84%E8%AF%9D%EF%BC%8C%E5%BA%94%E8%AF%A5%E6%98%AFiso%E6%96%87%E4%BB%B6%EF%BC%8C%E5%A5%BD%E4%BA%86%EF%BC%8C%E6%88%91%E8%A6%81%E5%81%9A%E7%9A%84%E6%98%AF%E6%8A%8A%E7%A1%AC%E4%BB%B6%E8%99%9A%E6%8B%9F%E5%8C%96%E7%9A%84%E4%B8%80%E4%B8%AA%E5%AE%9E%E9%AA%8C(%E5%B0%B1%E6%98%AF%E6%8A%8A%E4%B8%80%E5%8F%B0%E7%94%B5%E8%84%91%E5%BD%93%E5%81%9A%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9D%A5%E7%94%A8%EF%BC%8C%E4%B8%BA%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%85%85%E5%BD%93%E7%A1%AC%E4%BB%B6%E8%AE%BE%E6%96%BD)%EF%BC%8C%E6%9C%80%E5%BC%80%E5%A7%8B%E6%88%91%E7%9A%84%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%9C%89%E7%82%B9%E5%8F%A4%E8%80%81%EF%BC%8C%E6%9F%A5%E4%BA%86%E4%B8%8BCPU%E5%8E%9F%E6%9D%A5%E6%98%AF32%E4%BD%8D%E7%9A%84%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%B8%8B%E8%BD%BD%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%89%88%E6%9C%AC%E6%9C%89%E7%82%B9%E9%AB%98%EF%BC%8CVMware">http://www.vmware.com/cn.html下载最新版本，或者是稳定版，如果没错的话，应该是iso文件，好了，我要做的是把硬件虚拟化的一个实验(就是把一台电脑当做服务器来用，为虚拟机充当硬件设施)，最开始我的台式机有点古老，查了下CPU原来是32位的，所以我下载的虚拟机版本有点高，VMware</a> vSphere Hypervisor 6.0版本的，后来查了下，3.5版本的虚拟机可以支持32位的CPU，所以去官网找了下，很遗憾官网已经没有了，后来辗转反侧，来到了这么一个网站，看了下这几年貌似有，如果想要，可以在我的云盘这里<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1eSDurSI">下载</a>，密码：2px8，如果准备好的话就可以把这个ISO文件刻录在CD里或者是读取到U盘里面，方便系统启动的时候，直接安装这个虚拟机，CD刻录的话很简单，直接去买一个空白的CD就行了，右键这个ISO文件，选择打开方式为“Windows刻录”，这里我主要讲一下U盘的方式。 </p>
<p>我这里用U深度来进行读取ISO文件，U深度下载地址为:<a href="http://www.ushendu.com，如果直接制作成一个U深度救急盘的话，直接用智能模式就行，截图如下：">http://www.ushendu.com，如果直接制作成一个U深度救急盘的话，直接用智能模式就行，截图如下：</a></p>
<p><img src="http://i.imgur.com/EPipuqi.jpg"></p>
<p>如果做成一个具有其他个性化功能，比如一个系统，一个虚拟机等等，那么可以通过另外的方式，看截图：</p>
<p><img src="http://i.imgur.com/HdKrNZC.jpg"></p>
<p>教程看官网，做成的这个东西主要用来防止电脑不能显示桌面了，可以通过这个U盘通过进入PE系统(这是微软的一个小型操作系统)，可以看得到机器里面磁盘分区里的文件，然后用可移动盘把主机里的文件拷贝出来，挽救数据丢失，而且通过这个U救急盘可以格式化主机的任何盘，包括系统盘，格式化磁盘后要重新分区就行，分成单个盘就行，这样磁盘就被格式化了，有的时候，U盘装了虚拟机的文件的时候，在电脑上是没法被读取的，这个时候我们可能觉得这个u盘坏了，这个时候我们就可以启动这个微型系统来读取这种U盘，然后格式化，重新分区，这样这个U盘就又恢复到一个干干净净的状态了，具体看截图：</p>
<p>进入引导修复</p>
<p><img src="http://i.imgur.com/cM1Bghv.jpg"></p>
<p>选择插入的U盘，这个能够被读取就，选中分区管理，选中它：</p>
<p><img src="http://i.imgur.com/IF2Dxlq.jpg"></p>
<p>格式化目标磁盘，这里指U盘：</p>
<p><img src="http://i.imgur.com/XrELxoL.jpg"></p>
<p>格式化完毕之后，选择重新分区，不重新分区磁盘的空间是没法读取的</p>
<p><img src="http://i.imgur.com/CnoeZi4.jpg"></p>
<p>如果是一个U盘的话，那么选择单分区就好了，如果是一个移动硬盘，想要多个分区，这里可以选择多分区，截图如下：</p>
<p><img src="http://i.imgur.com/Rbtxe5G.jpg"></p>
<p>完成之后，我们就看到一个可以读取的U盘了</p>
<p><img src="http://i.imgur.com/u0JXtdl.jpg"></p>
<p>其实这个里面还有很多的工具，用来检测和分区，数据恢复。</p>
<p>好了，我们来进入到虚拟机所在主机的BIOS系统里面去，因为我们把这台宿主机格式化干干净净了，什么也没有了，启动的时候我们要进入修改下启动方式，通过优先读取USB里面的内容，也就是先读取U盘里面的东西，通过这一段设定后，开机的时候引导系统就会自动先运行U盘里的内容，当我们把制作好的虚拟机iso的U盘插上宿主机的时候就运行安装虚拟机的程序</p>
<p>这个bios系统是一个开机引导系统，用来决定哪些运行，哪些不运行，哪些先运行，哪些后运行，所以这个系统会先于操作系统运行。</p>
<p>bios系统里面可以设置一些东西，具体的可以去看下bios里面的一些知识，这里我主要说几点，由于我用的宿主机笔记本是华硕的，所以我就以他们的bios系统为例，前面的那个Main不管，我们直接来到Advanced，截图如下：</p>
<p><img src="http://i.imgur.com/TkwdhnM.jpg"></p>
<p>禁用Power off Energy Saving此项，关闭电源节能，否则会ping不通，这个问题困扰了我很久，切记！情况是这样的，当我按照教程走到最后一步的时候，发现连不上，测试虚拟机也不行，ping不同网关，ping不同客户机（同一网络中的客户机），找了很多原因，最开始是直接把Wake On Lid Open这个也关了，问题依然存在，后来就把Wake On Lid Open启动，发现问题搞定了，这个可是花了很长时间才搞定的，切记！</p>
<p>这里我们还要说的是我们在读取iso文件的时候需要注意，iso文件不能直接被复制粘贴到U盘里去，必须通过一些工具写进去，前面讲的U救急盘就是其中一种方法，然而，对于FreeBSD是不能通过U救急盘读取的，它需要一个工具去读取，这个工具是<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1skGLzbB">Win32DiskImager</a>，密码：7am2，解压运行就行了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2017/04/18/wordpress%E5%A4%9A%E7%AB%99%E7%82%B9%E5%85%B1%E4%BA%AB%E5%90%8C%E4%B8%80%E4%B8%BB%E9%A2%98%E7%9A%84%E4%B8%AA%E6%80%A7%E5%8C%96%E5%BC%80%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/18/wordpress%E5%A4%9A%E7%AB%99%E7%82%B9%E5%85%B1%E4%BA%AB%E5%90%8C%E4%B8%80%E4%B8%BB%E9%A2%98%E7%9A%84%E4%B8%AA%E6%80%A7%E5%8C%96%E5%BC%80%E5%8F%91/" class="post-title-link" itemprop="url">wordpress多站点共享同一主题的个性化开发</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-18 22:09:23" itemprop="dateCreated datePublished" datetime="2017-04-18T22:09:23+08:00">2017-04-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:12" itemprop="dateModified" datetime="2020-10-11T11:53:12+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>很多朋友可能在开发wordpress的时候，多个站点共用同一个主题，如果哪天某个站点需要修改源代码才能解决某个需求，那么其他的站点也会受到影响，那么我们该怎么办呢？看下面一个场景：</p>
<p>首先我们需要建一个子主题，步骤如下：</p>
<p>在wordpress主题目录下新建一个文件夹，比如主题名字为apicona，那么子主题我们可以给他取个名字apicona-child（这个名字可以随便取）,然后复制父主题里的几个文件，截图如下：</p>
<p><img src="http://i.imgur.com/nekd3Sa.png"></p>
<p>functions.php继承父文件，里面可以写东西，也可以什么也不写，如果在子站点里添加额外的功能，就可以在里面写东西，这个不再细说。style.css文件里面的文件内容最终要的如下：</p>
<pre><code>/*

Theme Name:  Apicona child

Description: Child theme for the Apicona theme

Author:      Theme Mount

Author URI:  http://themeforest.net/user/thememount

Template:    apicona

Version:     0.1.1

Tags:        light, white, two-columns, three-columns, four-columns, right-sidebar, left-sidebar, responsive, retina

*/


/* =Parent theme style.css file

-------------------------------------------------------------- */

@import url(&quot;../apicona/style.css&quot;);


/* =Theme customization starts here

-------------------------------------------------------------- */</code></pre>
<p>具体的解释可以参考我的这篇文章：<a target="_blank" rel="noopener" href="http://helongquan.github.io/2017/04/06/%E4%BD%BF%E7%94%A8-WordPress-%E7%9A%84%E5%AD%90%E4%B8%BB%E9%A2%98%EF%BC%88Child-Themes%EF%BC%89%E5%8A%9F%E8%83%BD%E5%BF%AB%E9%80%9F%E5%88%B6%E4%BD%9C%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%BB%E9%A2%98/">使用 WordPress 的子主题（Child Themes）功能快速制作自己的主题</a></p>
<p>当你看完这篇文章后，就明白建立子主题的方法了，好了这里我想要修改一下搜索结构页面的显示的问题，那该怎么办呢？难不成我还要找到search.php这个文件和category.php这个文件（这里是我在做一个搜索过滤的问题中碰到的问题，所以就以这两个文件为例），肯定不是，因为这个模板文件是多个网站共同使用的，我一旦修改了，其他网站的搜索显示页就会收到影响，好！我们从父主题那里复制这两个文件，放在apicona-child这个文件夹下，记住！文件的相对目录一定要跟父主题的一致，由于这两个文件跟style.css在同一个目录下，所以直接在这个目录下新建这两个文件即可。然后再根据问题的需求进行修改，修改完了后，我们刷新下网站，我们会发现只有启用该子主题的网站的这两个页面有影响，其他网站没啥问题。</p>
<p>这里我晒一下战果。</p>
<p>这是搜索后显示的效果，原生的可能不是这样显示的。</p>
<p><img src="http://i.imgur.com/SZGO7xl.png"></p>
<p>这是分类搜索修改后的效果，客户要求这样的</p>
<p><img src="http://i.imgur.com/x5cSMpg.png"></p>
<p>我的目标就是：左边是缩略图，右边是名字，右下方是摘要，因此可以去<a target="_blank" rel="noopener" href="https://developer.wordpress.org/reference/">wordpress函数查询</a>网获取函数使用方法即可，代码可以简单的贴一下：</p>
<pre><code>&#125; else &#123;
    // Post list view
    if ( has_post_thumbnail( get_the_ID() ) ) &#123;
        $featuredImage = get_the_post_thumbnail(get_the_ID(), &#39;thumbnail&#39; );
    &#125; else &#123;
        $featuredImage = &#39;&lt;img style=&quot;width:150px;height:200px&quot; src=&quot;&#39;.get_template_directory_uri().&#39;/images/noimage-150x150.png&quot; /&gt;&#39;;
    &#125;
    $postList .= &#39;
    &lt;div class=&quot;row bbsda&quot;&gt;
        &lt;div class=&quot;col-xs-4 col-sm-3 col-md-3 col-lg-3 mmpw&quot;&gt;&lt;a href=&quot;&#39;.get_permalink().&#39;&quot;&gt;&#39;.$featuredImage.&#39;&lt;/a&gt;&lt;/div&gt;
        &lt;div class=&quot;col-xs-8 col-sm-9 col-md-9 col-lg-9 mif&quot;&gt;&lt;h3&gt;&lt;a href=&quot;&#39;.get_permalink().&#39;&quot;&gt;&#39;.get_the_title().&#39;&lt;/a&gt;&lt;/h3&gt;
        &lt;span class=&quot;post-date&quot;&gt;&#39;.get_the_excerpt().&#39;&lt;/span&gt;&lt;/div&gt;
    &lt;/div&gt;&#39;;
&#125;
&#125;
$postListCount++;

&#125; else if( get_post_type() == &#39;portfolio&#39; )&#123;</code></pre>
<p>好了，今天说到这里。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2017/04/15/Javascript%E8%8E%B7%E5%8F%96%E9%A1%B5%E9%9D%A2%E7%9A%84%E6%A0%87%E9%A2%98-title/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/15/Javascript%E8%8E%B7%E5%8F%96%E9%A1%B5%E9%9D%A2%E7%9A%84%E6%A0%87%E9%A2%98-title/" class="post-title-link" itemprop="url">Javascript获取页面的标题(title)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-15 15:25:27" itemprop="dateCreated datePublished" datetime="2017-04-15T15:25:27+08:00">2017-04-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:31" itemprop="dateModified" datetime="2020-10-11T11:53:31+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>页面标题的获取可能会有多种方法，今天主要讲的是通过javasript的方式进行获取，完整代码如下：</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, maximum-scale=1&quot; /&gt;
    &lt;title&gt;最新资讯&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;../css/bootstrap.min.css&quot;&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;../js/jquery-2.1.1.min.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;../js/bootstrap.min.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;../js/inc.js&quot;&gt;&lt;/script&gt;
    &lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot;js/custom.js&quot;&gt;&lt;/script&gt; --&gt;
    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;../css/custom.css&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;../css/style.css&quot;&gt;
    &lt;style type=&quot;text/css&quot;&gt;
        .meeps&#123;
            /*width:200px;*/
            white-space:nowrap;
            overflow:hidden;
            text-overflow:ellipsis;
        &#125;
        .awesome img&#123;
            display: block;
            margin:5px auto;
            width: 100%;
        &#125;
    &lt;/style&gt;
    &lt;script type=&quot;text/javascript&quot;&gt;
        function sbb()&#123;
        obj = $.ajax(&#123;
            url: &#39;test.json&#39;,
            type: &#39;get&#39;,
            dataType: &#39;json&#39;,
            contentType : &quot;application/json&quot;,
            data : null,
            success: function (user) &#123;
                //字符串拼接
                var htmlNodes = &#39;&#39;;
                for(var i = 0; i &lt; user.length; i ++)&#123;
                  var weer=&#39;&lt;div class=&quot;col-xs-12 col-sm-12 col-md-12 col-lg-12 meeps&quot;&gt;&lt;a href=&quot;&#39;+user[i].title.rendered+&#39;&quot;&gt;&#39;+user[i].title.rendered+&#39;&lt;/a&gt;&lt;/div&gt;&lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;&#39;;
                htmlNodes += &#39;&lt;div class=&quot;row amew&quot;&gt;&#39;+weer+&#39;&lt;/div&gt;&#39;;
                &#125;

                $(&#39;#bbs&#39;).append(htmlNodes);
            &#125;
        &#125;);
        console.log(obj);
        return obj;
        &#125;
    &lt;/script&gt;
&lt;/head&gt;
&lt;body onload=&quot;sbb();&quot;&gt;
    &lt;div id=&quot;page_title&quot; class=&quot;row&quot;&gt;
    &lt;!-- 此处显示页面标题 --&gt;
        &lt;script type=&quot;text/javascript&quot;&gt;
            document.write(&quot;&lt;h3 class=&#39;center&#39;&gt;&quot;+document.title+&quot;&lt;/h3&gt;&quot;);
        &lt;/script&gt;
        &lt;!-- end --&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-xs-12 col-sm-12 col-md-12 col-lg-12 header maw&quot; id=&quot;school_detail&quot;&gt;
                &lt;div class=&quot;col-xs-12 col-sm-12 col-md-12 col-lg-12 center awesome&quot;&gt;
                    &lt;img src=&quot;image/dingqilawyer.jpg&quot;&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;

    &lt;/div&gt;
    &lt;div class=&quot;row&quot; id=&quot;kemu&quot;&gt;
    &lt;/div&gt;
    &lt;div id=&quot;bbs&quot;&gt;&lt;/div&gt;

&lt;div id=&quot;footer&quot;&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>截图如下：</p>
<p><img src="http://i.imgur.com/QPCSqVx.png"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2017/04/06/%E4%BD%BF%E7%94%A8-WordPress-%E7%9A%84%E5%AD%90%E4%B8%BB%E9%A2%98%EF%BC%88Child-Themes%EF%BC%89%E5%8A%9F%E8%83%BD%E5%BF%AB%E9%80%9F%E5%88%B6%E4%BD%9C%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%BB%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/06/%E4%BD%BF%E7%94%A8-WordPress-%E7%9A%84%E5%AD%90%E4%B8%BB%E9%A2%98%EF%BC%88Child-Themes%EF%BC%89%E5%8A%9F%E8%83%BD%E5%BF%AB%E9%80%9F%E5%88%B6%E4%BD%9C%E8%87%AA%E5%B7%B1%E7%9A%84%E4%B8%BB%E9%A2%98/" class="post-title-link" itemprop="url">使用 WordPress 的子主题（Child Themes）功能快速制作自己的主题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-06 10:56:01" itemprop="dateCreated datePublished" datetime="2017-04-06T10:56:01+08:00">2017-04-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:52:57" itemprop="dateModified" datetime="2020-10-11T11:52:57+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>使用子主题，可以继承父主题的所有功能，同时避免因为直接使用父主题在父主题升级时造成文件丢失的情况。</p>
<p>子主题的创建很简单：</p>
<p>1、首先在主题文件夹下(wp-content\themes)建立一个文件夹，用来存放子主题的所有文件，例如：apicona-child。</p>
<p>2、在apicona-child文件夹下新建一个style.css文件，该文件是必须的。将以下代码粘贴进去：</p>
<pre><code>/*
Theme Name:  Apicona Child（子主题名称，必须）
Description: Child theme for the Apicona theme（主题描述）
Author:      Theme Mount（主题作者）
Author URI:  http://themeforest.net/user/thememount（作者uri）
Template:    apicona（父主题目录名称，必须）
Version:     0.1.0
Tags:        light, white, two-columns, three-columns, four-columns, right-sidebar, left-sidebar, responsive, retina
*/


/* =Parent theme style.css file
-------------------------------------------------------------- */
@import url(&quot;../apicona/style.css&quot;);


/* =Theme customization starts here
-------------------------------------------------------------- */</code></pre>
<p>括号的字要去掉，此时就可以在后台-外观-主题中激活该子主题。</p>
<p><strong>3、自定义css</strong></p>
<p>子主题不会继承父主题的css样式，也就是说外观布局要重新定义，你可以在style.css文件中自定义，也可以使用@import直接调用父主题的样式，然后再进行修改，示例代码：上面的</p>
<pre><code>@import url(&quot;../apicona/style.css&quot;);

自定义样式，写在下面这里，不能写在导入的前面，防止被覆盖了。
a&#123;
color:red;
&#125;</code></pre>
<p>这个就是直接导入父主题的样式文件。</p>
<p><strong>4、编辑functions.php文件</strong></p>
<p>functions.php文件是用来保存主题的一系列功能函数，建立子主题后，父主题的功能函数会自动调用。如果你需要额外增加函数，则在apicona-child下新建一个functions.php文件，例：在底部添加版权文本</p>
<pre><code>&lt;?php
add_action( &#39;apicona_credits&#39;, &#39;my_credits&#39; );
function my_credits()&#123;
    echo &#39;&lt;span&gt;©2017 **wp All rights reserved.&lt;/span&gt; &#39;;
&#125;
?&gt;</code></pre>
<p>这个function.php里面的东西跟父主题里的function.php不一样，也可以一样，就是不会覆盖父主题的function.php，而是一种扩展，可以这么理解。</p>
<blockquote>
<p>注意：functions.php文件中的代码不会替换父主题的，它是额外增加进去。</p>
</blockquote>
<p><strong>5、编辑其它文件</strong></p>
<p>在子主题中，除functions.php文件外，其它文件都是完全替换父主题的同名文件。例如你要重新修改footer.php文件，则在apicona-child中新建该文件，将父主题该文件的代码粘贴进去再进行修改。</p>
<p><strong>要点：</strong></p>
<p>1、只需建立一个style.css文件就可以创建一个子主题；</p>
<p>2、使用hook API在functions.php中添加额外的主题功能；</p>
<p>3、要修改哪个文件就在子主题文件夹下建立它的同名文件。</p>
<p>4、父主题的升级不会影响到子主题的文件。</p>
<p>下面给一个案例吧，我要在woocommerce里添加一些自定义送货区域，该怎么写呢？</p>
<p>第一步：新建子主题，我把它命名为apicona-child文件夹</p>
<p>第二步，新建style.css文件，里面的内容：</p>
<pre><code>/*
Theme Name:  Apicona Child
Description: Child theme for the Apicona theme
Author:      Theme Mount
Author URI:  http://themeforest.net/user/thememount
Template:    apicona
Version:     0.1.0
Tags:        light, white, two-columns, three-columns, four-columns, right-sidebar, left-sidebar, responsive, retina
*/


/* =Parent theme style.css file
-------------------------------------------------------------- */
@import url(&quot;../apicona/style.css&quot;);


/* =Theme customization starts here
-------------------------------------------------------------- */</code></pre>
<p>里面已经修改完毕了。</p>
<p>第三步，新建一个function.php文件，里面的内容为：</p>
<pre><code>&lt;?php
/*
 * Custom PHP code for child theme will be here
 */
/**
 * Code goes in functions.php or a custom plugin. Replace XX with the country code your changing.
 */
add_filter( &#39;woocommerce_states&#39;, &#39;custom_woocommerce_states&#39; );

function custom_woocommerce_states( $states ) &#123;

  $states[&#39;HK&#39;] = array(
    &#39;HK1&#39; =&gt; &#39;葵涌&#39;, 
    &#39;HK2&#39; =&gt; &#39;荃灣 &#39;, 
    &#39;HK3&#39; =&gt; &#39;荔枝角&#39;,
    &#39;HK4&#39; =&gt; &#39;九龍區&#39;,
    &#39;HK5&#39; =&gt; &#39;香港區&#39;,
    &#39;HK6&#39; =&gt; &#39;半山&#39;,
    &#39;HK7&#39; =&gt; &#39;沙田&#39;,
    &#39;HK8&#39; =&gt; &#39;元朗&#39;,
    &#39;HK9&#39; =&gt; &#39;新大埔&#39;,
    &#39;HK10&#39; =&gt; &#39;東涌&#39;,
  );

  return $states;
&#125;</code></pre>
<p>通过添加一个hook函数，添加额外的功能，主要是为了在woocommerce里面添加一个这样的功能。</p>
<p>第四步，这个可以不用，这一步就是添加其他的样式，我把它命名为style.min.css，新建在apicona-child这个文件夹下。这个文件必须是父主题里的跟目录下有的文件名，这样可以直接被引用，而不用担心主题里没有应用这个文件，最妥当的做法就是复制父主题里面的一个样式文件，然后把里面的东西删除，然后导入父主题里的其他样式文件。这里我的这个文件里的内容是：</p>
<pre><code>@import url(&quot;../apicona/style.min.css&quot;);</code></pre>
<p>其实，我们完全可以把这个写在style.css这个文件里。</p>
<p>最后，我们得从父主题里把那个screenshot.png的图片也复制过来。搞定！</p>
<p>如果是多站点的网站，可以在管理网络里面启动这个子主题。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2017/04/05/WooCommerce%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%93%E8%B4%A6%E5%AD%97%E6%AE%B5%E5%9B%BE%E6%96%87%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/05/WooCommerce%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%93%E8%B4%A6%E5%AD%97%E6%AE%B5%E5%9B%BE%E6%96%87%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">WooCommerce添加自定义结账字段图文详解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-05 12:56:24" itemprop="dateCreated datePublished" datetime="2017-04-05T12:56:24+08:00">2017-04-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:15" itemprop="dateModified" datetime="2020-10-11T11:53:15+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>向WooCommerce的结账表单添加自定义字段，可以使用插件WooCommerce checkout manager或者filter:woocommerce_checkout_fields，本文介绍的方法非上述两种，而是使用woocommerce_form_field()函数在订单备注之后添加自定义字段，并将字段显示在订单详情、订单邮件和后台中的方法</p>
<p>代码测试环境和使用方法</p>
<p>WordPress 3.9.1 + WooCommerce 2.1.2 + 主题Twentytwelve</p>
<p>所有代码放在主题的functions.php中执行，每段代码后面的图片为改代码的执行效果。</p>
<p>本文原代码下载<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1ceoPmm">WooCommerce添加自定义结账字段源代码</a></p>
<h2 id="代码段1-–-在订单备注后添加自定义选项"><a href="#代码段1-–-在订单备注后添加自定义选项" class="headerlink" title="代码段1 – 在订单备注后添加自定义选项"></a>代码段1 – 在订单备注后添加自定义选项</h2><p>注意在最开头输出了带有my_custom_section class的div，可以用该class修改这个区域的样式，突出该区域。</p>
<pre><code>/**
 * 代码段1 - 在订单备注后添加自定义选项
 */
function my_custom_checkout_section( $checkout )&#123;
    // $checkout stores all checkout fields

    // Section starts, output wrapper or header
    echo &#39;&lt;div class=&quot;my_custom_section&quot;&gt;&#39;;

    // Create a select field
    $options = array(
        &#39;只工作日送货&#39; =&gt; &#39;只工作日送货&#39;,
        &#39;只双休日送&#39; =&gt; &#39;只双休日送货&#39;,
        &#39;工作日、双休日均可送货&#39; =&gt; &#39;工作日、双休日均可送货&#39;
    );
    woocommerce_form_field(&quot;my_custom_field_1&quot;, array(
        &#39;type&#39;     =&gt; &#39;select&#39;,
        &#39;class&#39;    =&gt; array(&#39;form-row-wide my_custom_field&#39;),
        &#39;label&#39;    =&gt; &#39;送货时间: &#39;,
        &#39;options&#39;  =&gt; array( &#39;&#39; =&gt; &#39;-----选择送货时间-----&#39;) + $options,
        &#39;required&#39; =&gt; true
    ), $checkout-&gt;get_value( &#39;my_custom_field_1&#39; ) );

    echo &#39;&lt;/div&gt;&#39;;
&#125;
add_action( &#39;woocommerce_after_order_notes&#39;, &#39;my_custom_checkout_section&#39; );</code></pre>
<p><img src="http://i.imgur.com/Kwm0rza.png"></p>
<p>在订单备注后面添加送货时间字段</p>
<h2 id="代码段2-–-验证自定义字段"><a href="#代码段2-–-验证自定义字段" class="headerlink" title="代码段2 – 验证自定义字段"></a>代码段2 – 验证自定义字段</h2><p>虽然第一步中强调了required=true，但只是改变了长相，真正的验证还得自己来。这里只验证是否有值。</p>
<pre><code>/**
 * 代码段2 - 验证自定义字段
 *
 * required=true只改变了长相，验证还得自己写代码
 */
function my_custom_checkout_field_process()&#123;
    global $woocommerce;
 
    if( empty($_POST[&#39;my_custom_field_1&#39;]) )
        $woocommerce-&gt;add_error( &#39;&lt;strong&gt;请选择送货时间&lt;/strong&gt;&#39; );
&#125;
add_action(&#39;woocommerce_checkout_process&#39;, &#39;my_custom_checkout_field_process&#39; );</code></pre>
<p><img src="http://i.imgur.com/mZi8Wrb.png"></p>
<p>验证送货时间是否选择，如果没选，提交订单时会有错误提示</p>
<h2 id="代码段3-–-存储自定义字段的值"><a href="#代码段3-–-存储自定义字段的值" class="headerlink" title="代码段3 – 存储自定义字段的值"></a>代码段3 – 存储自定义字段的值</h2><p>用户选择后还要把值存到订单中方便以后查询。order的本质是post，所以order meta就是post meta，用update_post_meta存储，用get_post_meta查询。</p>
<pre><code>/**
 * 代码段3 - 存储自定义字段的值
 *
 * 如果和用户属性相关，存到usermeta表里，否则存在order meta（postmeta）里即可
 */
function my_custom_checkout_field_save( $order_id )&#123;
    // custom field名称，最前面的下划线的作用是使该custom field在后台不可见，必须通过自定义程序显示
    $ordermeta_name = &#39;_my_custom_field_1&#39;;
    // 将送货时间存到订单的custom field里
    if( !empty($_POST[&#39;my_custom_field_1&#39;] ) )
        update_post_meta( $order_id, $ordermeta_name, wc_clean( $_POST[&#39;my_custom_field_1&#39;] ) );
&#125;
add_action(&#39;woocommerce_checkout_update_order_meta&#39;, &#39;my_custom_checkout_field_save&#39; );</code></pre>
<h2 id="代码段4-1-4-3-–-在成功下单页面不同位置显示自定义值"><a href="#代码段4-1-4-3-–-在成功下单页面不同位置显示自定义值" class="headerlink" title="代码段4.1-4.3 – 在成功下单页面不同位置显示自定义值"></a>代码段4.1-4.3 – 在成功下单页面不同位置显示自定义值</h2><p>提供三个位置显示，一般只需要选择其中一个即可。</p>
<p>代码段4.1 – 在订单详情之后，customer details之前显示</p>
<pre><code>/**
 * 代码段4.1 - 在order-received页面显示自定义字段的值
 *
 * 在订单详情之后，customer details之前显示
 */
function my_custom_field_display_on_order_received( $order )&#123;
    $my_custom_field_1 = get_post_meta( $order-&gt;id, &#39;_my_custom_field_1&#39;, true );
    if( !empty($my_custom_field_1) )&#123;
        echo &#39;&lt;h2&gt;送货时间&lt;/h2&gt;&#39;;
        echo &#39;&lt;p&gt;&lt;strong&gt;送货时间:&lt;/strong&gt;&#39; .$my_custom_field_1. &#39;&lt;/p&gt;&#39;;
    &#125;
&#125;
add_action(&#39;woocommerce_order_details_after_order_table&#39;, &#39;my_custom_field_display_on_order_received&#39; );</code></pre>
<h2 id="代码段4-2-–-在产品列表后显示"><a href="#代码段4-2-–-在产品列表后显示" class="headerlink" title="代码段4.2 – 在产品列表后显示"></a>代码段4.2 – 在产品列表后显示</h2><pre><code>/**
 * 代码段4.2在产品列表后显示
 *
 * 在tbody内、产品列表后显示
 */
function my_custom_field_display_after_product_list( $order )&#123;
    $my_custom_field_1 = get_post_meta( $order-&gt;id, &#39;_my_custom_field_1&#39;, true );
    if( !empty($my_custom_field_1) )&#123;
        ?&gt;
        &lt;tr&gt;&lt;td&gt;送货时间&lt;/td&gt;&lt;td&gt;&lt;?php echo $my_custom_field_1; ?&gt;&lt;/td&gt;&lt;/tr&gt;
        &lt;?php
    &#125;
&#125;
add_action( &#39;woocommerce_order_items_table&#39;, &#39;my_custom_field_display_after_product_list&#39; );</code></pre>
<h2 id="代码段4-3-–-在配送方式前面显示"><a href="#代码段4-3-–-在配送方式前面显示" class="headerlink" title="代码段4.3 – 在配送方式前面显示"></a>代码段4.3 – 在配送方式前面显示</h2><pre><code>/**
 * 代码段4.3 - 在配送方式前面显示
 *
 * 在tfoot内、shipping方式前显示
 */
function my_custom_field_display_before_shipping( $total_rows, $order )&#123;

    $my_custom_field_1 = get_post_meta( $order-&gt;id, &#39;_my_custom_field_1&#39;, true );
    $new_total_rows = array();
    if( !empty($my_custom_field_1) )&#123;
        $new_row[&#39;my_custom_field_1&#39;] = array(
            &#39;label&#39; =&gt; &#39;送货时间:&#39;,
            &#39;value&#39; =&gt; $my_custom_field_1
        );

        // Insert $new_row after shipping field
        $total_rows = array_merge( array_splice( $total_rows,0,2), $new_row, $total_rows );
    &#125;
    return $total_rows;
&#125;
add_filter( &#39;woocommerce_get_order_item_totals&#39;, &#39;my_custom_field_display_before_shipping&#39;, 10, 2 );</code></pre>
<p><img src="http://i.imgur.com/yJOHIep.png"></p>
<p>在order-received页面的不同位置显示自定义字段</p>
<h2 id="代码段5-–-在订单邮件中显示"><a href="#代码段5-–-在订单邮件中显示" class="headerlink" title="代码段5 – 在订单邮件中显示"></a>代码段5 – 在订单邮件中显示</h2><p>若选择代码段4.2将字段加入订单详情页面，则字段也会自动加到邮件中，就不需要代码段5了。</p>
<pre><code>/**
 * 代码段5 - 在email中显示
 *
 * 在email的订单详情表格之后显示
 * 若使用woocommerce_get_order_item_totals添加字段，
 * 无需下面的代码，就可以在订单详情表格里显示
 *
 * $sent_to_admin - 为true表示该邮件发送给管理员
 */
function my_custom_field_order_email( $order, $sent_to_admin )&#123;

    $my_custom_field_1 = get_post_meta( $order-&gt;id, &#39;_my_custom_field_1&#39;, true );
    if( !empty($my_custom_field_1) )&#123;
        echo &#39;&lt;h3&gt;送货时间&lt;/h3&gt;&#39;;
        echo &quot;&lt;p&gt;送货时间: $my_custom_field_1 &lt;/p&gt;&quot;;

        if( $sent_to_admin ) &#123;
            echo &#39;这是发给管理员的通知邮件&#39;;
        &#125;
    &#125;
&#125;
add_action( &#39;woocommerce_email_after_order_table&#39;, &#39;my_custom_field_order_email&#39;, 10, 2 );</code></pre>
<p><img src="http://i.imgur.com/iPEkvAu.png"></p>
<p>将字段加到order email notification中</p>
<h2 id="代码段6-–-在后台订单详情中显示自定义字段"><a href="#代码段6-–-在后台订单详情中显示自定义字段" class="headerlink" title="代码段6 – 在后台订单详情中显示自定义字段"></a>代码段6 – 在后台订单详情中显示自定义字段</h2><pre><code>/**
 * 代码段6 - 在后台订单详情中显示自定义字段
 */
function my_custom_field_admin_info( $order )&#123;
    $my_custom_field_1 = get_post_meta( $order-&gt;id, &#39;_my_custom_field_1&#39;, true );
    if( !empty($my_custom_field_1) )&#123;  
        echo &#39;&lt;h4&gt;送货时间&lt;/h4&gt;&#39;;
        echo &quot;&lt;p&gt;$my_custom_field_1&lt;/p&gt;&quot;;      
    &#125;
&#125;
add_action( &#39;woocommerce_admin_order_data_after_shipping_address&#39;, &#39;my_custom_field_admin_info&#39; );</code></pre>
<p><img src="http://i.imgur.com/Cavi4Df.png"></p>
<p>将字段加到order email notification中</p>
<p>更多帮助信息，可以参考这个大神的，地址：<a target="_blank" rel="noopener" href="http://www.solagirl.net/woocommerce-custom-checkout-field.html">http://www.solagirl.net/woocommerce-custom-checkout-field.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2017/04/05/%E7%94%A8sublime-server-%E5%90%AF%E5%8A%A8%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E6%89%8B%E6%9C%BA%E8%AE%BF%E9%97%AE%E7%94%B5%E8%84%91%E9%A1%B5%E9%9D%A2%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/05/%E7%94%A8sublime-server-%E5%90%AF%E5%8A%A8%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E6%89%8B%E6%9C%BA%E8%AE%BF%E9%97%AE%E7%94%B5%E8%84%91%E9%A1%B5%E9%9D%A2%EF%BC%89/" class="post-title-link" itemprop="url">用sublime server 启动本地服务器（手机访问电脑页面）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-05 11:20:27" itemprop="dateCreated datePublished" datetime="2017-04-05T11:20:27+08:00">2017-04-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:52:51" itemprop="dateModified" datetime="2020-10-11T11:52:51+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="安装sublime-server-插件包"><a href="#安装sublime-server-插件包" class="headerlink" title="安装sublime server 插件包"></a>安装sublime server 插件包</h2><p><strong>命令形式安装</strong></p>
<p>1.Ctrl + shift + p </p>
<pre><code>install package

sublimeServer</code></pre>
<p>两条命令搞定</p>
<p><strong>通过git下载安装包的方式安装</strong></p>
<p>cd to your Sublime packages folder, don’t know where is it? Open Sublime and choose Preferences -&gt; Browser Packages, yeah, here is it!</p>
<p>$ git clone git://<a href="github.com/learning/SublimeServer.git">github.com/learning/SublimeServer.git</a></p>
<p>3.下载sublime server 插件包解压放在Open Sublime and choose Preferences -&gt; Browser Packages里面。</p>
<p>4.tool－sublimeServer－settings:</p>
<pre><code>可以修改端口（1000以下的端口号尽量不要用，需要root权限）</code></pre>
<p>5.tool－sublimeServer－start server：</p>
<pre><code>开启sublimeServer服务</code></pre>
<p>6.index.html右键  view in sublimeServer，即可在浏览器上看到效果。</p>
<p>7.复制地址到手机端，把localhost改成电脑IP即可（Mac查电脑IP：ifconfig | grep “inet “ | grep -v 127.0.0.1）</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2017/04/05/%E6%80%8E%E6%A0%B7%E8%AE%A9%E5%A4%A7%E6%AE%B5%E7%9A%84%E6%96%87%E6%9C%AC%EF%BC%8C%E5%90%8C%E6%97%B6%E5%9C%A8%E6%89%8B%E6%9C%BA%E5%92%8C%E7%94%B5%E8%84%91%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E9%83%BD%E4%BB%A5%E6%AF%94%E8%BE%83%E5%90%88%E9%80%82%E7%9A%84%E5%AD%97%E4%BD%93%E6%98%BE%E7%A4%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/05/%E6%80%8E%E6%A0%B7%E8%AE%A9%E5%A4%A7%E6%AE%B5%E7%9A%84%E6%96%87%E6%9C%AC%EF%BC%8C%E5%90%8C%E6%97%B6%E5%9C%A8%E6%89%8B%E6%9C%BA%E5%92%8C%E7%94%B5%E8%84%91%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E9%83%BD%E4%BB%A5%E6%AF%94%E8%BE%83%E5%90%88%E9%80%82%E7%9A%84%E5%AD%97%E4%BD%93%E6%98%BE%E7%A4%BA/" class="post-title-link" itemprop="url">怎样让大段的文本，同时在手机和电脑浏览器中都以比较合适的字体显示</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-05 11:16:59" itemprop="dateCreated datePublished" datetime="2017-04-05T11:16:59+08:00">2017-04-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:52:48" itemprop="dateModified" datetime="2020-10-11T11:52:48+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>解决方案：在你的页面中加入：</p>
<pre><code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, maximum-scale=1&quot; /&gt;</code></pre>
<p>viewport概念最初由苹果提出，并应用到Safari浏览器中，现在基本上所有的手机浏览器都支持这个属性了。content属性可以设置成多种值，对于你的页面需要如何设置，可以自己研究一下viewport这个概念。</p>
<p>添加后，就可以看到手机版字体跟PC版字体一致了，也不会点击手机屏幕页面自动放大。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2017/04/03/vue%E7%9A%84webpack%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/03/vue%E7%9A%84webpack%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">vue的webpack打包工具使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-03 20:42:55" itemprop="dateCreated datePublished" datetime="2017-04-03T20:42:55+08:00">2017-04-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:16" itemprop="dateModified" datetime="2020-10-11T11:53:16+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>视频地址推荐</p>
<p><a target="_blank" rel="noopener" href="https://www.chuanke.com/v7652624-216790-1382598.html">https://www.chuanke.com/v7652624-216790-1382598.html</a></p>
<p>这里提醒一下的是：我们在通过powershell的时候，需要sublime T3安装了<a target="_blank" rel="noopener" href="https://github.com/wbond/sublime_terminal">Terminal</a>这个插件，下载后放在sublime T3的Packages里面，Preferences—&gt;Browser Packages，这个时候选择某个文件夹右键，会出现Open Terminal Here,选中即可，当然，也可以直接在windows命令框中进入到项目所在的文件夹下，运行webpack这个命令，前提是先安装webpack，笔者曾经在这里运行出错过，因此这里特地详细的做了一个讲解。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2017/04/03/WordPress-Actions%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/04/03/WordPress-Actions%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F/" class="post-title-link" itemprop="url">WordPress Actions加载顺序</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-03 20:33:04" itemprop="dateCreated datePublished" datetime="2017-04-03T20:33:04+08:00">2017-04-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-11 11:53:14" itemprop="dateModified" datetime="2020-10-11T11:53:14+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>写WordPress代码时需要不停的与hooks（actions and filters）打交道，filter就像茶壶的过滤嘴，茶壶在哪它就在哪，顺序问题不那么重要。而action是一种行为，比如掀起壶盖和盖上壶盖之间就可以放一个action，在这个action里可以放茶叶，不掀起壶盖是不可以放茶叶的，所以actions执行的顺序很重要。</p>
<p><strong>WordPress中的actions</strong></p>
<p>actions可以理解为一组在系统加载到某一时刻要执行的functions集合，使用do_action()添加，例如我们经常用到的get_header()函数，是这样定义的</p>
<pre><code>function get_header( $name = null ) &#123;
    do_action( &#39;get_header&#39;, $name );

    $templates = array();
    if ( isset($name) )
        $templates[] = &quot;header-&#123;$name&#125;.php&quot;;

    $templates[] = &#39;header.php&#39;;

    // Backward compat code will be removed in a future release
    if (&#39;&#39; == locate_template($templates, true))
        load_template( ABSPATH . WPINC . &#39;/theme-compat/header.php&#39;);
&#125;</code></pre>
<p>函数第二行用do_action()注册了一个action，叫做get_header</p>
<pre><code>do_action( &#39;get_header&#39;, $name );</code></pre>
<p>如果我们在functions.php中或者插件中写</p>
<pre><code>add_action(&#39;get_header&#39;,&#39;my_fun&#39;)</code></pre>
<p>my_fun()这个函数就会在do_action的位置执行，而不是在functions.php运行的位置执行。</p>
<p><strong>Actions的执行顺序</strong></p>
<p>了解WordPress中actions的执行顺序，可以知晓在这个action执行时，是否已经具备某些资源，例如登陆用户信心、例如插件API等。</p>
<p>要了解Actions的执行顺序，可以安装一个开发人员的插件WordPress Hook Sniffer,该插件不仅能告知actions的加载顺序，还能知道当前页面add_action操作有哪些，remove_action操作有哪些，还有filters信息。</p>
<p>用这个插件查看了安装默认主题时action的执行顺序，捡了一些重要的记录下来，红色字体标记了一下比较重要的阶段。</p>
<pre><code>muplugins_loaded （最先加载的action）

registered_taxonomy

registered_post_type

(加载所有激活的插件的文件，这是插件代码被执行的位置)

plugins_loaded

sanitize_comment_cookies

setup_theme

(载入当前主题的functions.php，functions.php中没有用add_filter或add_action添加的函数在这里被执行)

after_setup_theme (这个钩子看着眼熟吧，默认主题开头就有)

auth_cookie_malformed

auth_cookie_valid

set_current_user (这里执行了wp_set_current_user()函数，全局变量$current_user产生)

init

widgets_init

register_sidebar

wp_register_sidebar_widget

wp_default_scripts

wp_default_styles

admin_bar_init

add_admin_bar_menus

wp_loaded

parse_request

send_headers

parse_query

pre_get_posts

posts_selection

wp

template_redirect

加载激活的主题的模板（例如index.php、page.php等）

get_header

wp_head

wp_enqueue_scripts

wp_print_styles

wp_print_scripts

wp_print_scripts

get_footer

wp_footer</code></pre>
<p>从上面的列表中可以看出一些问题：</p>
<p>插件文件比主题的functions.php加载更早</p>
<p>插件加载时，wp_set_current_user()尚未执行，因此在插件文件的body中无法直接获取用户信息</p>
<p>init和after_setup_theme的区别是，后者执行时尚未调用wp_set_current_user()，没有授权用户信息</p>
<p>加载主题模板文件发生在最后阶段，此阶段中不管是插件的代码还是functions.php中的代码都已执行，这样我们就不奇怪为什么在single.php中调用query_posts()会增加查询次数，query_posts()大约在pre_get_posts的位置就执行完了，等程序执行到single.php时，如果调用query_posts，只能推翻前面的结果重新查一遍。我们还能看出，避免这个问题的方法就是在functions.php中使用filters函数（posts_join, posts_groupby等）更改query_posts的查询参数，因为functions.php早于query_posts执行，方法可以参考《自定义WordPress查询的4种方法》中的第三种方法。</p>
<p><strong>理解万岁</strong></p>
<p>与其枯燥的去记忆什么时候该用哪个action，不如理解一下WordPress的启动过程，了解actions加载的顺序，记忆几个比较重要的过程，例如哪些actions发生在插件代码执行以后，哪些actions发生在functions.php加载以后。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/35/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/35/">35</a><span class="page-number current">36</span><a class="page-number" href="/page/37/">37</a><span class="space">&hellip;</span><a class="page-number" href="/page/43/">43</a><a class="extend next" rel="next" href="/page/37/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">424</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">400</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
